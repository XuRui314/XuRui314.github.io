<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Multimodal NER | XuRui-Blog</title><meta name="keywords" content="Python,Deep Learning"><meta name="author" content="zxr"><meta name="copyright" content="zxr"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Ê¶ÇËø∞&amp;ÂéüÊ®°Âûã ÂÜôÂú®ÂºÄÂßã  ËÆ∫Êñá‰ª£Á†Å‰ªìÂ∫ìÔºöhttps://github.com/softhuafei/Pytorch-implementation-for-OCSGA ÂÖ∂ÂÆûÊòØÂ∞ë‰∫Üobject_labelËøô‰∏™Êñá‰ª∂ÔºåÈúÄË¶ÅÁøªÂéÜÂè≤ËÆ∞ÂΩï‰∏ãËΩΩÔºåÊàë‰πü‰∏çÂà∞‰∏∫Âï•ÊääËøô‰∏™Âà†‰∫Ü„ÄÇ  ËøôÂ∫îËØ•ÊòØÊàëÁ¨¨‰∏ÄÊ¨°ÊîπËÆ∫Êñá‰ª£Á†ÅÔºåÂØπ‰∫éÊï¥‰ΩìÁöÑ‰ª£Á†ÅÊ°ÜÊû∂Âï•ÁöÑÂÖ∂ÂÆûÈÉΩ‰∏çÊòØÂæàÊ∏ÖÊ•öÔºåËøòÊúâÂÖ∑‰ΩìÁî®Âà∞ÁöÑ‰∏Ä‰∫õÊñπÊ≥ïÔºå‰πü‰∏çÊòØÁâπÂà´ÁÜüÔºåÊâÄ‰ª•Â∞±Êù•ËæπÂ≠¶ËæπÊîπÔºåÂÅö‰∏™ËÆ∞ÂΩï„ÄÇ">
<meta property="og:type" content="article">
<meta property="og:title" content="Multimodal NER">
<meta property="og:url" content="https://xurui314.github.io/2022/06/01/Multimodal-NER/index.html">
<meta property="og:site_name" content="XuRui-Blog">
<meta property="og:description" content="Ê¶ÇËø∞&amp;ÂéüÊ®°Âûã ÂÜôÂú®ÂºÄÂßã  ËÆ∫Êñá‰ª£Á†Å‰ªìÂ∫ìÔºöhttps://github.com/softhuafei/Pytorch-implementation-for-OCSGA ÂÖ∂ÂÆûÊòØÂ∞ë‰∫Üobject_labelËøô‰∏™Êñá‰ª∂ÔºåÈúÄË¶ÅÁøªÂéÜÂè≤ËÆ∞ÂΩï‰∏ãËΩΩÔºåÊàë‰πü‰∏çÂà∞‰∏∫Âï•ÊääËøô‰∏™Âà†‰∫Ü„ÄÇ  ËøôÂ∫îËØ•ÊòØÊàëÁ¨¨‰∏ÄÊ¨°ÊîπËÆ∫Êñá‰ª£Á†ÅÔºåÂØπ‰∫éÊï¥‰ΩìÁöÑ‰ª£Á†ÅÊ°ÜÊû∂Âï•ÁöÑÂÖ∂ÂÆûÈÉΩ‰∏çÊòØÂæàÊ∏ÖÊ•öÔºåËøòÊúâÂÖ∑‰ΩìÁî®Âà∞ÁöÑ‰∏Ä‰∫õÊñπÊ≥ïÔºå‰πü‰∏çÊòØÁâπÂà´ÁÜüÔºåÊâÄ‰ª•Â∞±Êù•ËæπÂ≠¶ËæπÊîπÔºåÂÅö‰∏™ËÆ∞ÂΩï„ÄÇ">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://s2.loli.net/2022/06/01/NGZoMHJQIyVS5Ab.png">
<meta property="article:published_time" content="2022-06-01T15:26:34.000Z">
<meta property="article:modified_time" content="2022-06-19T05:05:06.866Z">
<meta property="article:author" content="zxr">
<meta property="article:tag" content="Python">
<meta property="article:tag" content="Deep Learning">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s2.loli.net/2022/06/01/NGZoMHJQIyVS5Ab.png"><link rel="shortcut icon" href="https://i.loli.net/2021/07/27/lSHRJbx7dYwTk8f.jpg"><link rel="canonical" href="https://xurui314.github.io/2022/06/01/Multimodal-NER/"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Multimodal NER',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-06-19 13:05:06'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const fontSizeVal = saveToLocal.get('global-font-size')
    if (fontSizeVal !== undefined) {
      document.documentElement.style.setProperty('--global-font-size', fontSizeVal + 'px')
    }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    document.addEventListener('pjax:complete', detectApple)})(window)</script><link rel="stylesheet" href="/css/badge.css"><link rel="stylesheet" href="/css/modify.css"><link rel="stylesheet" href="/css/mouse.css"><link rel="stylesheet" href="/dist/APlayer.min.css"><link rel="stylesheet" href="/css/custom.css"><link rel="stylesheet" href="/css/bilibiliBanner.css" media="defer" onload="this.media='screen'"><!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-swiper/swiper/swiper.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-swiper/swiper/swiperstyle.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/hexo-electric-clock@1.0.6/clock.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-double-row-display@1.00/cardlistpost.min.css">
<style>#recent-posts > .recent-post-item >.recent-post-info > .article-meta-wrap > .tags:before {content:"\A";
  white-space: pre;}#recent-posts > .recent-post-item >.recent-post-info > .article-meta-wrap > .tags > .article-meta__separator{display:none}</style>
<link rel="stylesheet" href="https://unpkg.zhimg.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://unpkg.zhimg.com/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload="this.media='all'"><script async="" src="https://unpkg.zhimg.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.4.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://s2.loli.net/2021/12/08/yTYthVwXD4IPbJ9.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">72</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">34</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">16</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> ‰∏ªÈ°µüç≠</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Ê°£Ê°àüåä</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Ê†áÁ≠æüìë</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> ÂàÜÁ±ªüåà</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> Â•ΩÂ∫∑ÁöÑ‚ú®</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://ocw.mit.edu/"><i class="fa-fw fas fa-link"></i><span> Êù•Â≠¶È∫ªÂ≠¶</span></a></li><li><a class="site-page child" href="/bangumis/"><i class="fa-fw fas fa-video"></i><span> zxr„ÅÆËøΩÁï™ËÆ°Âàí</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=RyOyXsKuUgI"><i class="fa-fw fas fa-heart"></i><span> zxrÊúÄÁà±Êª¥upÂòâÂÄ©</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://oskarstalberg.com/game/planet/planet.html"><span> Planet</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> ÂèãÈìæüíï</span></a></div><div class="menus_item"><a class="site-page" href="https://xurui314.github.io/aboutme/"><span> AboutMeüèÇ</span></a></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://www.foreverblog.cn/go.html"><span> Ëô´Ê¥û</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://s2.loli.net/2022/06/01/NGZoMHJQIyVS5Ab.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">XuRui-Blog</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> ‰∏ªÈ°µüç≠</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Ê°£Ê°àüåä</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Ê†áÁ≠æüìë</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> ÂàÜÁ±ªüåà</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> Â•ΩÂ∫∑ÁöÑ‚ú®</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://ocw.mit.edu/"><i class="fa-fw fas fa-link"></i><span> Êù•Â≠¶È∫ªÂ≠¶</span></a></li><li><a class="site-page child" href="/bangumis/"><i class="fa-fw fas fa-video"></i><span> zxr„ÅÆËøΩÁï™ËÆ°Âàí</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=RyOyXsKuUgI"><i class="fa-fw fas fa-heart"></i><span> zxrÊúÄÁà±Êª¥upÂòâÂÄ©</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://oskarstalberg.com/game/planet/planet.html"><span> Planet</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> ÂèãÈìæüíï</span></a></div><div class="menus_item"><a class="site-page" href="https://xurui314.github.io/aboutme/"><span> AboutMeüèÇ</span></a></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://www.foreverblog.cn/go.html"><span> Ëô´Ê¥û</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Multimodal NER</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2022-06-01T15:26:34.000Z" title="Created 2022-06-01 23:26:34">2022-06-01</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2022-06-19T05:05:06.866Z" title="Updated 2022-06-19 13:05:06">2022-06-19</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/NLP/">NLP</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word count:</span><span class="word-count">11.3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading time:</span><span>57min</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Multimodal NER"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><div class="top-img" style="background-image: url('https://s2.loli.net/2022/06/01/NGZoMHJQIyVS5Ab.png');"></div><article class="post-content" id="article-container"><h1>Ê¶ÇËø∞&amp;ÂéüÊ®°Âûã</h1>
<h2 id="ÂÜôÂú®ÂºÄÂßã">ÂÜôÂú®ÂºÄÂßã</h2>
<blockquote>
<p>ËÆ∫Êñá‰ª£Á†Å‰ªìÂ∫ìÔºö<a target="_blank" rel="noopener" href="https://github.com/softhuafei/Pytorch-implementation-for-OCSGA">https://github.com/softhuafei/Pytorch-implementation-for-OCSGA</a></p>
<p>ÂÖ∂ÂÆûÊòØÂ∞ë‰∫Üobject_labelËøô‰∏™Êñá‰ª∂ÔºåÈúÄË¶ÅÁøªÂéÜÂè≤ËÆ∞ÂΩï‰∏ãËΩΩÔºåÊàë‰πü‰∏çÂà∞‰∏∫Âï•ÊääËøô‰∏™Âà†‰∫Ü„ÄÇ</p>
</blockquote>
<p>ËøôÂ∫îËØ•ÊòØÊàëÁ¨¨‰∏ÄÊ¨°ÊîπËÆ∫Êñá‰ª£Á†ÅÔºåÂØπ‰∫éÊï¥‰ΩìÁöÑ‰ª£Á†ÅÊ°ÜÊû∂Âï•ÁöÑÂÖ∂ÂÆûÈÉΩ‰∏çÊòØÂæàÊ∏ÖÊ•öÔºåËøòÊúâÂÖ∑‰ΩìÁî®Âà∞ÁöÑ‰∏Ä‰∫õÊñπÊ≥ïÔºå‰πü‰∏çÊòØÁâπÂà´ÁÜüÔºåÊâÄ‰ª•Â∞±Êù•ËæπÂ≠¶ËæπÊîπÔºåÂÅö‰∏™ËÆ∞ÂΩï„ÄÇ</p>
<blockquote>
<p>----2022/5/30 update----</p>
</blockquote>
<p>ÂíåÂçöÂ£´Â∏àÂÖÑËÆ®ËÆ∫ÂÆåÔºåÊÑüËßâËøòÊòØ‰ªªÈáçÈÅìËøúÔºåbugÁ°ÆÂÆû‰∏çÂ∞ëÔºåË¶ÅÂºÑÁöÑ‰∏úË•ø‰πüËõÆÂ§öÁöÑÔºåÊâÄ‰ª•Êó¢ÁÑ∂ËøôÁé©ÊÑè‰∏çÊòØÂè™Èù†Êü•Êü•ËµÑÊñôÂ∞±ËÉΩËß£ÂÜ≥ÁöÑÔºåËøòÊòØË¶ÅÈùô‰∏ãÂøÉÊù•ÔºåÁ†îËØª‰ª£Á†ÅÔºåÊØïÁ´üËøô‰∏™‰ª£Á†Å‰πüÊòØÊå∫ËßÑËåÉÁöÑÔºåËøòÊúâÂæàÂ§öÂú∞ÊñπÂÄºÂæóÂ≠¶‰π†ÔºåÊâÄ‰ª•ËøòÊòØË¶ÅËÄê‰ΩèË∫ÅÂä®ÂíåÂØÇÂØûüö¥‚Äç‚ôÇÔ∏è„ÄÇ</p>
<blockquote>
<p>----2022/6/5 update----</p>
</blockquote>
<p>Âì•‰ª¨Áé∞Âú®ËøáÊãüÂêàÁöÑÈóÆÈ¢òËøòÊòØÊ≤°Ëß£ÂÜ≥ÔºåÊÑüÊ¶ÇËâØÂ§öÔºå‰ΩÜÊòØËøòÊòØË¶ÅË∏èË∏èÂÆûÂÆûÂú∞ÊääËøô‰∏™‰∏úË•øÂÅöÂÆåÔºåÊÑüËßâÂøÉÊÉÖÂ§±ËêΩÊòØÈ¢ÑÊúüËøáÈ´òÔºåÂØπ‰ªªÂä°ÁöÑÂàÜÊûê‰∏çÂ§üÂÆ¢ËßÇÔºåÊâÄ‰ª•Êõ¥ÈúÄË¶ÅÈùô‰∏ãÂøÉÊù•Ë∞ÉÊï¥ÂàÜÊûê„ÄÇËôΩÁÑ∂ËØ¥ÊØèÂ§©Â∞±Á≠îËæ©‰∫ÜÔºåÊÑüËßâÂÖ∑‰ΩìÁöÑÁªìÊûúËøòÊòØÂ∫îËØ•Âª∂ÊúüÂà∞‰∫§ËÆ∫ÊñáÁöÑÊó∂ÂÄôÊèê‰∫§ÔºåÁªßÁª≠Âä™ÂäõÔºÅ</p>
<blockquote>
<p>----2022/6/18 update‚Äî</p>
</blockquote>
<p>Áî±‰∫éËøô‰∏™ËØæÁ®ãÁªìËØæÂª∂ÊúüÔºåzxrÁªà‰∫éËé∑Âæó‰∫Ü‰∏ÄÁ∫øÁîüÊú∫ÔºåÁÑ∂ÂêéËøôÈáåÊù•ËÆ∞ÂΩï‰∏Ä‰∏ã‰∏Ä‰∫õÊÉ≥Ê≥ï„ÄÇ</p>
<p>ÁõÆÂâçÊàëÊÉ≥ÂØπ‰∫éÊ®°ÂûãËøõË°åÊîπËøõÔºå‰ΩÜÊòØÂèà‰∏çÁü•‰ªé‰Ωï‰∏ãÊâã„ÄÇ</p>
<p>Ê†πÊçÆÊà∑ËÄÅÂ∏àÊâÄËØ¥ÁöÑÔºåË¶ÅÊ†πÊçÆÁõÆÊ†áËøõË°åÂª∫Ê®°ÔºåÊ†πÊçÆÈóÆÈ¢òÁâπÂæÅÊù•ËÆæËÆ°„ÄÇËøôÂèØËÉΩ‰ºöÊ∂âÂèäÂà∞ÂØπ‰∫éÊï∞ÊçÆÁöÑÁâπÂæÅÁöÑÊèêÂèñÔºå‰πüÂ∞±ÊòØÂØπ‰∫éÊï∞ÊçÆÁöÑËßÇÂØüÂêéÔºåÂæóÂá∫ÊüêÁßçÂàÜÂ∏ÉÁöÑhypothesisÔºåÊàñËÄÖÊòØÂÜÖÈÉ®ÁöÑÊüêÁßçrelationÔºåÂ∞ÜËøô‰∏™insightÂ∫îÁî®‰∫éÊ®°ÂûãÁöÑÊûÑÂª∫‰∏≠Ôºå‰ΩÜÊòØÈóÆÈ¢òÂú®‰∫éÔºåËøôÊ†∑ÂæóÂà∞ÁöÑÁªìÊûúÂèØËÉΩÊòØÂ•ΩÁöÑÔºå‰πüÂèØËÉΩÊ†πÊú¨‰∏çËµ∑‰ΩúÁî®ÔºåËÄå‰∏îËøôÊ†∑ÁöÑinsightÂè™ÊòØÊù•Ëá™‰∫éÂêéÈ™åÁöÑ‰∏ÄÈÉ®ÂàÜËßÇÂØüÔºåÂÆûÈôÖ‰∏äÂíåÊΩúÂú®ÁöÑÊú¨Ë¥®ËøòÊòØÊúâ‰∏çÂ∞ëÂ∑ÆË∑ùÁöÑÔºåÂ∞±ÁÆóÊòØwork‰∫ÜÔºåÊÄé‰πàÂéªËØÅÊòéÊòØÊåâÁÖß‰Ω†ËÆæËÆ°ÁöÑÂàùË°∑workÁöÑÔºå‰∫∫Èù¢ÂØπdeep NNËøôÁßçÂ§çÊùÇÁöÑÊ®°ÂûãÔºå‰∏çËÉΩÂéªÂÆåÂÖ®Áî®‰∫∫‰∏∫ÁöÑÁâπÂæÅÈôêÂà∂Ôºå‰ΩÜÊòØ‰πüË¶Å‰øùËØÅ‰∏ÄÂÆöËåÉÂõ¥ÁöÑÂèØÊéßÔºåËøΩÊ±ÇËøôÁßçÂπ≥Ë°°ÊòØÂæÆÂ¶ôÁöÑÔºå‰πüÊòØÊúâË∂£ÁöÑ„ÄÇ</p>
<p>ÂØπ‰∫éÁ•ûÁªèÁΩëÁªúÁöÑ‰ºòÂåñÁõÆÊ†áÔºåÊòØÂê¶ÂèØ‰ª•ÂÆö‰πâ‰∏∫‰∏çËÆ©loss functionÂç°Âú®Â±ÄÈÉ®ÊûÅÂÄºÔºåËÄåÂØπ‰∫éÁ•ûÁªèÁΩëÁªúÁöÑËß£ÈáäÊÄßÔºåÂèØ‰∏çÂèØ‰ª•ÁêÜËß£‰∏∫Â¶Ç‰ΩïËÆæËÆ°‰∏ÄÁßçÊú∫Âà∂Êù•ÂÅöÂà∞Â∞ÜÊçüÂ§±ÂáΩÊï∞ÁöÑÁ©∫Èó¥ËΩ¨Êç¢ÊàêÊõ¥Âä†ÂÆπÊòìÊ¢ØÂ∫¶‰∏ãÈôçÁöÑÁ©∫Èó¥„ÄÇÂÖ∂‰∏≠ÁöÑ‰∏ÄÁßçÈÄîÂæÑÂ∞±ÊòØÂèØ‰ª•ÈÄöËøáÊèêÂèñË∂≥Â§üÁöÑÁâπÂæÅÔºåÂÉèMLPÔºåÂÖ∂ÂÆûÂèØ‰ª•ÂñÇÁªôÂÆÉ‰∏çÂêåÁ±ªÂûãÁöÑÊï∞ÊçÆÔºåÁêÜËÆ∫‰∏äÈÉΩÊòØËÉΩÈÄºËøëÂàÜÂ∏ÉÁöÑÔºå‰ΩÜÊòØÁî±‰∫éÊï∞ÊçÆÈõÜÁöÑÈóÆÈ¢òÔºåÂèØËÉΩÂ≠¶‰π†‰∏ÄÊÆµÊó∂Èó¥Â∞±Âç°‰Ωè‰∫ÜÔºåËøô‰πüËØ¥ÊòéÂú®Âπ≥Êó∂ÁöÑÂ∫îÁî®‰∏≠ÔºåMLP + SoftmaxÁöÑÊãüÂêàÂæÄÂæÄÊòØÊúâÈôêÁöÑ„ÄÇËÄåCNNÔºåTransformerÂÖ∂ÂÆûÈÉΩÊòØÂÖàËøõË°å‰∫ÜÊèêÂèñÁâπÂæÅÁöÑÊ≠•È™§ÔºåËøôÂÖ∂ÂÆûÊòØÁî®‰∏ÄÁßçÂº±Êú∫Âà∂ÂéªÂØπËæìÂÖ•ÁöÑÊï∞ÊçÆËøõË°åËΩ¨Êç¢ÔºåÂæóÂà∞Áõ∏ÂØπÊù•ËØ¥ÊúÄÈóÆÈ¢òÁõ∏ÂÖ≥ÁöÑÈÉ®ÂàÜÔºåÈíàÂØπÁâπÂÆöÁöÑÈóÆÈ¢òÔºåËøõË°åËß£ÂÜ≥„ÄÇ</p>
<p>‰∏çÂèØÊéßÊÄßÁöÑÊù•Ê∫êÂ∫îËØ•ÊòØÊ¢ØÂ∫¶‰∏ãÈôçËøô‰∏™ÊñπÊ≥ïÔºåÂè™ÊòØËßÑÂÆö‰∫ÜË¶ÅÂáèÂ∞ëÂàÜÂ∏ÉÁöÑÂ∑ÆÂà´Ôºå‰ΩÜÊòØÂÖ∑‰ΩìÊÄé‰πàÂÅöÂà∞ÁöÑÔºåÊòØÊ≤°ÊúâËßÑÂÆöÁöÑÔºåËôΩÁÑ∂ÂèØ‰ª•Êé¢Á¥¢‰∫∫Á±ªÊú™ÊõæÊ∂âÂèäÁöÑËßÑÂæãÔºå‰ΩÜÊòØËøôÂ∞±‰ºöÂØºËá¥ÂÜÖÈÉ®ÁöÑÈöêÁä∂ÊÄÅÂíåÊú∫Âà∂Êúâ‰∫õ‰∏çÂèØËß£ÈáäÔºåËÄåÊèêÂèñÁâπÂæÅÁöÑËøáÁ®ãÔºåÊòØ‰∏çÊòØÂèØ‰ª•ËßÜ‰∏∫ÊääËØÑÂà§ÁöÑÊ†áÂáÜ‰∏çÂè™ÊòØÁî®Ê¢ØÂ∫¶‰∏ãÈôçÁ∫ØÁ≤πÂêëÁùÄÁõÆÊ†áÔºåËÄåÊòØÂè¶Â§ñËøòË¶ÅÂÖºÈ°æÂà∞‰∏Ä‰∫õ‰ø°ÊÅØÁöÑÊèêÂèñÔºå‰πüÂ∞±ÊòØÂ¢ûÂº∫ÁúüÊ≠£ÊúâÊïàÁöÑ‰ø°ÊÅØ„ÄÇ</p>
<p>ÂØπ‰∫éÁ•ûÁªèÁΩëÁªúÁöÑ‰∏âÂ±ÇÁêÜËß£Ôºö</p>
<ol>
<li>Á∫øÊÄßÂíåÈùûÁ∫øÊÄßÁªÑÂêàÁöÑËø≠‰ª£ÔºåÊï∞ÊçÆÁ©∫Èó¥ÂèòÊç¢ÁöÑËßíÂ∫¶ÔºåËøôÁßçËßÜËßíÊòØÂæàÂ±ÄÈôêÁöÑÔºå‰∏çÊòØ‰∏ÄËà¨ÈÄÇÁî®ÁöÑ„ÄÇ</li>
<li>Ê¶ÇÁéáÂàÜÂ∏ÉÂíåÂáΩÊï∞ÁöÑÈÄºËøëÔºå‰ªéÁêÜËÆ∫ËßíÂ∫¶ÁêÜËß£Á•ûÁªèÁΩëÁªúÁöÑÊΩúÂú®ÊãüÂêàËÉΩÂäõ„ÄÇ</li>
<li>‰ºòÂåñÊçüÂ§±ÂáΩÊï∞Á©∫Èó¥„ÄÇ</li>
</ol>
<p>Good ideaÂíåidea work‰πãÈó¥ÁöÑËÅîÁ≥ªÔºü</p>
<p>‰∏™‰∫∫ÊÑüËßâÔºå‰∫∫ÊÄªÊòØÂéªËßÇÂØüÊï∞ÊçÆÂÜÖÂú®ÁöÑÊüêÁßçËÅîÁ≥ªÂíåÂõ†ÊûúÔºåËøôÊ†∑ÂæóÂà∞Êüê‰∫õËßÑÂæãÔºåÁÑ∂ÂêéÊääËøôÁßçËßÑÂæã‰Ωú‰∏∫motivationÂØπÊ®°ÂûãÂä†‰ª•ÊîπËøõÔºåÂú®loss functionÁöÑÁ©∫Èó¥‰∏äÂèØËÉΩ‰ΩìÁé∞‰∏∫ÈÄâÂèñ‰∫ÜÊΩúÂú®Êõ¥Â•ΩÁöÑ‰∏ÄÂùóÁ©∫Èó¥ÔºåÊää‰∏çÂ§™ÂèØËÉΩÁöÑÈÉ®ÂàÜÁúÅÂéª„ÄÇÂõ†‰∏∫Êï∞ÊçÆÈõÜÂíåÊ®°ÂûãÁöÑÂ§çÊùÇÊÄßÔºåÊ≤°ÂäûÊ≥ïÊèêÂâçËØÅÊòéËøôÁßçideaÁöÑÂáÜÁ°ÆÊÄßÔºåÂè™ËÉΩÈÄöËøáÁªìÊûú‰ΩìÁé∞„ÄÇ‰∏ÄËà¨Êù•ËØ¥ÔºåGood ideaÈÉΩÊòØÂØπ‰∫éÁâπÂÆöÈóÆÈ¢òËÄåË®ÄÁöÑÔºåËøôÈáåÂÖà‰∏çËÄÉËôëÊôÆÈÄÇÁöÑÊÄßË¥®ÔºåÂØπ‰∫éÁâπÂÆöÁöÑÈóÆÈ¢òÔºåÂÆûÈôÖ‰∏äÊòØÁî®ÊüêÁßçËßÑÂàôÂéªËøõË°åÂº±ÁöÑÁ∫¶ÊùüÔºåÊÑüËßâÊúâÁÇπÂÉèÈªëÁõíÈáåÁöÑ‰∏úË•øÂèò‰∫Ü‰∏Ä‰∏ãÔºå‰ΩÜÊòØ‰Ω†‰πü‰∏çÁü•ÈÅìËÉΩ‰∏çËÉΩË°åÔºåÂØπ‰∫éËßÑÂæãËøôÁßç‰∏úË•øÔºåÁêÜËÆ∫‰∏äMLPÈÉΩËÉΩÂ≠¶Ôºå‰ΩÜÊòØ‰ªã‰∫éÂÆûÈôÖÈóÆÈ¢ò‰∏≠ÁöÑÂ§çÊùÇÊÄßÔºåÂ∞±ÂæàÈöæËææÂà∞ÈÇ£ÁßçÊïàÊûú‰∫ÜÔºåËøôÊó∂ÂÄô‰∫∫‰∏∫ÁöÑ‰∏Ä‰∫õideaÊòØËÉΩÊõ¥Â•ΩÁöÑÂéªÂçèÂä©Ê®°ÂûãÂ≠¶‰π†ÔºåÊâÄ‰ª•Êú¨Ë¥®ÁöÑÂÅáËÆæËøòÊòØ‰∫∫ËÑëÂèØ‰ª•Ê≠£Á°ÆÂú∞ÁêÜËß£ÈóÆÈ¢ò„ÄÇ</p>
<p>ÊâÄ‰ª•ÊÑüËßâÂ∞±ÊúâÁÇπÁéÑÂ≠¶‰∫ÜÔºåÊØïÁ´ü‰∏çÊòØÂèØ‰ª•ÁêÜËÆ∫ËØÅÊòéÁöÑ‰∏úË•øÔºå‰ΩÜÊòØÂç¥ÂèØ‰ª•‰ªéÂÆûË∑µ‰∏≠‰∏ÄÁÇπÁÇπÊÑüÁü•„ÄÇÁâ©ÁêÜËøôÁßçÂ∞±ÊòØÊ†πÊçÆÊüê‰∫õÂÅáËÆæÂÖàËØÅÊòéÂÜçÊ£ÄÈ™åÔºåËÄåDPÂ∞±ÊòØÂÖàÁî±Êüê‰∫õÂÅáËÆæÂÆûÈ™åÂÜçÂéªÁêÜËß£ÔºåÊúÄÁªàworkÁöÑÂéüÂõ†‰πüÂèØËÉΩÊòØÂ§öÊ†∑ÁöÑÔºåËÄ¶ÂêàÁöÑÂõ†Á¥†ÂæàÂ§öÔºåÂæàÂ∞ëÊúâÁêÜËÆ∫ËØÅÊòéÁöÑÈÉ®ÂàÜ„ÄÇ</p>
<h2 id="È¶ñÂÖà‰ªémain-pyÂºÄÂßã">È¶ñÂÖà‰ªémain.pyÂºÄÂßã</h2>
<p><code>main.py</code>ÁöÑ<code>if __name__ == '__main__':</code>ÂºÄÂßãÁúãÔºå</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    parser = argparse.ArgumentParser(description=<span class="string">'Tuning with NCRF++'</span>)</span><br><span class="line">    <span class="comment"># parser.add_argument('--status', choices=['train', 'decode'], help='update algorithm', default='train')</span></span><br><span class="line">    parser.add_argument(<span class="string">'--config'</span>,  <span class="built_in">help</span>=<span class="string">'Configuration File'</span>, default=<span class="string">'None'</span>)</span><br><span class="line">    parser.add_argument(<span class="string">'--wordemb'</span>,  <span class="built_in">help</span>=<span class="string">'Embedding for words'</span>, default=<span class="string">'None'</span>)</span><br><span class="line">    parser.add_argument(<span class="string">'--charemb'</span>,  <span class="built_in">help</span>=<span class="string">'Embedding for chars'</span>, default=<span class="string">'None'</span>)</span><br><span class="line">    parser.add_argument(<span class="string">'--status'</span>, choices=[<span class="string">'train'</span>, <span class="string">'decode'</span>], <span class="built_in">help</span>=<span class="string">'update algorithm'</span>, default=<span class="string">'train'</span>)</span><br><span class="line">    parser.add_argument(<span class="string">'--savemodel'</span>, default=<span class="string">"data/model/saved_model.lstmcrf."</span>)</span><br><span class="line">    parser.add_argument(<span class="string">'--savedset'</span>, <span class="built_in">help</span>=<span class="string">'Dir of saved data setting'</span>)</span><br><span class="line">    parser.add_argument(<span class="string">'--train'</span>, default=<span class="string">"data/conll03/train.bmes"</span>) </span><br><span class="line">    parser.add_argument(<span class="string">'--dev'</span>, default=<span class="string">"data/conll03/dev.bmes"</span> )  </span><br><span class="line">    parser.add_argument(<span class="string">'--test'</span>, default=<span class="string">"data/conll03/test.bmes"</span>) </span><br><span class="line">    parser.add_argument(<span class="string">'--seg'</span>, default=<span class="string">"True"</span>) </span><br><span class="line">    parser.add_argument(<span class="string">'--raw'</span>) </span><br><span class="line">    parser.add_argument(<span class="string">'--loadmodel'</span>)</span><br><span class="line">    parser.add_argument(<span class="string">'--output'</span>) </span><br><span class="line">    args = parser.parse_args()</span><br><span class="line"></span><br><span class="line">    data = Data()</span><br><span class="line">    data.HP_gpu = torch.cuda.is_available()</span><br><span class="line">    <span class="keyword">if</span> args.config == <span class="string">'None'</span>:</span><br><span class="line">        data.train_dir = args.train </span><br><span class="line">        data.dev_dir = args.dev </span><br><span class="line">        data.test_dir = args.test</span><br><span class="line">        data.model_dir = args.savemodel</span><br><span class="line">        data.dset_dir = args.savedset</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"Save dset directory:"</span>,data.dset_dir)</span><br><span class="line">        save_model_dir = args.savemodel</span><br><span class="line">        data.word_emb_dir = args.wordemb</span><br><span class="line">        data.char_emb_dir = args.charemb</span><br><span class="line">        <span class="keyword">if</span> args.seg.lower() == <span class="string">'true'</span>:</span><br><span class="line">            data.seg = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            data.seg = <span class="literal">False</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"Seed num:"</span>, seed_num)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        data.read_config(args.config)</span><br><span class="line">    <span class="comment"># data.show_data_summary()</span></span><br><span class="line">    status = data.status.lower()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Seed num:"</span>,seed_num)</span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="keyword">if</span> (data.root_dir <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>) <span class="keyword">and</span> (<span class="keyword">not</span> os.path.exists(data.root_dir)):</span><br><span class="line">        os.mkdir(data.root_dir)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> status == <span class="string">'train'</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"MODEL: train"</span>)</span><br><span class="line">        data_initialization(data)</span><br><span class="line">        data.generate_instance(<span class="string">'train'</span>)</span><br><span class="line">        data.generate_instance(<span class="string">'dev'</span>)</span><br><span class="line">        data.generate_instance(<span class="string">'test'</span>)</span><br><span class="line">        data.build_pretrain_emb()</span><br><span class="line">        train(data)</span><br><span class="line">    <span class="keyword">elif</span> status == <span class="string">'decode'</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"MODEL: decode"</span>)</span><br><span class="line">        data.load(data.dset_dir)</span><br><span class="line">        data.read_config(args.config)</span><br><span class="line">        <span class="built_in">print</span>(data.raw_dir)</span><br><span class="line">        <span class="comment"># exit(0)</span></span><br><span class="line">        data.show_data_summary()</span><br><span class="line">        data.generate_instance(<span class="string">'raw'</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"nbest: %s"</span>%(data.nbest))</span><br><span class="line">        decode_results, pred_scores = load_model_decode(data, <span class="string">'raw'</span>)</span><br><span class="line">        <span class="keyword">if</span> data.nbest <span class="keyword">and</span> <span class="keyword">not</span> data.sentence_classification:</span><br><span class="line">            data.write_nbest_decoded_results(decode_results, pred_scores, <span class="string">'raw'</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            data.write_decoded_results(decode_results, <span class="string">'raw'</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"Invalid argument! Please use valid arguments! (train/test/decode)"</span>)</span><br></pre></td></tr></tbody></table></figure>
<p>È¶ñÂÖàÊòØ‰∏Ä‰∏™<code>parser = argparse.ArgumentParser(description='Tuning with NCRF++')</code>ÔºåËøô‰∏™ÂèØ‰ª•ÁêÜËß£‰∏∫Â≠ò‰∏Ä‰∫õÂèÇÊï∞ÁöÑÂÆπÂô®ÔºåÁâπÁÇπÊòØÔºåËøô‰∏™ÊòØÈÄöËøáÂëΩ‰ª§Ë°åÊù•ËøõË°åÂØπÂèÇÊï∞ÁöÑËµãÂÄº„ÄÇ</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># demo.py</span></span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"></span><br><span class="line">parser = argparse.ArgumentParser(description=<span class="string">'ÂëΩ‰ª§Ë°å‰∏≠‰º†ÂÖ•‰∏Ä‰∏™Êï∞Â≠ó'</span>)</span><br><span class="line"><span class="comment">#typeÊòØË¶Å‰º†ÂÖ•ÁöÑÂèÇÊï∞ÁöÑÊï∞ÊçÆÁ±ªÂûã  helpÊòØËØ•ÂèÇÊï∞ÁöÑÊèêÁ§∫‰ø°ÊÅØ</span></span><br><span class="line">parser.add_argument(<span class="string">'--str_arg'</span>, <span class="built_in">type</span>=<span class="built_in">str</span>, <span class="built_in">help</span>=<span class="string">'‰º†ÂÖ•ÁöÑÂ≠óÁ¨¶‰∏≤'</span>)</span><br><span class="line"></span><br><span class="line">args = parser.parse_args()</span><br><span class="line"></span><br><span class="line"><span class="comment">#Ëé∑Âæó‰º†ÂÖ•ÁöÑÂèÇÊï∞</span></span><br><span class="line"><span class="built_in">print</span>(args.str_arg)</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">python demo.py --str_arg = <span class="string">"lalala"</span></span><br><span class="line">&gt; lalala</span><br><span class="line"></span><br><span class="line">Êé®ËçêÁöÑËµÑÊñô</span><br><span class="line">https://zhuanlan.zhihu.com/p/<span class="number">56922793</span></span><br><span class="line">https://www.bilibili.com/video/BV1U4411j7xb?spm_id_from=<span class="number">333.337</span>.search-card.<span class="built_in">all</span>.click</span><br></pre></td></tr></tbody></table></figure>
<p>Êé•‰∏ãÊù•‰ºöÁ¢∞Âà∞<code>data</code>ÔºåËøôÁé©ÊÑèÂÖ∂ÂÆûÊòØ<code>data.py</code>ÈáåÂÆö‰πâÁöÑ<code>Data</code>Á±ªÁöÑÂÆû‰æãÔºåËøô‰∏™<code>Data</code>Á±ªË¥üË¥£ÁöÑÊòØÊ®°ÂûãÁöÑÂèÇÊï∞ÂíåÊï∞ÊçÆÔºåËøôÈáåÂàó‰∏æ‰∏Ä‰∫õÂåÖÂê´ÁöÑÂÜÖÂÆπÔºàÂè™ÊòØ‰∏ÄÈÉ®ÂàÜÔºâÔºö</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">self.model_name = <span class="literal">None</span></span><br><span class="line">        <span class="comment">### data</span></span><br><span class="line">        self.sentence_classification = <span class="literal">False</span></span><br><span class="line">        self.MAX_SENTENCE_LENGTH = <span class="number">250</span></span><br><span class="line">        self.MAX_WORD_LENGTH = -<span class="number">1</span></span><br><span class="line">        self.MAX_OBJECT_NB = <span class="number">3</span></span><br><span class="line">        self.number_normalized = <span class="literal">True</span></span><br><span class="line">        self.norm_word_emb = <span class="literal">False</span></span><br><span class="line">        self.word_alphabet = Alphabet(<span class="string">'word'</span>)</span><br><span class="line"></span><br><span class="line">        self.label_alphabet = Alphabet(<span class="string">'label'</span>,<span class="literal">True</span>)</span><br><span class="line">        self.tagScheme = <span class="string">"NoSeg"</span> <span class="comment">## BMES/BIO</span></span><br><span class="line">        self.split_token = <span class="string">' ||| '</span></span><br><span class="line">        self.seg = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">### I/O</span></span><br><span class="line">        self.train_dir = <span class="literal">None</span></span><br><span class="line">        self.dev_dir = <span class="literal">None</span></span><br><span class="line">        self.test_dir = <span class="literal">None</span></span><br><span class="line">        self.raw_dir = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        self.root_dir = <span class="literal">None</span></span><br><span class="line">        self.decode_dir = <span class="literal">None</span></span><br><span class="line">        self.dset_dir = <span class="literal">None</span> <span class="comment">## data vocabulary related file</span></span><br><span class="line">        self.model_dir = <span class="literal">None</span> <span class="comment">## model save  file</span></span><br><span class="line">        self.load_model_dir = <span class="literal">None</span> <span class="comment">## model load file</span></span><br><span class="line"></span><br><span class="line">        self.log_dir = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        self.feature_emb_dirs = []</span><br><span class="line">        <span class="comment"># img object files</span></span><br><span class="line">        self.object_dir = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        self.train_texts = []</span><br><span class="line">        self.dev_texts = []</span><br><span class="line">        self.test_texts = []</span><br><span class="line">        self.raw_texts = []</span><br><span class="line"></span><br><span class="line">        self.train_Ids = []</span><br><span class="line">        self.dev_Ids = []</span><br><span class="line">        self.test_Ids = []</span><br><span class="line">        self.raw_Ids = []</span><br><span class="line"></span><br><span class="line">        self.word_emb_dim = <span class="number">50</span></span><br><span class="line">        self.char_emb_dim = <span class="number">30</span></span><br><span class="line">        self.object_emb_dim = <span class="number">50</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">###Networks</span></span><br><span class="line">        self.word_feature_extractor = <span class="string">"LSTM"</span> <span class="comment">## "LSTM"/"CNN"/"GRU"/</span></span><br><span class="line">        self.use_char = <span class="literal">True</span></span><br><span class="line">        self.char_feature_extractor = <span class="string">"CNN"</span> <span class="comment">## "LSTM"/"CNN"/"GRU"/None</span></span><br><span class="line">        self.use_crf = <span class="literal">True</span></span><br><span class="line">        self.nbest = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">## Training</span></span><br><span class="line">        self.average_batch_loss = <span class="literal">False</span></span><br><span class="line">        self.optimizer = <span class="string">"SGD"</span> <span class="comment">## "SGD"/"AdaGrad"/"AdaDelta"/"RMSProp"/"Adam"</span></span><br><span class="line">        self.status = <span class="string">"train"</span></span><br><span class="line">        <span class="comment">### Hyperparameters</span></span><br><span class="line">        self.HP_cnn_layer = <span class="number">4</span></span><br><span class="line">        self.HP_iteration = <span class="number">100</span></span><br><span class="line">        self.HP_batch_size = <span class="number">10</span></span><br><span class="line">        self.HP_char_hidden_dim = <span class="number">50</span></span><br><span class="line">        self.HP_hidden_dim = <span class="number">512</span></span><br><span class="line">        self.HP_dropout = <span class="number">0.5</span></span><br><span class="line">        self.HP_MCA_dropout = <span class="number">0.5</span></span><br><span class="line">        self.HP_multi_head = <span class="number">1</span></span><br><span class="line">        self.HP_SGA_layer=<span class="number">8</span></span><br><span class="line"></span><br><span class="line">        self.HP_bilstm = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">        self.HP_gpu = <span class="literal">False</span></span><br><span class="line">        self.HP_lr = <span class="number">0.015</span></span><br><span class="line">        self.HP_lr_decay = <span class="number">0.05</span></span><br><span class="line">        self.HP_clip = <span class="literal">None</span></span><br><span class="line">        self.HP_momentum = <span class="number">0</span></span><br><span class="line">        self.HP_l2 = <span class="number">1e-8</span></span><br></pre></td></tr></tbody></table></figure>
<p>Êé•‰∏ãÊù•ÊòØÂºÄÂßãÂà§Êñ≠<code>config</code>Êñá‰ª∂ÊòØÂê¶‰∏∫Á©∫ÔºåÂ¶ÇÊûúÊòØÁ©∫ÁöÑÔºåÈÇ£Â∞±Êää<code>args</code>ÂÆπÂô®ÈáåÈù¢ÁöÑÈªòËÆ§ÂÄºÔºåËµãÂÄºÁªô<code>data</code>ÁöÑÊàêÂëòÂèòÈáèÔºåÊØîÂ¶Ç<code>data.train_dir</code>Ëøô‰∫õ„ÄÇÂ¶ÇÊûú<code>config</code>‰∏çÊòØÁ©∫Â∞±Áõ¥Êé•Ë∞ÉÁî®<code>data.read_config(config)</code>ÔºåËøô‰∏™Â∞±ÊòØÁõ¥Êé•Êää<code>config</code>Êñá‰ª∂ÈáåÈù¢ÁöÑÂèÇÊï∞ÂØπÂ∫îËØªËøõ<code>data</code>ÁöÑÂèÇÊï∞ÔºåÂÖ∑‰ΩìÁöÑËØùÊòØÂÖàÊää<code>config</code>ÂÜÖÂÆπËΩ¨Êç¢ÊàêÂ≠óÂÖ∏ÔºåÊòØÁî®<code>data</code>‰∏≠ÁöÑ<code>config_file_to_dict</code>ÂáΩÊï∞„ÄÇ</p>
<p>Êé•‰∏ãÊù•Â∞±ÊòØËÆ≠ÁªÉorËß£Á†ÅÁöÑÈÉ®ÂàÜ‰∫ÜÔºå‰ª•<code>train</code>‰∏∫‰æãÔºå</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">if</span> status == <span class="string">'train'</span>:</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">"MODEL: train"</span>)</span><br><span class="line">      data_initialization(data) <span class="comment"># ÊûÑÂª∫ËØçË°®</span></span><br><span class="line">      data.generate_instance(<span class="string">'train'</span>) </span><br><span class="line">      data.generate_instance(<span class="string">'dev'</span>)</span><br><span class="line">      data.generate_instance(<span class="string">'test'</span>)</span><br><span class="line">      data.build_pretrain_emb()</span><br><span class="line">      train(data)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># data_initialization</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">data_initialization</span>(<span class="params">data</span>):</span></span><br><span class="line">    data.initial_feature_alphabets()</span><br><span class="line">    data.build_alphabet(data.train_dir)</span><br><span class="line">    data.build_alphabet(data.dev_dir)</span><br><span class="line">    data.build_alphabet(data.test_dir)</span><br><span class="line">    data.build_object_alphabet(data.object_dir)</span><br><span class="line">    data.fix_alphabet()</span><br></pre></td></tr></tbody></table></figure>
<p>ËØçË°®ÊûÑÂª∫Âï•ÁöÑÁªÜËäÇÂêéÈù¢ÁöÑChapter‰ºöÁªÜÁêêÔºåÊûÑÂª∫ÂÆåËØçË°®ÁÑ∂ÂêéÊòØÂéª‰∫Ü<code>generate_instance</code>Ëøô‰∏™ÂáΩÊï∞ÔºåËøô‰∏™ÂáΩÊï∞ÊòØÂíå<code>batch</code>ÂàíÂàÜÂíå<code>decode</code>ÂÜôÊñá‰ª∂ÊúâÂÖ≥ÁöÑÔºåËøôÈáåÁªôÂá∫ÂæóÂà∞ÁöÑÁªìÊûúÁöÑÂ±ïÁ§∫ÔºåÂÖ∂ÂÆûÂ∞±ÊòØÊääÊâÄÊúâ‰ø°ÊÅØÊï¥ÂêàËµ∑Êù•„ÄÇ</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">self.train_texts[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">[words, features, chars, labels, objects]</span><br><span class="line"></span><br><span class="line">[[<span class="string">'RT'</span>, <span class="string">'@JayKenMinaj'</span>, <span class="string">'_'</span>, <span class="string">':'</span>, <span class="string">'Me'</span>, <span class="string">'outside'</span>, <span class="string">'of'</span>, <span class="string">'where'</span>, <span class="string">'George'</span>, <span class="string">'Zimmerman'</span>, <span class="string">'got'</span>, <span class="string">'shot'</span>, <span class="string">'at'</span>, <span class="string">'.'</span>, <span class="string">'You'</span>, <span class="string">'know'</span>, <span class="string">'God'</span>, <span class="string">'is'</span>, <span class="string">'so'</span>, <span class="string">'good'</span>, <span class="string">'.'</span>, <span class="string">'http://t.co/Z3neVBQ7vF'</span>], [[], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], []], [[<span class="string">'R'</span>, <span class="string">'T'</span>], [<span class="string">'@'</span>, <span class="string">'J'</span>, <span class="string">'a'</span>, <span class="string">'y'</span>, <span class="string">'K'</span>, <span class="string">'e'</span>, <span class="string">'n'</span>, <span class="string">'M'</span>, <span class="string">'i'</span>, <span class="string">'n'</span>, <span class="string">'a'</span>, <span class="string">'j'</span>], [<span class="string">'_'</span>], [<span class="string">':'</span>], [<span class="string">'M'</span>, <span class="string">'e'</span>], [<span class="string">'o'</span>, <span class="string">'u'</span>, <span class="string">'t'</span>, <span class="string">'s'</span>, <span class="string">'i'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>], [<span class="string">'o'</span>, <span class="string">'f'</span>], [<span class="string">'w'</span>, <span class="string">'h'</span>, <span class="string">'e'</span>, <span class="string">'r'</span>, <span class="string">'e'</span>], [<span class="string">'G'</span>, <span class="string">'e'</span>, <span class="string">'o'</span>, <span class="string">'r'</span>, <span class="string">'g'</span>, <span class="string">'e'</span>], [<span class="string">'Z'</span>, <span class="string">'i'</span>, <span class="string">'m'</span>, <span class="string">'m'</span>, <span class="string">'e'</span>, <span class="string">'r'</span>, <span class="string">'m'</span>, <span class="string">'a'</span>, <span class="string">'n'</span>], [<span class="string">'g'</span>, <span class="string">'o'</span>, <span class="string">'t'</span>], [<span class="string">'s'</span>, <span class="string">'h'</span>, <span class="string">'o'</span>, <span class="string">'t'</span>], [<span class="string">'a'</span>, <span class="string">'t'</span>], [<span class="string">'.'</span>], [<span class="string">'Y'</span>, <span class="string">'o'</span>, <span class="string">'u'</span>], [<span class="string">'k'</span>, <span class="string">'n'</span>, <span class="string">'o'</span>, <span class="string">'w'</span>], [<span class="string">'G'</span>, <span class="string">'o'</span>, <span class="string">'d'</span>], [<span class="string">'i'</span>, <span class="string">'s'</span>], [<span class="string">'s'</span>, <span class="string">'o'</span>], [<span class="string">'g'</span>, <span class="string">'o'</span>, <span class="string">'o'</span>, <span class="string">'d'</span>], [<span class="string">'.'</span>], [<span class="string">'h'</span>, <span class="string">'t'</span>, <span class="string">'t'</span>, <span class="string">'p'</span>, <span class="string">':'</span>, <span class="string">'/'</span>, <span class="string">'/'</span>, <span class="string">'t'</span>, <span class="string">'.'</span>, <span class="string">'c'</span>, <span class="string">'o'</span>, <span class="string">'/'</span>, <span class="string">'Z'</span>, <span class="string">'0'</span>, <span class="string">'n'</span>, <span class="string">'e'</span>, <span class="string">'V'</span>, <span class="string">'B'</span>, <span class="string">'Q'</span>, <span class="string">'0'</span>, <span class="string">'v'</span>, <span class="string">'F'</span>]], [<span class="string">'O'</span>, <span class="string">'O'</span>, <span class="string">'O'</span>, <span class="string">'O'</span>, <span class="string">'O'</span>, <span class="string">'O'</span>, <span class="string">'O'</span>, <span class="string">'O'</span>, <span class="string">'B-PER'</span>, <span class="string">'I-PER'</span>, <span class="string">'O'</span>, <span class="string">'O'</span>, <span class="string">'O'</span>, <span class="string">'O'</span>, <span class="string">'O'</span>, <span class="string">'O'</span>, <span class="string">'O'</span>, <span class="string">'O'</span>, <span class="string">'O'</span>, <span class="string">'O'</span>, <span class="string">'O'</span>, <span class="string">'O'</span>], [<span class="string">'person'</span>, <span class="string">'car'</span>, <span class="string">'cell'</span>, <span class="string">'phone'</span>, <span class="string">'car'</span>]]</span><br><span class="line"></span><br><span class="line">self.train_Ids[<span class="number">0</span>]</span><br><span class="line">[[<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">17</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">15</span>, <span class="number">22</span>], [[], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], []], [[<span class="number">2</span>, <span class="number">3</span>], [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">10</span>, <span class="number">6</span>, <span class="number">13</span>], [<span class="number">14</span>], [<span class="number">15</span>], [<span class="number">11</span>, <span class="number">9</span>], [<span class="number">16</span>, <span class="number">17</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">12</span>, <span class="number">20</span>, <span class="number">9</span>], [<span class="number">16</span>, <span class="number">21</span>], [<span class="number">22</span>, <span class="number">23</span>, <span class="number">9</span>, <span class="number">24</span>, <span class="number">9</span>], [<span class="number">25</span>, <span class="number">9</span>, <span class="number">16</span>, <span class="number">24</span>, <span class="number">26</span>, <span class="number">9</span>], [<span class="number">27</span>, <span class="number">12</span>, <span class="number">28</span>, <span class="number">28</span>, <span class="number">9</span>, <span class="number">24</span>, <span class="number">28</span>, <span class="number">6</span>, <span class="number">10</span>], [<span class="number">26</span>, <span class="number">16</span>, <span class="number">18</span>], [<span class="number">19</span>, <span class="number">23</span>, <span class="number">16</span>, <span class="number">18</span>], [<span class="number">6</span>, <span class="number">18</span>], [<span class="number">29</span>], [<span class="number">30</span>, <span class="number">16</span>, <span class="number">17</span>], [<span class="number">31</span>, <span class="number">10</span>, <span class="number">16</span>, <span class="number">22</span>], [<span class="number">25</span>, <span class="number">16</span>, <span class="number">20</span>], [<span class="number">12</span>, <span class="number">19</span>], [<span class="number">19</span>, <span class="number">16</span>], [<span class="number">26</span>, <span class="number">16</span>, <span class="number">16</span>, <span class="number">20</span>], [<span class="number">29</span>], [<span class="number">23</span>, <span class="number">18</span>, <span class="number">18</span>, <span class="number">32</span>, <span class="number">15</span>, <span class="number">33</span>, <span class="number">33</span>, <span class="number">18</span>, <span class="number">29</span>, <span class="number">34</span>, <span class="number">16</span>, <span class="number">33</span>, <span class="number">27</span>, <span class="number">35</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">36</span>, <span class="number">37</span>, <span class="number">38</span>, <span class="number">35</span>, <span class="number">39</span>, <span class="number">40</span>]], [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>], [<span class="number">5</span>, <span class="number">16</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">16</span>]]</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p>ÁÑ∂ÂêéÈ¢ÑÂ§ÑÁêÜÂºÑÂÆå‰∫ÜÔºåÂ∞±Áõ¥Êé•ËøõÂÖ•ËÆ≠ÁªÉÂáΩÊï∞<code>train</code>‰∫Ü„ÄÇ</p>
<p>È¶ñÂÖàÂÖàË¶ÅÂ§ÑÁêÜÁöÑÂ∞±ÊòØÂàíÂàÜ<code>batch</code>ÔºåÂÖ∑‰ΩìÊù•ËØ¥ÊòØËøôÊ†∑ÁöÑÔºåÂàíÂàÜ‰∏Ä‰∏ã<code>batch</code>ÁöÑ<code>start</code>Âíå<code>end</code>ÁÑ∂ÂêéÂØπ<code>train_Ids</code>Âéª<code>slice</code>Â∞±Ë°å‰∫ÜÔºö</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">batch_size = data.HP_batch_size</span><br><span class="line">batch_id = <span class="number">0</span></span><br><span class="line">train_num = <span class="built_in">len</span>(data.train_Ids)</span><br><span class="line">total_batch = train_num//batch_size+<span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> batch_id <span class="keyword">in</span> <span class="built_in">range</span>(total_batch):</span><br><span class="line">    start = batch_id*batch_size</span><br><span class="line">    end = (batch_id+<span class="number">1</span>)*batch_size</span><br><span class="line">    <span class="keyword">if</span> end &gt;train_num:</span><br><span class="line">         end = train_num</span><br><span class="line">    instance = data.train_Ids[start:end] </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> instance:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    batch_word, batch_features, batch_wordlen, batch_wordrecover, batch_char, batch_charlen, batch_charrecover, batch_label, mask, batch_obj, obj_mask = batchify_with_label(instance, data.HP_gpu, <span class="literal">True</span>, data.sentence_classification, data.MAX_OBJECT_NB)</span><br></pre></td></tr></tbody></table></figure>
<p>ÁÑ∂ÂêéÁúã<code>batchify_with_label</code>Ëøô‰∏™ÂáΩÊï∞Ôºö</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">batchify_with_label</span>(<span class="params">input_batch_list, gpu, if_train=<span class="literal">True</span>, sentence_classification=<span class="literal">False</span>, max_object_nb=<span class="number">0</span></span>):</span></span><br><span class="line">    <span class="keyword">if</span> sentence_classification:</span><br><span class="line">        <span class="keyword">return</span> batchify_sentence_classification_with_label(input_batch_list, gpu, if_train)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> batchify_sequence_labeling_with_label(input_batch_list, gpu, if_train, max_object_nb=max_object_nb)</span><br></pre></td></tr></tbody></table></figure>
<p>ÂÆûÈôÖ‰∏äËøòË¶ÅÂéªÁúã<code>batchify_sequence_labeling_with_label</code>ÂáΩÊï∞Ôºà<strong>Êà™Âèñ‰∫Ü‰∏ÄÈÉ®ÂàÜ</strong>ÔºâÔºö</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">batchify_sequence_labeling_with_label</span>(<span class="params">input_batch_list, gpu, if_train=<span class="literal">True</span>, max_object_nb=<span class="number">0</span></span>):</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">        input: list of words, chars and labels, various length. [[words, features, chars, labels, topics],[words, features, chars,labels, topics],...]</span></span><br><span class="line"><span class="string">            words: word ids for one sentence. (batch_size, sent_len)</span></span><br><span class="line"><span class="string">            features: features ids for one sentence. (batch_size, sent_len, feature_num)</span></span><br><span class="line"><span class="string">            chars: char ids for on sentences, various length. (batch_size, sent_len, each_word_length)</span></span><br><span class="line"><span class="string">            labels: label ids for one sentence. (batch_size, sent_len)</span></span><br><span class="line"><span class="string">            object: object id for this sentence</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        output:</span></span><br><span class="line"><span class="string">            zero padding for word and char, with their batch length</span></span><br><span class="line"><span class="string">            word_seq_tensor: (batch_size, max_sent_len) Variable</span></span><br><span class="line"><span class="string">            feature_seq_tensors: [(batch_size, max_sent_len),...] list of Variable</span></span><br><span class="line"><span class="string">            word_seq_lengths: (batch_size,1) Tensor</span></span><br><span class="line"><span class="string">            char_seq_tensor: (batch_size*max_sent_len, max_word_len) Variable</span></span><br><span class="line"><span class="string">            char_seq_lengths: (batch_size*max_sent_len,1) Tensor</span></span><br><span class="line"><span class="string">            char_seq_recover: (batch_size*max_sent_len,1)  recover char sequence order</span></span><br><span class="line"><span class="string">            label_seq_tensor: (batch_size, max_sent_len)</span></span><br><span class="line"><span class="string">            mask: (batch_size, max_sent_len)</span></span><br><span class="line"><span class="string">            object_tensor: (batch_size, max_topic_len) Variable</span></span><br><span class="line"><span class="string">            object_mask: (batch_size, max_topic_len)</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    batch_size = <span class="built_in">len</span>(input_batch_list)</span><br><span class="line">    words = [sent[<span class="number">0</span>] <span class="keyword">for</span> sent <span class="keyword">in</span> input_batch_list] <span class="comment"># Ëøô‰∏™ÁªìÂêà‰∏äÈù¢ÁöÑtrain_IdsËæìÂá∫Áúã</span></span><br><span class="line">    features = [np.asarray(sent[<span class="number">1</span>]) <span class="keyword">for</span> sent <span class="keyword">in</span> input_batch_list]</span><br><span class="line">    feature_num = <span class="built_in">len</span>(features[<span class="number">0</span>][<span class="number">0</span>])</span><br><span class="line">    chars = [sent[<span class="number">2</span>] <span class="keyword">for</span> sent <span class="keyword">in</span> input_batch_list]</span><br><span class="line">    labels = [sent[<span class="number">3</span>] <span class="keyword">for</span> sent <span class="keyword">in</span> input_batch_list]</span><br><span class="line">    objects = [sent[<span class="number">4</span>] <span class="keyword">for</span> sent <span class="keyword">in</span> input_batch_list]</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    word_seq_lengths = torch.LongTensor(<span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">len</span>, words)))</span><br><span class="line">    max_seq_len = word_seq_lengths.<span class="built_in">max</span>().item()</span><br><span class="line">    word_seq_tensor = torch.zeros((batch_size, max_seq_len), requires_grad =  if_train).long()</span><br><span class="line">    label_seq_tensor = torch.zeros((batch_size, max_seq_len), requires_grad =  if_train).long()</span><br><span class="line">    object_tensor = torch.zeros((batch_size, max_object_nb), requires_grad=if_train).long()</span><br><span class="line">    object_mask = torch.zeros((batch_size, max_object_nb), requires_grad=if_train).byte()</span><br><span class="line">    object_lengths = torch.LongTensor(<span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">len</span>, objects)))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> idx, (seq, label, seqlen) <span class="keyword">in</span> <span class="built_in">enumerate</span>(<span class="built_in">zip</span>(words, labels, word_seq_lengths)):</span><br><span class="line">        seqlen = seqlen.item()</span><br><span class="line">        word_seq_tensor[idx, :seqlen] = torch.LongTensor(seq)</span><br><span class="line">        label_seq_tensor[idx, :seqlen] = torch.LongTensor(label)</span><br><span class="line">        mask[idx, :seqlen] = torch.Tensor([<span class="number">1</span>]*seqlen)</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">Ouput of batch_word</span><br><span class="line">tensor([[<span class="number">17263</span>,   <span class="number">876</span>, <span class="number">17264</span>,  <span class="number">5671</span>,     <span class="number">8</span>, <span class="number">17265</span>,    <span class="number">15</span>,   <span class="number">313</span>,  <span class="number">3082</span>,  <span class="number">2398</span>,</span><br><span class="line">            <span class="number">29</span>,  <span class="number">6190</span>,  <span class="number">9973</span>, <span class="number">11973</span>,   <span class="number">127</span>,   <span class="number">300</span>,  <span class="number">4878</span>,    <span class="number">36</span>,  <span class="number">1070</span>,  <span class="number">1397</span>,</span><br><span class="line">         <span class="number">17266</span>,   <span class="number">192</span>,   <span class="number">192</span>, <span class="number">17267</span>],</span><br><span class="line">        [    <span class="number">2</span>, <span class="number">16550</span>,     <span class="number">4</span>,   <span class="number">147</span>,     <span class="number">5</span>,   <span class="number">723</span>, <span class="number">16551</span>,   <span class="number">803</span>,  <span class="number">1452</span>,    <span class="number">83</span>,</span><br><span class="line">           <span class="number">785</span>,    <span class="number">69</span>,  <span class="number">1053</span>,     <span class="number">5</span>, <span class="number">16552</span>, <span class="number">16553</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,</span><br><span class="line">             <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>],</span><br><span class="line">        [    <span class="number">2</span>,  <span class="number">2067</span>,     <span class="number">5</span>,  <span class="number">2068</span>,  <span class="number">2069</span>,  <span class="number">2070</span>,  <span class="number">2071</span>,  <span class="number">2072</span>,  <span class="number">2070</span>,  <span class="number">2073</span>,</span><br><span class="line">          <span class="number">2074</span>,  <span class="number">2075</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,</span><br><span class="line">             <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>],</span><br><span class="line">        [    <span class="number">2</span>, <span class="number">18490</span>,     <span class="number">5</span>,  <span class="number">3053</span>,    <span class="number">19</span>,  <span class="number">1746</span>,    <span class="number">69</span>,  <span class="number">1465</span>,  <span class="number">8699</span>,   <span class="number">192</span>,</span><br><span class="line">         <span class="number">18491</span>, <span class="number">18492</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,</span><br><span class="line">             <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>],</span><br><span class="line">        [    <span class="number">2</span>, <span class="number">11806</span>,     <span class="number">5</span>,  <span class="number">6629</span>,   <span class="number">300</span>,   <span class="number">470</span>,    <span class="number">14</span>, <span class="number">11807</span>, <span class="number">11808</span>, <span class="number">11809</span>,</span><br><span class="line">             <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,</span><br><span class="line">             <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>],</span><br><span class="line">        [    <span class="number">2</span>, <span class="number">18415</span>,     <span class="number">5</span>, <span class="number">10658</span>, <span class="number">18416</span>,  <span class="number">3119</span>,  <span class="number">5198</span>,    <span class="number">45</span>,    <span class="number">94</span>, <span class="number">18417</span>,</span><br><span class="line">             <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,</span><br><span class="line">             <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>],</span><br><span class="line">        [    <span class="number">2</span>, <span class="number">10927</span>,     <span class="number">5</span>, <span class="number">10782</span>,  <span class="number">4134</span>, <span class="number">16619</span>,   <span class="number">192</span>, <span class="number">16620</span>, <span class="number">16621</span>,     <span class="number">0</span>,</span><br><span class="line">             <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,</span><br><span class="line">             <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>],</span><br><span class="line">        [    <span class="number">2</span>, <span class="number">16279</span>,     <span class="number">5</span>,    <span class="number">58</span>,   <span class="number">786</span>,  <span class="number">7513</span>, <span class="number">16280</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,</span><br><span class="line">             <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,</span><br><span class="line">             <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>],</span><br><span class="line">        [    <span class="number">2</span>, <span class="number">17990</span>,     <span class="number">5</span>, <span class="number">17991</span>, <span class="number">17992</span>, <span class="number">17993</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,</span><br><span class="line">             <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,</span><br><span class="line">             <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>],</span><br><span class="line">        [ <span class="number">4012</span>,   <span class="number">131</span>,    <span class="number">96</span>,   <span class="number">192</span>, <span class="number">20515</span>, <span class="number">20516</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,</span><br><span class="line">             <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,</span><br><span class="line">             <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>]], device=<span class="string">'cuda:0'</span>)</span><br><span class="line">torch.Size([<span class="number">10</span>, <span class="number">24</span>])</span><br><span class="line"></span><br><span class="line">tensor([[    <span class="number">2</span>,  <span class="number">7381</span>,     <span class="number">5</span>,  <span class="number">7388</span>,   <span class="number">341</span>, <span class="number">16686</span>, <span class="number">16687</span>,  <span class="number">3635</span>,    <span class="number">37</span>,  <span class="number">4535</span>,</span><br><span class="line">           <span class="number">495</span>, <span class="number">16688</span>,    <span class="number">15</span>,   <span class="number">672</span>,  <span class="number">5484</span>,     <span class="number">8</span>, <span class="number">13808</span>,    <span class="number">69</span>,    <span class="number">37</span>,  <span class="number">7460</span>,</span><br><span class="line">             <span class="number">8</span>,    <span class="number">92</span>,    <span class="number">15</span>,    <span class="number">92</span>,  <span class="number">1403</span>,   <span class="number">323</span>,  <span class="number">7152</span>,  <span class="number">1408</span>],</span><br><span class="line">        [    <span class="number">2</span>, <span class="number">17320</span>,     <span class="number">5</span>,  <span class="number">6209</span>,   <span class="number">159</span>,  <span class="number">1497</span>,    <span class="number">14</span>,    <span class="number">94</span>,   <span class="number">181</span>,  <span class="number">9653</span>,</span><br><span class="line">           <span class="number">192</span>, <span class="number">17321</span>,  <span class="number">2714</span>,     <span class="number">5</span>, <span class="number">17322</span>, <span class="number">17323</span>,   <span class="number">100</span>,     <span class="number">5</span>,   <span class="number">101</span>,    <span class="number">15</span>,</span><br><span class="line">         <span class="number">17324</span>, <span class="number">17325</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>],</span><br><span class="line">        [<span class="number">15582</span>,    <span class="number">69</span>, <span class="number">13403</span>,     <span class="number">5</span>,  <span class="number">1448</span>,  <span class="number">3767</span>,   <span class="number">225</span>,   <span class="number">159</span>, <span class="number">15583</span>, <span class="number">15584</span>,</span><br><span class="line">            <span class="number">88</span>,    <span class="number">32</span>,  <span class="number">9694</span>, <span class="number">15585</span>,    <span class="number">39</span>, <span class="number">12421</span>,     <span class="number">5</span>, <span class="number">15586</span>,  <span class="number">6279</span>, <span class="number">15587</span>,</span><br><span class="line">             <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>],</span><br><span class="line">        [    <span class="number">2</span>, <span class="number">20728</span>,     <span class="number">5</span>,   <span class="number">122</span>,  <span class="number">1284</span>,     <span class="number">8</span>,   <span class="number">566</span>,   <span class="number">629</span>,    <span class="number">15</span>,    <span class="number">15</span>,</span><br><span class="line">            <span class="number">15</span>,    <span class="number">15</span>,    <span class="number">20</span>, <span class="number">20729</span>,    <span class="number">15</span>, <span class="number">20730</span>, <span class="number">20731</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,</span><br><span class="line">             <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>],</span><br><span class="line">        [    <span class="number">2</span>,  <span class="number">8460</span>,     <span class="number">5</span>,  <span class="number">8461</span>,  <span class="number">8462</span>,    <span class="number">97</span>,  <span class="number">3660</span>,  <span class="number">8463</span>,    <span class="number">36</span>,   <span class="number">622</span>,</span><br><span class="line">          <span class="number">8464</span>,  <span class="number">8465</span>,   <span class="number">291</span>,  <span class="number">8466</span>,  <span class="number">8467</span>,  <span class="number">8468</span>,  <span class="number">8469</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,</span><br><span class="line">             <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>],</span><br><span class="line">        [  <span class="number">841</span>,     <span class="number">5</span>, <span class="number">15006</span>,  <span class="number">1399</span>, <span class="number">15007</span>,    <span class="number">69</span>, <span class="number">15008</span>,   <span class="number">659</span>,   <span class="number">267</span>, <span class="number">15009</span>,</span><br><span class="line">          <span class="number">4784</span>, <span class="number">15010</span>, <span class="number">15011</span>, <span class="number">15012</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,</span><br><span class="line">             <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>],</span><br><span class="line">        [    <span class="number">2</span>, <span class="number">21204</span>,     <span class="number">5</span>, <span class="number">17259</span>,    <span class="number">29</span>,   <span class="number">341</span>,    <span class="number">15</span>, <span class="number">21205</span>,   <span class="number">159</span>,  <span class="number">1619</span>,</span><br><span class="line">          <span class="number">1760</span>,   <span class="number">473</span>,    <span class="number">15</span>, <span class="number">21206</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,</span><br><span class="line">             <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>],</span><br><span class="line">        [    <span class="number">2</span>,  <span class="number">3129</span>,     <span class="number">5</span>,  <span class="number">1448</span>, <span class="number">13414</span>, <span class="number">13415</span>,    <span class="number">19</span>, <span class="number">13416</span>,    <span class="number">37</span>,  <span class="number">1659</span>,</span><br><span class="line">             <span class="number">8</span>, <span class="number">13417</span>, <span class="number">13418</span>, <span class="number">13419</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,</span><br><span class="line">             <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>],</span><br><span class="line">        [ <span class="number">1520</span>, <span class="number">10610</span>,    <span class="number">36</span>, <span class="number">10611</span>, <span class="number">10612</span>, <span class="number">10613</span>,    <span class="number">97</span>, <span class="number">10614</span>,    <span class="number">15</span>,    <span class="number">15</span>,</span><br><span class="line">            <span class="number">15</span>, <span class="number">10615</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,</span><br><span class="line">             <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>],</span><br><span class="line">        [ <span class="number">1636</span>,  <span class="number">7560</span>,  <span class="number">8074</span>,    <span class="number">36</span>,  <span class="number">6149</span>,  <span class="number">8075</span>,   <span class="number">192</span>,  <span class="number">8076</span>,     <span class="number">0</span>,     <span class="number">0</span>,</span><br><span class="line">             <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,</span><br><span class="line">             <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>]],</span><br><span class="line">       device=<span class="string">'cuda:0'</span>)</span><br><span class="line">torch.Size([<span class="number">10</span>, <span class="number">28</span>])</span><br></pre></td></tr></tbody></table></figure>
<p>ÁúãÂà∞Ëøô‰∏™<code>'cuda:0'</code>ÁúüÊª¥ÊòØÈùûÂ∏∏ÁöÑÁæ°ÊÖïÂïäÔºå‰∏ç‰ºöÂá∫bugÔºåÁÑ∂ÂêéÂ∞±Áúã‰∫Ü‰∏Ä‰∏ãÊ∫êÁ†ÅÔºåÊòØËøôÊ†∑Â§ÑÁêÜÁöÑÔºåÂÖ∂ÂÆûÂ∞±ÊòØÂä†‰∏™<code>gpu</code>Âà§Êñ≠ÁÑ∂Âêé<code>cuda()</code>Ôºö</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> gpu:</span><br><span class="line">    word_seq_tensor = word_seq_tensor.cuda()</span><br><span class="line">    <span class="keyword">for</span> idx <span class="keyword">in</span> <span class="built_in">range</span>(feature_num):</span><br><span class="line">        feature_seq_tensors[idx] = feature_seq_tensors[idx].cuda()</span><br><span class="line">    word_seq_lengths = word_seq_lengths.cuda()</span><br><span class="line">    word_seq_recover = word_seq_recover.cuda()</span><br><span class="line">    label_seq_tensor = label_seq_tensor.cuda()</span><br><span class="line">    char_seq_tensor = char_seq_tensor.cuda()</span><br><span class="line">    char_seq_recover = char_seq_recover.cuda()</span><br><span class="line">    object_tensor = object_tensor.cuda()</span><br><span class="line">    object_mask = object_mask.cuda()</span><br><span class="line">    mask = mask.cuda()</span><br></pre></td></tr></tbody></table></figure>
<p>ÁÑ∂ÂêéÊé•‰∏ãÊù•ÂÖ∂ÂÆûÂ∞±ÊòØÊääËøô‰∫õ<code>batch input</code>ÂñÇÁªôÊ®°ÂûãÔºåÂ∞±ÂèØ‰ª•ÂéªËÆ≠ÁªÉ‰∫Ü„ÄÇ</p>
<p>ËøôÈáåËøòÊòØË¶ÅÊèê‰∏ÄÂè•ÔºåËøô‰∏™<code>cuda</code>Êä•ÈîôÁöÑÈóÆÈ¢òË¶ÅÊÄé‰πàÂéªÈÅøÂÖçÔºåÂõ†‰∏∫ÈªòËÆ§<code>tensor</code>ÈÉΩÊòØÊîæÂà∞<code>cpu</code>‰∏äÁöÑÔºö</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> data.HP_gpu:</span><br><span class="line">        model = model.cuda()</span><br></pre></td></tr></tbody></table></figure>
<p>ÂÖ∂ÂÆû<code>train</code>ÁöÑÁªìÊûÑÁÆóÊòØÊØîËæÉÁÆÄÂçïÁöÑÔºåÂ∞±ÊòØËÆæÁΩÆ‰∫Ü<code>epoch iteration</code>ÁöÑÊï∞ÈáèÂéªÂæ™ÁéØÔºå1‰∏™<code>epoch</code>ÊòØÊåáÊääÊï¥‰∏™ËÆ≠ÁªÉÈõÜËøá‰∏ÄÈÅçÔºå1‰∏™<code>epoch</code>ÂÜÖÔºåÊòØÈúÄË¶ÅËøõË°åÁõ∏Â∫îÁöÑ<code>batch iteration</code>ÁöÑÔºåÂÖ∂ÂÆû‰πüÂ∞±ÊòØÂØπ<code>train_size // batch_size</code>Ëøô‰πàÂ§öÁªÑ<code>batch</code>ËøõË°åÂæ™ÁéØÔºåÂêåÊó∂ËÆ°ÁÆó<code>loss</code>Âπ∂ÂèçÂêë‰º†Êí≠Êõ¥Êñ∞„ÄÇ</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">model.train()</span><br><span class="line">        model.zero_grad()</span><br><span class="line">        batch_size = data.HP_batch_size</span><br><span class="line">        batch_id = <span class="number">0</span></span><br><span class="line">        train_num = <span class="built_in">len</span>(data.train_Ids)</span><br><span class="line">        total_batch = train_num//batch_size+<span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> batch_id <span class="keyword">in</span> <span class="built_in">range</span>(total_batch):</span><br><span class="line">            start = batch_id*batch_size</span><br><span class="line">            end = (batch_id+<span class="number">1</span>)*batch_size</span><br><span class="line">            <span class="keyword">if</span> end &gt;train_num:</span><br><span class="line">                end = train_num</span><br><span class="line">            instance = data.train_Ids[start:end]</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> instance:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            batch_word, batch_features, batch_wordlen, batch_wordrecover, batch_char, batch_charlen, batch_charrecover, batch_label, mask, batch_obj, obj_mask = batchify_with_label(instance, data.HP_gpu, <span class="literal">True</span>, data.sentence_classification, data.MAX_OBJECT_NB)</span><br><span class="line">            instance_count += <span class="number">1</span></span><br><span class="line">            loss, tag_seq = model.calculate_loss(batch_word, batch_features, batch_wordlen, batch_char, batch_charlen, batch_charrecover, batch_label, mask, batch_obj, obj_mask)</span><br><span class="line">            right, whole = predict_check(tag_seq, batch_label, mask, data.sentence_classification)</span><br><span class="line">            right_token += right</span><br><span class="line">            whole_token += whole</span><br><span class="line">            <span class="comment"># print("loss:",loss.item())</span></span><br><span class="line">            sample_loss += loss.item()</span><br><span class="line">            total_loss += loss.item()</span><br><span class="line">            <span class="keyword">if</span> end%<span class="number">500</span> == <span class="number">0</span>:</span><br><span class="line">                temp_time = time.time()</span><br><span class="line">                temp_cost = temp_time - temp_start</span><br><span class="line">                temp_start = temp_time</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">"     Instance: %s; Time: %.2fs; loss: %.4f; acc: %s/%s=%.4f"</span>%(end, temp_cost, sample_loss, right_token, whole_token,(right_token+<span class="number">0.</span>)/whole_token))</span><br><span class="line">                <span class="keyword">if</span> sample_loss &gt; <span class="number">1e8</span> <span class="keyword">or</span> <span class="built_in">str</span>(sample_loss) == <span class="string">"nan"</span>:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">"ERROR: LOSS EXPLOSION (&gt;1e8) ! PLEASE SET PROPER PARAMETERS AND STRUCTURE! EXIT...."</span>)</span><br><span class="line">                    exit(<span class="number">1</span>)</span><br><span class="line">                sys.stdout.flush()</span><br><span class="line">                sample_loss = <span class="number">0</span></span><br><span class="line">            loss.backward()</span><br><span class="line">            optimizer.step()</span><br><span class="line">            model.zero_grad()</span><br></pre></td></tr></tbody></table></figure>
<p>ÈáåÈù¢ËøòÊúâ‰∏™<code>evaluate</code>ÁöÑÈÉ®ÂàÜÔºåËøôÈÉ®ÂàÜ‰ºöÂçïÁã¨ÊãøÂá∫Êù•ËØ¥ÔºåÂõ†‰∏∫‰πãÂâçÂú®ËøôÈáåÈÅáÂà∞‰∫Übug„ÄÇ</p>
<p>ÁÑ∂ÂêéËøôÊ†∑ÁöÑËØùÔºåÂ§ßËá¥ÁÆóÊòØËøá‰∫Ü‰∏ÄÈÅçÊµÅÁ®ãÔºåÊé•‰∏ãÊù•ÁöÑChapter‰ºöÁªÜËá¥ÁöÑËß£Êûê„ÄÇ</p>
<h2 id="Êï¥‰ΩìÊû∂ÊûÑ">Êï¥‰ΩìÊû∂ÊûÑ</h2>
<h3 id="Â¶Ç‰ΩïÂàõÂª∫‰∏Ä‰∏™Â∑•Á®ã">Â¶Ç‰ΩïÂàõÂª∫‰∏Ä‰∏™Â∑•Á®ã</h3>
<blockquote>
<p>ËøôÈÉ®ÂàÜÊîπÁºñËá™<a target="_blank" rel="noopener" href="https://github.com/chenyuntc/pytorch-book/blob/master/chapter06-best_practice/PyTorch%E5%AE%9E%E6%88%98%E6%8C%87%E5%8D%97.md#617-mainpy">link</a></p>
</blockquote>
<p>Â§ß‰ΩìÁöÑÁõÆÂΩïÂ¶Ç‰∏ã(‰∏çÊòØÂÖ®ÈÉ®)Ôºö</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">‚îú‚îÄ‚îÄ checkpoints/</span><br><span class="line">‚îú‚îÄ‚îÄ data/</span><br><span class="line">‚îÇ   ‚îú‚îÄ‚îÄ __init__.py</span><br><span class="line">‚îÇ   ‚îú‚îÄ‚îÄ dataset.py</span><br><span class="line">‚îÇ   ‚îî‚îÄ‚îÄ get_data.sh</span><br><span class="line">‚îú‚îÄ‚îÄ models/</span><br><span class="line">‚îÇ   ‚îú‚îÄ‚îÄ __init__.py</span><br><span class="line">‚îÇ   ‚îú‚îÄ‚îÄ crf.py</span><br><span class="line">‚îÇ   ‚îú‚îÄ‚îÄ mca.py</span><br><span class="line">‚îÇ   ‚îî‚îÄ‚îÄ MUL_LSTM_MCA.py</span><br><span class="line">‚îî‚îÄ‚îÄ utils/</span><br><span class="line">‚îÇ   ‚îú‚îÄ‚îÄ __init__.py</span><br><span class="line">‚îÇ   ‚îú‚îÄ‚îÄ alphabet.py</span><br><span class="line">‚îÇ   ‚îú‚îÄ‚îÄ data.py</span><br><span class="line">‚îÇ   ‚îú‚îÄ‚îÄ metric.py</span><br><span class="line">‚îÇ   ‚îî‚îÄ‚îÄ functions.py</span><br><span class="line">‚îî‚îÄ‚îÄ object_detector/</span><br><span class="line">‚îÇ   ‚îú‚îÄ‚îÄ mrcnn/</span><br><span class="line">‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config.py</span><br><span class="line">‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ model.py</span><br><span class="line">‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ utils.py</span><br><span class="line">‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ visualize.py</span><br><span class="line">‚îÇ   ‚îú‚îÄ‚îÄ detector.py</span><br><span class="line">‚îú‚îÄ‚îÄ sample.train.config</span><br><span class="line">‚îú‚îÄ‚îÄ main.py</span><br><span class="line">‚îú‚îÄ‚îÄ requirements.txt</span><br><span class="line">‚îú‚îÄ‚îÄ README.md</span><br></pre></td></tr></tbody></table></figure>
<p>ÂÖ∂‰∏≠Ôºö</p>
<ul>
<li><code>checkpoints/</code>Ôºö Áî®‰∫é‰øùÂ≠òËÆ≠ÁªÉÂ•ΩÁöÑÊ®°ÂûãÔºåÂèØ‰ΩøÁ®ãÂ∫èÂú®ÂºÇÂ∏∏ÈÄÄÂá∫Âêé‰ªçËÉΩÈáçÊñ∞ËΩΩÂÖ•Ê®°ÂûãÔºåÊÅ¢Â§çËÆ≠ÁªÉ</li>
<li><code>data/</code>ÔºöÊï∞ÊçÆÁõ∏ÂÖ≥Êìç‰ΩúÔºåÂåÖÊã¨Êï∞ÊçÆÈ¢ÑÂ§ÑÁêÜ„ÄÅdatasetÂÆûÁé∞Á≠â</li>
<li><code>models/</code>ÔºöÊ®°ÂûãÂÆö‰πâÔºåÂèØ‰ª•ÊúâÂ§ö‰∏™Ê®°ÂûãÔºå‰æãÂ¶Ç‰∏äÈù¢ÁöÑ<code>crf</code>Âíå<code>MUL_LSTM_MCA</code>Ôºå‰∏Ä‰∏™Ê®°ÂûãÂØπÂ∫î‰∏Ä‰∏™Êñá‰ª∂</li>
<li><code>utils/</code>ÔºöÂèØËÉΩÁî®Âà∞ÁöÑÂ∑•ÂÖ∑ÂáΩÊï∞ÔºåÂú®Ëøô‰∏™È°πÁõÆ‰∏≠‰∏ªË¶ÅÊòØÂ∞ÅË£Ö‰∫ÜËØçË°®ÁöÑ‰∏Ä‰∫õÁõ∏ÂÖ≥ÂáΩÊï∞„ÄÇ</li>
<li><code>config.py</code>ÔºöÈÖçÁΩÆÊñá‰ª∂ÔºåÊâÄÊúâÂèØÈÖçÁΩÆÁöÑÂèòÈáèÈÉΩÈõÜ‰∏≠Âú®Ê≠§ÔºåÂπ∂Êèê‰æõÈªòËÆ§ÂÄº</li>
<li><code>main.py</code>Ôºö‰∏ªÊñá‰ª∂ÔºåËÆ≠ÁªÉÂíåÊµãËØïÁ®ãÂ∫èÁöÑÂÖ•Âè£ÔºåÂèØÈÄöËøá‰∏çÂêåÁöÑÂëΩ‰ª§Êù•ÊåáÂÆö‰∏çÂêåÁöÑÊìç‰ΩúÂíåÂèÇÊï∞</li>
<li><code>requirements.txt</code>ÔºöÁ®ãÂ∫è‰æùËµñÁöÑÁ¨¨‰∏âÊñπÂ∫ì</li>
<li><code>README.md</code>ÔºöÊèê‰æõÁ®ãÂ∫èÁöÑÂøÖË¶ÅËØ¥Êòé</li>
</ul>
<h4 id="Êï∞ÊçÆÂä†ËΩΩ">Êï∞ÊçÆÂä†ËΩΩ</h4>
<p>ËøôÈÉ®ÂàÜË¶ÅÁúãÂÖ∑‰ΩìÁöÑ‰ªªÂä°ÔºåËøòË¶ÅÁúãÊèê‰æõÁöÑÊï∞ÊçÆÈõÜÊ†ºÂºèÔºåÊúâÊó∂ÂÄôÊï∞ÊçÆÈõÜÊòØÂàíÂàÜÂ•ΩÁöÑÔºåÊúâÊó∂ÂÄôÊòØË¶ÅËá™Â∑±ÂéªÂàíÂàÜÈ™åËØÅÈõÜ„ÄÅÊµãËØïÈõÜÁöÑ„ÄÇËøôÈáåËøòÂèØ‰ª•Áî®Âà∞<code>torchtext</code>Âï•ÁöÑÔºåÊúâÊú∫‰ºö‰ºöÁªÜÁêêÔºå‰ΩÜÊòØÂ∫îËØ•‰∏çÊòØÂú®ËøôÁØáÊñáÁ´†Èáå„ÄÇ</p>
<p>Êàë‰∏æ‰∏™Ê†óÂ≠êÔºåÊØîÂ¶ÇËøôÁßçÊñáÊú¨ÂàÜÁ±ªÁöÑÂ§ÑÁêÜÔºåÂ∞±ÊòØ<code>tokenize</code>ÂÜçÊûÑÂª∫<code>vocab</code>ÂÜçÂéªÊûÑÂª∫<code>embedding</code>ÔºåËÄåÂØπ‰∫é<code>NER</code>ÔºåËøòË¶ÅËÄÉËôë<code>label</code>Âï•ÁöÑÔºåÁªÜËäÇÊòØÊúâ‰∫õ‰∏ç‰∏ÄÊ†∑Ôºå‰ΩÜÊòØËøòÊòØÊúâÂæàÂ§öÂÖ±ÂêåÁöÑÂú∞ÊñπÔºåËøô‰∏™ÂÖàÈ∏Ω‰∏Ä‰∏ãÔºåÈ°πÁõÆÂÅöÂ§ö‰∫ÜÂ∞±ÂõûÊù•ÊÄªÁªì„ÄÇ</p>
<img src="https://moonhotel.oss-cn-shanghai.aliyuncs.com/images/21102512313.jpg" alt="img" style="zoom: 50%;">
<h4 id="ÂÖ≥‰∫é-init-py">ÂÖ≥‰∫é_<em>init</em>_.py</h4>
<p>ÂèØ‰ª•ÁúãÂà∞ÔºåÂá†‰πéÊØè‰∏™Êñá‰ª∂Â§π‰∏ãÈÉΩÊúâ<code>__init__.py</code>Ôºå‰∏Ä‰∏™ÁõÆÂΩïÂ¶ÇÊûúÂåÖÂê´‰∫Ü<code>__init__.py</code> Êñá‰ª∂ÔºåÈÇ£‰πàÂÆÉÂ∞±ÂèòÊàê‰∫Ü‰∏Ä‰∏™ÂåÖÔºàpackageÔºâ„ÄÇ<code>__init__.py</code>ÂèØ‰ª•‰∏∫Á©∫Ôºå‰πüÂèØ‰ª•ÂÆö‰πâÂåÖÁöÑÂ±ûÊÄßÂíåÊñπÊ≥ïÔºå‰ΩÜÂÖ∂ÂøÖÈ°ªÂ≠òÂú®ÔºåÂÖ∂ÂÆÉÁ®ãÂ∫èÊâçËÉΩ‰ªéËøô‰∏™ÁõÆÂΩï‰∏≠ÂØºÂÖ•Áõ∏Â∫îÁöÑÊ®°ÂùóÊàñÂáΩÊï∞„ÄÇ‰æãÂ¶ÇÂú®<code>data/</code>Êñá‰ª∂Â§π‰∏ãÊúâ<code>__init__.py</code>ÔºåÂàôÂú®<code>main.py</code> ‰∏≠Â∞±ÂèØ‰ª•<code>from data.dataset import DogCat</code>„ÄÇËÄåÂ¶ÇÊûúÂú®<code>__init__.py</code>‰∏≠ÂÜôÂÖ•<code>from .dataset import DogCat</code>ÔºåÂàôÂú®main.py‰∏≠Â∞±ÂèØ‰ª•Áõ¥Êé•ÂÜô‰∏∫Ôºö<code>from data import DogCat</code>ÔºåÊàñËÄÖ<code>import data; dataset = data.DogCat</code>ÔºåÁõ∏ÊØî‰∫é<code>from data.dataset import DogCat</code>Êõ¥Âä†‰æøÊç∑„ÄÇ</p>
<h4 id="Ê®°Âûã">Ê®°Âûã</h4>
<p>Ëøô‰∏™Êê≠Ê®°ÂûãÔºå‰∏™‰∫∫ÊÑüËßâÁõ∏ÂØπÊù•ËØ¥ÊØîËæÉÁÆÄÂçïÔºåÊØïÁ´üÊï¥‰ΩìÊù•ÁúãÂ∞±ÂíåÊê≠ÁßØÊú®‰∏ÄÊ†∑ÔºåÊääËæìÂÖ•ËæìÂá∫Áª¥Â∫¶ÂºÑÂ•ΩÔºåË∞ÉË∞ÉÂ∫ìÂ∞±Áõ¥Êé•Ëß£ÂÜ≥„ÄÇ</p>
<p>‰ΩÜÊòØÊçèÔºåÂÉè<code>bert</code>ËøôÁßçÈ¢ÑËÆ≠ÁªÉÊ®°ÂûãÔºåÊàë‰πãÂâçÊ≤°Êé•Ëß¶ËøáÔºåÊâÄ‰ª•ÂàöÂºÄÂßãÂè™Áü•ÈÅì‰∏Ä‰∏™<code>hugggingface</code>Ôºå‰∏çÁü•ÈÅìÂÖ∑‰ΩìÊÄé‰πàÂéªÁî®<code>bert</code>ÔºåËøôÈáåËØ¶ÁªÜËÆ∞ÂΩï‰∏Ä‰∏ã„ÄÇ</p>
<p>Áõ¥Êé•<code>import bert</code>ÁöÑÂåÖÊòØ‰∏çÂ§üÁöÑÔºåËøòÊúâ<code>config</code>ÂíåÂèÇÊï∞Âä†ËΩΩÁöÑËøáÁ®ãÔºö</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> transformers</span><br><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> BertConfig,BertModel</span><br><span class="line"></span><br><span class="line">bert_config = BertConfig.from_json_file(<span class="string">"model/config.json"</span>) </span><br><span class="line">bert = BertModel(self.bert_config)</span><br><span class="line"></span><br><span class="line">a = torch.load(<span class="string">"./model/pytorch_model.bin"</span>)</span><br><span class="line">model_dict = bert.state_dict()</span><br><span class="line">pretrained_dict = {k:v <span class="keyword">for</span> k,v <span class="keyword">in</span> a.items() <span class="keyword">if</span> k <span class="keyword">in</span> model_dict}</span><br><span class="line">model_dict.update(pretrained_dict)</span><br><span class="line">bert.load_state_dict(model_dict)</span><br><span class="line"></span><br><span class="line">output = bert(tensor_test).last_hidden_state <span class="comment"># get the output</span></span><br></pre></td></tr></tbody></table></figure>
<p>Ëøô‰∏äÈù¢ÁöÑ<code>config.json</code>Âíå<code>pytorch_model.bin</code>ÊòØË¶ÅÂéªÊä±Êä±ËÑ∏‰∏ãÁöÑÔºålinkÂú®ËøôÈáå<a target="_blank" rel="noopener" href="https://huggingface.co/bert-base-cased/tree/main">bert_based_cased</a>„ÄÇ</p>
<p><code>BiLSTM</code>Â∞±Ëíú‰∫ÜÔºåÊ≤°Âï•ÂèØËØ¥ÁöÑ‰∫ÜÔºåË∞ÉË∞ÉÂ∫ìÂ∞±ÂÆå‰∫ãÔºåÂéüÊú¨ÊòØ‰∏çÂáÜÂ§áËÆ≤ÁöÑÔºå‰ΩÜÊòØÁî±‰∫éÊîπÊ®°ÂûãÁöÑÊó∂ÂÄôÂç°bug‰∫ÜÔºåÊîπÂä®ÁöÑÂ∞±ÊòØËøôÂùóÔºå‰∏çÊîπÁöÑËØùÊòØÂ¶πÊúâÈóÆÈ¢òÁöÑÔºåÊâÄ‰ª•ËøòÊòØÊúâÂøÖË¶ÅÁúãÁúã„ÄÇ</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># char -&gt; emb -&gt; drop</span></span><br><span class="line">char_embeds = self.char_drop(</span><br><span class="line">    self.char_embeddings(char_inputs))  <span class="comment"># (batch_size * sent_len, word_length, char_emb_dim)</span></span><br><span class="line">char_hidden = <span class="literal">None</span></span><br><span class="line"><span class="comment"># -&gt; char lstm,</span></span><br><span class="line">pack_char_input = pack_padded_sequence(char_embeds, char_seq_lengths.cpu().numpy(), batch_first=<span class="literal">True</span>)</span><br><span class="line">char_rnn_out, char_hidden = self.char_lstm(pack_char_input, char_hidden)</span><br><span class="line"><span class="comment"># last hiddens</span></span><br><span class="line"><span class="comment">## char_hidden = (h_t, c_t)</span></span><br><span class="line"><span class="comment">#  char_hidden[0] = h_t = (2, batch_size, lstm_dimension)</span></span><br><span class="line">char_features = char_hidden[<span class="number">0</span>].transpose(<span class="number">1</span>, <span class="number">0</span>).contiguous().view(char_batch_size, -<span class="number">1</span>)  <span class="comment"># (batch_size * sent_len, char_hidden_dim)</span></span><br><span class="line">char_features = char_features[char_seq_recover]</span><br><span class="line"><span class="comment"># cat char_hidden_dim for every char in a word</span></span><br><span class="line">char_features = char_features.view(batch_size, sent_len, -<span class="number">1</span>)  <span class="comment"># (batch_size, sent_len, char_hidden_dim)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># word -&gt; word emb</span></span><br><span class="line">word_embs = self.word_embeddings(word_inputs)</span><br><span class="line"><span class="comment"># concat-&gt; word represent</span></span><br><span class="line">word_represent = torch.cat([word_embs, char_features], <span class="number">2</span>)</span><br><span class="line">word_represent = self.word_drop(word_represent)  <span class="comment"># (batch_size, sent_len, char_hidden_dim + word_emb_dim)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -&gt; word seq lstm</span></span><br><span class="line">packed_word = pack_padded_sequence(word_represent, word_seq_lengths.cpu().numpy(), <span class="literal">True</span>)</span><br><span class="line">hidden = <span class="literal">None</span></span><br><span class="line">lstm_out, hidden = self.word_lstm(packed_word, hidden)</span><br><span class="line">lstm_out, _ = pad_packed_sequence(lstm_out, batch_first=<span class="literal">True</span>)</span><br><span class="line">text_feat = self.droplstm(lstm_out)  <span class="comment"># (batch_size, sent_len, hidden_dim) X</span></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">text_feat:</span><br><span class="line"></span><br><span class="line">tensor([[[ <span class="number">2.4799e-01</span>,  <span class="number">0.0000e+00</span>, -<span class="number">5.9055e-02</span>,  ...,  <span class="number">0.0000e+00</span>,</span><br><span class="line">          -<span class="number">0.0000e+00</span>, -<span class="number">0.0000e+00</span>],</span><br><span class="line">         [-<span class="number">6.9201e-01</span>,  <span class="number">1.2951e+00</span>, -<span class="number">4.5080e-01</span>,  ...,  <span class="number">0.0000e+00</span>,</span><br><span class="line">          -<span class="number">0.0000e+00</span>, -<span class="number">0.0000e+00</span>],</span><br><span class="line">         [-<span class="number">0.0000e+00</span>,  <span class="number">0.0000e+00</span>, -<span class="number">2.0977e-01</span>,  ..., -<span class="number">2.4604e-01</span>,</span><br><span class="line">          -<span class="number">4.0794e-01</span>,  <span class="number">0.0000e+00</span>],</span><br><span class="line">         ...,</span><br><span class="line">         [ <span class="number">0.0000e+00</span>,  <span class="number">0.0000e+00</span>,  <span class="number">0.0000e+00</span>,  ...,  <span class="number">0.0000e+00</span>,</span><br><span class="line">           <span class="number">0.0000e+00</span>,  <span class="number">0.0000e+00</span>],</span><br><span class="line">         [ <span class="number">0.0000e+00</span>,  <span class="number">0.0000e+00</span>,  <span class="number">0.0000e+00</span>,  ...,  <span class="number">0.0000e+00</span>,</span><br><span class="line">           <span class="number">0.0000e+00</span>,  <span class="number">0.0000e+00</span>],</span><br><span class="line">         [ <span class="number">0.0000e+00</span>,  <span class="number">0.0000e+00</span>,  <span class="number">0.0000e+00</span>,  ...,  <span class="number">0.0000e+00</span>,</span><br><span class="line">           <span class="number">0.0000e+00</span>,  <span class="number">0.0000e+00</span>]]], device=<span class="string">'cuda:0'</span>,</span><br><span class="line">       grad_fn=&lt;NativeDropoutBackward0&gt;)</span><br><span class="line">torch.Size([<span class="number">10</span>, <span class="number">22</span>, <span class="number">200</span>])</span><br><span class="line">object_feat1:</span><br><span class="line"></span><br><span class="line">tensor([[[ <span class="number">0.0969</span>,  <span class="number">0.1156</span>,  <span class="number">0.7336</span>,  ...,  <span class="number">0.3659</span>,  <span class="number">0.8398</span>, -<span class="number">0.0733</span>],</span><br><span class="line">         [ <span class="number">0.0969</span>,  <span class="number">0.1156</span>,  <span class="number">0.7336</span>,  ...,  <span class="number">0.3659</span>,  <span class="number">0.8398</span>, -<span class="number">0.0733</span>],</span><br><span class="line">         [ <span class="number">0.0969</span>,  <span class="number">0.1156</span>,  <span class="number">0.7336</span>,  ...,  <span class="number">0.3659</span>,  <span class="number">0.8398</span>, -<span class="number">0.0733</span>],</span><br><span class="line">         [ <span class="number">0.0969</span>,  <span class="number">0.1156</span>,  <span class="number">0.7336</span>,  ...,  <span class="number">0.3659</span>,  <span class="number">0.8398</span>, -<span class="number">0.0733</span>]]</span><br><span class="line"></span><br><span class="line">        ...,</span><br><span class="line"></span><br><span class="line">        [[ <span class="number">0.3127</span>,  <span class="number">0.2678</span>, -<span class="number">0.1752</span>,  ...,  <span class="number">0.0502</span>,  <span class="number">0.4489</span>,  <span class="number">0.0190</span>],</span><br><span class="line">         [ <span class="number">0.0328</span>,  <span class="number">0.0349</span>,  <span class="number">0.0448</span>,  ...,  <span class="number">0.0234</span>, -<span class="number">0.0258</span>, -<span class="number">0.0344</span>],</span><br><span class="line">         [ <span class="number">0.0328</span>,  <span class="number">0.0349</span>,  <span class="number">0.0448</span>,  ...,  <span class="number">0.0234</span>, -<span class="number">0.0258</span>, -<span class="number">0.0344</span>],</span><br><span class="line">         [ <span class="number">0.0328</span>,  <span class="number">0.0349</span>,  <span class="number">0.0448</span>,  ...,  <span class="number">0.0234</span>, -<span class="number">0.0258</span>, -<span class="number">0.0344</span>]]],</span><br><span class="line">       device=<span class="string">'cuda:0'</span>, grad_fn=&lt;AddBackward0&gt;)</span><br><span class="line">torch.Size([<span class="number">10</span>, <span class="number">4</span>, <span class="number">200</span>])</span><br><span class="line">object_feat2:</span><br><span class="line"></span><br><span class="line">tensor([[[ <span class="number">0.6313</span>,  <span class="number">0.0668</span>,  <span class="number">1.7060</span>,  ...,  <span class="number">0.7507</span>, -<span class="number">1.8600</span>, -<span class="number">0.0626</span>],</span><br><span class="line">         [-<span class="number">0.1332</span>, -<span class="number">0.1341</span>,  <span class="number">1.6088</span>,  ..., -<span class="number">0.1397</span>, -<span class="number">0.1451</span>, -<span class="number">0.1421</span>],</span><br><span class="line">         [ <span class="number">0.2382</span>, -<span class="number">0.0867</span>,  <span class="number">1.9205</span>,  ..., -<span class="number">0.0903</span>, -<span class="number">1.6302</span>, -<span class="number">1.1887</span>],</span><br><span class="line"></span><br><span class="line">         ...,</span><br><span class="line">         [ <span class="number">0.3853</span>, -<span class="number">0.0110</span>, -<span class="number">0.0118</span>,  ...,  <span class="number">1.0296</span>, -<span class="number">1.6793</span>, -<span class="number">0.0116</span>],</span><br><span class="line">         [ <span class="number">0.0198</span>, -<span class="number">0.0935</span>, -<span class="number">0.1009</span>,  ..., -<span class="number">0.0973</span>, -<span class="number">0.1011</span>, -<span class="number">0.0990</span>],</span><br><span class="line">         [-<span class="number">0.0844</span>,  <span class="number">0.0894</span>,  <span class="number">1.4972</span>,  ..., -<span class="number">0.0885</span>, -<span class="number">0.0920</span>, -<span class="number">0.0901</span>]]],</span><br><span class="line">       device=<span class="string">'cuda:0'</span>, grad_fn=&lt;AddBackward0&gt;)</span><br><span class="line">torch.Size([<span class="number">10</span>, <span class="number">22</span>, <span class="number">200</span>])</span><br><span class="line">final_feature:</span><br><span class="line"></span><br><span class="line">tensor([[[ <span class="number">1.8418</span>, -<span class="number">0.1712</span>,  <span class="number">0.9581</span>,  ...,  <span class="number">0.7861</span>, -<span class="number">1.2411</span>,  <span class="number">0.4923</span>],</span><br><span class="line">         [-<span class="number">2.2322</span>,  <span class="number">2.3943</span>,  <span class="number">0.4914</span>,  ..., -<span class="number">1.0388</span>,  <span class="number">0.6236</span>,  <span class="number">0.4107</span>],</span><br><span class="line">         [ <span class="number">0.3094</span>, -<span class="number">0.5312</span>,  <span class="number">1.0190</span>,  ..., -<span class="number">1.4420</span>, -<span class="number">1.4349</span>, -<span class="number">0.6635</span>],</span><br><span class="line">         ...,</span><br><span class="line"></span><br><span class="line">         [ <span class="number">0.6611</span>, -<span class="number">0.3536</span>, -<span class="number">0.6253</span>,  ...,  <span class="number">1.3579</span>, -<span class="number">1.0447</span>,  <span class="number">0.5446</span>],</span><br><span class="line">         [-<span class="number">0.2124</span>, -<span class="number">0.5470</span>, -<span class="number">0.7103</span>,  ..., -<span class="number">0.9521</span>,  <span class="number">0.6715</span>,  <span class="number">0.4549</span>],</span><br><span class="line">         [-<span class="number">0.4616</span>, -<span class="number">0.1183</span>,  <span class="number">0.8152</span>,  ..., -<span class="number">0.9340</span>,  <span class="number">0.6814</span>,  <span class="number">0.4641</span>]]],</span><br><span class="line">       device=<span class="string">'cuda:0'</span>, grad_fn=&lt;CloneBackward0&gt;)</span><br><span class="line">torch.Size([<span class="number">10</span>, <span class="number">22</span>, <span class="number">200</span>])</span><br><span class="line">outputs: </span><br><span class="line"></span><br><span class="line">torch.Size([<span class="number">10</span>, <span class="number">22</span>, <span class="number">12</span>])</span><br><span class="line">tensor([[[-<span class="number">8.9976e-01</span>,  <span class="number">3.3332e+00</span>,  <span class="number">4.5517e-01</span>,  ..., -<span class="number">6.5960e-02</span>,</span><br><span class="line">           <span class="number">5.3608e-01</span>,  <span class="number">3.6342e-01</span>],</span><br><span class="line">         [ <span class="number">8.6288e-01</span>,  <span class="number">6.8532e+00</span>, -<span class="number">1.0493e+00</span>,  ...,  <span class="number">4.0046e-01</span>,</span><br><span class="line">           <span class="number">5.7598e-01</span>,  <span class="number">3.4561e-01</span>],</span><br><span class="line">         [-<span class="number">3.6927e-01</span>,  <span class="number">4.3114e+00</span>, -<span class="number">1.8063e+00</span>,  ..., -<span class="number">1.3175e+00</span>,</span><br><span class="line">          -<span class="number">2.2204e-01</span>,  <span class="number">2.9056e-01</span>],</span><br><span class="line"></span><br><span class="line">         ...,</span><br><span class="line">         [ <span class="number">8.6925e-01</span>,  <span class="number">3.2675e+00</span>,  <span class="number">5.0813e-01</span>,  ..., -<span class="number">9.7195e-01</span>,</span><br><span class="line">           <span class="number">1.8619e-03</span>, -<span class="number">4.3975e-01</span>],</span><br><span class="line">         [ <span class="number">2.0090e-01</span>,  <span class="number">3.2550e+00</span>, -<span class="number">3.0622e-01</span>,  ..., -<span class="number">1.0537e+00</span>,</span><br><span class="line">          -<span class="number">5.0671e-01</span>, -<span class="number">1.6619e-01</span>],</span><br><span class="line">         [ <span class="number">3.9266e-02</span>,  <span class="number">1.8018e+00</span>, -<span class="number">6.3803e-01</span>,  ..., -<span class="number">2.3062e-01</span>,</span><br><span class="line">           <span class="number">3.9648e-01</span>, -<span class="number">5.0846e-01</span>]]], device=<span class="string">'cuda:0'</span>, grad_fn=&lt;AddBackward0&gt;)</span><br></pre></td></tr></tbody></table></figure>
<p>ËøôÈáåÂÜçËØ¥‰∏Ä‰∏™<code>crf</code>Ôºå‰ª•Ââç‰πüÂ∞±ÊòØÁü•ÈÅìÁª¥ÁâπÊØîÁÆóÊ≥ïÔºåÁÑ∂ÂêéÂÖ∑‰Ωì<code>crf</code>ÊÄé‰πàÂíåÁ•ûÁªèÁΩëÁªúÁªìÂêàÁöÑÂü∫Êú¨Ê≤°‰∫ÜËß£ËøáÔºåËøôÈáå‰ª•<code>pytorch</code>ÂÆòÊñπÊñáÊ°£ÂíåÊú¨Ê®°ÂûãÁöÑ‰ª£Á†ÅÂÅö‰∏™ËæÉ‰∏∫ÁªÜËá¥ÁöÑËß£ËØª„ÄÇ</p>
<p>ÂéüÁêÜÁöÑÈÉ®ÂàÜÁúãËøô‰∏™Ôºö <a target="_blank" rel="noopener" href="https://www.zhihu.com/question/316740909/answer/2380526295">https://www.zhihu.com/question/316740909/answer/2380526295</a></p>
<blockquote>
<p>Ë°•ÂÖÖÊ¶ÇÁéáÂõæÊ®°ÂûãÂ§ßËá¥‰ªãÁªçÔºö</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/jiangkejie/p/10729773.html">https://www.cnblogs.com/jiangkejie/p/10729773.html</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44441131/article/details/104434297">https://blog.csdn.net/weixin_44441131/article/details/104434297</a></p>
<p><a target="_blank" rel="noopener" href="https://longaspire.github.io/blog/%E6%A6%82%E7%8E%87%E5%9B%BE%E6%A8%A1%E5%9E%8B%E6%80%BB%E8%A7%88/">https://longaspire.github.io/blog/Ê¶ÇÁéáÂõæÊ®°ÂûãÊÄªËßà/</a></p>
</blockquote>
<p>ÁÑ∂ÂêéÊé•‰∏ãÊù•ÊòØ<code>pytorch</code>ÂÆòÊñπ<code>bilstm + crf</code>‰ª£Á†ÅÁöÑÂàÜÊûêÔºåÂèØ‰ª•ÁúãËøô‰∏™Ôºö</p>
<ul>
<li>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_39526294/article/details/104055944">https://blog.csdn.net/qq_39526294/article/details/104055944</a></p>
</li>
<li>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/140479197">https://zhuanlan.zhihu.com/p/140479197</a></p>
</li>
</ul>
<p>‰∏ªË¶ÅÂØπÊú¨Ê®°Âûã‰∏≠<code>crf</code>ÂàÜÊûêÂ¶Ç‰∏ãÔºö</p>
<p>ËøôÈáåÊèê‰∏Ä‰∏ãÊ®°ÂûãÁöÑ‰π†ÊÉØÁöÑÊûÑÂª∫ÊñπÂºèÔºö</p>
<p>Âú®<code>models/__init__py</code>‰∏≠Ôºå‰ª£Á†ÅÂ¶Ç‰∏ãÔºö</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> model.MUL_LSTM_MCA <span class="keyword">import</span> *</span><br></pre></td></tr></tbody></table></figure>
<p>ËøôÊ†∑Âú®‰∏ªÂáΩÊï∞‰∏≠Â∞±ÂèØ‰ª•ÂÜôÊàêÔºö</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> models <span class="keyword">import</span> MUL_LSTM_MCA</span><br><span class="line">----------------------------</span><br><span class="line"><span class="keyword">import</span> models</span><br><span class="line">model = models.MUL_LSTM_MCA()</span><br><span class="line">----------------------------</span><br><span class="line"><span class="keyword">import</span> models</span><br><span class="line">model = <span class="built_in">getattr</span>(<span class="string">'models'</span>, <span class="string">'MUL_LSTM_MCA'</span>)()</span><br></pre></td></tr></tbody></table></figure>
<p>ÊúÄÂêé‰∏ÄÁßçÂÜôÊ≥ïËõÆÈáçË¶ÅÁöÑÔºåÂèØËÉΩ‰πãÂâçÈÉΩÊ≤°Êé•Ëß¶ËøáÔºå‰ΩÜÂç¥ÊòØÊúÄÂ∏∏Áî®ÁöÑ„ÄÇ</p>
<h2 id="Êï∞ÊçÆÂ§ÑÁêÜ">Êï∞ÊçÆÂ§ÑÁêÜ</h2>
<h3 id="AlphabetÊûÑÂª∫">AlphabetÊûÑÂª∫</h3>
<p>ÂÖàÊîæÂº†Êï∞ÊçÆÈõÜÁöÑÊ†∑ÂºèÔºö</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">IMGID:<span class="number">1015799</span></span><br><span class="line">RT  O</span><br><span class="line"><span class="meta">@JayKenMinaj    O</span></span><br><span class="line">_   O</span><br><span class="line">:   O</span><br><span class="line">Me  O</span><br><span class="line">outside O</span><br><span class="line">of  O</span><br><span class="line">where   O</span><br><span class="line">George  B-PER</span><br><span class="line">Zimmerman   I-PER</span><br><span class="line">got O</span><br><span class="line">shot    O</span><br><span class="line">at  O</span><br><span class="line">.   O</span><br><span class="line">You O</span><br><span class="line">know    O</span><br><span class="line">God O</span><br><span class="line"><span class="keyword">is</span>  O</span><br><span class="line">so  O</span><br><span class="line">good    O</span><br><span class="line">.   O</span><br><span class="line">http://t.co/Z3neVBQ7vF  O</span><br><span class="line"></span><br><span class="line">IMGID:<span class="number">1109405</span></span><br><span class="line">Swan    O</span><br><span class="line">upping  O</span><br><span class="line">:   O</span><br><span class="line">first   O</span><br><span class="line">stop    O</span><br><span class="line">Hermitage   B-LOC</span><br><span class="line">Warf    I-LOC</span><br><span class="line">,   O</span><br><span class="line">Tower   B-LOC</span><br><span class="line">Bridge  I-LOC</span><br><span class="line">(   O</span><br><span class="line">Tower   B-LOC</span><br><span class="line"><span class="keyword">and</span> O</span><br><span class="line">Olympic B-OTHER</span><br><span class="line">rings   O</span><br><span class="line"><span class="keyword">in</span>  O</span><br><span class="line">the O</span><br><span class="line">background  O</span><br><span class="line">)   O</span><br><span class="line">http://t.co/pQdOHx3s    O</span><br><span class="line"></span><br><span class="line">IMGID:<span class="number">563049</span></span><br><span class="line">RT  O</span><br><span class="line"><span class="meta">@redbullESPORTS O</span></span><br><span class="line">:   O</span><br><span class="line">Smash   B-OTHER</span><br><span class="line">Shiba   I-OTHER</span><br><span class="line"><span class="keyword">is</span>  O</span><br><span class="line">stoked  O</span><br><span class="line"><span class="keyword">for</span> O</span><br><span class="line"><span class="comment">#NWM7   O</span></span><br><span class="line">Melee   B-OTHER</span><br><span class="line">Grand   I-OTHER</span><br><span class="line">Finals  I-OTHER</span><br><span class="line">.   O</span><br><span class="line">http://t.co/hmTEF9q0gz  O</span><br></pre></td></tr></tbody></table></figure>
<p>ÁÑ∂ÂêéÊûÑÂª∫ËØçË°®ÔºåËøôÈáåÊòØÂàÜÊàê‰∏§ÁßçÂΩ¢ÂºèÂéªÂ§ÑÁêÜÔºå‰ΩÜÂÆûÈôÖ‰∏≠ÊòØ<code>CoNLL 2003</code>ËøôÁßçÔºåÊâÄ‰ª•<code>sentence_classification</code>ËøôÁßç<code>format</code>Â∞±‰∏çËØ¥‰∫Ü„ÄÇ‰πüÊØîËæÉÂÆπÊòìÁêÜËß£ÔºåÂÖàÂéªÂà§Êñ≠<code>if len(line.strip().split('\t')) &gt;= 2</code>Ôºå‰πüÂ∞±ÊòØÈÄâÂèñ<code>word label</code>ËøôÁßçË°åÔºåÁÑ∂ÂêéÂÜçÂàÜÂâ≤Âá∫Ëøô‰∏§ÈÉ®ÂàÜÔºåÂàÜÂà´Âä†Âà∞<code>word_alphabet</code>Âíå<code>label_alphabet</code>ÔºåÊèê‰∏Ä‰∏ãËøôÈáåÁöÑ<code>feature</code>ÂÖ∂ÂÆûÂ∫îËØ•ÊòØ<code>sentence_classification</code>ÁöÑÈÇ£‰∏™<code>POS</code>ËøôÁßçÊ†áËÆ∞Á¨¶ÔºåËøôÊñπ‰æøÂ§ÑÁêÜÂèØ‰ª•‰∏çËÄÉËôë„ÄÇ</p>
<blockquote>
<p>AlphabetÁ±ª</p>
</blockquote>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">Alphabet maps objects to integer ids. It provides two way mapping from the index to the objects.</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Alphabet</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, label=<span class="literal">False</span>, keep_growing=<span class="literal">True</span></span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.UNKNOWN = <span class="string">"&lt;/unk&gt;"</span></span><br><span class="line">        self.label = label</span><br><span class="line">        self.instance2index = {}</span><br><span class="line">        self.instances = []</span><br><span class="line">        self.keep_growing = keep_growing</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Index 0 is occupied by default, all else following.</span></span><br><span class="line">        self.default_index = <span class="number">0</span></span><br><span class="line">        self.next_index = <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.label:</span><br><span class="line">            self.add(self.UNKNOWN)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">self, instance</span>):</span></span><br><span class="line">        <span class="keyword">if</span> instance <span class="keyword">not</span> <span class="keyword">in</span> self.instance2index:</span><br><span class="line">            self.instances.append(instance)</span><br><span class="line">            self.instance2index[instance] = self.next_index</span><br><span class="line">            self.next_index += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_index</span>(<span class="params">self, instance</span>):</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> self.instance2index[instance]</span><br><span class="line">        <span class="keyword">except</span> KeyError:</span><br><span class="line">            <span class="keyword">if</span> self.keep_growing:</span><br><span class="line">                index = self.next_index</span><br><span class="line">                self.add(instance)</span><br><span class="line">                <span class="keyword">return</span> index</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> self.instance2index[self.UNKNOWN]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_instance</span>(<span class="params">self, index</span>):</span></span><br><span class="line">        <span class="keyword">if</span> index == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">if</span> self.label:</span><br><span class="line">                <span class="keyword">return</span> self.instances[<span class="number">0</span>]</span><br><span class="line">            <span class="comment"># First index is occupied by the wildcard element.</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> self.instances[index - <span class="number">1</span>]</span><br><span class="line">        <span class="keyword">except</span> IndexError:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">'WARNING:Alphabet get_instance ,unknown instance, return the first label.'</span>)</span><br><span class="line">            <span class="keyword">return</span> self.instances[<span class="number">0</span>]</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>dataÈáåÈù¢ÁöÑbuild_alphabetÂáΩÊï∞</p>
</blockquote>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">build_alphabet</span>(<span class="params">self, input_file</span>):</span></span><br><span class="line">    in_lines = <span class="built_in">open</span>(input_file,<span class="string">'r'</span>, encoding=<span class="string">'utf-8'</span>).readlines()</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> in_lines:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(line.strip().split(<span class="string">'\t'</span>)) &gt;= <span class="number">2</span>:</span><br><span class="line">            <span class="comment">## if sentence classification data format, splited by \t</span></span><br><span class="line">            <span class="keyword">if</span> self.sentence_classification:</span><br><span class="line">                pairs = line.strip().split(self.split_token)</span><br><span class="line">                sent = pairs[<span class="number">0</span>]</span><br><span class="line">                <span class="keyword">if</span> sys.version_info[<span class="number">0</span>] &lt; <span class="number">3</span>:</span><br><span class="line">                    sent = sent.decode(<span class="string">'utf-8'</span>)</span><br><span class="line">                words = sent.split()</span><br><span class="line">                <span class="keyword">for</span> word <span class="keyword">in</span> words:</span><br><span class="line">                    <span class="keyword">if</span> self.number_normalized:</span><br><span class="line">                        word = normalize_word(word)</span><br><span class="line">                    self.word_alphabet.add(word)</span><br><span class="line">                    <span class="keyword">for</span> char <span class="keyword">in</span> word:</span><br><span class="line">                        self.char_alphabet.add(char)</span><br><span class="line">                label = pairs[-<span class="number">1</span>]</span><br><span class="line">                self.label_alphabet.add(label)</span><br><span class="line">                <span class="comment">## build feature alphabet</span></span><br><span class="line">                <span class="keyword">for</span> idx <span class="keyword">in</span> <span class="built_in">range</span>(self.feature_num):</span><br><span class="line">                    feat_idx = pairs[idx+<span class="number">1</span>].split(<span class="string">']'</span>,<span class="number">1</span>)[-<span class="number">1</span>]</span><br><span class="line">                    self.feature_alphabets[idx].add(feat_idx)</span><br><span class="line"></span><br><span class="line">            <span class="comment">## if sequence labeling data format i.e. CoNLL 2003</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                pairs = line.strip().split()</span><br><span class="line">                word = pairs[<span class="number">0</span>]</span><br><span class="line">                <span class="keyword">if</span> sys.version_info[<span class="number">0</span>] &lt; <span class="number">3</span>:</span><br><span class="line">                    word = word.decode(<span class="string">'utf-8'</span>)</span><br><span class="line">                <span class="keyword">if</span> self.number_normalized:</span><br><span class="line">                    word = normalize_word(word)</span><br><span class="line">                label = pairs[-<span class="number">1</span>]</span><br><span class="line">                self.label_alphabet.add(label)</span><br><span class="line">                self.word_alphabet.add(word)</span><br><span class="line">                <span class="comment">## build feature alphabet</span></span><br><span class="line">                <span class="keyword">for</span> idx <span class="keyword">in</span> <span class="built_in">range</span>(self.feature_num):</span><br><span class="line">                    feat_idx = pairs[idx+<span class="number">1</span>].split(<span class="string">']'</span>,<span class="number">1</span>)[-<span class="number">1</span>]</span><br><span class="line">                    self.feature_alphabets[idx].add(feat_idx)</span><br><span class="line">                <span class="keyword">for</span> char <span class="keyword">in</span> word:</span><br><span class="line">                    self.char_alphabet.add(char)</span><br><span class="line">    self.word_alphabet_size = self.word_alphabet.size()</span><br><span class="line">    self.char_alphabet_size = self.char_alphabet.size()</span><br><span class="line">    self.label_alphabet_size = self.label_alphabet.size()</span><br><span class="line">    <span class="keyword">for</span> idx <span class="keyword">in</span> <span class="built_in">range</span>(self.feature_num):</span><br><span class="line">        self.feature_alphabet_sizes[idx] = self.feature_alphabets[idx].size()</span><br><span class="line">    startS = <span class="literal">False</span></span><br><span class="line">    startB = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">for</span> label,_ <span class="keyword">in</span> self.label_alphabet.iteritems():</span><br><span class="line">        <span class="keyword">if</span> <span class="string">"S-"</span> <span class="keyword">in</span> label.upper():</span><br><span class="line">            startS = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">elif</span> <span class="string">"B-"</span> <span class="keyword">in</span> label.upper():</span><br><span class="line">            startB = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">if</span> startB:</span><br><span class="line">        <span class="keyword">if</span> startS:</span><br><span class="line">            self.tagScheme = <span class="string">"BMES"</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.tagScheme = <span class="string">"BIO"</span></span><br><span class="line">    <span class="keyword">if</span> self.sentence_classification:</span><br><span class="line">        self.tagScheme = <span class="string">"Not sequence labeling task"</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="EmbeddingÊûÑÂª∫">EmbeddingÊûÑÂª∫</h3>
<p>È¶ñÂÖàÈúÄË¶ÅËØ¥ÊòéÁöÑ‰∏ÄÁÇπÊòØÔºå<code>embedding</code>Âíå<code>alphabet</code>ÁöÑ<code>index</code>‰∏ÄÂÆöË¶ÅÊòØÂØπÂ∫îÂÖ≥Á≥ªÔºå‰πüÂ∞±ÊòØËØ¥Â¶ÇÊûúÈÄâÊã©Áî®<code>glove embedding</code>ÔºåÂ∞±Ë¶ÅÊûÑÂª∫Áõ∏Â∫î<code>index</code>ÁöÑ<code>dictionary</code>ÔºåÂ¶ÇÊûúÈÄâÁî®<code>bert</code>ÁöÑËØùÂêåÁêÜÔºåÁÑ∂ÂêéÂÜçÂà©Áî®ËÆ≠ÁªÉÈõÜÊûÑÂª∫ÁöÑËØçË°®ÂíåËøô‰∏™<code>embedding</code>Â≠óÂÖ∏(<code>bert</code>ÁöÑËØùÊúâ<code>embedding layer</code>‰∏çÁî®ËÄÉËôë)ÂéªÊûÑÂª∫ËæìÂÖ•ÁöÑËØçÂêëÈáè„ÄÇ</p>
<p>ÂéüÊ®°ÂûãÈááÁî®ÁöÑÊòØ<code>glove200</code>ËØçÂêëÈáèÔºå‰πüÂ∞±ÊòØ<code>glove.twitter.27B.200d.txt</code>ÔºåËøô‰∏™<code>embedding</code>ÁöÑÂÜÖÂÆπÂ¶Ç‰∏ãÔºö</p>
<p><img src="https://img-blog.csdnimg.cn/20201125185649508.png" alt="img"></p>
<p>ËØ¥ÁöÑÈÄö‰øóÊòìÊáÇ‰∏ÄÁÇπÂ∞±ÊòØÂª∫Á´ã‰∏Ä‰∏™<code>dictionary</code>Ôºå<code>key</code>ÊòØÈ¶ñ‰ΩçÁöÑÂçïËØçÔºå<code>value</code>ÊòØÂØπÂ∫îÁöÑËØçÂêëÈáèÔºåÊûÑÂª∫ËøáÁ®ãÂ¶Ç‰∏ãÔºö</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">load_pretrain_emb</span>(<span class="params">embedding_path</span>):</span></span><br><span class="line">    embedd_dim = -<span class="number">1</span></span><br><span class="line">    embedd_dict = <span class="built_in">dict</span>()</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(embedding_path, <span class="string">'r'</span>, encoding=<span class="string">"utf8"</span>) <span class="keyword">as</span> file:</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> file:</span><br><span class="line">            line = line.strip()</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(line) == <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            tokens = line.split()</span><br><span class="line">            <span class="keyword">if</span> embedd_dim &lt; <span class="number">0</span>:</span><br><span class="line">                embedd_dim = <span class="built_in">len</span>(tokens) - <span class="number">1</span></span><br><span class="line">            <span class="keyword">elif</span> embedd_dim + <span class="number">1</span> != <span class="built_in">len</span>(tokens):</span><br><span class="line">                <span class="comment">## ignore illegal embedding line</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">                <span class="comment"># assert (embedd_dim + 1 == len(tokens))</span></span><br><span class="line">            embedd = np.empty([<span class="number">1</span>, embedd_dim])</span><br><span class="line">            embedd[:] = tokens[<span class="number">1</span>:]</span><br><span class="line">            <span class="keyword">if</span> sys.version_info[<span class="number">0</span>] &lt; <span class="number">3</span>:</span><br><span class="line">                first_col = tokens[<span class="number">0</span>].decode(<span class="string">'utf-8'</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                first_col = tokens[<span class="number">0</span>]</span><br><span class="line">            embedd_dict[first_col] = embedd</span><br><span class="line">    <span class="keyword">return</span> embedd_dict, embedd_dim</span><br></pre></td></tr></tbody></table></figure>
<p>ÁÑ∂ÂêéÊòØÂÜçÂà©Áî®Ëá™Â∑±ÊûÑÂª∫ÁöÑËØçË°®Êù•ÂàõÂª∫ËæìÂÖ•ÁöÑÂêëÈáèÔºåÁÆóÊòØÊØîËæÉÂ∑ßÂ¶ôÁöÑ‰∏ÄÁßçÊñπÊ≥ïÔºåÂà©Áî®Ëá™Â∑±ÊûÑÂª∫ËØçË°®<code>index-&gt;word</code>ÔºåÂÄüÂä©<code>embedding</code>Â≠óÂÖ∏<code>word-&gt;embedding</code>ÔºåÁÑ∂ÂêéÁõ¥Êé•ÂèòÊàê<code>index-&gt;embedding</code>ÔºåËøô‰πüÂíå<code>glove</code>Êú¨Ë∫´ÁöÑÊÄßË¥®ÊúâÂÖ≥Ôºå‰πüÂ∞±ÊòØ<code>word embedding pair</code>ÔºåÊç¢Êàê<code>bert</code>ÁöÑËØùÔºåÂ∞±Ë¶ÅÂà©Áî®ÂÆÉËá™Â∏¶ÁöÑËØçË°®<code>index</code>Ôºå‰∏çÁÑ∂ÂíåÈ¢ÑËÆ≠ÁªÉÁöÑ<code>embedding</code>‰∏ç‰ºöÂØπÂ∫î„ÄÇ</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">build_pretrain_embedding</span>(<span class="params">embedding_path, word_alphabet, embedd_dim=<span class="number">100</span>, norm=<span class="literal">True</span></span>):</span></span><br><span class="line">    embedd_dict = <span class="built_in">dict</span>()</span><br><span class="line">    <span class="keyword">if</span> embedding_path != <span class="literal">None</span>:</span><br><span class="line">        embedd_dict, embedd_dim = load_pretrain_emb(embedding_path)</span><br><span class="line">    alphabet_size = word_alphabet.size()</span><br><span class="line">    scale = np.sqrt(<span class="number">3.0</span> / embedd_dim)</span><br><span class="line">    pretrain_emb = np.zeros([word_alphabet.size(), embedd_dim])</span><br><span class="line">    perfect_match = <span class="number">0</span></span><br><span class="line">    case_match = <span class="number">0</span></span><br><span class="line">    not_match = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> word, index <span class="keyword">in</span> word_alphabet.iteritems():</span><br><span class="line">        <span class="keyword">if</span> word <span class="keyword">in</span> embedd_dict:</span><br><span class="line">            <span class="keyword">if</span> norm:</span><br><span class="line">                pretrain_emb[index,:] = norm2one(embedd_dict[word])</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                pretrain_emb[index,:] = embedd_dict[word]</span><br><span class="line">            perfect_match += <span class="number">1</span></span><br><span class="line">        <span class="keyword">elif</span> word.lower() <span class="keyword">in</span> embedd_dict:</span><br><span class="line">            <span class="keyword">if</span> norm:</span><br><span class="line">                pretrain_emb[index,:] = norm2one(embedd_dict[word.lower()])</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                pretrain_emb[index,:] = embedd_dict[word.lower()]</span><br><span class="line">            case_match += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            pretrain_emb[index,:] = np.random.uniform(-scale, scale, [<span class="number">1</span>, embedd_dim])</span><br><span class="line">            not_match += <span class="number">1</span></span><br><span class="line">    pretrained_size = <span class="built_in">len</span>(embedd_dict)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Embedding:\n     pretrain word:%s, prefect match:%s, case_match:%s, oov:%s, oov%%:%s"</span>%(pretrained_size, perfect_match, case_match, not_match, (not_match+<span class="number">0.</span>)/alphabet_size))</span><br><span class="line">    <span class="keyword">return</span> pretrain_emb, embedd_dim</span><br></pre></td></tr></tbody></table></figure>
<h2 id="Ê®°ÂûãËÆ≠ÁªÉ-ËØÑ‰º∞">Ê®°ÂûãËÆ≠ÁªÉ&amp;ËØÑ‰º∞</h2>
<h1>ÊîπÊ®°Âûã</h1>
<h3 id="ËØçË°®Â§ÑÁêÜ">ËØçË°®Â§ÑÁêÜ</h3>
<p>È¶ñÂÖàÂ∞±ÊòØÂØπËØçË°®ÁöÑÈáçÂÜôÔºåÂõ†‰∏∫ÊòØË¶ÅÁî®‰∏çÂêåÁöÑ<code>embedding</code>ÔºåÁî±‰∫éBERTÈ¢ÑËÆ≠ÁªÉÊ®°Âûã‰∏≠Â∑≤ÁªèÊúâ‰∫Ü‰∏Ä‰∏™ÁªôÂÆöÁöÑËØçË°®Ôºà<code>vocab.txt</code>ÔºâÔºåÂõ†Ê≠§Âπ∂‰∏çÈúÄË¶ÅÊ†πÊçÆËá™Â∑±ÁöÑËØ≠ÊñôÊù•Âª∫Á´ã‰∏Ä‰∏™ËØçË°®„ÄÇÂΩìÁÑ∂Ôºå‰πü‰∏çËÉΩÂ§üÊ†πÊçÆËá™Â∑±ÁöÑËØ≠ÊñôÊù•Âª∫Á´ãËØçË°®ÔºåÂõ†‰∏∫Áõ∏ÂêåÁöÑÂ≠óÂú®Êàë‰ª¨Ëá™Â∑±ÊûÑÂª∫ÁöÑËØçË°®‰∏≠Âíå<code>vocab.txt</code>‰∏≠ÁöÑÁ¥¢ÂºïÈ°∫Â∫èËÇØÂÆö‰ºö‰∏ç‰∏ÄÊ†∑„ÄÇÁÑ∂ÂêéÊòØË¶ÅÂà©Áî®Ëøô‰∏™Á¥¢Âºï‰Ωú‰∏∫ËæìÂÖ•ÂñÇÂà∞BERTÈáå„ÄÇ</p>
<p>ÂÖ∑‰ΩìÂÅöÊ≥ïÂ∞±ÊòØÊää<code>build_alphabet</code>ÁªôÊîπ‰∫ÜÔºåÊîπÂêéÂ¶Ç‰∏ãÔºö</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">build_label_alphabet</span>(<span class="params">self, input_file</span>):</span></span><br><span class="line">        in_lines = <span class="built_in">open</span>(input_file,<span class="string">'r'</span>, encoding=<span class="string">'utf-8'</span>).readlines()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> in_lines:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(line.strip().split(<span class="string">'\t'</span>)) &gt;= <span class="number">2</span>:</span><br><span class="line">                <span class="comment">## if sentence classification data format, splited by \t</span></span><br><span class="line">                <span class="keyword">if</span> self.sentence_classification:</span><br><span class="line">                    pairs = line.strip().split(self.split_token)</span><br><span class="line">                    sent = pairs[<span class="number">0</span>]</span><br><span class="line">                    <span class="keyword">if</span> sys.version_info[<span class="number">0</span>] &lt; <span class="number">3</span>:</span><br><span class="line">                        sent = sent.decode(<span class="string">'utf-8'</span>)</span><br><span class="line">                    </span><br><span class="line">                    label = pairs[-<span class="number">1</span>]</span><br><span class="line">                    self.label_alphabet.add(label)</span><br><span class="line">                    <span class="comment">## build feature alphabet</span></span><br><span class="line">                    <span class="keyword">for</span> idx <span class="keyword">in</span> <span class="built_in">range</span>(self.feature_num):</span><br><span class="line">                        feat_idx = pairs[idx+<span class="number">1</span>].split(<span class="string">']'</span>,<span class="number">1</span>)[-<span class="number">1</span>]</span><br><span class="line">                        self.feature_alphabets[idx].add(feat_idx)</span><br><span class="line"></span><br><span class="line">                <span class="comment">## if sequence labeling data format i.e. CoNLL 2003</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    pairs = line.strip().split()</span><br><span class="line">                    label = pairs[-<span class="number">1</span>]</span><br><span class="line">                    self.label_alphabet.add(label)</span><br><span class="line">                    <span class="comment">## build feature alphabet</span></span><br><span class="line">                    <span class="keyword">for</span> idx <span class="keyword">in</span> <span class="built_in">range</span>(self.feature_num):</span><br><span class="line">                        feat_idx = pairs[idx+<span class="number">1</span>].split(<span class="string">']'</span>,<span class="number">1</span>)[-<span class="number">1</span>]</span><br><span class="line">                        self.feature_alphabets[idx].add(feat_idx</span><br><span class="line">                    </span><br><span class="line">        self.label_alphabet_size = self.label_alphabet.size()</span><br><span class="line">        <span class="keyword">for</span> idx <span class="keyword">in</span> <span class="built_in">range</span>(self.feature_num):</span><br><span class="line">            self.feature_alphabet_sizes[idx] = self.feature_alphabets[idx].size()</span><br><span class="line">      </span><br><span class="line">        startS = <span class="literal">False</span></span><br><span class="line">        startB = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">for</span> label,_ <span class="keyword">in</span> self.label_alphabet.iteritems():</span><br><span class="line">            <span class="keyword">if</span> <span class="string">"S-"</span> <span class="keyword">in</span> label.upper():</span><br><span class="line">                startS = <span class="literal">True</span></span><br><span class="line">            <span class="keyword">elif</span> <span class="string">"B-"</span> <span class="keyword">in</span> label.upper():</span><br><span class="line">                startB = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">if</span> startB:</span><br><span class="line">            <span class="keyword">if</span> startS:</span><br><span class="line">                self.tagScheme = <span class="string">"BMES"</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                self.tagScheme = <span class="string">"BIO"</span></span><br><span class="line">        <span class="keyword">if</span> self.sentence_classification:</span><br><span class="line">            self.tagScheme = <span class="string">"Not sequence labeling task"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ÊîπÂä®ÁöÑÂú∞ÊñπÂú®ËøôÈáå</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">build_word_alphabet</span>(<span class="params">self, input_file</span>):</span></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(input_file, <span class="string">'r'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> f:</span><br><span class="line">            <span class="keyword">for</span> i, word <span class="keyword">in</span> <span class="built_in">enumerate</span>(f):</span><br><span class="line">                w = word.strip(<span class="string">'\n'</span>)</span><br><span class="line">                self.word_alphabet.add(w)            </span><br><span class="line">        self.word_alphabet_size = self.word_alphabet.size()</span><br></pre></td></tr></tbody></table></figure>
<p>ÂÖ∂ÂÆûÂ∞±ÊòØÂä†‰∫Ü‰∏™<code>bulid_word_alphabet</code>ÔºåÂØπBERTÁöÑ<code>vocab.txt</code>ÂéªÂ§ÑÁêÜÔºåËøôÈáåÁî®‰∫ÜËá™Â∑±ÂÜôÁöÑ<code>Alphabet</code>Á±ªÔºåÊòØÊå∫Êñπ‰æøÁöÑ„ÄÇÁÑ∂ÂêéÂÜçÊääÊúâÂÖ≥<code>char</code>ÁöÑÈÉ®ÂàÜÂÖ®Âà†ÊéâÔºåËøòÊúâÂéüÊú¨<code>word embedding</code>ÁöÑÊûÑÂª∫„ÄÇ</p>
<p>‰ΩÜÊòØÂó∑ÔºåËøôÊ†∑ÈÖçÂêà‰∏ãÈù¢ÁöÑÊ®°ÂûãÊõøÊç¢ÂêéÔºåÂÆûÈôÖÁöÑÊïàÊûúÂπ∂‰∏çÊòØÂæàÁêÜÊÉ≥ÔºåËÄÉËôëÊòØÂàÜËØçÁöÑÂéüÂõ†ÔºåÂõ†‰∏∫<code>bert</code>ÁöÑ<code>tokenizers</code>‰ºöÊää<code>word</code>ËøòË¶ÅÂàíÂàÜÔºåÊâÄ‰ª•ÂÖ∂ÂÆûÁõ¥Êé•ÈÇ£ÁßçÊï¥‰∏™ÂçïËØçÁöÑËæìÂÖ•ÂèØËÉΩÊòØÊúâÁÇπÈóÆÈ¢òÁöÑÔºåÊé•‰∏ãÊù•ÊòØÂà©Áî®<code>huggingface</code>‰∏≠ÁöÑ<code>tokenizer</code>ÂàÜËØçÔºö</p>
<h3 id="Ê®°ÂûãÊõ¥Êç¢">Ê®°ÂûãÊõ¥Êç¢</h3>
<p>Â§ßËá¥ÂàÜ‰∏∫‰∏§ÂùóÔºåÁ¨¨‰∏ÄÊòØ‰∏çÂä†<code>object_feature</code>Áõ¥Êé•Êää<code>char-Bilstm</code>Êç¢Êàê<code>bert</code>ÔºåÁ¨¨‰∫åÂ∞±ÊòØÂÜçÂú®Ëøô‰∏™Âü∫Á°Ä‰∏äÔºåÂéªÂä†‰∏ä<code>visual</code>ÁöÑ‰ø°ÊÅØÔºåÂÅö‰∏Ä‰∏™Â§öÊ®°ÊÄÅÁöÑ<code>NER</code>„ÄÇ</p>
<blockquote>
<p>ÂÖ∂ÂÆû‰πüÊòØÂõ†‰∏∫‰ø∫‰πãÂâçÊ≤°Áî®Ëøá<code>bert</code>ÔºåÁÑ∂ÂêéËøôÁ¨¨‰∏ÄÊ¨°Áî®Â∞±Âç°‰∫ÜÊå∫Â§öbugÁöÑÔºåÊâÄ‰ª•ÂáÜÂ§áÊääÊîπÊ®°ÂûãÁöÑÂ∑•‰ΩúÂàíÂàÜÊàêÈò∂ÊÆµÊÄßÔºåÂáèÂ∞ëÈîôËØØÁöÑËÄ¶Âêà„ÄÇ</p>
</blockquote>
<h4 id="ÊõøÊç¢‰∏∫Bert">ÊõøÊç¢‰∏∫Bert</h4>
<p>Ê®°ÂûãÊîπ‰∏∫‰ª•‰∏ãÔºö</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> transformers</span><br><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> BertConfig,BertModel</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BERT_CRF</span>(<span class="params">nn.Module</span>):</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    bert + crf</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, data</span>):</span></span><br><span class="line">        <span class="built_in">super</span>(BERT_CRF, self).__init__()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">'build BERT_CRF network...'</span>)</span><br><span class="line">        self.gpu = data.HP_gpu</span><br><span class="line">        self.average_batch = data.average_batch_loss</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># ÂèØËÉΩ‰ºöÂä†‰∏ä self.dropbert = nn.Dropout(data.HP_dropout)  # word seq bert out -&gt; dropout</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># topic_embed_dim to the dim as text hidden dim</span></span><br><span class="line">        self.txt_feat_linear = nn.Linear(<span class="number">768</span>, <span class="number">200</span>)</span><br><span class="line"></span><br><span class="line">        self.hidden2tag = nn.Linear(self.mca_params[<span class="string">'HIDDEN_SIZE'</span>], data.label_alphabet_size + <span class="number">2</span>)</span><br><span class="line">        <span class="comment"># crf</span></span><br><span class="line">        self.crf = CRF(data.label_alphabet_size, self.gpu)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Bert</span></span><br><span class="line">        self.bert_config = BertConfig.from_json_file(<span class="string">"model/config.json"</span>)</span><br><span class="line">        self.bert = BertModel(self.bert_config)</span><br><span class="line">        </span><br><span class="line">        a = torch.load(<span class="string">"./model/pytorch_model.bin"</span>)</span><br><span class="line">        model_dict = self.bert.state_dict()</span><br><span class="line">        pretrained_dict = {k:v <span class="keyword">for</span> k,v <span class="keyword">in</span> a.items() <span class="keyword">if</span> k <span class="keyword">in</span> model_dict}</span><br><span class="line">        model_dict.update(pretrained_dict)</span><br><span class="line">        self.bert.load_state_dict(model_dict)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_get_bert_features</span>(<span class="params">self, word_inputs, feature_inputs, word_seq_lengths</span>):</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">         word_input -&gt; bert -&gt; dropout -&gt; Linear -&gt; tagscores</span></span><br><span class="line"><span class="string">        :param word_inputs: (batch_size, sent_len)</span></span><br><span class="line"><span class="string">        :param feature_inputs:  [(batch_size, sent_len), ...] list of variables</span></span><br><span class="line"><span class="string">        :param word_seq_lengths: list of batch_size, (batch_size, 1)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">            variable(batch_size,sent_len, hidden_dim)</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        batch_size = word_inputs.size(<span class="number">0</span>)</span><br><span class="line">        sent_len = word_inputs.size(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Bert</span></span><br><span class="line">        device = torch.device(<span class="string">'cuda:0'</span>)</span><br><span class="line">        </span><br><span class="line">        tmp = torch.tensor(word_inputs, device=device)</span><br><span class="line">        tmp = tmp.long()</span><br><span class="line">        </span><br><span class="line">        text_feat = self.txt_feat_linear(self.bert(tmp).last_hidden_state)</span><br><span class="line">   </span><br><span class="line">        <span class="comment"># -&gt; tagscore</span></span><br><span class="line">        outputs = self.hidden2tag(text_feat)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> outputs</span><br></pre></td></tr></tbody></table></figure>
<blockquote></blockquote>
<p>ÊàñËÄÖÊòØÁî®<code>distilbert-base-cased</code>Ôºå‰πüÂ∞±ÊòØËí∏È¶èËøáÁöÑÔºåÊïàÊûúÁ°ÆÂÆûÂ•ΩÔºåË∑ëÁöÑÂèàÂø´ÂèàÂ•ΩÔºåÊîπÂä®Â¶Ç‰∏ãÔºö</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> transformers</span><br><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> DistilBertConfig,DistilBertModel</span><br><span class="line"></span><br><span class="line">self.bert_config = DistilBertConfig.from_json_file(<span class="string">"model/config.json"</span>)</span><br><span class="line">self.bert = DistilBertModel(self.bert_config)</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://huggingface.co/distilbert-base-cased">https://huggingface.co/distilbert-base-cased</a></p>
</blockquote>
<h4 id="Âä†ÂÖ•Â§öÊ®°ÊÄÅ‰ø°ÊÅØ">Âä†ÂÖ•Â§öÊ®°ÊÄÅ‰ø°ÊÅØ</h4>
<p>Ëøô‰∏™Ë¶ÅËÄÉËôëÁöÑÁÇπÂ∫îËØ•ËøòÊòØÊúâ‰∫õÁöÑÔºåÊØîÂ¶Ç<code>object_feature</code>ÁöÑ<code>embedding</code>ÈÄâÂèñÔºåËøô‰∏™ÊòØÂê¶ËÉΩÁõ¥Êé•‰πüÂíå<code>bert</code>ÁöÑ<code>embedding</code>ÈÄâÂèñ‰∏ÄÊ†∑ËøòÊòØË¶ÅÁ†îÁ©∂‰∏Ä‰∏ãÁöÑÔºåÂ§ßËá¥ÁöÑÊÄùË∑ØÂÖàËÆæÊàê<code>concat</code>‰ª•ÂêéÂÜçÂéª<code>get fusion feature</code>„ÄÇ</p>
<h2 id="ÈÅáÂà∞ÁöÑbug">ÈÅáÂà∞ÁöÑbug</h2>
<h3 id="colabÊâìÂºÄÊñá‰ª∂">colabÊâìÂºÄÊñá‰ª∂</h3>
<p><strong>Ëß£ÂÜ≥ÊñπÊ≥ï</strong>ÔºöÁî®<code>!cd</code>‰∏çË°åÁöÑÊó∂ÂÄôËØïËØï<code>%cd</code></p>
<h3 id="Torch-TensorÊîæÂú®GPU‰∏ä">Torch TensorÊîæÂú®GPU‰∏ä</h3>
<p>Ëøô‰∏™ÊØîËæÉÊÄ™ÔºåÊúâÂá†ÁßçÊ†ºÂºèÊòØ‰∏çË°åÁöÑÔºåÈúÄË¶ÅÊ≥®ÊÑè‰∏Ä‰∏ã</p>
<h3 id="Ê¢ØÂ∫¶NAN">Ê¢ØÂ∫¶NAN</h3>
<p>Ëøô‰∏™ÂèØËÉΩÊòØÂ≠¶‰π†ÂæãÊ≤°Ë∞ÉÂ•ΩÔºåÂèØ‰ª•ÂèÇËÄÉ‰∏Ä‰∫õËµÑÊñôÔºå<code>bert</code>ÁöÑËØùËÆæÁΩÆÊàê<code>1e-5 or 3e-5</code>ÈÉΩÊòØÂèØ‰ª•ÁöÑ„ÄÇ‰πüÂ∞±ÊòØ</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">optimizer = torch.optim.Adam(model.parameters(), lr=<span class="number">5e-5</span>)</span><br></pre></td></tr></tbody></table></figure>
<h3 id="pÔºårÔºåfÁöÑÂÄºÈóÆÈ¢ò">pÔºårÔºåfÁöÑÂÄºÈóÆÈ¢ò</h3>
<p>‰ºöÊúâ<img src="https://math.now.sh?inline=p%2Cr%2Cf" style="display:inline-block;margin: 0;">ÂÄºÂºÇÂ∏∏ÁöÑÊÉÖÂÜµÔºåËøôÈáåÁöÑ<img src="https://math.now.sh?inline=p%2Cr%2Cf" style="display:inline-block;margin: 0;">ÂàÜÂà´Â∞±ÊòØËØÑÊµãÊåáÊ†á<img src="https://math.now.sh?inline=precision%2C%20recall%2C%20F1%20%5C%20score" style="display:inline-block;margin: 0;">ÔºåËøô‰∏™‰∏çÁÜüÁöÑËØùÂèØ‰ª•Áúã‰∏ãÈù¢ÁöÑËµÑÊñôÔºö<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/161703182">https://zhuanlan.zhihu.com/p/161703182</a></p>
<p>ÂºÇÂ∏∏ÁöÑÂéüÂõ†ÊòØÂéãÊ†πÂï•‰πüÊ≤°Â≠¶Âà∞ÔºåÂèØËÉΩÊòØÂíåÂ≠¶‰π†ÁéáÁöÑËÆæÁΩÆÊúâÂÖ≥ÔºåÊàëÂ∞±ÊòØÂõ†‰∏∫Â≠¶‰π†Áéá‰∏çÂØπÂØºËá¥ÁöÑËøô‰∏™ÈóÆÈ¢ò„ÄÇ</p>
<h3 id="BertËøáÊãüÂêà">BertËøáÊãüÂêà</h3>
<p>ÂèØ‰ª•ÁúãÁúã‰∏ãÈù¢ÁöÑ‰æãÂ≠êÔºåËÆ≠ÁªÉÈõÜÁöÑf1scoreÂ∞±ÂæàÈ´òÔºå‰ΩÜÊòØÊµãËØïÈõÜÂ∞±‰∏çË°å‰∫Ü„ÄÇ</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line">Epoch: <span class="number">9</span> training finished. Time: <span class="number">115.85</span>s, speed: <span class="number">34.53</span>st/s,  total loss: <span class="number">11371.80078125</span></span><br><span class="line">totalloss: <span class="number">11371.80078125</span></span><br><span class="line">Entity <span class="built_in">type</span>:  PER p =  <span class="number">0.9280045351473923</span>  r =  <span class="number">0.7383852052322959</span>  f =  <span class="number">0.8224064305450891</span></span><br><span class="line">Entity <span class="built_in">type</span>:  LOC p =  <span class="number">0.8448979591836735</span>  r =  <span class="number">0.7919655667144907</span>  f =  <span class="number">0.8175759071834116</span></span><br><span class="line">Entity <span class="built_in">type</span>:  ORG p =  <span class="number">0.8514056224899599</span>  r =  <span class="number">0.45689655172413796</span>  f =  <span class="number">0.5946704067321178</span></span><br><span class="line">Entity <span class="built_in">type</span>:  OTHER p =  <span class="number">0.8706896551724138</span>  r =  <span class="number">0.4297872340425532</span>  f =  <span class="number">0.5754985754985755</span></span><br><span class="line">Entity <span class="built_in">type</span>:  <span class="built_in">all</span> p =  <span class="number">0.8794280836534357</span>  r =  <span class="number">0.6672603626943006</span>  f =  <span class="number">0.7587921193150433</span></span><br><span class="line">speed: <span class="number">39.21</span>st/s; acc: <span class="number">0.9588</span>, p: <span class="number">0.8794</span>, r: <span class="number">0.6673</span>, f: <span class="number">0.7588</span></span><br><span class="line">Entity <span class="built_in">type</span>:  PER p =  <span class="number">0.5945273631840796</span>  r =  <span class="number">0.4329710144927536</span>  f =  <span class="number">0.5010482180293501</span></span><br><span class="line">Entity <span class="built_in">type</span>:  LOC p =  <span class="number">0.5848623853211009</span>  r =  <span class="number">0.4885057471264368</span>  f =  <span class="number">0.5323590814196242</span></span><br><span class="line">Entity <span class="built_in">type</span>:  ORG p =  <span class="number">0.3375</span>  r =  <span class="number">0.10931174089068826</span>  f =  <span class="number">0.16513761467889906</span></span><br><span class="line">Entity <span class="built_in">type</span>:  OTHER p =  <span class="number">0.323943661971831</span>  r =  <span class="number">0.10222222222222223</span>  f =  <span class="number">0.1554054054054054</span></span><br><span class="line">Entity <span class="built_in">type</span>:  <span class="built_in">all</span> p =  <span class="number">0.5500505561172901</span>  r =  <span class="number">0.351875808538163</span>  f =  <span class="number">0.42919132149901384</span></span><br><span class="line">Dev: time: <span class="number">127.54</span>s, speed: <span class="number">39.27</span>st/s; acc: <span class="number">0.8892</span>, p: <span class="number">0.5501</span>, r: <span class="number">0.3519</span>, f: <span class="number">0.4292</span></span><br><span class="line">Entity <span class="built_in">type</span>:  PER p =  <span class="number">0.5916149068322981</span>  r =  <span class="number">0.4196035242290749</span>  f =  <span class="number">0.49097938144329895</span></span><br><span class="line">Entity <span class="built_in">type</span>:  LOC p =  <span class="number">0.5734870317002881</span>  r =  <span class="number">0.46906305244549207</span>  f =  <span class="number">0.5160453808752026</span></span><br><span class="line">Entity <span class="built_in">type</span>:  ORG p =  <span class="number">0.32450331125827814</span>  r =  <span class="number">0.11680572109654351</span>  f =  <span class="number">0.17177914110429449</span></span><br><span class="line">Entity <span class="built_in">type</span>:  OTHER p =  <span class="number">0.24390243902439024</span>  r =  <span class="number">0.06887052341597796</span>  f =  <span class="number">0.10741138560687431</span></span><br><span class="line">Entity <span class="built_in">type</span>:  <span class="built_in">all</span> p =  <span class="number">0.5359723531259818</span>  r =  <span class="number">0.335959038991729</span>  f =  <span class="number">0.4130250574990922</span></span><br><span class="line">Test: time: <span class="number">84.01</span>s, speed: <span class="number">38.79</span>st/s; acc: <span class="number">0.8881</span>, p: <span class="number">0.5360</span>, r: <span class="number">0.3360</span>, f: <span class="number">0.4130</span></span><br><span class="line">Epoch: <span class="number">10</span>/<span class="number">200</span></span><br><span class="line">Shuffle: first <span class="built_in">input</span> word <span class="built_in">list</span>: [<span class="number">1989</span>, <span class="number">121</span>, <span class="number">1</span>, <span class="number">133</span>, <span class="number">4110</span>, <span class="number">1105</span>, <span class="number">3966</span>, <span class="number">1117</span>, <span class="number">3589</span>, <span class="number">1105</span>, <span class="number">4707</span>, <span class="number">121</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>]</span><br><span class="line">     Instance: <span class="number">500</span>; Time: <span class="number">14.51</span>s; loss: <span class="number">1278.0686</span>; acc: <span class="number">7798.0</span>/<span class="number">8189.0</span>=<span class="number">0.9523</span></span><br><span class="line">     Instance: <span class="number">1000</span>; Time: <span class="number">14.53</span>s; loss: <span class="number">1258.4695</span>; acc: <span class="number">15454.0</span>/<span class="number">16250.0</span>=<span class="number">0.9510</span></span><br><span class="line">     Instance: <span class="number">1500</span>; Time: <span class="number">14.51</span>s; loss: <span class="number">1191.4680</span>; acc: <span class="number">23218.0</span>/<span class="number">24397.0</span>=<span class="number">0.9517</span></span><br><span class="line">     Instance: <span class="number">2000</span>; Time: <span class="number">14.56</span>s; loss: <span class="number">1284.1797</span>; acc: <span class="number">30973.0</span>/<span class="number">32569.0</span>=<span class="number">0.9510</span></span><br><span class="line">     Instance: <span class="number">2500</span>; Time: <span class="number">14.64</span>s; loss: <span class="number">1328.2502</span>; acc: <span class="number">38397.0</span>/<span class="number">40438.0</span>=<span class="number">0.9495</span></span><br><span class="line">     Instance: <span class="number">3000</span>; Time: <span class="number">14.43</span>s; loss: <span class="number">1240.5212</span>; acc: <span class="number">45835.0</span>/<span class="number">48265.0</span>=<span class="number">0.9497</span></span><br><span class="line">     Instance: <span class="number">3500</span>; Time: <span class="number">14.55</span>s; loss: <span class="number">1379.7368</span>; acc: <span class="number">53359.0</span>/<span class="number">56210.0</span>=<span class="number">0.9493</span></span><br><span class="line">     Instance: <span class="number">4000</span>; Time: <span class="number">14.42</span>s; loss: <span class="number">1359.3643</span>; acc: <span class="number">61151.0</span>/<span class="number">64439.0</span>=<span class="number">0.9490</span></span><br><span class="line">     Instance: <span class="number">4000</span>; Time: <span class="number">0.06</span>s; loss: <span class="number">0.0000</span>; acc: <span class="number">61151.0</span>/<span class="number">64439.0</span>=<span class="number">0.9490</span></span><br><span class="line">Epoch: <span class="number">10</span> training finished. Time: <span class="number">116.21</span>s, speed: <span class="number">34.42</span>st/s,  total loss: <span class="number">10320.058349609375</span></span><br><span class="line">totalloss: <span class="number">10320.058349609375</span></span><br><span class="line">Entity <span class="built_in">type</span>:  PER p =  <span class="number">0.9315818281335523</span>  r =  <span class="number">0.7677041046459179</span>  f =  <span class="number">0.8417408506429277</span></span><br><span class="line">Entity <span class="built_in">type</span>:  LOC p =  <span class="number">0.8866090712742981</span>  r =  <span class="number">0.7852702056432329</span>  f =  <span class="number">0.8328683743342633</span></span><br><span class="line">Entity <span class="built_in">type</span>:  ORG p =  <span class="number">0.8691099476439791</span>  r =  <span class="number">0.5366379310344828</span>  f =  <span class="number">0.6635576282478348</span></span><br><span class="line">Entity <span class="built_in">type</span>:  OTHER p =  <span class="number">0.7667785234899329</span>  r =  <span class="number">0.48617021276595745</span>  f =  <span class="number">0.5950520833333334</span></span><br><span class="line">Entity <span class="built_in">type</span>:  <span class="built_in">all</span> p =  <span class="number">0.8867574257425742</span>  r =  <span class="number">0.6960816062176166</span>  f =  <span class="number">0.7799346879535558</span></span><br><span class="line">speed: <span class="number">38.91</span>st/s; acc: <span class="number">0.9632</span>, p: <span class="number">0.8868</span>, r: <span class="number">0.6961</span>, f: <span class="number">0.7799</span></span><br><span class="line">Entity <span class="built_in">type</span>:  PER p =  <span class="number">0.6033653846153846</span>  r =  <span class="number">0.45471014492753625</span>  f =  <span class="number">0.5185950413223142</span></span><br><span class="line">Entity <span class="built_in">type</span>:  LOC p =  <span class="number">0.6221198156682027</span>  r =  <span class="number">0.5172413793103449</span>  f =  <span class="number">0.5648535564853556</span></span><br><span class="line">Entity <span class="built_in">type</span>:  ORG p =  <span class="number">0.3114754098360656</span>  r =  <span class="number">0.15384615384615385</span>  f =  <span class="number">0.20596205962059622</span></span><br><span class="line">Entity <span class="built_in">type</span>:  OTHER p =  <span class="number">0.18055555555555555</span>  r =  <span class="number">0.11555555555555555</span>  f =  <span class="number">0.14092140921409213</span></span><br><span class="line">Entity <span class="built_in">type</span>:  <span class="built_in">all</span> p =  <span class="number">0.5241935483870968</span>  r =  <span class="number">0.3783958602846054</span>  f =  <span class="number">0.439519158527423</span></span><br><span class="line">Dev: time: <span class="number">128.61</span>s, speed: <span class="number">38.86</span>st/s; acc: <span class="number">0.8871</span>, p: <span class="number">0.5242</span>, r: <span class="number">0.3784</span>, f: <span class="number">0.4395</span></span><br><span class="line">Entity <span class="built_in">type</span>:  PER p =  <span class="number">0.5936578171091446</span>  r =  <span class="number">0.44328193832599116</span>  f =  <span class="number">0.5075662042875158</span></span><br><span class="line">Entity <span class="built_in">type</span>:  LOC p =  <span class="number">0.5782219159200551</span>  r =  <span class="number">0.49440188568061283</span>  f =  <span class="number">0.5330368487928844</span></span><br><span class="line">Entity <span class="built_in">type</span>:  ORG p =  <span class="number">0.30434782608695654</span>  r =  <span class="number">0.14183551847437426</span>  f =  <span class="number">0.19349593495934958</span></span><br><span class="line">Entity <span class="built_in">type</span>:  OTHER p =  <span class="number">0.16263736263736264</span>  r =  <span class="number">0.10192837465564739</span>  f =  <span class="number">0.12531752751905167</span></span><br><span class="line">Entity <span class="built_in">type</span>:  <span class="built_in">all</span> p =  <span class="number">0.5028743498494388</span>  r =  <span class="number">0.3617565970854667</span>  f =  <span class="number">0.42079945023479554</span></span><br><span class="line">Test: time: <span class="number">83.61</span>s, speed: <span class="number">38.97</span>st/s; acc: <span class="number">0.8852</span>, p: <span class="number">0.5029</span>, r: <span class="number">0.3618</span>, f: <span class="number">0.4208</span></span><br><span class="line">Epoch: <span class="number">11</span>/<span class="number">200</span></span><br><span class="line">Shuffle: first <span class="built_in">input</span> word <span class="built_in">list</span>: [<span class="number">1</span>, <span class="number">1</span>, <span class="number">133</span>, <span class="number">1</span>, <span class="number">21542</span>, <span class="number">123</span>, <span class="number">25351</span>, <span class="number">4077</span>, <span class="number">1109</span>, <span class="number">1</span>, <span class="number">3072</span>, <span class="number">2502</span>, <span class="number">1</span>, <span class="number">1</span>]</span><br><span class="line">     Instance: <span class="number">500</span>; Time: <span class="number">14.56</span>s; loss: <span class="number">1038.2153</span>; acc: <span class="number">7877.0</span>/<span class="number">8206.0</span>=<span class="number">0.9599</span></span><br><span class="line">     Instance: <span class="number">1000</span>; Time: <span class="number">14.58</span>s; loss: <span class="number">1133.9968</span>; acc: <span class="number">15664.0</span>/<span class="number">16356.0</span>=<span class="number">0.9577</span></span><br><span class="line">     Instance: <span class="number">1500</span>; Time: <span class="number">14.43</span>s; loss: <span class="number">1135.8523</span>; acc: <span class="number">23177.0</span>/<span class="number">24248.0</span>=<span class="number">0.9558</span></span><br><span class="line">     Instance: <span class="number">2000</span>; Time: <span class="number">14.63</span>s; loss: <span class="number">1096.4941</span>; acc: <span class="number">30962.0</span>/<span class="number">32400.0</span>=<span class="number">0.9556</span></span><br><span class="line">     Instance: <span class="number">2500</span>; Time: <span class="number">14.63</span>s; loss: <span class="number">1277.8718</span>; acc: <span class="number">38635.0</span>/<span class="number">40496.0</span>=<span class="number">0.9540</span></span><br><span class="line">     Instance: <span class="number">3000</span>; Time: <span class="number">14.55</span>s; loss: <span class="number">1193.8625</span>; acc: <span class="number">46213.0</span>/<span class="number">48460.0</span>=<span class="number">0.9536</span></span><br><span class="line">     Instance: <span class="number">3500</span>; Time: <span class="number">14.61</span>s; loss: <span class="number">1012.0950</span>; acc: <span class="number">53744.0</span>/<span class="number">56312.0</span>=<span class="number">0.9544</span></span><br><span class="line">     Instance: <span class="number">4000</span>; Time: <span class="number">14.67</span>s; loss: <span class="number">1173.8591</span>; acc: <span class="number">61486.0</span>/<span class="number">64439.0</span>=<span class="number">0.9542</span></span><br><span class="line">     Instance: <span class="number">4000</span>; Time: <span class="number">0.07</span>s; loss: <span class="number">0.0000</span>; acc: <span class="number">61486.0</span>/<span class="number">64439.0</span>=<span class="number">0.9542</span></span><br><span class="line">Epoch: <span class="number">11</span> training finished. Time: <span class="number">116.72</span>s, speed: <span class="number">34.27</span>st/s,  total loss: <span class="number">9062.2470703125</span></span><br><span class="line">totalloss: <span class="number">9062.2470703125</span></span><br><span class="line">Entity <span class="built_in">type</span>:  PER p =  <span class="number">0.8663298116674323</span>  r =  <span class="number">0.8506991429860171</span>  f =  <span class="number">0.8584433318161129</span></span><br><span class="line">Entity <span class="built_in">type</span>:  LOC p =  <span class="number">0.9219701162147206</span>  r =  <span class="number">0.7967479674796748</span>  f =  <span class="number">0.8547973319651103</span></span><br><span class="line">Entity <span class="built_in">type</span>:  ORG p =  <span class="number">0.808695652173913</span>  r =  <span class="number">0.6012931034482759</span>  f =  <span class="number">0.6897404202719406</span></span><br><span class="line">Entity <span class="built_in">type</span>:  OTHER p =  <span class="number">0.8234265734265734</span>  r =  <span class="number">0.5010638297872341</span>  f =  <span class="number">0.623015873015873</span></span><br><span class="line">Entity <span class="built_in">type</span>:  <span class="built_in">all</span> p =  <span class="number">0.8732367518109035</span>  r =  <span class="number">0.7417422279792746</span>  f =  <span class="number">0.8021362283312905</span></span><br><span class="line">speed: <span class="number">38.69</span>st/s; acc: <span class="number">0.9675</span>, p: <span class="number">0.8732</span>, r: <span class="number">0.7417</span>, f: <span class="number">0.8021</span></span><br><span class="line">Entity <span class="built_in">type</span>:  PER p =  <span class="number">0.5479166666666667</span>  r =  <span class="number">0.47644927536231885</span>  f =  <span class="number">0.5096899224806202</span></span><br><span class="line">Entity <span class="built_in">type</span>:  LOC p =  <span class="number">0.6430317848410758</span>  r =  <span class="number">0.5038314176245211</span>  f =  <span class="number">0.564983888292159</span></span><br><span class="line">Entity <span class="built_in">type</span>:  ORG p =  <span class="number">0.25196850393700787</span>  r =  <span class="number">0.12955465587044535</span>  f =  <span class="number">0.1711229946524064</span></span><br><span class="line">Entity <span class="built_in">type</span>:  OTHER p =  <span class="number">0.2079207920792079</span>  r =  <span class="number">0.09333333333333334</span>  f =  <span class="number">0.12883435582822086</span></span><br><span class="line">Entity <span class="built_in">type</span>:  <span class="built_in">all</span> p =  <span class="number">0.5183527305282005</span>  r =  <span class="number">0.3745148771021992</span>  f =  <span class="number">0.43484791588434096</span></span><br><span class="line">Dev: time: <span class="number">129.12</span>s, speed: <span class="number">38.97</span>st/s; acc: <span class="number">0.8893</span>, p: <span class="number">0.5184</span>, r: <span class="number">0.3745</span>, f: <span class="number">0.4348</span></span><br><span class="line">Entity <span class="built_in">type</span>:  PER p =  <span class="number">0.5332125603864735</span>  r =  <span class="number">0.48623348017621143</span>  f =  <span class="number">0.5086405529953917</span></span><br><span class="line">Entity <span class="built_in">type</span>:  LOC p =  <span class="number">0.6096822995461422</span>  r =  <span class="number">0.4749558043606364</span>  f =  <span class="number">0.5339516396157669</span></span><br><span class="line">Entity <span class="built_in">type</span>:  ORG p =  <span class="number">0.2968036529680365</span>  r =  <span class="number">0.15494636471990464</span>  f =  <span class="number">0.20360219263899765</span></span><br><span class="line">Entity <span class="built_in">type</span>:  OTHER p =  <span class="number">0.18575851393188855</span>  r =  <span class="number">0.08264462809917356</span>  f =  <span class="number">0.11439466158245949</span></span><br><span class="line">Entity <span class="built_in">type</span>:  <span class="built_in">all</span> p =  <span class="number">0.502540786306499</span>  r =  <span class="number">0.37002756990941316</span>  f =  <span class="number">0.4262220709992061</span></span><br><span class="line">Test: time: <span class="number">83.39</span>s, speed: <span class="number">39.08</span>st/s; acc: <span class="number">0.8876</span>, p: <span class="number">0.5025</span>, r: <span class="number">0.3700</span>, f: <span class="number">0.4262</span></span><br><span class="line">Epoch: <span class="number">12</span>/<span class="number">200</span></span><br><span class="line">Shuffle: first <span class="built_in">input</span> word <span class="built_in">list</span>: [<span class="number">7506</span>, <span class="number">1</span>, <span class="number">119</span>, <span class="number">1699</span>, <span class="number">1106</span>, <span class="number">1</span>, <span class="number">119</span>, <span class="number">1115</span>, <span class="number">1105</span>, <span class="number">7245</span>, <span class="number">1106</span>, <span class="number">4702</span>, <span class="number">1109</span>, <span class="number">1</span>, <span class="number">1107</span>, <span class="number">1295</span>, <span class="number">1</span>, <span class="number">1112</span>, <span class="number">5130</span>, <span class="number">1108</span>, <span class="number">1620</span>, <span class="number">4801</span>, <span class="number">2688</span>, <span class="number">1</span>]</span><br><span class="line">     Instance: <span class="number">500</span>; Time: <span class="number">14.44</span>s; loss: <span class="number">1003.1052</span>; acc: <span class="number">7896.0</span>/<span class="number">8212.0</span>=<span class="number">0.9615</span></span><br><span class="line">     Instance: <span class="number">1000</span>; Time: <span class="number">14.64</span>s; loss: <span class="number">1009.0051</span>; acc: <span class="number">15646.0</span>/<span class="number">16300.0</span>=<span class="number">0.9599</span></span><br><span class="line">     Instance: <span class="number">1500</span>; Time: <span class="number">14.56</span>s; loss: <span class="number">1015.7129</span>; acc: <span class="number">23344.0</span>/<span class="number">24327.0</span>=<span class="number">0.9596</span></span><br><span class="line">     Instance: <span class="number">2000</span>; Time: <span class="number">14.51</span>s; loss: <span class="number">992.6101</span>; acc: <span class="number">31061.0</span>/<span class="number">32366.0</span>=<span class="number">0.9597</span></span><br><span class="line">     Instance: <span class="number">2500</span>; Time: <span class="number">14.52</span>s; loss: <span class="number">952.4902</span>; acc: <span class="number">38903.0</span>/<span class="number">40512.0</span>=<span class="number">0.9603</span></span><br><span class="line">     Instance: <span class="number">3000</span>; Time: <span class="number">14.68</span>s; loss: <span class="number">989.9021</span>; acc: <span class="number">46493.0</span>/<span class="number">48444.0</span>=<span class="number">0.9597</span></span><br><span class="line">     Instance: <span class="number">3500</span>; Time: <span class="number">15.40</span>s; loss: <span class="number">1149.4375</span>; acc: <span class="number">54169.0</span>/<span class="number">56501.0</span>=<span class="number">0.9587</span></span><br><span class="line">     Instance: <span class="number">4000</span>; Time: <span class="number">14.50</span>s; loss: <span class="number">1003.2131</span>; acc: <span class="number">61772.0</span>/<span class="number">64439.0</span>=<span class="number">0.9586</span></span><br><span class="line">     Instance: <span class="number">4000</span>; Time: <span class="number">0.06</span>s; loss: <span class="number">0.0000</span>; acc: <span class="number">61772.0</span>/<span class="number">64439.0</span>=<span class="number">0.9586</span></span><br><span class="line">Epoch: <span class="number">12</span> training finished. Time: <span class="number">117.31</span>s, speed: <span class="number">34.10</span>st/s,  total loss: <span class="number">8115.476318359375</span></span><br><span class="line">totalloss: <span class="number">8115.476318359375</span></span><br><span class="line">Entity <span class="built_in">type</span>:  PER p =  <span class="number">0.9242191500256016</span>  r =  <span class="number">0.8141632837167343</span>  f =  <span class="number">0.8657074340527579</span></span><br><span class="line">Entity <span class="built_in">type</span>:  LOC p =  <span class="number">0.9044619422572179</span>  r =  <span class="number">0.8240076518412243</span>  f =  <span class="number">0.8623623623623624</span></span><br><span class="line">Entity <span class="built_in">type</span>:  ORG p =  <span class="number">0.8483965014577259</span>  r =  <span class="number">0.6271551724137931</span>  f =  <span class="number">0.7211895910780669</span></span><br><span class="line">Entity <span class="built_in">type</span>:  OTHER p =  <span class="number">0.7117117117117117</span>  r =  <span class="number">0.6723404255319149</span>  f =  <span class="number">0.6914660831509846</span></span><br><span class="line">Entity <span class="built_in">type</span>:  <span class="built_in">all</span> p =  <span class="number">0.8729749631811488</span>  r =  <span class="number">0.7678108808290155</span>  f =  <span class="number">0.8170227429359064</span></span><br><span class="line">speed: <span class="number">38.96</span>st/s; acc: <span class="number">0.9698</span>, p: <span class="number">0.8730</span>, r: <span class="number">0.7678</span>, f: <span class="number">0.8170</span></span><br><span class="line">Entity <span class="built_in">type</span>:  PER p =  <span class="number">0.578088578088578</span>  r =  <span class="number">0.4492753623188406</span>  f =  <span class="number">0.5056065239551478</span></span><br><span class="line">Entity <span class="built_in">type</span>:  LOC p =  <span class="number">0.5982532751091703</span>  r =  <span class="number">0.524904214559387</span>  f =  <span class="number">0.5591836734693878</span></span><br><span class="line">Entity <span class="built_in">type</span>:  ORG p =  <span class="number">0.3088235294117647</span>  r =  <span class="number">0.1700404858299595</span>  f =  <span class="number">0.2193211488250653</span></span><br><span class="line">Entity <span class="built_in">type</span>:  OTHER p =  <span class="number">0.16033755274261605</span>  r =  <span class="number">0.1688888888888889</span>  f =  <span class="number">0.1645021645021645</span></span><br><span class="line">Entity <span class="built_in">type</span>:  <span class="built_in">all</span> p =  <span class="number">0.4777777777777778</span>  r =  <span class="number">0.38939197930142305</span>  f =  <span class="number">0.42908054169636495</span></span><br><span class="line">Dev: time: <span class="number">128.44</span>s, speed: <span class="number">38.91</span>st/s; acc: <span class="number">0.8829</span>, p: <span class="number">0.4778</span>, r: <span class="number">0.3894</span>, f: <span class="number">0.4291</span></span><br><span class="line">Entity <span class="built_in">type</span>:  PER p =  <span class="number">0.5748148148148148</span>  r =  <span class="number">0.42731277533039647</span>  f =  <span class="number">0.4902084649399874</span></span><br><span class="line">Entity <span class="built_in">type</span>:  LOC p =  <span class="number">0.554983922829582</span>  r =  <span class="number">0.5085444902769594</span>  f =  <span class="number">0.5307503075030751</span></span><br><span class="line">Entity <span class="built_in">type</span>:  ORG p =  <span class="number">0.30455635491606714</span>  r =  <span class="number">0.15137067938021453</span>  f =  <span class="number">0.2022292993630573</span></span><br><span class="line">Entity <span class="built_in">type</span>:  OTHER p =  <span class="number">0.11796982167352538</span>  r =  <span class="number">0.1184573002754821</span>  f =  <span class="number">0.11821305841924398</span></span><br><span class="line">Entity <span class="built_in">type</span>:  <span class="built_in">all</span> p =  <span class="number">0.45717106887188347</span>  r =  <span class="number">0.3647105159511619</span>  f =  <span class="number">0.40573994961112936</span></span><br><span class="line">Test: time: <span class="number">83.82</span>s, speed: <span class="number">38.88</span>st/s; acc: <span class="number">0.8814</span>, p: <span class="number">0.4572</span>, r: <span class="number">0.3647</span>, f: <span class="number">0.4057</span></span><br><span class="line">Epoch: <span class="number">13</span>/<span class="number">200</span></span><br><span class="line">Shuffle: first <span class="built_in">input</span> word <span class="built_in">list</span>: [<span class="number">1989</span>, <span class="number">121</span>, <span class="number">2407</span>, <span class="number">9415</span>, <span class="number">1626</span>, <span class="number">3110</span>, <span class="number">1115</span>, <span class="number">1119</span>, <span class="number">1238</span>, <span class="number">1108</span>, <span class="number">1105</span>, <span class="number">5838</span>, <span class="number">5361</span>, <span class="number">7239</span>, <span class="number">119</span>, <span class="number">1</span>, <span class="number">121</span>, <span class="number">21908</span>, <span class="number">1120</span>, <span class="number">1891</span>, <span class="number">4675</span>, <span class="number">1</span>, <span class="number">1</span>]</span><br><span class="line">     Instance: <span class="number">500</span>; Time: <span class="number">14.47</span>s; loss: <span class="number">1008.4021</span>; acc: <span class="number">7600.0</span>/<span class="number">7921.0</span>=<span class="number">0.9595</span></span><br><span class="line">     Instance: <span class="number">1000</span>; Time: <span class="number">14.60</span>s; loss: <span class="number">904.8628</span>; acc: <span class="number">15557.0</span>/<span class="number">16189.0</span>=<span class="number">0.9610</span></span><br><span class="line">     Instance: <span class="number">1500</span>; Time: <span class="number">15.21</span>s; loss: <span class="number">890.7754</span>; acc: <span class="number">23248.0</span>/<span class="number">24185.0</span>=<span class="number">0.9613</span></span><br><span class="line">     Instance: <span class="number">2000</span>; Time: <span class="number">14.53</span>s; loss: <span class="number">934.3428</span>; acc: <span class="number">30880.0</span>/<span class="number">32140.0</span>=<span class="number">0.9608</span></span><br><span class="line">     Instance: <span class="number">2500</span>; Time: <span class="number">14.48</span>s; loss: <span class="number">902.6064</span>; acc: <span class="number">38665.0</span>/<span class="number">40220.0</span>=<span class="number">0.9613</span></span><br><span class="line">     Instance: <span class="number">3000</span>; Time: <span class="number">14.53</span>s; loss: <span class="number">974.2864</span>; acc: <span class="number">46434.0</span>/<span class="number">48328.0</span>=<span class="number">0.9608</span></span><br><span class="line">     Instance: <span class="number">3500</span>; Time: <span class="number">14.61</span>s; loss: <span class="number">993.2480</span>; acc: <span class="number">54312.0</span>/<span class="number">56536.0</span>=<span class="number">0.9607</span></span><br><span class="line">     Instance: <span class="number">4000</span>; Time: <span class="number">14.60</span>s; loss: <span class="number">872.9658</span>; acc: <span class="number">61925.0</span>/<span class="number">64439.0</span>=<span class="number">0.9610</span></span><br><span class="line">     Instance: <span class="number">4000</span>; Time: <span class="number">0.06</span>s; loss: <span class="number">0.0000</span>; acc: <span class="number">61925.0</span>/<span class="number">64439.0</span>=<span class="number">0.9610</span></span><br><span class="line">Epoch: <span class="number">13</span> training finished. Time: <span class="number">117.09</span>s, speed: <span class="number">34.16</span>st/s,  total loss: <span class="number">7481.48974609375</span></span><br><span class="line">totalloss: <span class="number">7481.48974609375</span></span><br><span class="line">Entity <span class="built_in">type</span>:  PER p =  <span class="number">0.8835676625659051</span>  r =  <span class="number">0.9070816418583671</span>  f =  <span class="number">0.8951702648564435</span></span><br><span class="line">Entity <span class="built_in">type</span>:  LOC p =  <span class="number">0.9378980891719745</span>  r =  <span class="number">0.8450502152080345</span>  f =  <span class="number">0.889056603773585</span></span><br><span class="line">Entity <span class="built_in">type</span>:  ORG p =  <span class="number">0.9246153846153846</span>  r =  <span class="number">0.6476293103448276</span>  f =  <span class="number">0.761723700887199</span></span><br><span class="line">Entity <span class="built_in">type</span>:  OTHER p =  <span class="number">0.813443072702332</span>  r =  <span class="number">0.6308510638297873</span>  f =  <span class="number">0.7106051527860996</span></span><br><span class="line">Entity <span class="built_in">type</span>:  <span class="built_in">all</span> p =  <span class="number">0.8976349521574292</span>  r =  <span class="number">0.8050518134715026</span>  f =  <span class="number">0.8488262910798122</span></span><br><span class="line">speed: <span class="number">38.83</span>st/s; acc: <span class="number">0.9744</span>, p: <span class="number">0.8976</span>, r: <span class="number">0.8051</span>, f: <span class="number">0.8488</span></span><br><span class="line">Entity <span class="built_in">type</span>:  PER p =  <span class="number">0.5139146567717996</span>  r =  <span class="number">0.5018115942028986</span>  f =  <span class="number">0.5077910174152154</span></span><br><span class="line">Entity <span class="built_in">type</span>:  LOC p =  <span class="number">0.6324582338902148</span>  r =  <span class="number">0.5076628352490421</span>  f =  <span class="number">0.563230605738576</span></span><br><span class="line">Entity <span class="built_in">type</span>:  ORG p =  <span class="number">0.2732919254658385</span>  r =  <span class="number">0.17813765182186234</span>  f =  <span class="number">0.2156862745098039</span></span><br><span class="line">Entity <span class="built_in">type</span>:  OTHER p =  <span class="number">0.18439716312056736</span>  r =  <span class="number">0.11555555555555555</span>  f =  <span class="number">0.14207650273224043</span></span><br><span class="line">Entity <span class="built_in">type</span>:  <span class="built_in">all</span> p =  <span class="number">0.4857142857142857</span>  r =  <span class="number">0.3958602846054334</span>  f =  <span class="number">0.436208125445474</span></span><br><span class="line">Dev: time: <span class="number">128.99</span>s, speed: <span class="number">38.62</span>st/s; acc: <span class="number">0.8845</span>, p: <span class="number">0.4857</span>, r: <span class="number">0.3959</span>, f: <span class="number">0.4362</span></span><br><span class="line">Entity <span class="built_in">type</span>:  PER p =  <span class="number">0.5144124168514412</span>  r =  <span class="number">0.5110132158590308</span>  f =  <span class="number">0.512707182320442</span></span><br><span class="line">Entity <span class="built_in">type</span>:  LOC p =  <span class="number">0.6137026239067055</span>  r =  <span class="number">0.49616971125515613</span>  f =  <span class="number">0.54871293580971</span></span><br><span class="line">Entity <span class="built_in">type</span>:  ORG p =  <span class="number">0.2938775510204082</span>  r =  <span class="number">0.17163289630512515</span>  f =  <span class="number">0.21670428893905191</span></span><br><span class="line">Entity <span class="built_in">type</span>:  OTHER p =  <span class="number">0.15777262180974477</span>  r =  <span class="number">0.09366391184573003</span>  f =  <span class="number">0.11754537597234226</span></span><br><span class="line">Entity <span class="built_in">type</span>:  <span class="built_in">all</span> p =  <span class="number">0.4837686111789114</span>  r =  <span class="number">0.39031114612051987</span>  f =  <span class="number">0.4320435967302453</span></span><br><span class="line">Test: time: <span class="number">84.74</span>s, speed: <span class="number">38.46</span>st/s; acc: <span class="number">0.8848</span>, p: <span class="number">0.4838</span>, r: <span class="number">0.3903</span>, f: <span class="number">0.4320</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="indexË∂äÁïå">indexË∂äÁïå</h3>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"main.py"</span>, line <span class="number">569</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    train(data)</span><br><span class="line">  File <span class="string">"main.py"</span>, line <span class="number">481</span>, <span class="keyword">in</span> train</span><br><span class="line">    speed, acc, p, r, f, _,_ = evaluate(data, model, <span class="string">"test"</span>)</span><br><span class="line">  File <span class="string">"main.py"</span>, line <span class="number">171</span>, <span class="keyword">in</span> evaluate</span><br><span class="line">    tag_seq = model(batch_word, batch_features, batch_wordlen, batch_char, batch_charlen, batch_charrecover, mask, batch_obj, obj_mask)</span><br><span class="line">  File <span class="string">"/usr/local/lib/python3.7/dist-packages/torch/nn/modules/module.py"</span>, line <span class="number">1110</span>, <span class="keyword">in</span> _call_impl</span><br><span class="line">    <span class="keyword">return</span> forward_call(*<span class="built_in">input</span>, **kwargs)</span><br><span class="line">  File <span class="string">"/content/drive/MyDrive/Pytorch-implementation-for-OCSGA/model/MUL_LSTM_MCA.py"</span>, line <span class="number">223</span>, <span class="keyword">in</span> forward</span><br><span class="line">    char_seq_recover, object_inputs, object_mask)</span><br><span class="line">  File <span class="string">"/content/drive/MyDrive/Pytorch-implementation-for-OCSGA/model/MUL_LSTM_MCA.py"</span>, line <span class="number">126</span>, <span class="keyword">in</span> _get_lstm_features</span><br><span class="line">    text_feat = self.txt_feat_linear(self.bert(tmp).last_hidden_state)</span><br><span class="line">  File <span class="string">"/usr/local/lib/python3.7/dist-packages/torch/nn/modules/module.py"</span>, line <span class="number">1110</span>, <span class="keyword">in</span> _call_impl</span><br><span class="line">    <span class="keyword">return</span> forward_call(*<span class="built_in">input</span>, **kwargs)</span><br><span class="line">  File <span class="string">"/usr/local/lib/python3.7/dist-packages/transformers/models/bert/modeling_bert.py"</span>, line <span class="number">1027</span>, <span class="keyword">in</span> forward</span><br><span class="line">    return_dict=return_dict,</span><br><span class="line">  File <span class="string">"/usr/local/lib/python3.7/dist-packages/torch/nn/modules/module.py"</span>, line <span class="number">1110</span>, <span class="keyword">in</span> _call_impl</span><br><span class="line">    <span class="keyword">return</span> forward_call(*<span class="built_in">input</span>, **kwargs)</span><br><span class="line">  File <span class="string">"/usr/local/lib/python3.7/dist-packages/transformers/models/bert/modeling_bert.py"</span>, line <span class="number">613</span>, <span class="keyword">in</span> forward</span><br><span class="line">    output_attentions,</span><br><span class="line">  File <span class="string">"/usr/local/lib/python3.7/dist-packages/torch/nn/modules/module.py"</span>, line <span class="number">1110</span>, <span class="keyword">in</span> _call_impl</span><br><span class="line">    <span class="keyword">return</span> forward_call(*<span class="built_in">input</span>, **kwargs)</span><br><span class="line">  File <span class="string">"/usr/local/lib/python3.7/dist-packages/transformers/models/bert/modeling_bert.py"</span>, line <span class="number">498</span>, <span class="keyword">in</span> forward</span><br><span class="line">    past_key_value=self_attn_past_key_value,</span><br><span class="line">  File <span class="string">"/usr/local/lib/python3.7/dist-packages/torch/nn/modules/module.py"</span>, line <span class="number">1110</span>, <span class="keyword">in</span> _call_impl</span><br><span class="line">    <span class="keyword">return</span> forward_call(*<span class="built_in">input</span>, **kwargs)</span><br><span class="line">  File <span class="string">"/usr/local/lib/python3.7/dist-packages/transformers/models/bert/modeling_bert.py"</span>, line <span class="number">430</span>, <span class="keyword">in</span> forward</span><br><span class="line">    output_attentions,</span><br><span class="line">  File <span class="string">"/usr/local/lib/python3.7/dist-packages/torch/nn/modules/module.py"</span>, line <span class="number">1110</span>, <span class="keyword">in</span> _call_impl</span><br><span class="line">    <span class="keyword">return</span> forward_call(*<span class="built_in">input</span>, **kwargs)</span><br><span class="line">  File <span class="string">"/usr/local/lib/python3.7/dist-packages/transformers/models/bert/modeling_bert.py"</span>, line <span class="number">311</span>, <span class="keyword">in</span> forward</span><br><span class="line">    key_layer = self.transpose_for_scores(self.key(hidden_states))</span><br><span class="line">  File <span class="string">"/usr/local/lib/python3.7/dist-packages/torch/nn/modules/module.py"</span>, line <span class="number">1110</span>, <span class="keyword">in</span> _call_impl</span><br><span class="line">    <span class="keyword">return</span> forward_call(*<span class="built_in">input</span>, **kwargs)</span><br><span class="line">  File <span class="string">"/usr/local/lib/python3.7/dist-packages/torch/nn/modules/linear.py"</span>, line <span class="number">103</span>, <span class="keyword">in</span> forward</span><br><span class="line">    <span class="keyword">return</span> F.linear(<span class="built_in">input</span>, self.weight, self.bias)</span><br><span class="line">RuntimeError: CUDA error: CUBLAS_STATUS_EXECUTION_FAILED when calling `cublasSgemm( handle, opa, opb, m, n, k, &amp;alpha, a, lda, b, ldb, &amp;beta, c, ldc)`</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"main.py"</span>, line <span class="number">569</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    train(data)</span><br><span class="line">  File <span class="string">"main.py"</span>, line <span class="number">481</span>, <span class="keyword">in</span> train</span><br><span class="line">    speed, acc, p, r, f, _,_ = evaluate(data, model, <span class="string">"test"</span>)</span><br><span class="line">  File <span class="string">"main.py"</span>, line <span class="number">171</span>, <span class="keyword">in</span> evaluate</span><br><span class="line">    tag_seq = model(batch_word, batch_features, batch_wordlen, batch_char, batch_charlen, batch_charrecover, mask, batch_obj, obj_mask)</span><br><span class="line">  File <span class="string">"/usr/local/lib/python3.7/dist-packages/torch/nn/modules/module.py"</span>, line <span class="number">1110</span>, <span class="keyword">in</span> _call_impl</span><br><span class="line">    <span class="keyword">return</span> forward_call(*<span class="built_in">input</span>, **kwargs)</span><br><span class="line">  File <span class="string">"/content/drive/MyDrive/Pytorch-implementation-for-OCSGA/model/MUL_LSTM_MCA.py"</span>, line <span class="number">228</span>, <span class="keyword">in</span> forward</span><br><span class="line">    outs = self._get_lstm_features(word_inputs, feature_inputs, word_seq_lengths, char_inputs, char_seq_lengths, char_seq_recover, object_inputs, object_mask)</span><br><span class="line">  File <span class="string">"/content/drive/MyDrive/Pytorch-implementation-for-OCSGA/model/MUL_LSTM_MCA.py"</span>, line <span class="number">126</span>, <span class="keyword">in</span> _get_lstm_features</span><br><span class="line">    text_feat = self.txt_feat_linear(self.bert(tmp).last_hidden_state)</span><br><span class="line">  File <span class="string">"/usr/local/lib/python3.7/dist-packages/torch/nn/modules/module.py"</span>, line <span class="number">1110</span>, <span class="keyword">in</span> _call_impl</span><br><span class="line">    <span class="keyword">return</span> forward_call(*<span class="built_in">input</span>, **kwargs)</span><br><span class="line">  File <span class="string">"/usr/local/lib/python3.7/dist-packages/transformers/models/bert/modeling_bert.py"</span>, line <span class="number">1027</span>, <span class="keyword">in</span> forward</span><br><span class="line">    return_dict=return_dict,</span><br><span class="line">  File <span class="string">"/usr/local/lib/python3.7/dist-packages/torch/nn/modules/module.py"</span>, line <span class="number">1110</span>, <span class="keyword">in</span> _call_impl</span><br><span class="line">    <span class="keyword">return</span> forward_call(*<span class="built_in">input</span>, **kwargs)</span><br><span class="line">  File <span class="string">"/usr/local/lib/python3.7/dist-packages/transformers/models/bert/modeling_bert.py"</span>, line <span class="number">613</span>, <span class="keyword">in</span> forward</span><br><span class="line">    output_attentions,</span><br><span class="line">  File <span class="string">"/usr/local/lib/python3.7/dist-packages/torch/nn/modules/module.py"</span>, line <span class="number">1110</span>, <span class="keyword">in</span> _call_impl</span><br><span class="line">    <span class="keyword">return</span> forward_call(*<span class="built_in">input</span>, **kwargs)</span><br><span class="line">  File <span class="string">"/usr/local/lib/python3.7/dist-packages/transformers/models/bert/modeling_bert.py"</span>, line <span class="number">498</span>, <span class="keyword">in</span> forward</span><br><span class="line">    past_key_value=self_attn_past_key_value,</span><br><span class="line">  File <span class="string">"/usr/local/lib/python3.7/dist-packages/torch/nn/modules/module.py"</span>, line <span class="number">1110</span>, <span class="keyword">in</span> _call_impl</span><br><span class="line">    <span class="keyword">return</span> forward_call(*<span class="built_in">input</span>, **kwargs)</span><br><span class="line">  File <span class="string">"/usr/local/lib/python3.7/dist-packages/transformers/models/bert/modeling_bert.py"</span>, line <span class="number">430</span>, <span class="keyword">in</span> forward</span><br><span class="line">    output_attentions,</span><br><span class="line">  File <span class="string">"/usr/local/lib/python3.7/dist-packages/torch/nn/modules/module.py"</span>, line <span class="number">1110</span>, <span class="keyword">in</span> _call_impl</span><br><span class="line">    <span class="keyword">return</span> forward_call(*<span class="built_in">input</span>, **kwargs)</span><br><span class="line">  File <span class="string">"/usr/local/lib/python3.7/dist-packages/transformers/models/bert/modeling_bert.py"</span>, line <span class="number">327</span>, <span class="keyword">in</span> forward</span><br><span class="line">    attention_scores = torch.matmul(query_layer, key_layer.transpose(-<span class="number">1</span>, -<span class="number">2</span>))</span><br></pre></td></tr></tbody></table></figure>
<img src="C:\Users\19772\AppData\Roaming\Typora\typora-user-images\image-20220530210749779.png" alt="image-20220530210749779" style="zoom:80%;">
<blockquote>
<p>È≠îÊîπÁöÑ</p>
</blockquote>
<img src="C:\Users\19772\AppData\Roaming\Typora\typora-user-images\image-20220530160217433.png" alt="image-20220530160217433" style="zoom:80%;">
<blockquote>
<p>ÂéüÊú¨ÁöÑ</p>
</blockquote>
<img src="C:\Users\19772\AppData\Roaming\Typora\typora-user-images\image-20220530160241049.png" alt="image-20220530160241049" style="zoom:80%;">
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">zxr</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://xurui314.github.io/2022/06/01/Multimodal-NER/">https://xurui314.github.io/2022/06/01/Multimodal-NER/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Python/">Python</a><a class="post-meta__tags" href="/tags/Deep-Learning/">Deep Learning</a></div><div class="post_share"><div class="social-share" data-image="https://s2.loli.net/2022/06/01/NGZoMHJQIyVS5Ab.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer=""></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/06/14/%E9%9A%8F%E4%BE%BF%E8%AE%B0%E8%AE%B0/"><img class="prev-cover" src="https://s2.loli.net/2022/01/09/rihH9tKPQCcLD7e.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">Èöè‰æøËÆ∞ËÆ∞</div></div></a></div><div class="next-post pull-right"><a href="/2022/05/29/%E6%91%B8%E9%B1%BC%E5%AD%A6%E6%96%B9%E6%B3%95%E8%AE%BA/"><img class="next-cover" src="https://s2.loli.net/2022/05/29/KyGgICA235bBLov.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">Êë∏È±ºÂ≠¶ÊñπÊ≥ïËÆ∫</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2022/06/16/nlp-learning-recording/" title="nlp learning recording"><img class="cover" src="https://images.unsplash.com/photo-1501555088652-021faa106b9b?ixlib=rb-1.2.1&amp;ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;auto=format&amp;fit=crop&amp;w=873&amp;q=80" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-06-16</div><div class="title">nlp learning recording</div></div></a></div><div><a href="/2022/02/10/MIT-ML/" title="MIT ML"><img class="cover" src="https://s2.loli.net/2022/01/14/ftJD3kOcUnPHpzN.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-02-10</div><div class="title">MIT ML</div></div></a></div><div><a href="/2022/10/13/Tree-based-AI/" title="Tree based AI"><img class="cover" src="https://s2.loli.net/2022/10/13/Z8Llvman5s1iGXz.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-13</div><div class="title">Tree based AI</div></div></a></div><div><a href="/2021/08/15/‰∏§Â±ÇÁ•ûÁªèÁΩëÁªúËØÜÂà´ÊâãÂÜôÊï∞Â≠ó/" title="‰∏§Â±ÇÁ•ûÁªèÁΩëÁªúËØÜÂà´ÊâãÂÜôÊï∞Â≠ó"><img class="cover" src="https://i.loli.net/2021/08/15/NYcSXrECnvzOiLP.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-08-15</div><div class="title">‰∏§Â±ÇÁ•ûÁªèÁΩëÁªúËØÜÂà´ÊâãÂÜôÊï∞Â≠ó</div></div></a></div><div><a href="/2021/08/14/Á•ûÁªèÁΩëÁªúÊê≠Âª∫ÂáÜÂ§áÂÜÖÂÆπ/" title="Á•ûÁªèÁΩëÁªúÊê≠Âª∫ÂáÜÂ§áÂÜÖÂÆπ"><img class="cover" src="https://i.loli.net/2021/08/15/F8aP7R36IidpCt5.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-08-14</div><div class="title">Á•ûÁªèÁΩëÁªúÊê≠Âª∫ÂáÜÂ§áÂÜÖÂÆπ</div></div></a></div><div><a href="/2022/01/14/Machine-Learning-Coding/" title="Machine Learning Code"><img class="cover" src="https://s2.loli.net/2022/01/14/LaGcAPJX9QpgTBH.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-01-14</div><div class="title">Machine Learning Code</div></div></a></div></div></div><hr><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comment</span></div><div id="comment-switch"><span class="first-comment">Valine</span><span class="switch-btn"></span><span class="second-comment">Disqus</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div><div><div id="disqus_thread"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://s2.loli.net/2021/12/08/yTYthVwXD4IPbJ9.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"></div><div class="author-info__name">zxr</div><div class="author-info__description">Think and Do like an MIT student</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">72</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">34</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">16</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/XuRui314"><i class="fab fa-github"></i><span>This is zxr!üöÄ</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/XuRui314" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="https://mail.qq.com/" target="_blank" title="Email-1977289398@qq.com"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>Announcement</span></div><div class="announcement_content">zxrÁöÑÁîüÊ¥ªÔºåmathÔºåÁºñÁ®ãËÆ∞ÂΩï,<div class="twopeople"><div class="container" style="height:200px;"><canvas class="illo" width="800" height="800" style="max-width: 200px; max-height: 200px; touch-action: none; width: 640px; height: 640px;"></canvas></div><script src="https://cdn.jsdelivr.net/gh/Justlovesmile/CDN/js/twopeople1.js"></script><script src="https://cdn.jsdelivr.net/gh/Justlovesmile/CDN/js/zdog.dist.js"></script><script id="rendered-js" src="https://cdn.jsdelivr.net/gh/Justlovesmile/CDN/js/twopeople.js"></script><style>.twopeople{margin: 0;align-items: center;justify-content: center;text-align: center;}canvas{display: block;margin: 0 auto;cursor: move;}</style></div><div class="twopeople"></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">Ê¶ÇËø∞&amp;ÂéüÊ®°Âûã</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%99%E5%9C%A8%E5%BC%80%E5%A7%8B"><span class="toc-number">1.1.</span> <span class="toc-text">ÂÜôÂú®ÂºÄÂßã</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A6%96%E5%85%88%E4%BB%8Emain-py%E5%BC%80%E5%A7%8B"><span class="toc-number">1.2.</span> <span class="toc-text">È¶ñÂÖà‰ªémain.pyÂºÄÂßã</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84"><span class="toc-number">1.3.</span> <span class="toc-text">Êï¥‰ΩìÊû∂ÊûÑ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%B7%A5%E7%A8%8B"><span class="toc-number">1.3.1.</span> <span class="toc-text">Â¶Ç‰ΩïÂàõÂª∫‰∏Ä‰∏™Â∑•Á®ã</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%8A%A0%E8%BD%BD"><span class="toc-number">1.3.1.1.</span> <span class="toc-text">Êï∞ÊçÆÂä†ËΩΩ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E-init-py"><span class="toc-number">1.3.1.2.</span> <span class="toc-text">ÂÖ≥‰∫é_init_.py</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.3.1.3.</span> <span class="toc-text">Ê®°Âûã</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86"><span class="toc-number">1.4.</span> <span class="toc-text">Êï∞ÊçÆÂ§ÑÁêÜ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Alphabet%E6%9E%84%E5%BB%BA"><span class="toc-number">1.4.1.</span> <span class="toc-text">AlphabetÊûÑÂª∫</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Embedding%E6%9E%84%E5%BB%BA"><span class="toc-number">1.4.2.</span> <span class="toc-text">EmbeddingÊûÑÂª∫</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E5%9E%8B%E8%AE%AD%E7%BB%83-%E8%AF%84%E4%BC%B0"><span class="toc-number">1.5.</span> <span class="toc-text">Ê®°ÂûãËÆ≠ÁªÉ&amp;ËØÑ‰º∞</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">2.</span> <span class="toc-text">ÊîπÊ®°Âûã</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%8D%E8%A1%A8%E5%A4%84%E7%90%86"><span class="toc-number">2.0.1.</span> <span class="toc-text">ËØçË°®Â§ÑÁêÜ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E5%9E%8B%E6%9B%B4%E6%8D%A2"><span class="toc-number">2.0.2.</span> <span class="toc-text">Ê®°ÂûãÊõ¥Êç¢</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9B%BF%E6%8D%A2%E4%B8%BABert"><span class="toc-number">2.0.2.1.</span> <span class="toc-text">ÊõøÊç¢‰∏∫Bert</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%A0%E5%85%A5%E5%A4%9A%E6%A8%A1%E6%80%81%E4%BF%A1%E6%81%AF"><span class="toc-number">2.0.2.2.</span> <span class="toc-text">Âä†ÂÖ•Â§öÊ®°ÊÄÅ‰ø°ÊÅØ</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%81%87%E5%88%B0%E7%9A%84bug"><span class="toc-number">2.1.</span> <span class="toc-text">ÈÅáÂà∞ÁöÑbug</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#colab%E6%89%93%E5%BC%80%E6%96%87%E4%BB%B6"><span class="toc-number">2.1.1.</span> <span class="toc-text">colabÊâìÂºÄÊñá‰ª∂</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Torch-Tensor%E6%94%BE%E5%9C%A8GPU%E4%B8%8A"><span class="toc-number">2.1.2.</span> <span class="toc-text">Torch TensorÊîæÂú®GPU‰∏ä</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A2%AF%E5%BA%A6NAN"><span class="toc-number">2.1.3.</span> <span class="toc-text">Ê¢ØÂ∫¶NAN</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#p%EF%BC%8Cr%EF%BC%8Cf%E7%9A%84%E5%80%BC%E9%97%AE%E9%A2%98"><span class="toc-number">2.1.4.</span> <span class="toc-text">pÔºårÔºåfÁöÑÂÄºÈóÆÈ¢ò</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Bert%E8%BF%87%E6%8B%9F%E5%90%88"><span class="toc-number">2.1.5.</span> <span class="toc-text">BertËøáÊãüÂêà</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#index%E8%B6%8A%E7%95%8C"><span class="toc-number">2.1.6.</span> <span class="toc-text">indexË∂äÁïå</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/03/17/%E9%A3%9E%E6%A1%A8%E5%AD%A6%E4%B9%A0%E8%B5%9B%EF%BC%9A%E4%BA%A7%E5%93%81%E8%AF%84%E8%AE%BA%E8%A7%82%E7%82%B9%E6%8F%90%E5%8F%96/" title="È£ûÊ°®Â≠¶‰π†ËµõÔºö‰∫ßÂìÅËØÑËÆ∫ËßÇÁÇπÊèêÂèñ"><img src="https://pic1.zhimg.com/v2-1583bb0421d71bf07ed0897f4186da82_xl.jpg?source=32738c0c" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="È£ûÊ°®Â≠¶‰π†ËµõÔºö‰∫ßÂìÅËØÑËÆ∫ËßÇÁÇπÊèêÂèñ"></a><div class="content"><a class="title" href="/2023/03/17/%E9%A3%9E%E6%A1%A8%E5%AD%A6%E4%B9%A0%E8%B5%9B%EF%BC%9A%E4%BA%A7%E5%93%81%E8%AF%84%E8%AE%BA%E8%A7%82%E7%82%B9%E6%8F%90%E5%8F%96/" title="È£ûÊ°®Â≠¶‰π†ËµõÔºö‰∫ßÂìÅËØÑËÆ∫ËßÇÁÇπÊèêÂèñ">È£ûÊ°®Â≠¶‰π†ËµõÔºö‰∫ßÂìÅËØÑËÆ∫ËßÇÁÇπÊèêÂèñ</a><time datetime="2023-03-17T14:48:51.000Z" title="Created 2023-03-17 22:48:51">2023-03-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/03/13/Hey-this-is-how-LSTM-works/" title="Hey, this is why LSTM works!"><img src="https://i.pinimg.com/originals/eb/f4/3c/ebf43c10b242f73d8dfc5e4545ecc63e.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Hey, this is why LSTM works!"></a><div class="content"><a class="title" href="/2023/03/13/Hey-this-is-how-LSTM-works/" title="Hey, this is why LSTM works!">Hey, this is why LSTM works!</a><time datetime="2023-03-13T14:19:27.000Z" title="Created 2023-03-13 22:19:27">2023-03-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/03/13/2023-deep-learning/" title="2023 deep learning"><img src="https://www.csail.mit.edu/sites/default/files/2017-08/15473005358_576e646680_o.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="2023 deep learning"></a><div class="content"><a class="title" href="/2023/03/13/2023-deep-learning/" title="2023 deep learning">2023 deep learning</a><time datetime="2023-03-13T08:03:35.000Z" title="Created 2023-03-13 16:03:35">2023-03-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/03/08/HW3P1/" title="HW3P1"><img src="https://s2.loli.net/2023/03/08/CSvgBbyca1RNiEF.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="HW3P1"></a><div class="content"><a class="title" href="/2023/03/08/HW3P1/" title="HW3P1">HW3P1</a><time datetime="2023-03-08T14:18:15.000Z" title="Created 2023-03-08 22:18:15">2023-03-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/03/03/HW2P2/" title="HW2P2"><img src="https://s2.loli.net/2023/03/03/Qav93NjokKmWh7A.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="HW2P2"></a><div class="content"><a class="title" href="/2023/03/03/HW2P2/" title="HW2P2">HW2P2</a><time datetime="2023-03-03T03:08:13.000Z" title="Created 2023-03-03 11:08:13">2023-03-03</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">¬©2020 - 2023 By zxr</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="github-badge"><a style="color: #fff" rel="license" href="https://hexo.io/" target="_blank" title="Áî± Hexo Âº∫ÂäõÈ©±Âä®"><span class="badge-subject">Powered</span><span class="badge-value bg-blue">Hexo</span></a><a style="color: #fff" rel="license" href="https://gitee.com/" target="_blank" title="ÈùôÊÄÅÁΩëÈ°µÊâòÁÆ°‰∫é GitHub Pages Âíå Coding Pages Âíå Gitee Pages"><span class="badge-subject">Hosted</span><span class="badge-value bg-brightgreen">GitHub &amp; Coding &amp; Gitee</span></a><a style="color: #fff" rel="license" href="https://www.jsdelivr.com/" target="_blank" title="jsDelivr Êèê‰æõ CDN Âä†ÈÄüÊúçÂä°"><span class="badge-subject">CDN</span><span class="badge-value bg-orange">jsDelivr</span></a><a style="color: #fff" rel="license" href="https://jerryc.me" target="_blank" title="Á´ôÁÇπ‰ΩøÁî® Butterfly‰∏ªÈ¢ò"><span class="badge-subject">Theme</span><span class="badge-value bg-blue">Butterfly</span></a><a style="color: #fff" rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" title="Êú¨Á´ôÁÇπÈááÁî®Áü•ËØÜÂÖ±‰∫´ÁΩ≤Âêç-ÈùûÂïÜ‰∏öÊÄß‰ΩøÁî®-Áõ∏ÂêåÊñπÂºèÂÖ±‰∫´ 4.0 ÂõΩÈôÖËÆ∏ÂèØÂçèËÆÆËøõË°åËÆ∏ÂèØ"><span class="badge-subject"><i class="fa fa-copyright"></i></span><span class="badge-value bg-lightgrey">BY-NC-SA 4.0  </span></a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="font-plus" type="button" title="Increase font size"><i class="fas fa-plus"></i></button><button id="font-minus" type="button" title="Decrease font size"><i class="fas fa-minus"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="Scroll To Comments"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.2
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container:not\([display]\)').forEach(node => {
            const target = node.parentNode
            if (target.nodeName.toLowerCase() === 'li') {
              target.parentNode.classList.add('has-jax')
            } else {
              target.classList.add('has-jax')
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = '[object Object]'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typeset()
}</script><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '',
      appKey: '',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script><script>function loadDisqus () {
  var disqus_config = function () {
    this.page.url = 'https://xurui314.github.io/2022/06/01/Multimodal-NER/'
    this.page.identifier = '2022/06/01/Multimodal-NER/'
    this.page.title = 'Multimodal NER'
  };

  window.disqusReset = () => {
    DISQUS.reset({
      reload: true,
      config: disqus_config
    })
  }

  if (window.DISQUS) disqusReset()
  else {
    (function() { 
      var d = document, s = d.createElement('script');
      s.src = 'https://.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  }
}

if ('Valine' === 'Disqus' || !false) {
  if (false) btf.loadComment(document.getElementById('disqus_thread'), loadDisqus)
  else loadDisqus()
} else {
  function loadOtherComment () {
    loadDisqus()
  }
}
</script></div><script src="https://cdn.jsdelivr.net/gh/XuRui314/live2d-widget@1.0.1/autoload.js"></script><script src="/js/title.js"></script><script src="/dist/nochocolate.js"></script><div id="aplayer"></div><script type="text/javascript" src="/dist/APlayer.min.js"></script><script type="text/javascript" src="/dist/music.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/gh/metowolf/MetingJS@1.2/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = [
  'title',
  '#config-diff',
  '#body-wrap',
  '#rightside-config-hide',
  '#rightside-config-show',
  '.js-pjax'
]

if (false) {
  pjaxSelectors.unshift('meta[property="og:image"]', 'meta[property="og:title"]', 'meta[property="og:url"]')
}

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.removeEventListener('scroll', window.tocScrollFn)
  window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // Analytics
  if (false) {
    MtaH5.pgv()
  }

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async="" data-pjax="" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --> <script data-pjax="">if(document.getElementById('recent-posts') && (location.pathname ==='all'|| 'all' ==='all')){
    var parent = document.getElementById('recent-posts');
    var child = '<div class="recent-post-item" style="width:100%;height: auto"><div id="catalog_magnet"><div class="magnet_item"><a class="magnet_link" href="https://XuRui314.github.io/categories/Math/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">üìö zxr„ÅÆÊï∞Â≠¶‰∏ñÁïå (12)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://XuRui314.github.io/categories/ÁÆóÊ≥ïÂ≠¶‰π†/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">üéÆ zxr„ÅÆÁÆóÊ≥ïÂ≠¶‰π† (6)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://XuRui314.github.io/categories/ÁîüÊ¥ªË∂£Èóª/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">üê±‚Äçüëì zxr„ÅÆÁîüÊ¥ªË∂£Èóª (4)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://XuRui314.github.io/categories/ÁºñÁ®ãÂÆû‰æã/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">üë©‚Äçüíª zxr„ÅÆÁºñÁ®ãÂ≠¶‰π† (4)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://XuRui314.github.io/categories/ÁîüÊ¥ªÊÑüÊÇü/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">üö¥‚Äç‚ôÇ zxr„ÅÆÁîüÊ¥ªÊÑüÊÇü (11)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://XuRui314.github.io/categories/Hexo/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">üíå zxr„ÅÆBlogËÆ∞ÂΩï (1)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><a class="magnet_link_more"  href="https://XuRui314.github.io/categories" style="flex:1;text-align: center;margin-bottom: 10px;">Êü•ÁúãÊõ¥Â§ö...</a></div></div>';
    console.log('Â∑≤ÊåÇËΩΩmagnet')
    parent.insertAdjacentHTML("afterbegin",child)}
     </script><style>#catalog_magnet{flex-wrap: wrap;display: flex;width:100%;justify-content:space-between;padding: 10px 10px 0 10px;align-content: flex-start;}.magnet_item{flex-basis: calc(50% - 5px);background: #f2f2f2;margin-bottom: 10px;border-radius: 8px;transition: all 0.2s ease-in-out;}.magnet_item:hover{background: #b30070}.magnet_link_more{color:#555}.magnet_link{color:black}.magnet_link:hover{color:white}@media screen and (max-width: 600px) {.magnet_item {flex-basis: 100%;}}.magnet_link_context{display:flex;padding: 10px;font-size:16px;transition: all 0.2s ease-in-out;}.magnet_link_context:hover{padding: 10px 20px;}</style>
    <style></style> <script data-pjax="">if(document.getElementById('recent-posts') && location.pathname =='/'){
    
    var parent = document.getElementById('recent-posts');
    var child = '<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src="https://i.loli.net/2021/09/17/9H5WSbTrVejOdkz.jpg" alt="https://i.loli.net/2021/09/17/9H5WSbTrVejOdkz.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2021-09-17</span><a class="blog-slider__title" href="2021/09/17/Ê¶ÇÁéáÂíåÊµãÂ∫¶/">Ê¶ÇÁéáÂíåÊµãÂ∫¶(ZJUÂ§ß‰Ω¨)</a><div class="blog-slider__text">Êù•ÁúãÁúãZJUËÆ°ÁßëÂ§ß‰Ω¨Ëß£ÈáäÊ¶ÇÁéáÂíåÊµãÂ∫¶ü•ô</div><a class="blog-slider__button" href="2021/09/17/Ê¶ÇÁéáÂíåÊµãÂ∫¶/">ËØ¶ÊÉÖ</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src="https://i.loli.net/2021/08/25/bPy5m3j9QAilwr2.jpg" alt="https://i.loli.net/2021/08/25/bPy5m3j9QAilwr2.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2021-08-26</span><a class="blog-slider__title" href="2021/08/26/ÁÆóÊ≥ïÈ¢òÁõÆÁªÉ‰π†/">AcWing-Oj-Âà∑È¢òÂ≠¶‰π†ËÆ∞ÂΩï(Âü∫Á°ÄÁÆóÊ≥ï)</a><div class="blog-slider__text">Êù•ÁúãÁÆóÊ≥ïËíüËíªÁöÑ‰∏¢‰∫∫Êó•Â∏∏Âïäüë©‚Äçü¶Ω</div><a class="blog-slider__button" href="2021/08/26/ÁÆóÊ≥ïÈ¢òÁõÆÁªÉ‰π†/">ËØ¶ÊÉÖ</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src="https://i.loli.net/2021/08/15/NYcSXrECnvzOiLP.jpg" alt="https://i.loli.net/2021/08/15/NYcSXrECnvzOiLP.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2021-08-15</span><a class="blog-slider__title" href="2021/08/15/‰∏§Â±ÇÁ•ûÁªèÁΩëÁªúËØÜÂà´ÊâãÂÜôÊï∞Â≠ó/">‰∏§Â±ÇÁ•ûÁªèÁΩëÁªúËØÜÂà´ÊâãÂÜôÊï∞Â≠ó</a><div class="blog-slider__text">ËØÜÂà´ÊâãÂÜôÊï∞Â≠óÊúÄÁÆÄÂçïÁöÑÂÆûÁé∞üß¶</div><a class="blog-slider__button" href="2021/08/15/‰∏§Â±ÇÁ•ûÁªèÁΩëÁªúËØÜÂà´ÊâãÂÜôÊï∞Â≠ó/">ËØ¶ÊÉÖ</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src="https://i.loli.net/2021/08/15/F8aP7R36IidpCt5.jpg" alt="https://i.loli.net/2021/08/15/F8aP7R36IidpCt5.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2021-08-14</span><a class="blog-slider__title" href="2021/08/14/Á•ûÁªèÁΩëÁªúÊê≠Âª∫ÂáÜÂ§áÂÜÖÂÆπ/">Á•ûÁªèÁΩëÁªúÊê≠Âª∫ÂáÜÂ§áÂÜÖÂÆπ</a><div class="blog-slider__text">Â¶Ç‰ΩïËØÜÂà´ÊâãÂÜôüî¢ÔºåzxrÂ∏¶‰Ω†‰∏ÄÊ≠•‰∏ÄÊ≠•ÂÆûÁé∞üéº</div><a class="blog-slider__button" href="2021/08/14/Á•ûÁªèÁΩëÁªúÊê≠Âª∫ÂáÜÂ§áÂÜÖÂÆπ/">ËØ¶ÊÉÖ</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src="https://i.loli.net/2021/08/12/SJs3MgYC7x8IU26.jpg" alt="https://i.loli.net/2021/08/12/SJs3MgYC7x8IU26.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2021-08-12</span><a class="blog-slider__title" href="2021/08/12/xuperchain-solidity/">xuperchain&solidity</a><div class="blog-slider__text">Âå∫ÂùóÈìæ‰∏çÊ≠¢ÊòØÊåñÂ∏ÅÔºåËøòÊúâvÁ•ûÂíåsolidityüéà</div><a class="blog-slider__button" href="2021/08/12/xuperchain-solidity/">ËØ¶ÊÉÖ</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src="https://i.loli.net/2021/07/27/6fy8mTCbAOWPkrq.png" alt="https://i.loli.net/2021/07/27/6fy8mTCbAOWPkrq.png"/></div><div class="blog-slider__content"><span class="blog-slider__code">2021-07-26</span><a class="blog-slider__title" href="2021/07/26/FFT/">FFTÁöÑËØ¶Ëß£</a><div class="blog-slider__text">Ëøô‰πàÂ•ΩÁúãÁöÑFFTÔºå‰ø°Âè∑ÁãóÈÉΩÈ¶ãÂì≠‰∫Üüí¶</div><a class="blog-slider__button" href="2021/07/26/FFT/">ËØ¶ÊÉÖ</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src="https://i.loli.net/2021/08/09/zdt4YKoehQvR96S.jpg" alt="https://i.loli.net/2021/08/09/zdt4YKoehQvR96S.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2021-08-09</span><a class="blog-slider__title" href="2021/08/09/ÁÇíÈ∏°Â•ΩÁêÜËß£ÁöÑÊµãÂ∫¶ËÆ∫/">ÁÇíÈ∏°Â•ΩÁêÜËß£ÁöÑÊµãÂ∫¶ËÆ∫</a><div class="blog-slider__text">‰∏âÊÆµÂ≠óÔºåËÆ©‰Ω†ËØªÊáÇÊµãÂ∫¶ËÆ∫</div><a class="blog-slider__button" href="2021/08/09/ÁÇíÈ∏°Â•ΩÁêÜËß£ÁöÑÊµãÂ∫¶ËÆ∫/">ËØ¶ÊÉÖ</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src="https://i.loli.net/2021/08/12/wF7TJlqxOLEWGQk.png" alt="https://i.loli.net/2021/08/12/wF7TJlqxOLEWGQk.png"/></div><div class="blog-slider__content"><span class="blog-slider__code">2021-07-27</span><a class="blog-slider__title" href="2021/07/27/FT/">ÂÇÖÈáåÂè∂Â≠¶‰π†ËµÑÊñô</a><div class="blog-slider__text">ÁÆÄÂçïÂ•ΩÂ≠¶ÁöÑÂÇÖÈáåÂè∂Â≠¶‰π†ËµÑÊñô</div><a class="blog-slider__button" href="2021/07/27/FT/">ËØ¶ÊÉÖ</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src="https://i.loli.net/2021/07/27/f7jO8hlNpzWVXSP.jpg" alt="https://i.loli.net/2021/07/27/f7jO8hlNpzWVXSP.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2021-07-26</span><a class="blog-slider__title" href="2021/07/26/hello-world/">Â§ßÈ∏üËΩ¨ËΩ¨ËΩ¨ÈÖíÂêßÂÜÖÈÉ®ÁªùÂØÜÊ°£Ê°à</a><div class="blog-slider__text">‰∏çË¶ÅÁÇπËøõÊù•QAQÔºÅ</div><a class="blog-slider__button" href="2021/07/26/hello-world/">ËØ¶ÊÉÖ</a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';
    console.log('Â∑≤ÊåÇËΩΩswiper')
    parent.insertAdjacentHTML("afterbegin",child)}
     </script>
<script data-pjax="" src="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-swiper/swiper/swiper.min.js"></script>
<script data-pjax="" src="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-swiper@0.18/swiper/swiperindex.js"></script>
<style></style><script data-pjax="">function electric_clock_injector_config(){
                var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
                var item_html = '<div class="card-widget card-clock"><div class="card-glass"><div class="card-background"><div class="card-content"><div id="hexo_electric_clock"><img id="card-clock-loading" src="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-clock/clock/images/weather/loading.gif" style="height: 120px; width: 100%;" data-ll-status="loading" class="entered loading"></div></div></div></div></div>';
                console.log('Â∑≤ÊåÇËΩΩelectric_clock')
                // parent_div_git.innerHTML=item_html+parent_div_git.innerHTML // Êó†Êä•ÈîôÔºå‰ΩÜ‰∏çÂΩ±Âìç‰ΩøÁî®(ÊîØÊåÅpjaxË∑≥ËΩ¨)
                parent_div_git.insertAdjacentHTML("afterbegin",item_html) // ÊúâÊä•ÈîôÔºå‰ΩÜ‰∏çÂΩ±Âìç‰ΩøÁî®(ÊîØÊåÅpjaxË∑≥ËΩ¨)
            }if( document.getElementsByClassName('sticky_layout')[0] && (location.pathname ==='all'|| 'all' ==='all')){

            electric_clock_injector_config()
        } </script><script src="https://pv.sohu.com/cityjson?ie=utf-8"></script><script data-pjax="" src="https://cdn.jsdelivr.net/gh/Zfour/hexo-electric-clock@1.0.6/clock.js"></script>
  <script data-pjax="" src="https://cdn.jsdelivr.net/gh/Zfour/hexo-github-calendar@1.21/hexo_githubcalendar.js"></script>
  <script data-pjax="">
        function GithubCalendarConfig(){
            var git_githubapiurl ="https://python-github-calendar-api.vercel.app/api?XuRui314";
            var git_color =['#ebedf0', '#fdcdec', '#fc9bd9', '#fa6ac5', '#f838b2', '#f5089f', '#c4067e', '#92055e', '#540336', '#48022f', '#30021f'];
            var git_user ="XuRui314";
            var parent_div_git = document.getElementById('recent-posts');
            var git_div_html = '<div class="recent-post-item" style="width:100%;height:auto;padding:10px;"><div id="github_loading" style="height:100%;display: flex;align-items: center;justify-content: center;"><svg style="height:50px" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"  viewBox="0 0 50 50" style="enable-background:new 0 0 50 50" xml:space="preserve"><path fill="#d0d0d0" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z" transform="rotate(275.098 25 25)"><animateTransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animateTransform></path></svg></div><div id="github_container"></div></div>';
            if(parent_div_git && location.pathname =='/'){
                console.log('Â∑≤ÊåÇËΩΩgithub calendar')
                // parent_div_git.innerHTML=git_div_html+parent_div_git.innerHTML // Êó†Êä•ÈîôÔºå‰ΩÜ‰∏çÂΩ±Âìç‰ΩøÁî®(ÊîØÊåÅpjaxË∑≥ËΩ¨)
                parent_div_git.insertAdjacentHTML("afterbegin",git_div_html) // ÊúâÊä•ÈîôÔºå‰ΩÜ‰∏çÂΩ±Âìç‰ΩøÁî®(ÊîØÊåÅpjaxË∑≥ËΩ¨)
            };
            GithubCalendar(git_githubapiurl,git_color,git_user)
        }
        if(document.getElementById('recent-posts')){
            GithubCalendarConfig()
        }
    </script>
    <style>#github_container{min-height:248px}@media screen and (max-width:650px) {#github_container{background-image:;min-height:0px}}</style>
    <style></style><script async="" src="//at.alicdn.com/t/font_2032782_8d5kxvn09md.js"></script><!-- hexo injector body_end end --><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"live2d-widget-model-wanko"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"react":{"opacity":0.7},"log":false});</script></body></html>