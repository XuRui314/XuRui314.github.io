<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Multimodal NER | XuRui-Blog</title><meta name="keywords" content="Python,Deep Learning"><meta name="author" content="zxr"><meta name="copyright" content="zxr"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="æ¦‚è¿°&amp;åŸæ¨¡å‹å†™åœ¨å¼€å§‹ è®ºæ–‡ä»£ç ä»“åº“ï¼šhttps://github.com/softhuafei/Pytorch-implementation-for-OCSGA å…¶å®æ˜¯å°‘äº†object_labelè¿™ä¸ªæ–‡ä»¶ï¼Œéœ€è¦ç¿»å†å²è®°å½•ä¸‹è½½ï¼Œæˆ‘ä¹Ÿä¸åˆ°ä¸ºå•¥æŠŠè¿™ä¸ªåˆ äº†ã€‚  è¿™åº”è¯¥æ˜¯æˆ‘ç¬¬ä¸€æ¬¡æ”¹è®ºæ–‡ä»£ç ï¼Œå¯¹äºæ•´ä½“çš„ä»£ç æ¡†æ¶å•¥çš„å…¶å®éƒ½ä¸æ˜¯å¾ˆæ¸…æ¥šï¼Œè¿˜æœ‰å…·ä½“ç”¨åˆ°çš„ä¸€äº›æ–¹æ³•ï¼Œä¹Ÿä¸æ˜¯ç‰¹åˆ«ç†Ÿï¼Œæ‰€ä»¥å°±æ¥è¾¹å­¦è¾¹æ”¹ï¼Œåšä¸ªè®°å½•ã€‚">
<meta property="og:type" content="article">
<meta property="og:title" content="Multimodal NER">
<meta property="og:url" content="https://xurui314.github.io/2022/06/01/Multimodal-NER/index.html">
<meta property="og:site_name" content="XuRui-Blog">
<meta property="og:description" content="æ¦‚è¿°&amp;åŸæ¨¡å‹å†™åœ¨å¼€å§‹ è®ºæ–‡ä»£ç ä»“åº“ï¼šhttps://github.com/softhuafei/Pytorch-implementation-for-OCSGA å…¶å®æ˜¯å°‘äº†object_labelè¿™ä¸ªæ–‡ä»¶ï¼Œéœ€è¦ç¿»å†å²è®°å½•ä¸‹è½½ï¼Œæˆ‘ä¹Ÿä¸åˆ°ä¸ºå•¥æŠŠè¿™ä¸ªåˆ äº†ã€‚  è¿™åº”è¯¥æ˜¯æˆ‘ç¬¬ä¸€æ¬¡æ”¹è®ºæ–‡ä»£ç ï¼Œå¯¹äºæ•´ä½“çš„ä»£ç æ¡†æ¶å•¥çš„å…¶å®éƒ½ä¸æ˜¯å¾ˆæ¸…æ¥šï¼Œè¿˜æœ‰å…·ä½“ç”¨åˆ°çš„ä¸€äº›æ–¹æ³•ï¼Œä¹Ÿä¸æ˜¯ç‰¹åˆ«ç†Ÿï¼Œæ‰€ä»¥å°±æ¥è¾¹å­¦è¾¹æ”¹ï¼Œåšä¸ªè®°å½•ã€‚">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://s2.loli.net/2022/06/01/NGZoMHJQIyVS5Ab.png">
<meta property="article:published_time" content="2022-06-01T15:26:34.000Z">
<meta property="article:modified_time" content="2022-06-01T15:30:55.659Z">
<meta property="article:author" content="zxr">
<meta property="article:tag" content="Python">
<meta property="article:tag" content="Deep Learning">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s2.loli.net/2022/06/01/NGZoMHJQIyVS5Ab.png"><link rel="shortcut icon" href="https://i.loli.net/2021/07/27/lSHRJbx7dYwTk8f.jpg"><link rel="canonical" href="https://xurui314.github.io/2022/06/01/Multimodal-NER/"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Multimodal NER',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-06-01 23:30:55'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const fontSizeVal = saveToLocal.get('global-font-size')
    if (fontSizeVal !== undefined) {
      document.documentElement.style.setProperty('--global-font-size', fontSizeVal + 'px')
    }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    document.addEventListener('pjax:complete', detectApple)})(window)</script><link rel="stylesheet" href="/css/badge.css"><link rel="stylesheet" href="/css/modify.css"><link rel="stylesheet" href="/css/mouse.css"><link rel="stylesheet" href="/dist/APlayer.min.css"><link rel="stylesheet" href="/css/custom.css"><link rel="stylesheet" href="/css/bilibiliBanner.css" media="defer" onload="this.media='screen'"><!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-swiper/swiper/swiper.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-swiper/swiper/swiperstyle.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/hexo-electric-clock@1.0.6/clock.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-double-row-display@1.00/cardlistpost.min.css">
<style>#recent-posts > .recent-post-item >.recent-post-info > .article-meta-wrap > .tags:before {content:"\A";
  white-space: pre;}#recent-posts > .recent-post-item >.recent-post-info > .article-meta-wrap > .tags > .article-meta__separator{display:none}</style>
<link rel="stylesheet" href="https://unpkg.zhimg.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://unpkg.zhimg.com/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload="this.media='all'"><script async="" src="https://unpkg.zhimg.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.4.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://s2.loli.net/2021/12/08/yTYthVwXD4IPbJ9.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">47</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">23</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">12</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> ä¸»é¡µğŸ­</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> æ¡£æ¡ˆğŸŒŠ</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾ğŸ“‘</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»ğŸŒˆ</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> å¥½åº·çš„âœ¨</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://ocw.mit.edu/"><i class="fa-fw fas fa-link"></i><span> æ¥å­¦éº»å­¦</span></a></li><li><a class="site-page child" href="/bangumis/"><i class="fa-fw fas fa-video"></i><span> zxrã®è¿½ç•ªè®¡åˆ’</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=RyOyXsKuUgI"><i class="fa-fw fas fa-heart"></i><span> zxræœ€çˆ±æ»´upå˜‰å€©</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://oskarstalberg.com/game/planet/planet.html"><span> Planet</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> å‹é“¾ğŸ’•</span></a></div><div class="menus_item"><a class="site-page" href="https://xurui314.github.io/aboutme/"><span> AboutMeğŸ‚</span></a></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://www.foreverblog.cn/go.html"><span> è™«æ´</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://s2.loli.net/2022/06/01/NGZoMHJQIyVS5Ab.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">XuRui-Blog</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> ä¸»é¡µğŸ­</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> æ¡£æ¡ˆğŸŒŠ</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾ğŸ“‘</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»ğŸŒˆ</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> å¥½åº·çš„âœ¨</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://ocw.mit.edu/"><i class="fa-fw fas fa-link"></i><span> æ¥å­¦éº»å­¦</span></a></li><li><a class="site-page child" href="/bangumis/"><i class="fa-fw fas fa-video"></i><span> zxrã®è¿½ç•ªè®¡åˆ’</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=RyOyXsKuUgI"><i class="fa-fw fas fa-heart"></i><span> zxræœ€çˆ±æ»´upå˜‰å€©</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://oskarstalberg.com/game/planet/planet.html"><span> Planet</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> å‹é“¾ğŸ’•</span></a></div><div class="menus_item"><a class="site-page" href="https://xurui314.github.io/aboutme/"><span> AboutMeğŸ‚</span></a></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://www.foreverblog.cn/go.html"><span> è™«æ´</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Multimodal NER</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2022-06-01T15:26:34.000Z" title="Created 2022-06-01 23:26:34">2022-06-01</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2022-06-01T15:30:55.659Z" title="Updated 2022-06-01 23:30:55">2022-06-01</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/NLP/">NLP</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word count:</span><span class="word-count">11.1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading time:</span><span>61min</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Multimodal NER"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><div class="top-img" style="background-image: url('https://s2.loli.net/2022/06/01/NGZoMHJQIyVS5Ab.png');"></div><article class="post-content" id="article-container"><h1 id="æ¦‚è¿°-amp-åŸæ¨¡å‹"><a href="#æ¦‚è¿°-amp-åŸæ¨¡å‹" class="headerlink" title="æ¦‚è¿°&amp;åŸæ¨¡å‹"></a>æ¦‚è¿°&amp;åŸæ¨¡å‹</h1><h2 id="å†™åœ¨å¼€å§‹"><a href="#å†™åœ¨å¼€å§‹" class="headerlink" title="å†™åœ¨å¼€å§‹"></a>å†™åœ¨å¼€å§‹</h2><blockquote>
<p>è®ºæ–‡ä»£ç ä»“åº“ï¼š<a target="_blank" rel="noopener" href="https://github.com/softhuafei/Pytorch-implementation-for-OCSGA">https://github.com/softhuafei/Pytorch-implementation-for-OCSGA</a></p>
<p>å…¶å®æ˜¯å°‘äº†object_labelè¿™ä¸ªæ–‡ä»¶ï¼Œéœ€è¦ç¿»å†å²è®°å½•ä¸‹è½½ï¼Œæˆ‘ä¹Ÿä¸åˆ°ä¸ºå•¥æŠŠè¿™ä¸ªåˆ äº†ã€‚</p>
</blockquote>
<p>è¿™åº”è¯¥æ˜¯æˆ‘ç¬¬ä¸€æ¬¡æ”¹è®ºæ–‡ä»£ç ï¼Œå¯¹äºæ•´ä½“çš„ä»£ç æ¡†æ¶å•¥çš„å…¶å®éƒ½ä¸æ˜¯å¾ˆæ¸…æ¥šï¼Œè¿˜æœ‰å…·ä½“ç”¨åˆ°çš„ä¸€äº›æ–¹æ³•ï¼Œä¹Ÿä¸æ˜¯ç‰¹åˆ«ç†Ÿï¼Œæ‰€ä»¥å°±æ¥è¾¹å­¦è¾¹æ”¹ï¼Œåšä¸ªè®°å½•ã€‚</p>
<blockquote>
<p>â€”â€”2022/5/30 updateâ€”â€”</p>
</blockquote>
<p>å’Œåšå£«å¸ˆå…„è®¨è®ºå®Œï¼Œæ„Ÿè§‰è¿˜æ˜¯ä»»é‡é“è¿œï¼Œbugç¡®å®ä¸å°‘ï¼Œè¦å¼„çš„ä¸œè¥¿ä¹Ÿè›®å¤šçš„ï¼Œæ‰€ä»¥æ—¢ç„¶è¿™ç©æ„ä¸æ˜¯åªé æŸ¥æŸ¥èµ„æ–™å°±èƒ½è§£å†³çš„ï¼Œè¿˜æ˜¯è¦é™ä¸‹å¿ƒæ¥ï¼Œç ”è¯»ä»£ç ï¼Œæ¯•ç«Ÿè¿™ä¸ªä»£ç ä¹Ÿæ˜¯æŒºè§„èŒƒçš„ï¼Œè¿˜æœ‰å¾ˆå¤šåœ°æ–¹å€¼å¾—å­¦ä¹ ï¼Œæ‰€ä»¥è¿˜æ˜¯è¦è€ä½èºåŠ¨å’Œå¯‚å¯ğŸš´â€â™‚ï¸ã€‚</p>
<h2 id="é¦–å…ˆä»main-pyå¼€å§‹"><a href="#é¦–å…ˆä»main-pyå¼€å§‹" class="headerlink" title="é¦–å…ˆä»main.pyå¼€å§‹"></a>é¦–å…ˆä»main.pyå¼€å§‹</h2><p><code>main.py</code>çš„<code>if __name__ == '__main__':</code>å¼€å§‹çœ‹ï¼Œ</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    parser = argparse.ArgumentParser(description=<span class="string">'Tuning with NCRF++'</span>)</span><br><span class="line">    <span class="comment"># parser.add_argument('--status', choices=['train', 'decode'], help='update algorithm', default='train')</span></span><br><span class="line">    parser.add_argument(<span class="string">'--config'</span>,  <span class="built_in">help</span>=<span class="string">'Configuration File'</span>, default=<span class="string">'None'</span>)</span><br><span class="line">    parser.add_argument(<span class="string">'--wordemb'</span>,  <span class="built_in">help</span>=<span class="string">'Embedding for words'</span>, default=<span class="string">'None'</span>)</span><br><span class="line">    parser.add_argument(<span class="string">'--charemb'</span>,  <span class="built_in">help</span>=<span class="string">'Embedding for chars'</span>, default=<span class="string">'None'</span>)</span><br><span class="line">    parser.add_argument(<span class="string">'--status'</span>, choices=[<span class="string">'train'</span>, <span class="string">'decode'</span>], <span class="built_in">help</span>=<span class="string">'update algorithm'</span>, default=<span class="string">'train'</span>)</span><br><span class="line">    parser.add_argument(<span class="string">'--savemodel'</span>, default=<span class="string">"data/model/saved_model.lstmcrf."</span>)</span><br><span class="line">    parser.add_argument(<span class="string">'--savedset'</span>, <span class="built_in">help</span>=<span class="string">'Dir of saved data setting'</span>)</span><br><span class="line">    parser.add_argument(<span class="string">'--train'</span>, default=<span class="string">"data/conll03/train.bmes"</span>) </span><br><span class="line">    parser.add_argument(<span class="string">'--dev'</span>, default=<span class="string">"data/conll03/dev.bmes"</span> )  </span><br><span class="line">    parser.add_argument(<span class="string">'--test'</span>, default=<span class="string">"data/conll03/test.bmes"</span>) </span><br><span class="line">    parser.add_argument(<span class="string">'--seg'</span>, default=<span class="string">"True"</span>) </span><br><span class="line">    parser.add_argument(<span class="string">'--raw'</span>) </span><br><span class="line">    parser.add_argument(<span class="string">'--loadmodel'</span>)</span><br><span class="line">    parser.add_argument(<span class="string">'--output'</span>) </span><br><span class="line">    args = parser.parse_args()</span><br><span class="line"></span><br><span class="line">    data = Data()</span><br><span class="line">    data.HP_gpu = torch.cuda.is_available()</span><br><span class="line">    <span class="keyword">if</span> args.config == <span class="string">'None'</span>:</span><br><span class="line">        data.train_dir = args.train </span><br><span class="line">        data.dev_dir = args.dev </span><br><span class="line">        data.test_dir = args.test</span><br><span class="line">        data.model_dir = args.savemodel</span><br><span class="line">        data.dset_dir = args.savedset</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"Save dset directory:"</span>,data.dset_dir)</span><br><span class="line">        save_model_dir = args.savemodel</span><br><span class="line">        data.word_emb_dir = args.wordemb</span><br><span class="line">        data.char_emb_dir = args.charemb</span><br><span class="line">        <span class="keyword">if</span> args.seg.lower() == <span class="string">'true'</span>:</span><br><span class="line">            data.seg = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            data.seg = <span class="literal">False</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"Seed num:"</span>, seed_num)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        data.read_config(args.config)</span><br><span class="line">    <span class="comment"># data.show_data_summary()</span></span><br><span class="line">    status = data.status.lower()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Seed num:"</span>,seed_num)</span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="keyword">if</span> (data.root_dir <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>) <span class="keyword">and</span> (<span class="keyword">not</span> os.path.exists(data.root_dir)):</span><br><span class="line">        os.mkdir(data.root_dir)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> status == <span class="string">'train'</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"MODEL: train"</span>)</span><br><span class="line">        data_initialization(data)</span><br><span class="line">        data.generate_instance(<span class="string">'train'</span>)</span><br><span class="line">        data.generate_instance(<span class="string">'dev'</span>)</span><br><span class="line">        data.generate_instance(<span class="string">'test'</span>)</span><br><span class="line">        data.build_pretrain_emb()</span><br><span class="line">        train(data)</span><br><span class="line">    <span class="keyword">elif</span> status == <span class="string">'decode'</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"MODEL: decode"</span>)</span><br><span class="line">        data.load(data.dset_dir)</span><br><span class="line">        data.read_config(args.config)</span><br><span class="line">        <span class="built_in">print</span>(data.raw_dir)</span><br><span class="line">        <span class="comment"># exit(0)</span></span><br><span class="line">        data.show_data_summary()</span><br><span class="line">        data.generate_instance(<span class="string">'raw'</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"nbest: %s"</span>%(data.nbest))</span><br><span class="line">        decode_results, pred_scores = load_model_decode(data, <span class="string">'raw'</span>)</span><br><span class="line">        <span class="keyword">if</span> data.nbest <span class="keyword">and</span> <span class="keyword">not</span> data.sentence_classification:</span><br><span class="line">            data.write_nbest_decoded_results(decode_results, pred_scores, <span class="string">'raw'</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            data.write_decoded_results(decode_results, <span class="string">'raw'</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"Invalid argument! Please use valid arguments! (train/test/decode)"</span>)</span><br></pre></td></tr></tbody></table></figure>
<p>é¦–å…ˆæ˜¯ä¸€ä¸ª<code>parser = argparse.ArgumentParser(description='Tuning with NCRF++')</code>ï¼Œè¿™ä¸ªå¯ä»¥ç†è§£ä¸ºå­˜ä¸€äº›å‚æ•°çš„å®¹å™¨ï¼Œç‰¹ç‚¹æ˜¯ï¼Œè¿™ä¸ªæ˜¯é€šè¿‡å‘½ä»¤è¡Œæ¥è¿›è¡Œå¯¹å‚æ•°çš„èµ‹å€¼ã€‚</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># demo.py</span></span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"></span><br><span class="line">parser = argparse.ArgumentParser(description=<span class="string">'å‘½ä»¤è¡Œä¸­ä¼ å…¥ä¸€ä¸ªæ•°å­—'</span>)</span><br><span class="line"><span class="comment">#typeæ˜¯è¦ä¼ å…¥çš„å‚æ•°çš„æ•°æ®ç±»å‹  helpæ˜¯è¯¥å‚æ•°çš„æç¤ºä¿¡æ¯</span></span><br><span class="line">parser.add_argument(<span class="string">'--str_arg'</span>, <span class="built_in">type</span>=<span class="built_in">str</span>, <span class="built_in">help</span>=<span class="string">'ä¼ å…¥çš„å­—ç¬¦ä¸²'</span>)</span><br><span class="line"></span><br><span class="line">args = parser.parse_args()</span><br><span class="line"></span><br><span class="line"><span class="comment">#è·å¾—ä¼ å…¥çš„å‚æ•°</span></span><br><span class="line"><span class="built_in">print</span>(args.str_arg)</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">python demo.py --str_arg = <span class="string">"lalala"</span></span><br><span class="line">&gt; lalala</span><br><span class="line"></span><br><span class="line">æ¨èçš„èµ„æ–™</span><br><span class="line">https://zhuanlan.zhihu.com/p/<span class="number">56922793</span></span><br><span class="line">https://www.bilibili.com/video/BV1U4411j7xb?spm_id_from=<span class="number">333.337</span>.search-card.<span class="built_in">all</span>.click</span><br></pre></td></tr></tbody></table></figure>
<p>æ¥ä¸‹æ¥ä¼šç¢°åˆ°<code>data</code>ï¼Œè¿™ç©æ„å…¶å®æ˜¯<code>data.py</code>é‡Œå®šä¹‰çš„<code>Data</code>ç±»çš„å®ä¾‹ï¼Œè¿™ä¸ª<code>Data</code>ç±»è´Ÿè´£çš„æ˜¯æ¨¡å‹çš„å‚æ•°å’Œæ•°æ®ï¼Œè¿™é‡Œåˆ—ä¸¾ä¸€äº›åŒ…å«çš„å†…å®¹ï¼ˆåªæ˜¯ä¸€éƒ¨åˆ†ï¼‰ï¼š</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">self.model_name = <span class="literal">None</span></span><br><span class="line">		<span class="comment">### data</span></span><br><span class="line">        self.sentence_classification = <span class="literal">False</span></span><br><span class="line">        self.MAX_SENTENCE_LENGTH = <span class="number">250</span></span><br><span class="line">        self.MAX_WORD_LENGTH = -<span class="number">1</span></span><br><span class="line">        self.MAX_OBJECT_NB = <span class="number">3</span></span><br><span class="line">        self.number_normalized = <span class="literal">True</span></span><br><span class="line">        self.norm_word_emb = <span class="literal">False</span></span><br><span class="line">        self.word_alphabet = Alphabet(<span class="string">'word'</span>)</span><br><span class="line"></span><br><span class="line">        self.label_alphabet = Alphabet(<span class="string">'label'</span>,<span class="literal">True</span>)</span><br><span class="line">        self.tagScheme = <span class="string">"NoSeg"</span> <span class="comment">## BMES/BIO</span></span><br><span class="line">        self.split_token = <span class="string">' ||| '</span></span><br><span class="line">        self.seg = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">### I/O</span></span><br><span class="line">        self.train_dir = <span class="literal">None</span></span><br><span class="line">        self.dev_dir = <span class="literal">None</span></span><br><span class="line">        self.test_dir = <span class="literal">None</span></span><br><span class="line">        self.raw_dir = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        self.root_dir = <span class="literal">None</span></span><br><span class="line">        self.decode_dir = <span class="literal">None</span></span><br><span class="line">        self.dset_dir = <span class="literal">None</span> <span class="comment">## data vocabulary related file</span></span><br><span class="line">        self.model_dir = <span class="literal">None</span> <span class="comment">## model save  file</span></span><br><span class="line">        self.load_model_dir = <span class="literal">None</span> <span class="comment">## model load file</span></span><br><span class="line"></span><br><span class="line">        self.log_dir = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        self.feature_emb_dirs = []</span><br><span class="line">        <span class="comment"># img object files</span></span><br><span class="line">        self.object_dir = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        self.train_texts = []</span><br><span class="line">        self.dev_texts = []</span><br><span class="line">        self.test_texts = []</span><br><span class="line">        self.raw_texts = []</span><br><span class="line"></span><br><span class="line">        self.train_Ids = []</span><br><span class="line">        self.dev_Ids = []</span><br><span class="line">        self.test_Ids = []</span><br><span class="line">        self.raw_Ids = []</span><br><span class="line"></span><br><span class="line">        self.word_emb_dim = <span class="number">50</span></span><br><span class="line">        self.char_emb_dim = <span class="number">30</span></span><br><span class="line">        self.object_emb_dim = <span class="number">50</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">###Networks</span></span><br><span class="line">        self.word_feature_extractor = <span class="string">"LSTM"</span> <span class="comment">## "LSTM"/"CNN"/"GRU"/</span></span><br><span class="line">        self.use_char = <span class="literal">True</span></span><br><span class="line">        self.char_feature_extractor = <span class="string">"CNN"</span> <span class="comment">## "LSTM"/"CNN"/"GRU"/None</span></span><br><span class="line">        self.use_crf = <span class="literal">True</span></span><br><span class="line">        self.nbest = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">## Training</span></span><br><span class="line">        self.average_batch_loss = <span class="literal">False</span></span><br><span class="line">        self.optimizer = <span class="string">"SGD"</span> <span class="comment">## "SGD"/"AdaGrad"/"AdaDelta"/"RMSProp"/"Adam"</span></span><br><span class="line">        self.status = <span class="string">"train"</span></span><br><span class="line">        <span class="comment">### Hyperparameters</span></span><br><span class="line">        self.HP_cnn_layer = <span class="number">4</span></span><br><span class="line">        self.HP_iteration = <span class="number">100</span></span><br><span class="line">        self.HP_batch_size = <span class="number">10</span></span><br><span class="line">        self.HP_char_hidden_dim = <span class="number">50</span></span><br><span class="line">        self.HP_hidden_dim = <span class="number">512</span></span><br><span class="line">        self.HP_dropout = <span class="number">0.5</span></span><br><span class="line">        self.HP_MCA_dropout = <span class="number">0.5</span></span><br><span class="line">        self.HP_multi_head = <span class="number">1</span></span><br><span class="line">        self.HP_SGA_layer=<span class="number">8</span></span><br><span class="line"></span><br><span class="line">        self.HP_bilstm = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">        self.HP_gpu = <span class="literal">False</span></span><br><span class="line">        self.HP_lr = <span class="number">0.015</span></span><br><span class="line">        self.HP_lr_decay = <span class="number">0.05</span></span><br><span class="line">        self.HP_clip = <span class="literal">None</span></span><br><span class="line">        self.HP_momentum = <span class="number">0</span></span><br><span class="line">        self.HP_l2 = <span class="number">1e-8</span></span><br></pre></td></tr></tbody></table></figure>
<p>æ¥ä¸‹æ¥æ˜¯å¼€å§‹åˆ¤æ–­<code>config</code>æ–‡ä»¶æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœæ˜¯ç©ºçš„ï¼Œé‚£å°±æŠŠ<code>args</code>å®¹å™¨é‡Œé¢çš„é»˜è®¤å€¼ï¼Œèµ‹å€¼ç»™<code>data</code>çš„æˆå‘˜å˜é‡ï¼Œæ¯”å¦‚<code>data.train_dir</code>è¿™äº›ã€‚å¦‚æœ<code>config</code>ä¸æ˜¯ç©ºå°±ç›´æ¥è°ƒç”¨<code>data.read_config(config)</code>ï¼Œè¿™ä¸ªå°±æ˜¯ç›´æ¥æŠŠ<code>config</code>æ–‡ä»¶é‡Œé¢çš„å‚æ•°å¯¹åº”è¯»è¿›<code>data</code>çš„å‚æ•°ï¼Œå…·ä½“çš„è¯æ˜¯å…ˆæŠŠ<code>config</code>å†…å®¹è½¬æ¢æˆå­—å…¸ï¼Œæ˜¯ç”¨<code>data</code>ä¸­çš„<code>config_file_to_dict</code>å‡½æ•°ã€‚</p>
<p>æ¥ä¸‹æ¥å°±æ˜¯è®­ç»ƒorè§£ç çš„éƒ¨åˆ†äº†ï¼Œä»¥<code>train</code>ä¸ºä¾‹ï¼Œ</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">if</span> status == <span class="string">'train'</span>:</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">"MODEL: train"</span>)</span><br><span class="line">      data_initialization(data) <span class="comment"># æ„å»ºè¯è¡¨</span></span><br><span class="line">      data.generate_instance(<span class="string">'train'</span>) </span><br><span class="line">      data.generate_instance(<span class="string">'dev'</span>)</span><br><span class="line">      data.generate_instance(<span class="string">'test'</span>)</span><br><span class="line">      data.build_pretrain_emb()</span><br><span class="line">      train(data)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># data_initialization</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">data_initialization</span>(<span class="params">data</span>):</span></span><br><span class="line">    data.initial_feature_alphabets()</span><br><span class="line">    data.build_alphabet(data.train_dir)</span><br><span class="line">    data.build_alphabet(data.dev_dir)</span><br><span class="line">    data.build_alphabet(data.test_dir)</span><br><span class="line">    data.build_object_alphabet(data.object_dir)</span><br><span class="line">    data.fix_alphabet()</span><br></pre></td></tr></tbody></table></figure>
<p>è¯è¡¨æ„å»ºå•¥çš„ç»†èŠ‚åé¢çš„Chapterä¼šç»†çï¼Œæ„å»ºå®Œè¯è¡¨ç„¶åæ˜¯å»äº†<code>generate_instance</code>è¿™ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°æ˜¯å’Œ<code>batch</code>åˆ’åˆ†å’Œ<code>decode</code>å†™æ–‡ä»¶æœ‰å…³çš„ï¼Œè¿™é‡Œç»™å‡ºå¾—åˆ°çš„ç»“æœçš„å±•ç¤ºï¼Œå…¶å®å°±æ˜¯æŠŠæ‰€æœ‰ä¿¡æ¯æ•´åˆèµ·æ¥ã€‚</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">self.train_texts[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">[words, features, chars, labels, objects]</span><br><span class="line"></span><br><span class="line">[[<span class="string">'RT'</span>, <span class="string">'@JayKenMinaj'</span>, <span class="string">'_'</span>, <span class="string">':'</span>, <span class="string">'Me'</span>, <span class="string">'outside'</span>, <span class="string">'of'</span>, <span class="string">'where'</span>, <span class="string">'George'</span>, <span class="string">'Zimmerman'</span>, <span class="string">'got'</span>, <span class="string">'shot'</span>, <span class="string">'at'</span>, <span class="string">'.'</span>, <span class="string">'You'</span>, <span class="string">'know'</span>, <span class="string">'God'</span>, <span class="string">'is'</span>, <span class="string">'so'</span>, <span class="string">'good'</span>, <span class="string">'.'</span>, <span class="string">'http://t.co/Z3neVBQ7vF'</span>], [[], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], []], [[<span class="string">'R'</span>, <span class="string">'T'</span>], [<span class="string">'@'</span>, <span class="string">'J'</span>, <span class="string">'a'</span>, <span class="string">'y'</span>, <span class="string">'K'</span>, <span class="string">'e'</span>, <span class="string">'n'</span>, <span class="string">'M'</span>, <span class="string">'i'</span>, <span class="string">'n'</span>, <span class="string">'a'</span>, <span class="string">'j'</span>], [<span class="string">'_'</span>], [<span class="string">':'</span>], [<span class="string">'M'</span>, <span class="string">'e'</span>], [<span class="string">'o'</span>, <span class="string">'u'</span>, <span class="string">'t'</span>, <span class="string">'s'</span>, <span class="string">'i'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>], [<span class="string">'o'</span>, <span class="string">'f'</span>], [<span class="string">'w'</span>, <span class="string">'h'</span>, <span class="string">'e'</span>, <span class="string">'r'</span>, <span class="string">'e'</span>], [<span class="string">'G'</span>, <span class="string">'e'</span>, <span class="string">'o'</span>, <span class="string">'r'</span>, <span class="string">'g'</span>, <span class="string">'e'</span>], [<span class="string">'Z'</span>, <span class="string">'i'</span>, <span class="string">'m'</span>, <span class="string">'m'</span>, <span class="string">'e'</span>, <span class="string">'r'</span>, <span class="string">'m'</span>, <span class="string">'a'</span>, <span class="string">'n'</span>], [<span class="string">'g'</span>, <span class="string">'o'</span>, <span class="string">'t'</span>], [<span class="string">'s'</span>, <span class="string">'h'</span>, <span class="string">'o'</span>, <span class="string">'t'</span>], [<span class="string">'a'</span>, <span class="string">'t'</span>], [<span class="string">'.'</span>], [<span class="string">'Y'</span>, <span class="string">'o'</span>, <span class="string">'u'</span>], [<span class="string">'k'</span>, <span class="string">'n'</span>, <span class="string">'o'</span>, <span class="string">'w'</span>], [<span class="string">'G'</span>, <span class="string">'o'</span>, <span class="string">'d'</span>], [<span class="string">'i'</span>, <span class="string">'s'</span>], [<span class="string">'s'</span>, <span class="string">'o'</span>], [<span class="string">'g'</span>, <span class="string">'o'</span>, <span class="string">'o'</span>, <span class="string">'d'</span>], [<span class="string">'.'</span>], [<span class="string">'h'</span>, <span class="string">'t'</span>, <span class="string">'t'</span>, <span class="string">'p'</span>, <span class="string">':'</span>, <span class="string">'/'</span>, <span class="string">'/'</span>, <span class="string">'t'</span>, <span class="string">'.'</span>, <span class="string">'c'</span>, <span class="string">'o'</span>, <span class="string">'/'</span>, <span class="string">'Z'</span>, <span class="string">'0'</span>, <span class="string">'n'</span>, <span class="string">'e'</span>, <span class="string">'V'</span>, <span class="string">'B'</span>, <span class="string">'Q'</span>, <span class="string">'0'</span>, <span class="string">'v'</span>, <span class="string">'F'</span>]], [<span class="string">'O'</span>, <span class="string">'O'</span>, <span class="string">'O'</span>, <span class="string">'O'</span>, <span class="string">'O'</span>, <span class="string">'O'</span>, <span class="string">'O'</span>, <span class="string">'O'</span>, <span class="string">'B-PER'</span>, <span class="string">'I-PER'</span>, <span class="string">'O'</span>, <span class="string">'O'</span>, <span class="string">'O'</span>, <span class="string">'O'</span>, <span class="string">'O'</span>, <span class="string">'O'</span>, <span class="string">'O'</span>, <span class="string">'O'</span>, <span class="string">'O'</span>, <span class="string">'O'</span>, <span class="string">'O'</span>, <span class="string">'O'</span>], [<span class="string">'person'</span>, <span class="string">'car'</span>, <span class="string">'cell'</span>, <span class="string">'phone'</span>, <span class="string">'car'</span>]]</span><br><span class="line"></span><br><span class="line">self.train_Ids[<span class="number">0</span>]</span><br><span class="line">[[<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">17</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">15</span>, <span class="number">22</span>], [[], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], []], [[<span class="number">2</span>, <span class="number">3</span>], [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">10</span>, <span class="number">6</span>, <span class="number">13</span>], [<span class="number">14</span>], [<span class="number">15</span>], [<span class="number">11</span>, <span class="number">9</span>], [<span class="number">16</span>, <span class="number">17</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">12</span>, <span class="number">20</span>, <span class="number">9</span>], [<span class="number">16</span>, <span class="number">21</span>], [<span class="number">22</span>, <span class="number">23</span>, <span class="number">9</span>, <span class="number">24</span>, <span class="number">9</span>], [<span class="number">25</span>, <span class="number">9</span>, <span class="number">16</span>, <span class="number">24</span>, <span class="number">26</span>, <span class="number">9</span>], [<span class="number">27</span>, <span class="number">12</span>, <span class="number">28</span>, <span class="number">28</span>, <span class="number">9</span>, <span class="number">24</span>, <span class="number">28</span>, <span class="number">6</span>, <span class="number">10</span>], [<span class="number">26</span>, <span class="number">16</span>, <span class="number">18</span>], [<span class="number">19</span>, <span class="number">23</span>, <span class="number">16</span>, <span class="number">18</span>], [<span class="number">6</span>, <span class="number">18</span>], [<span class="number">29</span>], [<span class="number">30</span>, <span class="number">16</span>, <span class="number">17</span>], [<span class="number">31</span>, <span class="number">10</span>, <span class="number">16</span>, <span class="number">22</span>], [<span class="number">25</span>, <span class="number">16</span>, <span class="number">20</span>], [<span class="number">12</span>, <span class="number">19</span>], [<span class="number">19</span>, <span class="number">16</span>], [<span class="number">26</span>, <span class="number">16</span>, <span class="number">16</span>, <span class="number">20</span>], [<span class="number">29</span>], [<span class="number">23</span>, <span class="number">18</span>, <span class="number">18</span>, <span class="number">32</span>, <span class="number">15</span>, <span class="number">33</span>, <span class="number">33</span>, <span class="number">18</span>, <span class="number">29</span>, <span class="number">34</span>, <span class="number">16</span>, <span class="number">33</span>, <span class="number">27</span>, <span class="number">35</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">36</span>, <span class="number">37</span>, <span class="number">38</span>, <span class="number">35</span>, <span class="number">39</span>, <span class="number">40</span>]], [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>], [<span class="number">5</span>, <span class="number">16</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">16</span>]]</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p>ç„¶åé¢„å¤„ç†å¼„å®Œäº†ï¼Œå°±ç›´æ¥è¿›å…¥è®­ç»ƒå‡½æ•°<code>train</code>äº†ã€‚</p>
<p>é¦–å…ˆå…ˆè¦å¤„ç†çš„å°±æ˜¯åˆ’åˆ†<code>batch</code>ï¼Œå…·ä½“æ¥è¯´æ˜¯è¿™æ ·çš„ï¼Œåˆ’åˆ†ä¸€ä¸‹<code>batch</code>çš„<code>start</code>å’Œ<code>end</code>ç„¶åå¯¹<code>train_Ids</code>å»<code>slice</code>å°±è¡Œäº†ï¼š</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">batch_size = data.HP_batch_size</span><br><span class="line">batch_id = <span class="number">0</span></span><br><span class="line">train_num = <span class="built_in">len</span>(data.train_Ids)</span><br><span class="line">total_batch = train_num//batch_size+<span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> batch_id <span class="keyword">in</span> <span class="built_in">range</span>(total_batch):</span><br><span class="line">	start = batch_id*batch_size</span><br><span class="line">	end = (batch_id+<span class="number">1</span>)*batch_size</span><br><span class="line">	<span class="keyword">if</span> end &gt;train_num:</span><br><span class="line">		 end = train_num</span><br><span class="line">	instance = data.train_Ids[start:end] </span><br><span class="line">	<span class="keyword">if</span> <span class="keyword">not</span> instance:</span><br><span class="line">		<span class="keyword">continue</span></span><br><span class="line">	batch_word, batch_features, batch_wordlen, batch_wordrecover, batch_char, batch_charlen, batch_charrecover, batch_label, mask, batch_obj, obj_mask = batchify_with_label(instance, data.HP_gpu, <span class="literal">True</span>, data.sentence_classification, data.MAX_OBJECT_NB)</span><br></pre></td></tr></tbody></table></figure>
<p>ç„¶åçœ‹<code>batchify_with_label</code>è¿™ä¸ªå‡½æ•°ï¼š</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">batchify_with_label</span>(<span class="params">input_batch_list, gpu, if_train=<span class="literal">True</span>, sentence_classification=<span class="literal">False</span>, max_object_nb=<span class="number">0</span></span>):</span></span><br><span class="line">    <span class="keyword">if</span> sentence_classification:</span><br><span class="line">        <span class="keyword">return</span> batchify_sentence_classification_with_label(input_batch_list, gpu, if_train)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> batchify_sequence_labeling_with_label(input_batch_list, gpu, if_train, max_object_nb=max_object_nb)</span><br></pre></td></tr></tbody></table></figure>
<p>å®é™…ä¸Šè¿˜è¦å»çœ‹<code>batchify_sequence_labeling_with_label</code>å‡½æ•°ï¼ˆ<strong>æˆªå–äº†ä¸€éƒ¨åˆ†</strong>ï¼‰ï¼š</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">batchify_sequence_labeling_with_label</span>(<span class="params">input_batch_list, gpu, if_train=<span class="literal">True</span>, max_object_nb=<span class="number">0</span></span>):</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">        input: list of words, chars and labels, various length. [[words, features, chars, labels, topics],[words, features, chars,labels, topics],...]</span></span><br><span class="line"><span class="string">            words: word ids for one sentence. (batch_size, sent_len)</span></span><br><span class="line"><span class="string">            features: features ids for one sentence. (batch_size, sent_len, feature_num)</span></span><br><span class="line"><span class="string">            chars: char ids for on sentences, various length. (batch_size, sent_len, each_word_length)</span></span><br><span class="line"><span class="string">            labels: label ids for one sentence. (batch_size, sent_len)</span></span><br><span class="line"><span class="string">            object: object id for this sentence</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        output:</span></span><br><span class="line"><span class="string">            zero padding for word and char, with their batch length</span></span><br><span class="line"><span class="string">            word_seq_tensor: (batch_size, max_sent_len) Variable</span></span><br><span class="line"><span class="string">            feature_seq_tensors: [(batch_size, max_sent_len),...] list of Variable</span></span><br><span class="line"><span class="string">            word_seq_lengths: (batch_size,1) Tensor</span></span><br><span class="line"><span class="string">            char_seq_tensor: (batch_size*max_sent_len, max_word_len) Variable</span></span><br><span class="line"><span class="string">            char_seq_lengths: (batch_size*max_sent_len,1) Tensor</span></span><br><span class="line"><span class="string">            char_seq_recover: (batch_size*max_sent_len,1)  recover char sequence order</span></span><br><span class="line"><span class="string">            label_seq_tensor: (batch_size, max_sent_len)</span></span><br><span class="line"><span class="string">            mask: (batch_size, max_sent_len)</span></span><br><span class="line"><span class="string">            object_tensor: (batch_size, max_topic_len) Variable</span></span><br><span class="line"><span class="string">            object_mask: (batch_size, max_topic_len)</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    batch_size = <span class="built_in">len</span>(input_batch_list)</span><br><span class="line">    words = [sent[<span class="number">0</span>] <span class="keyword">for</span> sent <span class="keyword">in</span> input_batch_list] <span class="comment"># è¿™ä¸ªç»“åˆä¸Šé¢çš„train_Idsè¾“å‡ºçœ‹</span></span><br><span class="line">    features = [np.asarray(sent[<span class="number">1</span>]) <span class="keyword">for</span> sent <span class="keyword">in</span> input_batch_list]</span><br><span class="line">    feature_num = <span class="built_in">len</span>(features[<span class="number">0</span>][<span class="number">0</span>])</span><br><span class="line">    chars = [sent[<span class="number">2</span>] <span class="keyword">for</span> sent <span class="keyword">in</span> input_batch_list]</span><br><span class="line">    labels = [sent[<span class="number">3</span>] <span class="keyword">for</span> sent <span class="keyword">in</span> input_batch_list]</span><br><span class="line">    objects = [sent[<span class="number">4</span>] <span class="keyword">for</span> sent <span class="keyword">in</span> input_batch_list]</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    word_seq_lengths = torch.LongTensor(<span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">len</span>, words)))</span><br><span class="line">    max_seq_len = word_seq_lengths.<span class="built_in">max</span>().item()</span><br><span class="line">    word_seq_tensor = torch.zeros((batch_size, max_seq_len), requires_grad =  if_train).long()</span><br><span class="line">    label_seq_tensor = torch.zeros((batch_size, max_seq_len), requires_grad =  if_train).long()</span><br><span class="line">    object_tensor = torch.zeros((batch_size, max_object_nb), requires_grad=if_train).long()</span><br><span class="line">    object_mask = torch.zeros((batch_size, max_object_nb), requires_grad=if_train).byte()</span><br><span class="line">    object_lengths = torch.LongTensor(<span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">len</span>, objects)))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> idx, (seq, label, seqlen) <span class="keyword">in</span> <span class="built_in">enumerate</span>(<span class="built_in">zip</span>(words, labels, word_seq_lengths)):</span><br><span class="line">        seqlen = seqlen.item()</span><br><span class="line">        word_seq_tensor[idx, :seqlen] = torch.LongTensor(seq)</span><br><span class="line">        label_seq_tensor[idx, :seqlen] = torch.LongTensor(label)</span><br><span class="line">        mask[idx, :seqlen] = torch.Tensor([<span class="number">1</span>]*seqlen)</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">Ouput of batch_word</span><br><span class="line">tensor([[<span class="number">17263</span>,   <span class="number">876</span>, <span class="number">17264</span>,  <span class="number">5671</span>,     <span class="number">8</span>, <span class="number">17265</span>,    <span class="number">15</span>,   <span class="number">313</span>,  <span class="number">3082</span>,  <span class="number">2398</span>,</span><br><span class="line">            <span class="number">29</span>,  <span class="number">6190</span>,  <span class="number">9973</span>, <span class="number">11973</span>,   <span class="number">127</span>,   <span class="number">300</span>,  <span class="number">4878</span>,    <span class="number">36</span>,  <span class="number">1070</span>,  <span class="number">1397</span>,</span><br><span class="line">         <span class="number">17266</span>,   <span class="number">192</span>,   <span class="number">192</span>, <span class="number">17267</span>],</span><br><span class="line">        [    <span class="number">2</span>, <span class="number">16550</span>,     <span class="number">4</span>,   <span class="number">147</span>,     <span class="number">5</span>,   <span class="number">723</span>, <span class="number">16551</span>,   <span class="number">803</span>,  <span class="number">1452</span>,    <span class="number">83</span>,</span><br><span class="line">           <span class="number">785</span>,    <span class="number">69</span>,  <span class="number">1053</span>,     <span class="number">5</span>, <span class="number">16552</span>, <span class="number">16553</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,</span><br><span class="line">             <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>],</span><br><span class="line">        [    <span class="number">2</span>,  <span class="number">2067</span>,     <span class="number">5</span>,  <span class="number">2068</span>,  <span class="number">2069</span>,  <span class="number">2070</span>,  <span class="number">2071</span>,  <span class="number">2072</span>,  <span class="number">2070</span>,  <span class="number">2073</span>,</span><br><span class="line">          <span class="number">2074</span>,  <span class="number">2075</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,</span><br><span class="line">             <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>],</span><br><span class="line">        [    <span class="number">2</span>, <span class="number">18490</span>,     <span class="number">5</span>,  <span class="number">3053</span>,    <span class="number">19</span>,  <span class="number">1746</span>,    <span class="number">69</span>,  <span class="number">1465</span>,  <span class="number">8699</span>,   <span class="number">192</span>,</span><br><span class="line">         <span class="number">18491</span>, <span class="number">18492</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,</span><br><span class="line">             <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>],</span><br><span class="line">        [    <span class="number">2</span>, <span class="number">11806</span>,     <span class="number">5</span>,  <span class="number">6629</span>,   <span class="number">300</span>,   <span class="number">470</span>,    <span class="number">14</span>, <span class="number">11807</span>, <span class="number">11808</span>, <span class="number">11809</span>,</span><br><span class="line">             <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,</span><br><span class="line">             <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>],</span><br><span class="line">        [    <span class="number">2</span>, <span class="number">18415</span>,     <span class="number">5</span>, <span class="number">10658</span>, <span class="number">18416</span>,  <span class="number">3119</span>,  <span class="number">5198</span>,    <span class="number">45</span>,    <span class="number">94</span>, <span class="number">18417</span>,</span><br><span class="line">             <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,</span><br><span class="line">             <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>],</span><br><span class="line">        [    <span class="number">2</span>, <span class="number">10927</span>,     <span class="number">5</span>, <span class="number">10782</span>,  <span class="number">4134</span>, <span class="number">16619</span>,   <span class="number">192</span>, <span class="number">16620</span>, <span class="number">16621</span>,     <span class="number">0</span>,</span><br><span class="line">             <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,</span><br><span class="line">             <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>],</span><br><span class="line">        [    <span class="number">2</span>, <span class="number">16279</span>,     <span class="number">5</span>,    <span class="number">58</span>,   <span class="number">786</span>,  <span class="number">7513</span>, <span class="number">16280</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,</span><br><span class="line">             <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,</span><br><span class="line">             <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>],</span><br><span class="line">        [    <span class="number">2</span>, <span class="number">17990</span>,     <span class="number">5</span>, <span class="number">17991</span>, <span class="number">17992</span>, <span class="number">17993</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,</span><br><span class="line">             <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,</span><br><span class="line">             <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>],</span><br><span class="line">        [ <span class="number">4012</span>,   <span class="number">131</span>,    <span class="number">96</span>,   <span class="number">192</span>, <span class="number">20515</span>, <span class="number">20516</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,</span><br><span class="line">             <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,</span><br><span class="line">             <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>]], device=<span class="string">'cuda:0'</span>)</span><br><span class="line">torch.Size([<span class="number">10</span>, <span class="number">24</span>])</span><br><span class="line"></span><br><span class="line">tensor([[    <span class="number">2</span>,  <span class="number">7381</span>,     <span class="number">5</span>,  <span class="number">7388</span>,   <span class="number">341</span>, <span class="number">16686</span>, <span class="number">16687</span>,  <span class="number">3635</span>,    <span class="number">37</span>,  <span class="number">4535</span>,</span><br><span class="line">           <span class="number">495</span>, <span class="number">16688</span>,    <span class="number">15</span>,   <span class="number">672</span>,  <span class="number">5484</span>,     <span class="number">8</span>, <span class="number">13808</span>,    <span class="number">69</span>,    <span class="number">37</span>,  <span class="number">7460</span>,</span><br><span class="line">             <span class="number">8</span>,    <span class="number">92</span>,    <span class="number">15</span>,    <span class="number">92</span>,  <span class="number">1403</span>,   <span class="number">323</span>,  <span class="number">7152</span>,  <span class="number">1408</span>],</span><br><span class="line">        [    <span class="number">2</span>, <span class="number">17320</span>,     <span class="number">5</span>,  <span class="number">6209</span>,   <span class="number">159</span>,  <span class="number">1497</span>,    <span class="number">14</span>,    <span class="number">94</span>,   <span class="number">181</span>,  <span class="number">9653</span>,</span><br><span class="line">           <span class="number">192</span>, <span class="number">17321</span>,  <span class="number">2714</span>,     <span class="number">5</span>, <span class="number">17322</span>, <span class="number">17323</span>,   <span class="number">100</span>,     <span class="number">5</span>,   <span class="number">101</span>,    <span class="number">15</span>,</span><br><span class="line">         <span class="number">17324</span>, <span class="number">17325</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>],</span><br><span class="line">        [<span class="number">15582</span>,    <span class="number">69</span>, <span class="number">13403</span>,     <span class="number">5</span>,  <span class="number">1448</span>,  <span class="number">3767</span>,   <span class="number">225</span>,   <span class="number">159</span>, <span class="number">15583</span>, <span class="number">15584</span>,</span><br><span class="line">            <span class="number">88</span>,    <span class="number">32</span>,  <span class="number">9694</span>, <span class="number">15585</span>,    <span class="number">39</span>, <span class="number">12421</span>,     <span class="number">5</span>, <span class="number">15586</span>,  <span class="number">6279</span>, <span class="number">15587</span>,</span><br><span class="line">             <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>],</span><br><span class="line">        [    <span class="number">2</span>, <span class="number">20728</span>,     <span class="number">5</span>,   <span class="number">122</span>,  <span class="number">1284</span>,     <span class="number">8</span>,   <span class="number">566</span>,   <span class="number">629</span>,    <span class="number">15</span>,    <span class="number">15</span>,</span><br><span class="line">            <span class="number">15</span>,    <span class="number">15</span>,    <span class="number">20</span>, <span class="number">20729</span>,    <span class="number">15</span>, <span class="number">20730</span>, <span class="number">20731</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,</span><br><span class="line">             <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>],</span><br><span class="line">        [    <span class="number">2</span>,  <span class="number">8460</span>,     <span class="number">5</span>,  <span class="number">8461</span>,  <span class="number">8462</span>,    <span class="number">97</span>,  <span class="number">3660</span>,  <span class="number">8463</span>,    <span class="number">36</span>,   <span class="number">622</span>,</span><br><span class="line">          <span class="number">8464</span>,  <span class="number">8465</span>,   <span class="number">291</span>,  <span class="number">8466</span>,  <span class="number">8467</span>,  <span class="number">8468</span>,  <span class="number">8469</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,</span><br><span class="line">             <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>],</span><br><span class="line">        [  <span class="number">841</span>,     <span class="number">5</span>, <span class="number">15006</span>,  <span class="number">1399</span>, <span class="number">15007</span>,    <span class="number">69</span>, <span class="number">15008</span>,   <span class="number">659</span>,   <span class="number">267</span>, <span class="number">15009</span>,</span><br><span class="line">          <span class="number">4784</span>, <span class="number">15010</span>, <span class="number">15011</span>, <span class="number">15012</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,</span><br><span class="line">             <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>],</span><br><span class="line">        [    <span class="number">2</span>, <span class="number">21204</span>,     <span class="number">5</span>, <span class="number">17259</span>,    <span class="number">29</span>,   <span class="number">341</span>,    <span class="number">15</span>, <span class="number">21205</span>,   <span class="number">159</span>,  <span class="number">1619</span>,</span><br><span class="line">          <span class="number">1760</span>,   <span class="number">473</span>,    <span class="number">15</span>, <span class="number">21206</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,</span><br><span class="line">             <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>],</span><br><span class="line">        [    <span class="number">2</span>,  <span class="number">3129</span>,     <span class="number">5</span>,  <span class="number">1448</span>, <span class="number">13414</span>, <span class="number">13415</span>,    <span class="number">19</span>, <span class="number">13416</span>,    <span class="number">37</span>,  <span class="number">1659</span>,</span><br><span class="line">             <span class="number">8</span>, <span class="number">13417</span>, <span class="number">13418</span>, <span class="number">13419</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,</span><br><span class="line">             <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>],</span><br><span class="line">        [ <span class="number">1520</span>, <span class="number">10610</span>,    <span class="number">36</span>, <span class="number">10611</span>, <span class="number">10612</span>, <span class="number">10613</span>,    <span class="number">97</span>, <span class="number">10614</span>,    <span class="number">15</span>,    <span class="number">15</span>,</span><br><span class="line">            <span class="number">15</span>, <span class="number">10615</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,</span><br><span class="line">             <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>],</span><br><span class="line">        [ <span class="number">1636</span>,  <span class="number">7560</span>,  <span class="number">8074</span>,    <span class="number">36</span>,  <span class="number">6149</span>,  <span class="number">8075</span>,   <span class="number">192</span>,  <span class="number">8076</span>,     <span class="number">0</span>,     <span class="number">0</span>,</span><br><span class="line">             <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,</span><br><span class="line">             <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>,     <span class="number">0</span>]],</span><br><span class="line">       device=<span class="string">'cuda:0'</span>)</span><br><span class="line">torch.Size([<span class="number">10</span>, <span class="number">28</span>])</span><br></pre></td></tr></tbody></table></figure>
<p>çœ‹åˆ°è¿™ä¸ª<code>'cuda:0'</code>çœŸæ»´æ˜¯éå¸¸çš„ç¾¡æ…•å•Šï¼Œä¸ä¼šå‡ºbugï¼Œç„¶åå°±çœ‹äº†ä¸€ä¸‹æºç ï¼Œæ˜¯è¿™æ ·å¤„ç†çš„ï¼Œå…¶å®å°±æ˜¯åŠ ä¸ª<code>gpu</code>åˆ¤æ–­ç„¶å<code>cuda()</code>ï¼š</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> gpu:</span><br><span class="line">    word_seq_tensor = word_seq_tensor.cuda()</span><br><span class="line">    <span class="keyword">for</span> idx <span class="keyword">in</span> <span class="built_in">range</span>(feature_num):</span><br><span class="line">        feature_seq_tensors[idx] = feature_seq_tensors[idx].cuda()</span><br><span class="line">    word_seq_lengths = word_seq_lengths.cuda()</span><br><span class="line">    word_seq_recover = word_seq_recover.cuda()</span><br><span class="line">    label_seq_tensor = label_seq_tensor.cuda()</span><br><span class="line">    char_seq_tensor = char_seq_tensor.cuda()</span><br><span class="line">    char_seq_recover = char_seq_recover.cuda()</span><br><span class="line">    object_tensor = object_tensor.cuda()</span><br><span class="line">    object_mask = object_mask.cuda()</span><br><span class="line">    mask = mask.cuda()</span><br></pre></td></tr></tbody></table></figure>
<p>ç„¶åæ¥ä¸‹æ¥å…¶å®å°±æ˜¯æŠŠè¿™äº›<code>batch input</code>å–‚ç»™æ¨¡å‹ï¼Œå°±å¯ä»¥å»è®­ç»ƒäº†ã€‚</p>
<p>è¿™é‡Œè¿˜æ˜¯è¦æä¸€å¥ï¼Œè¿™ä¸ª<code>cuda</code>æŠ¥é”™çš„é—®é¢˜è¦æ€ä¹ˆå»é¿å…ï¼Œå› ä¸ºé»˜è®¤<code>tensor</code>éƒ½æ˜¯æ”¾åˆ°<code>cpu</code>ä¸Šçš„ï¼š</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> data.HP_gpu:</span><br><span class="line">        model = model.cuda()</span><br></pre></td></tr></tbody></table></figure>
<p>å…¶å®<code>train</code>çš„ç»“æ„ç®—æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œå°±æ˜¯è®¾ç½®äº†<code>epoch iteration</code>çš„æ•°é‡å»å¾ªç¯ï¼Œ1ä¸ª<code>epoch</code>æ˜¯æŒ‡æŠŠæ•´ä¸ªè®­ç»ƒé›†è¿‡ä¸€éï¼Œ1ä¸ª<code>epoch</code>å†…ï¼Œæ˜¯éœ€è¦è¿›è¡Œç›¸åº”çš„<code>batch iteration</code>çš„ï¼Œå…¶å®ä¹Ÿå°±æ˜¯å¯¹<code>train_size // batch_size</code>è¿™ä¹ˆå¤šç»„<code>batch</code>è¿›è¡Œå¾ªç¯ï¼ŒåŒæ—¶è®¡ç®—<code>loss</code>å¹¶åå‘ä¼ æ’­æ›´æ–°ã€‚</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">model.train()</span><br><span class="line">        model.zero_grad()</span><br><span class="line">        batch_size = data.HP_batch_size</span><br><span class="line">        batch_id = <span class="number">0</span></span><br><span class="line">        train_num = <span class="built_in">len</span>(data.train_Ids)</span><br><span class="line">        total_batch = train_num//batch_size+<span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> batch_id <span class="keyword">in</span> <span class="built_in">range</span>(total_batch):</span><br><span class="line">            start = batch_id*batch_size</span><br><span class="line">            end = (batch_id+<span class="number">1</span>)*batch_size</span><br><span class="line">            <span class="keyword">if</span> end &gt;train_num:</span><br><span class="line">                end = train_num</span><br><span class="line">            instance = data.train_Ids[start:end]</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> instance:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            batch_word, batch_features, batch_wordlen, batch_wordrecover, batch_char, batch_charlen, batch_charrecover, batch_label, mask, batch_obj, obj_mask = batchify_with_label(instance, data.HP_gpu, <span class="literal">True</span>, data.sentence_classification, data.MAX_OBJECT_NB)</span><br><span class="line">            instance_count += <span class="number">1</span></span><br><span class="line">            loss, tag_seq = model.calculate_loss(batch_word, batch_features, batch_wordlen, batch_char, batch_charlen, batch_charrecover, batch_label, mask, batch_obj, obj_mask)</span><br><span class="line">            right, whole = predict_check(tag_seq, batch_label, mask, data.sentence_classification)</span><br><span class="line">            right_token += right</span><br><span class="line">            whole_token += whole</span><br><span class="line">            <span class="comment"># print("loss:",loss.item())</span></span><br><span class="line">            sample_loss += loss.item()</span><br><span class="line">            total_loss += loss.item()</span><br><span class="line">            <span class="keyword">if</span> end%<span class="number">500</span> == <span class="number">0</span>:</span><br><span class="line">                temp_time = time.time()</span><br><span class="line">                temp_cost = temp_time - temp_start</span><br><span class="line">                temp_start = temp_time</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">"     Instance: %s; Time: %.2fs; loss: %.4f; acc: %s/%s=%.4f"</span>%(end, temp_cost, sample_loss, right_token, whole_token,(right_token+<span class="number">0.</span>)/whole_token))</span><br><span class="line">                <span class="keyword">if</span> sample_loss &gt; <span class="number">1e8</span> <span class="keyword">or</span> <span class="built_in">str</span>(sample_loss) == <span class="string">"nan"</span>:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">"ERROR: LOSS EXPLOSION (&gt;1e8) ! PLEASE SET PROPER PARAMETERS AND STRUCTURE! EXIT...."</span>)</span><br><span class="line">                    exit(<span class="number">1</span>)</span><br><span class="line">                sys.stdout.flush()</span><br><span class="line">                sample_loss = <span class="number">0</span></span><br><span class="line">            loss.backward()</span><br><span class="line">            optimizer.step()</span><br><span class="line">            model.zero_grad()</span><br></pre></td></tr></tbody></table></figure>
<p>é‡Œé¢è¿˜æœ‰ä¸ª<code>evaluate</code>çš„éƒ¨åˆ†ï¼Œè¿™éƒ¨åˆ†ä¼šå•ç‹¬æ‹¿å‡ºæ¥è¯´ï¼Œå› ä¸ºä¹‹å‰åœ¨è¿™é‡Œé‡åˆ°äº†bugã€‚</p>
<p>ç„¶åè¿™æ ·çš„è¯ï¼Œå¤§è‡´ç®—æ˜¯è¿‡äº†ä¸€éæµç¨‹ï¼Œæ¥ä¸‹æ¥çš„Chapterä¼šç»†è‡´çš„è§£æã€‚</p>
<h2 id="æ•´ä½“æ¶æ„"><a href="#æ•´ä½“æ¶æ„" class="headerlink" title="æ•´ä½“æ¶æ„"></a>æ•´ä½“æ¶æ„</h2><h3 id="å¦‚ä½•åˆ›å»ºä¸€ä¸ªå·¥ç¨‹"><a href="#å¦‚ä½•åˆ›å»ºä¸€ä¸ªå·¥ç¨‹" class="headerlink" title="å¦‚ä½•åˆ›å»ºä¸€ä¸ªå·¥ç¨‹"></a>å¦‚ä½•åˆ›å»ºä¸€ä¸ªå·¥ç¨‹</h3><blockquote>
<p>è¿™éƒ¨åˆ†æ”¹ç¼–è‡ª<a target="_blank" rel="noopener" href="https://github.com/chenyuntc/pytorch-book/blob/master/chapter06-best_practice/PyTorch%E5%AE%9E%E6%88%98%E6%8C%87%E5%8D%97.md#617-mainpy">link</a></p>
</blockquote>
<p>å¤§ä½“çš„ç›®å½•å¦‚ä¸‹(ä¸æ˜¯å…¨éƒ¨)ï¼š</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">â”œâ”€â”€ checkpoints/</span><br><span class="line">â”œâ”€â”€ data/</span><br><span class="line">â”‚   â”œâ”€â”€ __init__.py</span><br><span class="line">â”‚   â”œâ”€â”€ dataset.py</span><br><span class="line">â”‚   â””â”€â”€ get_data.sh</span><br><span class="line">â”œâ”€â”€ models/</span><br><span class="line">â”‚   â”œâ”€â”€ __init__.py</span><br><span class="line">â”‚   â”œâ”€â”€ crf.py</span><br><span class="line">â”‚   â”œâ”€â”€ mca.py</span><br><span class="line">â”‚   â””â”€â”€ MUL_LSTM_MCA.py</span><br><span class="line">â””â”€â”€ utils/</span><br><span class="line">â”‚   â”œâ”€â”€ __init__.py</span><br><span class="line">â”‚   â”œâ”€â”€ alphabet.py</span><br><span class="line">â”‚   â”œâ”€â”€ data.py</span><br><span class="line">â”‚   â”œâ”€â”€ metric.py</span><br><span class="line">â”‚   â””â”€â”€ functions.py</span><br><span class="line">â””â”€â”€ object_detector/</span><br><span class="line">â”‚   â”œâ”€â”€ mrcnn/</span><br><span class="line">â”‚   â”‚	â”œâ”€â”€ config.py</span><br><span class="line">â”‚   â”‚	â”œâ”€â”€ model.py</span><br><span class="line">â”‚   â”‚	â”œâ”€â”€ utils.py</span><br><span class="line">â”‚   â”‚	â”œâ”€â”€ visualize.py</span><br><span class="line">â”‚   â”œâ”€â”€ detector.py</span><br><span class="line">â”œâ”€â”€ sample.train.config</span><br><span class="line">â”œâ”€â”€ main.py</span><br><span class="line">â”œâ”€â”€ requirements.txt</span><br><span class="line">â”œâ”€â”€ README.md</span><br></pre></td></tr></tbody></table></figure>
<p>å…¶ä¸­ï¼š</p>
<ul>
<li><code>checkpoints/</code>ï¼š ç”¨äºä¿å­˜è®­ç»ƒå¥½çš„æ¨¡å‹ï¼Œå¯ä½¿ç¨‹åºåœ¨å¼‚å¸¸é€€å‡ºåä»èƒ½é‡æ–°è½½å…¥æ¨¡å‹ï¼Œæ¢å¤è®­ç»ƒ</li>
<li><code>data/</code>ï¼šæ•°æ®ç›¸å…³æ“ä½œï¼ŒåŒ…æ‹¬æ•°æ®é¢„å¤„ç†ã€datasetå®ç°ç­‰</li>
<li><code>models/</code>ï¼šæ¨¡å‹å®šä¹‰ï¼Œå¯ä»¥æœ‰å¤šä¸ªæ¨¡å‹ï¼Œä¾‹å¦‚ä¸Šé¢çš„<code>crf</code>å’Œ<code>MUL_LSTM_MCA</code>ï¼Œä¸€ä¸ªæ¨¡å‹å¯¹åº”ä¸€ä¸ªæ–‡ä»¶</li>
<li><code>utils/</code>ï¼šå¯èƒ½ç”¨åˆ°çš„å·¥å…·å‡½æ•°ï¼Œåœ¨è¿™ä¸ªé¡¹ç›®ä¸­ä¸»è¦æ˜¯å°è£…äº†è¯è¡¨çš„ä¸€äº›ç›¸å…³å‡½æ•°ã€‚</li>
<li><code>config.py</code>ï¼šé…ç½®æ–‡ä»¶ï¼Œæ‰€æœ‰å¯é…ç½®çš„å˜é‡éƒ½é›†ä¸­åœ¨æ­¤ï¼Œå¹¶æä¾›é»˜è®¤å€¼</li>
<li><code>main.py</code>ï¼šä¸»æ–‡ä»¶ï¼Œè®­ç»ƒå’Œæµ‹è¯•ç¨‹åºçš„å…¥å£ï¼Œå¯é€šè¿‡ä¸åŒçš„å‘½ä»¤æ¥æŒ‡å®šä¸åŒçš„æ“ä½œå’Œå‚æ•°</li>
<li><code>requirements.txt</code>ï¼šç¨‹åºä¾èµ–çš„ç¬¬ä¸‰æ–¹åº“</li>
<li><code>README.md</code>ï¼šæä¾›ç¨‹åºçš„å¿…è¦è¯´æ˜</li>
</ul>
<h4 id="æ•°æ®åŠ è½½"><a href="#æ•°æ®åŠ è½½" class="headerlink" title="æ•°æ®åŠ è½½"></a>æ•°æ®åŠ è½½</h4><p>è¿™éƒ¨åˆ†è¦çœ‹å…·ä½“çš„ä»»åŠ¡ï¼Œè¿˜è¦çœ‹æä¾›çš„æ•°æ®é›†æ ¼å¼ï¼Œæœ‰æ—¶å€™æ•°æ®é›†æ˜¯åˆ’åˆ†å¥½çš„ï¼Œæœ‰æ—¶å€™æ˜¯è¦è‡ªå·±å»åˆ’åˆ†éªŒè¯é›†ã€æµ‹è¯•é›†çš„ã€‚è¿™é‡Œè¿˜å¯ä»¥ç”¨åˆ°<code>torchtext</code>å•¥çš„ï¼Œæœ‰æœºä¼šä¼šç»†çï¼Œä½†æ˜¯åº”è¯¥ä¸æ˜¯åœ¨è¿™ç¯‡æ–‡ç« é‡Œã€‚</p>
<p>æˆ‘ä¸¾ä¸ªæ —å­ï¼Œæ¯”å¦‚è¿™ç§æ–‡æœ¬åˆ†ç±»çš„å¤„ç†ï¼Œå°±æ˜¯<code>tokenize</code>å†æ„å»º<code>vocab</code>å†å»æ„å»º<code>embedding</code>ï¼Œè€Œå¯¹äº<code>NER</code>ï¼Œè¿˜è¦è€ƒè™‘<code>label</code>å•¥çš„ï¼Œç»†èŠ‚æ˜¯æœ‰äº›ä¸ä¸€æ ·ï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰å¾ˆå¤šå…±åŒçš„åœ°æ–¹ï¼Œè¿™ä¸ªå…ˆé¸½ä¸€ä¸‹ï¼Œé¡¹ç›®åšå¤šäº†å°±å›æ¥æ€»ç»“ã€‚</p>
<p><img src="https://moonhotel.oss-cn-shanghai.aliyuncs.com/images/21102512313.jpg" alt="img" style="zoom: 50%;"></p>
<h4 id="å…³äº-init-py"><a href="#å…³äº-init-py" class="headerlink" title="å…³äº_init_.py"></a>å…³äº_<em>init_</em>.py</h4><p>å¯ä»¥çœ‹åˆ°ï¼Œå‡ ä¹æ¯ä¸ªæ–‡ä»¶å¤¹ä¸‹éƒ½æœ‰<code>__init__.py</code>ï¼Œä¸€ä¸ªç›®å½•å¦‚æœåŒ…å«äº†<code>__init__.py</code> æ–‡ä»¶ï¼Œé‚£ä¹ˆå®ƒå°±å˜æˆäº†ä¸€ä¸ªåŒ…ï¼ˆpackageï¼‰ã€‚<code>__init__.py</code>å¯ä»¥ä¸ºç©ºï¼Œä¹Ÿå¯ä»¥å®šä¹‰åŒ…çš„å±æ€§å’Œæ–¹æ³•ï¼Œä½†å…¶å¿…é¡»å­˜åœ¨ï¼Œå…¶å®ƒç¨‹åºæ‰èƒ½ä»è¿™ä¸ªç›®å½•ä¸­å¯¼å…¥ç›¸åº”çš„æ¨¡å—æˆ–å‡½æ•°ã€‚ä¾‹å¦‚åœ¨<code>data/</code>æ–‡ä»¶å¤¹ä¸‹æœ‰<code>__init__.py</code>ï¼Œåˆ™åœ¨<code>main.py</code> ä¸­å°±å¯ä»¥<code>from data.dataset import DogCat</code>ã€‚è€Œå¦‚æœåœ¨<code>__init__.py</code>ä¸­å†™å…¥<code>from .dataset import DogCat</code>ï¼Œåˆ™åœ¨main.pyä¸­å°±å¯ä»¥ç›´æ¥å†™ä¸ºï¼š<code>from data import DogCat</code>ï¼Œæˆ–è€…<code>import data; dataset = data.DogCat</code>ï¼Œç›¸æ¯”äº<code>from data.dataset import DogCat</code>æ›´åŠ ä¾¿æ·ã€‚</p>
<h4 id="æ¨¡å‹"><a href="#æ¨¡å‹" class="headerlink" title="æ¨¡å‹"></a>æ¨¡å‹</h4><p>è¿™ä¸ªæ­æ¨¡å‹ï¼Œä¸ªäººæ„Ÿè§‰ç›¸å¯¹æ¥è¯´æ¯”è¾ƒç®€å•ï¼Œæ¯•ç«Ÿæ•´ä½“æ¥çœ‹å°±å’Œæ­ç§¯æœ¨ä¸€æ ·ï¼ŒæŠŠè¾“å…¥è¾“å‡ºç»´åº¦å¼„å¥½ï¼Œè°ƒè°ƒåº“å°±ç›´æ¥è§£å†³ã€‚</p>
<p>ä½†æ˜¯æï¼Œåƒ<code>bert</code>è¿™ç§é¢„è®­ç»ƒæ¨¡å‹ï¼Œæˆ‘ä¹‹å‰æ²¡æ¥è§¦è¿‡ï¼Œæ‰€ä»¥åˆšå¼€å§‹åªçŸ¥é“ä¸€ä¸ª<code>hugggingface</code>ï¼Œä¸çŸ¥é“å…·ä½“æ€ä¹ˆå»ç”¨<code>bert</code>ï¼Œè¿™é‡Œè¯¦ç»†è®°å½•ä¸€ä¸‹ã€‚</p>
<p>ç›´æ¥<code>import bert</code>çš„åŒ…æ˜¯ä¸å¤Ÿçš„ï¼Œè¿˜æœ‰<code>config</code>å’Œå‚æ•°åŠ è½½çš„è¿‡ç¨‹ï¼š</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> transformers</span><br><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> BertConfig,BertModel</span><br><span class="line"></span><br><span class="line">bert_config = BertConfig.from_json_file(<span class="string">"model/config.json"</span>) </span><br><span class="line">bert = BertModel(self.bert_config)</span><br><span class="line"></span><br><span class="line">a = torch.load(<span class="string">"./model/pytorch_model.bin"</span>)</span><br><span class="line">model_dict = bert.state_dict()</span><br><span class="line">pretrained_dict = {k:v <span class="keyword">for</span> k,v <span class="keyword">in</span> a.items() <span class="keyword">if</span> k <span class="keyword">in</span> model_dict}</span><br><span class="line">model_dict.update(pretrained_dict)</span><br><span class="line">bert.load_state_dict(model_dict)</span><br><span class="line"></span><br><span class="line">output = bert(tensor_test).last_hidden_state <span class="comment"># get the output</span></span><br></pre></td></tr></tbody></table></figure>
<p>è¿™ä¸Šé¢çš„<code>config.json</code>å’Œ<code>pytorch_model.bin</code>æ˜¯è¦å»æŠ±æŠ±è„¸ä¸‹çš„ï¼Œlinkåœ¨è¿™é‡Œ<a target="_blank" rel="noopener" href="https://huggingface.co/bert-base-cased/tree/main">bert_based_cased</a>ã€‚</p>
<p><code>BiLSTM</code>å°±è’œäº†ï¼Œæ²¡å•¥å¯è¯´çš„äº†ï¼Œè°ƒè°ƒåº“å°±å®Œäº‹ï¼ŒåŸæœ¬æ˜¯ä¸å‡†å¤‡è®²çš„ï¼Œä½†æ˜¯ç”±äºæ”¹æ¨¡å‹çš„æ—¶å€™å¡bugäº†ï¼Œæ”¹åŠ¨çš„å°±æ˜¯è¿™å—ï¼Œä¸æ”¹çš„è¯æ˜¯å¦¹æœ‰é—®é¢˜çš„ï¼Œæ‰€ä»¥è¿˜æ˜¯æœ‰å¿…è¦çœ‹çœ‹ã€‚</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># char -&gt; emb -&gt; drop</span></span><br><span class="line">char_embeds = self.char_drop(</span><br><span class="line">    self.char_embeddings(char_inputs))  <span class="comment"># (batch_size * sent_len, word_length, char_emb_dim)</span></span><br><span class="line">char_hidden = <span class="literal">None</span></span><br><span class="line"><span class="comment"># -&gt; char lstm,</span></span><br><span class="line">pack_char_input = pack_padded_sequence(char_embeds, char_seq_lengths.cpu().numpy(), batch_first=<span class="literal">True</span>)</span><br><span class="line">char_rnn_out, char_hidden = self.char_lstm(pack_char_input, char_hidden)</span><br><span class="line"><span class="comment"># last hiddens</span></span><br><span class="line"><span class="comment">## char_hidden = (h_t, c_t)</span></span><br><span class="line"><span class="comment">#  char_hidden[0] = h_t = (2, batch_size, lstm_dimension)</span></span><br><span class="line">char_features = char_hidden[<span class="number">0</span>].transpose(<span class="number">1</span>, <span class="number">0</span>).contiguous().view(char_batch_size, -<span class="number">1</span>)  <span class="comment"># (batch_size * sent_len, char_hidden_dim)</span></span><br><span class="line">char_features = char_features[char_seq_recover]</span><br><span class="line"><span class="comment"># cat char_hidden_dim for every char in a word</span></span><br><span class="line">char_features = char_features.view(batch_size, sent_len, -<span class="number">1</span>)  <span class="comment"># (batch_size, sent_len, char_hidden_dim)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># word -&gt; word emb</span></span><br><span class="line">word_embs = self.word_embeddings(word_inputs)</span><br><span class="line"><span class="comment"># concat-&gt; word represent</span></span><br><span class="line">word_represent = torch.cat([word_embs, char_features], <span class="number">2</span>)</span><br><span class="line">word_represent = self.word_drop(word_represent)  <span class="comment"># (batch_size, sent_len, char_hidden_dim + word_emb_dim)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -&gt; word seq lstm</span></span><br><span class="line">packed_word = pack_padded_sequence(word_represent, word_seq_lengths.cpu().numpy(), <span class="literal">True</span>)</span><br><span class="line">hidden = <span class="literal">None</span></span><br><span class="line">lstm_out, hidden = self.word_lstm(packed_word, hidden)</span><br><span class="line">lstm_out, _ = pad_packed_sequence(lstm_out, batch_first=<span class="literal">True</span>)</span><br><span class="line">text_feat = self.droplstm(lstm_out)  <span class="comment"># (batch_size, sent_len, hidden_dim) X</span></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">text_feat:</span><br><span class="line"></span><br><span class="line">tensor([[[ <span class="number">2.4799e-01</span>,  <span class="number">0.0000e+00</span>, -<span class="number">5.9055e-02</span>,  ...,  <span class="number">0.0000e+00</span>,</span><br><span class="line">          -<span class="number">0.0000e+00</span>, -<span class="number">0.0000e+00</span>],</span><br><span class="line">         [-<span class="number">6.9201e-01</span>,  <span class="number">1.2951e+00</span>, -<span class="number">4.5080e-01</span>,  ...,  <span class="number">0.0000e+00</span>,</span><br><span class="line">          -<span class="number">0.0000e+00</span>, -<span class="number">0.0000e+00</span>],</span><br><span class="line">         [-<span class="number">0.0000e+00</span>,  <span class="number">0.0000e+00</span>, -<span class="number">2.0977e-01</span>,  ..., -<span class="number">2.4604e-01</span>,</span><br><span class="line">          -<span class="number">4.0794e-01</span>,  <span class="number">0.0000e+00</span>],</span><br><span class="line">         ...,</span><br><span class="line">         [ <span class="number">0.0000e+00</span>,  <span class="number">0.0000e+00</span>,  <span class="number">0.0000e+00</span>,  ...,  <span class="number">0.0000e+00</span>,</span><br><span class="line">           <span class="number">0.0000e+00</span>,  <span class="number">0.0000e+00</span>],</span><br><span class="line">         [ <span class="number">0.0000e+00</span>,  <span class="number">0.0000e+00</span>,  <span class="number">0.0000e+00</span>,  ...,  <span class="number">0.0000e+00</span>,</span><br><span class="line">           <span class="number">0.0000e+00</span>,  <span class="number">0.0000e+00</span>],</span><br><span class="line">         [ <span class="number">0.0000e+00</span>,  <span class="number">0.0000e+00</span>,  <span class="number">0.0000e+00</span>,  ...,  <span class="number">0.0000e+00</span>,</span><br><span class="line">           <span class="number">0.0000e+00</span>,  <span class="number">0.0000e+00</span>]]], device=<span class="string">'cuda:0'</span>,</span><br><span class="line">       grad_fn=&lt;NativeDropoutBackward0&gt;)</span><br><span class="line">torch.Size([<span class="number">10</span>, <span class="number">22</span>, <span class="number">200</span>])</span><br><span class="line">object_feat1:</span><br><span class="line"></span><br><span class="line">tensor([[[ <span class="number">0.0969</span>,  <span class="number">0.1156</span>,  <span class="number">0.7336</span>,  ...,  <span class="number">0.3659</span>,  <span class="number">0.8398</span>, -<span class="number">0.0733</span>],</span><br><span class="line">         [ <span class="number">0.0969</span>,  <span class="number">0.1156</span>,  <span class="number">0.7336</span>,  ...,  <span class="number">0.3659</span>,  <span class="number">0.8398</span>, -<span class="number">0.0733</span>],</span><br><span class="line">         [ <span class="number">0.0969</span>,  <span class="number">0.1156</span>,  <span class="number">0.7336</span>,  ...,  <span class="number">0.3659</span>,  <span class="number">0.8398</span>, -<span class="number">0.0733</span>],</span><br><span class="line">         [ <span class="number">0.0969</span>,  <span class="number">0.1156</span>,  <span class="number">0.7336</span>,  ...,  <span class="number">0.3659</span>,  <span class="number">0.8398</span>, -<span class="number">0.0733</span>]]</span><br><span class="line"></span><br><span class="line">        ...,</span><br><span class="line"></span><br><span class="line">        [[ <span class="number">0.3127</span>,  <span class="number">0.2678</span>, -<span class="number">0.1752</span>,  ...,  <span class="number">0.0502</span>,  <span class="number">0.4489</span>,  <span class="number">0.0190</span>],</span><br><span class="line">         [ <span class="number">0.0328</span>,  <span class="number">0.0349</span>,  <span class="number">0.0448</span>,  ...,  <span class="number">0.0234</span>, -<span class="number">0.0258</span>, -<span class="number">0.0344</span>],</span><br><span class="line">         [ <span class="number">0.0328</span>,  <span class="number">0.0349</span>,  <span class="number">0.0448</span>,  ...,  <span class="number">0.0234</span>, -<span class="number">0.0258</span>, -<span class="number">0.0344</span>],</span><br><span class="line">         [ <span class="number">0.0328</span>,  <span class="number">0.0349</span>,  <span class="number">0.0448</span>,  ...,  <span class="number">0.0234</span>, -<span class="number">0.0258</span>, -<span class="number">0.0344</span>]]],</span><br><span class="line">       device=<span class="string">'cuda:0'</span>, grad_fn=&lt;AddBackward0&gt;)</span><br><span class="line">torch.Size([<span class="number">10</span>, <span class="number">4</span>, <span class="number">200</span>])</span><br><span class="line">object_feat2:</span><br><span class="line"></span><br><span class="line">tensor([[[ <span class="number">0.6313</span>,  <span class="number">0.0668</span>,  <span class="number">1.7060</span>,  ...,  <span class="number">0.7507</span>, -<span class="number">1.8600</span>, -<span class="number">0.0626</span>],</span><br><span class="line">         [-<span class="number">0.1332</span>, -<span class="number">0.1341</span>,  <span class="number">1.6088</span>,  ..., -<span class="number">0.1397</span>, -<span class="number">0.1451</span>, -<span class="number">0.1421</span>],</span><br><span class="line">         [ <span class="number">0.2382</span>, -<span class="number">0.0867</span>,  <span class="number">1.9205</span>,  ..., -<span class="number">0.0903</span>, -<span class="number">1.6302</span>, -<span class="number">1.1887</span>],</span><br><span class="line"></span><br><span class="line">         ...,</span><br><span class="line">         [ <span class="number">0.3853</span>, -<span class="number">0.0110</span>, -<span class="number">0.0118</span>,  ...,  <span class="number">1.0296</span>, -<span class="number">1.6793</span>, -<span class="number">0.0116</span>],</span><br><span class="line">         [ <span class="number">0.0198</span>, -<span class="number">0.0935</span>, -<span class="number">0.1009</span>,  ..., -<span class="number">0.0973</span>, -<span class="number">0.1011</span>, -<span class="number">0.0990</span>],</span><br><span class="line">         [-<span class="number">0.0844</span>,  <span class="number">0.0894</span>,  <span class="number">1.4972</span>,  ..., -<span class="number">0.0885</span>, -<span class="number">0.0920</span>, -<span class="number">0.0901</span>]]],</span><br><span class="line">       device=<span class="string">'cuda:0'</span>, grad_fn=&lt;AddBackward0&gt;)</span><br><span class="line">torch.Size([<span class="number">10</span>, <span class="number">22</span>, <span class="number">200</span>])</span><br><span class="line">final_feature:</span><br><span class="line"></span><br><span class="line">tensor([[[ <span class="number">1.8418</span>, -<span class="number">0.1712</span>,  <span class="number">0.9581</span>,  ...,  <span class="number">0.7861</span>, -<span class="number">1.2411</span>,  <span class="number">0.4923</span>],</span><br><span class="line">         [-<span class="number">2.2322</span>,  <span class="number">2.3943</span>,  <span class="number">0.4914</span>,  ..., -<span class="number">1.0388</span>,  <span class="number">0.6236</span>,  <span class="number">0.4107</span>],</span><br><span class="line">         [ <span class="number">0.3094</span>, -<span class="number">0.5312</span>,  <span class="number">1.0190</span>,  ..., -<span class="number">1.4420</span>, -<span class="number">1.4349</span>, -<span class="number">0.6635</span>],</span><br><span class="line">         ...,</span><br><span class="line"></span><br><span class="line">         [ <span class="number">0.6611</span>, -<span class="number">0.3536</span>, -<span class="number">0.6253</span>,  ...,  <span class="number">1.3579</span>, -<span class="number">1.0447</span>,  <span class="number">0.5446</span>],</span><br><span class="line">         [-<span class="number">0.2124</span>, -<span class="number">0.5470</span>, -<span class="number">0.7103</span>,  ..., -<span class="number">0.9521</span>,  <span class="number">0.6715</span>,  <span class="number">0.4549</span>],</span><br><span class="line">         [-<span class="number">0.4616</span>, -<span class="number">0.1183</span>,  <span class="number">0.8152</span>,  ..., -<span class="number">0.9340</span>,  <span class="number">0.6814</span>,  <span class="number">0.4641</span>]]],</span><br><span class="line">       device=<span class="string">'cuda:0'</span>, grad_fn=&lt;CloneBackward0&gt;)</span><br><span class="line">torch.Size([<span class="number">10</span>, <span class="number">22</span>, <span class="number">200</span>])</span><br><span class="line">outputs: </span><br><span class="line"></span><br><span class="line">torch.Size([<span class="number">10</span>, <span class="number">22</span>, <span class="number">12</span>])</span><br><span class="line">tensor([[[-<span class="number">8.9976e-01</span>,  <span class="number">3.3332e+00</span>,  <span class="number">4.5517e-01</span>,  ..., -<span class="number">6.5960e-02</span>,</span><br><span class="line">           <span class="number">5.3608e-01</span>,  <span class="number">3.6342e-01</span>],</span><br><span class="line">         [ <span class="number">8.6288e-01</span>,  <span class="number">6.8532e+00</span>, -<span class="number">1.0493e+00</span>,  ...,  <span class="number">4.0046e-01</span>,</span><br><span class="line">           <span class="number">5.7598e-01</span>,  <span class="number">3.4561e-01</span>],</span><br><span class="line">         [-<span class="number">3.6927e-01</span>,  <span class="number">4.3114e+00</span>, -<span class="number">1.8063e+00</span>,  ..., -<span class="number">1.3175e+00</span>,</span><br><span class="line">          -<span class="number">2.2204e-01</span>,  <span class="number">2.9056e-01</span>],</span><br><span class="line"></span><br><span class="line">         ...,</span><br><span class="line">         [ <span class="number">8.6925e-01</span>,  <span class="number">3.2675e+00</span>,  <span class="number">5.0813e-01</span>,  ..., -<span class="number">9.7195e-01</span>,</span><br><span class="line">           <span class="number">1.8619e-03</span>, -<span class="number">4.3975e-01</span>],</span><br><span class="line">         [ <span class="number">2.0090e-01</span>,  <span class="number">3.2550e+00</span>, -<span class="number">3.0622e-01</span>,  ..., -<span class="number">1.0537e+00</span>,</span><br><span class="line">          -<span class="number">5.0671e-01</span>, -<span class="number">1.6619e-01</span>],</span><br><span class="line">         [ <span class="number">3.9266e-02</span>,  <span class="number">1.8018e+00</span>, -<span class="number">6.3803e-01</span>,  ..., -<span class="number">2.3062e-01</span>,</span><br><span class="line">           <span class="number">3.9648e-01</span>, -<span class="number">5.0846e-01</span>]]], device=<span class="string">'cuda:0'</span>, grad_fn=&lt;AddBackward0&gt;)</span><br></pre></td></tr></tbody></table></figure>
<p>è¿™é‡Œå†è¯´ä¸€ä¸ª<code>crf</code>ï¼Œä»¥å‰ä¹Ÿå°±æ˜¯çŸ¥é“ç»´ç‰¹æ¯”ç®—æ³•ï¼Œç„¶åå…·ä½“<code>crf</code>æ€ä¹ˆå’Œç¥ç»ç½‘ç»œç»“åˆçš„åŸºæœ¬æ²¡äº†è§£è¿‡ï¼Œè¿™é‡Œ</p>
<p>è¿™é‡Œæä¸€ä¸‹æ¨¡å‹çš„ä¹ æƒ¯çš„æ„å»ºæ–¹å¼ï¼š</p>
<p>åœ¨<code>models/__init__py</code>ä¸­ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> model.MUL_LSTM_MCA <span class="keyword">import</span> *</span><br></pre></td></tr></tbody></table></figure>
<p>è¿™æ ·åœ¨ä¸»å‡½æ•°ä¸­å°±å¯ä»¥å†™æˆï¼š</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> models <span class="keyword">import</span> MUL_LSTM_MCA</span><br><span class="line">----------------------------</span><br><span class="line"><span class="keyword">import</span> models</span><br><span class="line">model = models.MUL_LSTM_MCA()</span><br><span class="line">----------------------------</span><br><span class="line"><span class="keyword">import</span> models</span><br><span class="line">model = <span class="built_in">getattr</span>(<span class="string">'models'</span>, <span class="string">'MUL_LSTM_MCA'</span>)()</span><br></pre></td></tr></tbody></table></figure>
<p>æœ€åä¸€ç§å†™æ³•è›®é‡è¦çš„ï¼Œå¯èƒ½ä¹‹å‰éƒ½æ²¡æ¥è§¦è¿‡ï¼Œä½†å´æ˜¯æœ€å¸¸ç”¨çš„ã€‚</p>
<h2 id="æ•°æ®å¤„ç†"><a href="#æ•°æ®å¤„ç†" class="headerlink" title="æ•°æ®å¤„ç†"></a>æ•°æ®å¤„ç†</h2><h3 id="Alphabetæ„å»º"><a href="#Alphabetæ„å»º" class="headerlink" title="Alphabetæ„å»º"></a>Alphabetæ„å»º</h3><p>å…ˆæ”¾å¼ æ•°æ®é›†çš„æ ·å¼ï¼š</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">IMGID:<span class="number">1015799</span></span><br><span class="line">RT	O</span><br><span class="line"><span class="meta">@JayKenMinaj	O</span></span><br><span class="line">_	O</span><br><span class="line">:	O</span><br><span class="line">Me	O</span><br><span class="line">outside	O</span><br><span class="line">of	O</span><br><span class="line">where	O</span><br><span class="line">George	B-PER</span><br><span class="line">Zimmerman	I-PER</span><br><span class="line">got	O</span><br><span class="line">shot	O</span><br><span class="line">at	O</span><br><span class="line">.	O</span><br><span class="line">You	O</span><br><span class="line">know	O</span><br><span class="line">God	O</span><br><span class="line"><span class="keyword">is</span>	O</span><br><span class="line">so	O</span><br><span class="line">good	O</span><br><span class="line">.	O</span><br><span class="line">http://t.co/Z3neVBQ7vF	O</span><br><span class="line"></span><br><span class="line">IMGID:<span class="number">1109405</span></span><br><span class="line">Swan	O</span><br><span class="line">upping	O</span><br><span class="line">:	O</span><br><span class="line">first	O</span><br><span class="line">stop	O</span><br><span class="line">Hermitage	B-LOC</span><br><span class="line">Warf	I-LOC</span><br><span class="line">,	O</span><br><span class="line">Tower	B-LOC</span><br><span class="line">Bridge	I-LOC</span><br><span class="line">(	O</span><br><span class="line">Tower	B-LOC</span><br><span class="line"><span class="keyword">and</span>	O</span><br><span class="line">Olympic	B-OTHER</span><br><span class="line">rings	O</span><br><span class="line"><span class="keyword">in</span>	O</span><br><span class="line">the	O</span><br><span class="line">background	O</span><br><span class="line">)	O</span><br><span class="line">http://t.co/pQdOHx3s	O</span><br><span class="line"></span><br><span class="line">IMGID:<span class="number">563049</span></span><br><span class="line">RT	O</span><br><span class="line"><span class="meta">@redbullESPORTS	O</span></span><br><span class="line">:	O</span><br><span class="line">Smash	B-OTHER</span><br><span class="line">Shiba	I-OTHER</span><br><span class="line"><span class="keyword">is</span>	O</span><br><span class="line">stoked	O</span><br><span class="line"><span class="keyword">for</span>	O</span><br><span class="line"><span class="comment">#NWM7	O</span></span><br><span class="line">Melee	B-OTHER</span><br><span class="line">Grand	I-OTHER</span><br><span class="line">Finals	I-OTHER</span><br><span class="line">.	O</span><br><span class="line">http://t.co/hmTEF9q0gz	O</span><br></pre></td></tr></tbody></table></figure>
<p>ç„¶åæ„å»ºè¯è¡¨ï¼Œè¿™é‡Œæ˜¯åˆ†æˆä¸¤ç§å½¢å¼å»å¤„ç†ï¼Œä½†å®é™…ä¸­æ˜¯<code>CoNLL 2003</code>è¿™ç§ï¼Œæ‰€ä»¥<code>sentence_classification</code>è¿™ç§<code>format</code>å°±ä¸è¯´äº†ã€‚ä¹Ÿæ¯”è¾ƒå®¹æ˜“ç†è§£ï¼Œå…ˆå»åˆ¤æ–­<code>if len(line.strip().split('\t')) &gt;= 2</code>ï¼Œä¹Ÿå°±æ˜¯é€‰å–<code>word label</code>è¿™ç§è¡Œï¼Œç„¶åå†åˆ†å‰²å‡ºè¿™ä¸¤éƒ¨åˆ†ï¼Œåˆ†åˆ«åŠ åˆ°<code>word_alphabet</code>å’Œ<code>label_alphabet</code>ï¼Œæä¸€ä¸‹è¿™é‡Œçš„<code>feature</code>å…¶å®åº”è¯¥æ˜¯<code>sentence_classification</code>çš„é‚£ä¸ª<code>POS</code>è¿™ç§æ ‡è®°ç¬¦ï¼Œè¿™æ–¹ä¾¿å¤„ç†å¯ä»¥ä¸è€ƒè™‘ã€‚</p>
<blockquote>
<p>Alphabetç±»</p>
</blockquote>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">Alphabet maps objects to integer ids. It provides two way mapping from the index to the objects.</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Alphabet</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, label=<span class="literal">False</span>, keep_growing=<span class="literal">True</span></span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.UNKNOWN = <span class="string">"&lt;/unk&gt;"</span></span><br><span class="line">        self.label = label</span><br><span class="line">        self.instance2index = {}</span><br><span class="line">        self.instances = []</span><br><span class="line">        self.keep_growing = keep_growing</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Index 0 is occupied by default, all else following.</span></span><br><span class="line">        self.default_index = <span class="number">0</span></span><br><span class="line">        self.next_index = <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.label:</span><br><span class="line">            self.add(self.UNKNOWN)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">self, instance</span>):</span></span><br><span class="line">        <span class="keyword">if</span> instance <span class="keyword">not</span> <span class="keyword">in</span> self.instance2index:</span><br><span class="line">            self.instances.append(instance)</span><br><span class="line">            self.instance2index[instance] = self.next_index</span><br><span class="line">            self.next_index += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_index</span>(<span class="params">self, instance</span>):</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> self.instance2index[instance]</span><br><span class="line">        <span class="keyword">except</span> KeyError:</span><br><span class="line">            <span class="keyword">if</span> self.keep_growing:</span><br><span class="line">                index = self.next_index</span><br><span class="line">                self.add(instance)</span><br><span class="line">                <span class="keyword">return</span> index</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> self.instance2index[self.UNKNOWN]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_instance</span>(<span class="params">self, index</span>):</span></span><br><span class="line">        <span class="keyword">if</span> index == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">if</span> self.label:</span><br><span class="line">                <span class="keyword">return</span> self.instances[<span class="number">0</span>]</span><br><span class="line">            <span class="comment"># First index is occupied by the wildcard element.</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> self.instances[index - <span class="number">1</span>]</span><br><span class="line">        <span class="keyword">except</span> IndexError:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">'WARNING:Alphabet get_instance ,unknown instance, return the first label.'</span>)</span><br><span class="line">            <span class="keyword">return</span> self.instances[<span class="number">0</span>]</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>dataé‡Œé¢çš„build_alphabetå‡½æ•°</p>
</blockquote>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">build_alphabet</span>(<span class="params">self, input_file</span>):</span></span><br><span class="line">    in_lines = <span class="built_in">open</span>(input_file,<span class="string">'r'</span>, encoding=<span class="string">'utf-8'</span>).readlines()</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> in_lines:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(line.strip().split(<span class="string">'\t'</span>)) &gt;= <span class="number">2</span>:</span><br><span class="line">            <span class="comment">## if sentence classification data format, splited by \t</span></span><br><span class="line">            <span class="keyword">if</span> self.sentence_classification:</span><br><span class="line">                pairs = line.strip().split(self.split_token)</span><br><span class="line">                sent = pairs[<span class="number">0</span>]</span><br><span class="line">                <span class="keyword">if</span> sys.version_info[<span class="number">0</span>] &lt; <span class="number">3</span>:</span><br><span class="line">                    sent = sent.decode(<span class="string">'utf-8'</span>)</span><br><span class="line">                words = sent.split()</span><br><span class="line">                <span class="keyword">for</span> word <span class="keyword">in</span> words:</span><br><span class="line">                    <span class="keyword">if</span> self.number_normalized:</span><br><span class="line">                        word = normalize_word(word)</span><br><span class="line">                    self.word_alphabet.add(word)</span><br><span class="line">                    <span class="keyword">for</span> char <span class="keyword">in</span> word:</span><br><span class="line">                        self.char_alphabet.add(char)</span><br><span class="line">                label = pairs[-<span class="number">1</span>]</span><br><span class="line">                self.label_alphabet.add(label)</span><br><span class="line">                <span class="comment">## build feature alphabet</span></span><br><span class="line">                <span class="keyword">for</span> idx <span class="keyword">in</span> <span class="built_in">range</span>(self.feature_num):</span><br><span class="line">                    feat_idx = pairs[idx+<span class="number">1</span>].split(<span class="string">']'</span>,<span class="number">1</span>)[-<span class="number">1</span>]</span><br><span class="line">                    self.feature_alphabets[idx].add(feat_idx)</span><br><span class="line"></span><br><span class="line">            <span class="comment">## if sequence labeling data format i.e. CoNLL 2003</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                pairs = line.strip().split()</span><br><span class="line">                word = pairs[<span class="number">0</span>]</span><br><span class="line">                <span class="keyword">if</span> sys.version_info[<span class="number">0</span>] &lt; <span class="number">3</span>:</span><br><span class="line">                    word = word.decode(<span class="string">'utf-8'</span>)</span><br><span class="line">                <span class="keyword">if</span> self.number_normalized:</span><br><span class="line">                    word = normalize_word(word)</span><br><span class="line">                label = pairs[-<span class="number">1</span>]</span><br><span class="line">                self.label_alphabet.add(label)</span><br><span class="line">                self.word_alphabet.add(word)</span><br><span class="line">                <span class="comment">## build feature alphabet</span></span><br><span class="line">                <span class="keyword">for</span> idx <span class="keyword">in</span> <span class="built_in">range</span>(self.feature_num):</span><br><span class="line">                    feat_idx = pairs[idx+<span class="number">1</span>].split(<span class="string">']'</span>,<span class="number">1</span>)[-<span class="number">1</span>]</span><br><span class="line">                    self.feature_alphabets[idx].add(feat_idx)</span><br><span class="line">                <span class="keyword">for</span> char <span class="keyword">in</span> word:</span><br><span class="line">                    self.char_alphabet.add(char)</span><br><span class="line">    self.word_alphabet_size = self.word_alphabet.size()</span><br><span class="line">    self.char_alphabet_size = self.char_alphabet.size()</span><br><span class="line">    self.label_alphabet_size = self.label_alphabet.size()</span><br><span class="line">    <span class="keyword">for</span> idx <span class="keyword">in</span> <span class="built_in">range</span>(self.feature_num):</span><br><span class="line">        self.feature_alphabet_sizes[idx] = self.feature_alphabets[idx].size()</span><br><span class="line">    startS = <span class="literal">False</span></span><br><span class="line">    startB = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">for</span> label,_ <span class="keyword">in</span> self.label_alphabet.iteritems():</span><br><span class="line">        <span class="keyword">if</span> <span class="string">"S-"</span> <span class="keyword">in</span> label.upper():</span><br><span class="line">            startS = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">elif</span> <span class="string">"B-"</span> <span class="keyword">in</span> label.upper():</span><br><span class="line">            startB = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">if</span> startB:</span><br><span class="line">        <span class="keyword">if</span> startS:</span><br><span class="line">            self.tagScheme = <span class="string">"BMES"</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.tagScheme = <span class="string">"BIO"</span></span><br><span class="line">    <span class="keyword">if</span> self.sentence_classification:</span><br><span class="line">        self.tagScheme = <span class="string">"Not sequence labeling task"</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="Embeddingæ„å»º"><a href="#Embeddingæ„å»º" class="headerlink" title="Embeddingæ„å»º"></a>Embeddingæ„å»º</h3><p>é¦–å…ˆéœ€è¦è¯´æ˜çš„ä¸€ç‚¹æ˜¯ï¼Œ<code>embedding</code>å’Œ<code>alphabet</code>çš„<code>index</code>ä¸€å®šè¦æ˜¯å¯¹åº”å…³ç³»ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœé€‰æ‹©ç”¨<code>glove embedding</code>ï¼Œå°±è¦æ„å»ºç›¸åº”<code>index</code>çš„<code>dictionary</code>ï¼Œå¦‚æœé€‰ç”¨<code>bert</code>çš„è¯åŒç†ï¼Œç„¶åå†åˆ©ç”¨è®­ç»ƒé›†æ„å»ºçš„è¯è¡¨å’Œè¿™ä¸ª<code>embedding</code>å­—å…¸(<code>bert</code>çš„è¯æœ‰<code>embedding layer</code>ä¸ç”¨è€ƒè™‘)å»æ„å»ºè¾“å…¥çš„è¯å‘é‡ã€‚</p>
<p>åŸæ¨¡å‹é‡‡ç”¨çš„æ˜¯<code>glove200</code>è¯å‘é‡ï¼Œä¹Ÿå°±æ˜¯<code>glove.twitter.27B.200d.txt</code>ï¼Œè¿™ä¸ª<code>embedding</code>çš„å†…å®¹å¦‚ä¸‹ï¼š</p>
<p><img src="https://img-blog.csdnimg.cn/20201125185649508.png" alt="img"></p>
<p>è¯´çš„é€šä¿—æ˜“æ‡‚ä¸€ç‚¹å°±æ˜¯å»ºç«‹ä¸€ä¸ª<code>dictionary</code>ï¼Œ<code>key</code>æ˜¯é¦–ä½çš„å•è¯ï¼Œ<code>value</code>æ˜¯å¯¹åº”çš„è¯å‘é‡ï¼Œæ„å»ºè¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">load_pretrain_emb</span>(<span class="params">embedding_path</span>):</span></span><br><span class="line">    embedd_dim = -<span class="number">1</span></span><br><span class="line">    embedd_dict = <span class="built_in">dict</span>()</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(embedding_path, <span class="string">'r'</span>, encoding=<span class="string">"utf8"</span>) <span class="keyword">as</span> file:</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> file:</span><br><span class="line">            line = line.strip()</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(line) == <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            tokens = line.split()</span><br><span class="line">            <span class="keyword">if</span> embedd_dim &lt; <span class="number">0</span>:</span><br><span class="line">                embedd_dim = <span class="built_in">len</span>(tokens) - <span class="number">1</span></span><br><span class="line">            <span class="keyword">elif</span> embedd_dim + <span class="number">1</span> != <span class="built_in">len</span>(tokens):</span><br><span class="line">                <span class="comment">## ignore illegal embedding line</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">                <span class="comment"># assert (embedd_dim + 1 == len(tokens))</span></span><br><span class="line">            embedd = np.empty([<span class="number">1</span>, embedd_dim])</span><br><span class="line">            embedd[:] = tokens[<span class="number">1</span>:]</span><br><span class="line">            <span class="keyword">if</span> sys.version_info[<span class="number">0</span>] &lt; <span class="number">3</span>:</span><br><span class="line">                first_col = tokens[<span class="number">0</span>].decode(<span class="string">'utf-8'</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                first_col = tokens[<span class="number">0</span>]</span><br><span class="line">            embedd_dict[first_col] = embedd</span><br><span class="line">    <span class="keyword">return</span> embedd_dict, embedd_dim</span><br></pre></td></tr></tbody></table></figure>
<p>ç„¶åæ˜¯å†åˆ©ç”¨è‡ªå·±æ„å»ºçš„è¯è¡¨æ¥åˆ›å»ºè¾“å…¥çš„å‘é‡ï¼Œç®—æ˜¯æ¯”è¾ƒå·§å¦™çš„ä¸€ç§æ–¹æ³•ï¼Œåˆ©ç”¨è‡ªå·±æ„å»ºè¯è¡¨<code>index-&gt;word</code>ï¼Œå€ŸåŠ©<code>embedding</code>å­—å…¸<code>word-&gt;embedding</code>ï¼Œç„¶åç›´æ¥å˜æˆ<code>index-&gt;embedding</code>ï¼Œè¿™ä¹Ÿå’Œ<code>glove</code>æœ¬èº«çš„æ€§è´¨æœ‰å…³ï¼Œä¹Ÿå°±æ˜¯<code>word embedding pair</code>ï¼Œæ¢æˆ<code>bert</code>çš„è¯ï¼Œå°±è¦åˆ©ç”¨å®ƒè‡ªå¸¦çš„è¯è¡¨<code>index</code>ï¼Œä¸ç„¶å’Œé¢„è®­ç»ƒçš„<code>embedding</code>ä¸ä¼šå¯¹åº”ã€‚</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">build_pretrain_embedding</span>(<span class="params">embedding_path, word_alphabet, embedd_dim=<span class="number">100</span>, norm=<span class="literal">True</span></span>):</span></span><br><span class="line">    embedd_dict = <span class="built_in">dict</span>()</span><br><span class="line">    <span class="keyword">if</span> embedding_path != <span class="literal">None</span>:</span><br><span class="line">        embedd_dict, embedd_dim = load_pretrain_emb(embedding_path)</span><br><span class="line">    alphabet_size = word_alphabet.size()</span><br><span class="line">    scale = np.sqrt(<span class="number">3.0</span> / embedd_dim)</span><br><span class="line">    pretrain_emb = np.zeros([word_alphabet.size(), embedd_dim])</span><br><span class="line">    perfect_match = <span class="number">0</span></span><br><span class="line">    case_match = <span class="number">0</span></span><br><span class="line">    not_match = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> word, index <span class="keyword">in</span> word_alphabet.iteritems():</span><br><span class="line">        <span class="keyword">if</span> word <span class="keyword">in</span> embedd_dict:</span><br><span class="line">            <span class="keyword">if</span> norm:</span><br><span class="line">                pretrain_emb[index,:] = norm2one(embedd_dict[word])</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                pretrain_emb[index,:] = embedd_dict[word]</span><br><span class="line">            perfect_match += <span class="number">1</span></span><br><span class="line">        <span class="keyword">elif</span> word.lower() <span class="keyword">in</span> embedd_dict:</span><br><span class="line">            <span class="keyword">if</span> norm:</span><br><span class="line">                pretrain_emb[index,:] = norm2one(embedd_dict[word.lower()])</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                pretrain_emb[index,:] = embedd_dict[word.lower()]</span><br><span class="line">            case_match += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            pretrain_emb[index,:] = np.random.uniform(-scale, scale, [<span class="number">1</span>, embedd_dim])</span><br><span class="line">            not_match += <span class="number">1</span></span><br><span class="line">    pretrained_size = <span class="built_in">len</span>(embedd_dict)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Embedding:\n     pretrain word:%s, prefect match:%s, case_match:%s, oov:%s, oov%%:%s"</span>%(pretrained_size, perfect_match, case_match, not_match, (not_match+<span class="number">0.</span>)/alphabet_size))</span><br><span class="line">    <span class="keyword">return</span> pretrain_emb, embedd_dim</span><br></pre></td></tr></tbody></table></figure>
<h2 id="æ¨¡å‹è®­ç»ƒ-amp-è¯„ä¼°"><a href="#æ¨¡å‹è®­ç»ƒ-amp-è¯„ä¼°" class="headerlink" title="æ¨¡å‹è®­ç»ƒ&amp;è¯„ä¼°"></a>æ¨¡å‹è®­ç»ƒ&amp;è¯„ä¼°</h2><h1 id="æ”¹æ¨¡å‹"><a href="#æ”¹æ¨¡å‹" class="headerlink" title="æ”¹æ¨¡å‹"></a>æ”¹æ¨¡å‹</h1><h3 id="è¯è¡¨å¤„ç†"><a href="#è¯è¡¨å¤„ç†" class="headerlink" title="è¯è¡¨å¤„ç†"></a>è¯è¡¨å¤„ç†</h3><p>é¦–å…ˆå°±æ˜¯å¯¹è¯è¡¨çš„é‡å†™ï¼Œå› ä¸ºæ˜¯è¦ç”¨ä¸åŒçš„<code>embedding</code>ï¼Œç”±äºBERTé¢„è®­ç»ƒæ¨¡å‹ä¸­å·²ç»æœ‰äº†ä¸€ä¸ªç»™å®šçš„è¯è¡¨ï¼ˆ<code>vocab.txt</code>ï¼‰ï¼Œå› æ­¤å¹¶ä¸éœ€è¦æ ¹æ®è‡ªå·±çš„è¯­æ–™æ¥å»ºç«‹ä¸€ä¸ªè¯è¡¨ã€‚å½“ç„¶ï¼Œä¹Ÿä¸èƒ½å¤Ÿæ ¹æ®è‡ªå·±çš„è¯­æ–™æ¥å»ºç«‹è¯è¡¨ï¼Œå› ä¸ºç›¸åŒçš„å­—åœ¨æˆ‘ä»¬è‡ªå·±æ„å»ºçš„è¯è¡¨ä¸­å’Œ<code>vocab.txt</code>ä¸­çš„ç´¢å¼•é¡ºåºè‚¯å®šä¼šä¸ä¸€æ ·ã€‚ç„¶åæ˜¯è¦åˆ©ç”¨è¿™ä¸ªç´¢å¼•ä½œä¸ºè¾“å…¥å–‚åˆ°BERTé‡Œã€‚</p>
<p>å…·ä½“åšæ³•å°±æ˜¯æŠŠ<code>build_alphabet</code>ç»™æ”¹äº†ï¼Œæ”¹åå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">build_label_alphabet</span>(<span class="params">self, input_file</span>):</span></span><br><span class="line">        in_lines = <span class="built_in">open</span>(input_file,<span class="string">'r'</span>, encoding=<span class="string">'utf-8'</span>).readlines()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> in_lines:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(line.strip().split(<span class="string">'\t'</span>)) &gt;= <span class="number">2</span>:</span><br><span class="line">                <span class="comment">## if sentence classification data format, splited by \t</span></span><br><span class="line">                <span class="keyword">if</span> self.sentence_classification:</span><br><span class="line">                    pairs = line.strip().split(self.split_token)</span><br><span class="line">                    sent = pairs[<span class="number">0</span>]</span><br><span class="line">                    <span class="keyword">if</span> sys.version_info[<span class="number">0</span>] &lt; <span class="number">3</span>:</span><br><span class="line">                        sent = sent.decode(<span class="string">'utf-8'</span>)</span><br><span class="line">                    </span><br><span class="line">                    label = pairs[-<span class="number">1</span>]</span><br><span class="line">                    self.label_alphabet.add(label)</span><br><span class="line">                    <span class="comment">## build feature alphabet</span></span><br><span class="line">                    <span class="keyword">for</span> idx <span class="keyword">in</span> <span class="built_in">range</span>(self.feature_num):</span><br><span class="line">                        feat_idx = pairs[idx+<span class="number">1</span>].split(<span class="string">']'</span>,<span class="number">1</span>)[-<span class="number">1</span>]</span><br><span class="line">                        self.feature_alphabets[idx].add(feat_idx)</span><br><span class="line"></span><br><span class="line">                <span class="comment">## if sequence labeling data format i.e. CoNLL 2003</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    pairs = line.strip().split()</span><br><span class="line">                    label = pairs[-<span class="number">1</span>]</span><br><span class="line">                    self.label_alphabet.add(label)</span><br><span class="line">                    <span class="comment">## build feature alphabet</span></span><br><span class="line">                    <span class="keyword">for</span> idx <span class="keyword">in</span> <span class="built_in">range</span>(self.feature_num):</span><br><span class="line">                        feat_idx = pairs[idx+<span class="number">1</span>].split(<span class="string">']'</span>,<span class="number">1</span>)[-<span class="number">1</span>]</span><br><span class="line">                        self.feature_alphabets[idx].add(feat_idx</span><br><span class="line">                    </span><br><span class="line">        self.label_alphabet_size = self.label_alphabet.size()</span><br><span class="line">        <span class="keyword">for</span> idx <span class="keyword">in</span> <span class="built_in">range</span>(self.feature_num):</span><br><span class="line">            self.feature_alphabet_sizes[idx] = self.feature_alphabets[idx].size()</span><br><span class="line">      </span><br><span class="line">        startS = <span class="literal">False</span></span><br><span class="line">        startB = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">for</span> label,_ <span class="keyword">in</span> self.label_alphabet.iteritems():</span><br><span class="line">            <span class="keyword">if</span> <span class="string">"S-"</span> <span class="keyword">in</span> label.upper():</span><br><span class="line">                startS = <span class="literal">True</span></span><br><span class="line">            <span class="keyword">elif</span> <span class="string">"B-"</span> <span class="keyword">in</span> label.upper():</span><br><span class="line">                startB = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">if</span> startB:</span><br><span class="line">            <span class="keyword">if</span> startS:</span><br><span class="line">                self.tagScheme = <span class="string">"BMES"</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                self.tagScheme = <span class="string">"BIO"</span></span><br><span class="line">        <span class="keyword">if</span> self.sentence_classification:</span><br><span class="line">            self.tagScheme = <span class="string">"Not sequence labeling task"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ”¹åŠ¨çš„åœ°æ–¹åœ¨è¿™é‡Œ</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">build_word_alphabet</span>(<span class="params">self, input_file</span>):</span></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(input_file, <span class="string">'r'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> f:</span><br><span class="line">            <span class="keyword">for</span> i, word <span class="keyword">in</span> <span class="built_in">enumerate</span>(f):</span><br><span class="line">                w = word.strip(<span class="string">'\n'</span>)</span><br><span class="line">                self.word_alphabet.add(w)            </span><br><span class="line">        self.word_alphabet_size = self.word_alphabet.size()</span><br></pre></td></tr></tbody></table></figure>
<p>å…¶å®å°±æ˜¯åŠ äº†ä¸ª<code>bulid_word_alphabet</code>ï¼Œå¯¹BERTçš„<code>vocab.txt</code>å»å¤„ç†ï¼Œè¿™é‡Œç”¨äº†è‡ªå·±å†™çš„<code>Alphabet</code>ç±»ï¼Œæ˜¯æŒºæ–¹ä¾¿çš„ã€‚ç„¶åå†æŠŠæœ‰å…³<code>char</code>çš„éƒ¨åˆ†å…¨åˆ æ‰ï¼Œè¿˜æœ‰åŸæœ¬<code>word embedding</code>çš„æ„å»ºã€‚</p>
<h3 id="æ¨¡å‹æ›´æ¢"><a href="#æ¨¡å‹æ›´æ¢" class="headerlink" title="æ¨¡å‹æ›´æ¢"></a>æ¨¡å‹æ›´æ¢</h3><p>å¤§è‡´åˆ†ä¸ºä¸¤å—ï¼Œç¬¬ä¸€æ˜¯ä¸åŠ <code>object_feature</code>ç›´æ¥æŠŠ<code>char-Bilstm</code>æ¢æˆ<code>bert</code>ï¼Œç¬¬äºŒå°±æ˜¯å†åœ¨è¿™ä¸ªåŸºç¡€ä¸Šï¼Œå»åŠ ä¸Š<code>visual</code>çš„ä¿¡æ¯ï¼Œåšä¸€ä¸ªå¤šæ¨¡æ€çš„<code>NER</code>ã€‚</p>
<blockquote>
<p>å…¶å®ä¹Ÿæ˜¯å› ä¸ºä¿ºä¹‹å‰æ²¡ç”¨è¿‡<code>bert</code>ï¼Œç„¶åè¿™ç¬¬ä¸€æ¬¡ç”¨å°±å¡äº†æŒºå¤šbugçš„ï¼Œæ‰€ä»¥å‡†å¤‡æŠŠæ”¹æ¨¡å‹çš„å·¥ä½œåˆ’åˆ†æˆé˜¶æ®µæ€§ï¼Œå‡å°‘é”™è¯¯çš„è€¦åˆã€‚</p>
</blockquote>
<h4 id="æ›¿æ¢ä¸ºBert"><a href="#æ›¿æ¢ä¸ºBert" class="headerlink" title="æ›¿æ¢ä¸ºBert"></a>æ›¿æ¢ä¸ºBert</h4><p>æ¨¡å‹æ”¹ä¸ºä»¥ä¸‹ï¼š</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BERT_CRF</span>(<span class="params">nn.Module</span>):</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    bert + crf</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, data</span>):</span></span><br><span class="line">        <span class="built_in">super</span>(BERT_CRF, self).__init__()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">'build BERT_CRF network...'</span>)</span><br><span class="line">        self.gpu = data.HP_gpu</span><br><span class="line">        self.average_batch = data.average_batch_loss</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># å¯èƒ½ä¼šåŠ ä¸Š self.dropbert = nn.Dropout(data.HP_dropout)  # word seq bert out -&gt; dropout</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># topic_embed_dim to the dim as text hidden dim</span></span><br><span class="line">        self.txt_feat_linear = nn.Linear(<span class="number">768</span>, <span class="number">200</span>)</span><br><span class="line"></span><br><span class="line">        self.hidden2tag = nn.Linear(self.mca_params[<span class="string">'HIDDEN_SIZE'</span>], data.label_alphabet_size + <span class="number">2</span>)</span><br><span class="line">        <span class="comment"># crf</span></span><br><span class="line">        self.crf = CRF(data.label_alphabet_size, self.gpu)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Bert</span></span><br><span class="line">        self.bert_config = BertConfig.from_json_file(<span class="string">"model/config.json"</span>)</span><br><span class="line">        self.bert = BertModel(self.bert_config)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_get_lstm_features</span>(<span class="params">self, word_inputs, feature_inputs, word_seq_lengths</span>):</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">         word_input -&gt; bert -&gt; dropout -&gt; Linear -&gt; tagscores</span></span><br><span class="line"><span class="string">        :param word_inputs: (batch_size, sent_len)</span></span><br><span class="line"><span class="string">        :param feature_inputs:  [(batch_size, sent_len), ...] list of variables</span></span><br><span class="line"><span class="string">        :param word_seq_lengths: list of batch_size, (batch_size, 1)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">            variable(batch_size,sent_len, hidden_dim)</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        batch_size = word_inputs.size(<span class="number">0</span>)</span><br><span class="line">        sent_len = word_inputs.size(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Bert</span></span><br><span class="line">        device = torch.device(<span class="string">'cuda:0'</span>)</span><br><span class="line">        </span><br><span class="line">        tmp = torch.tensor(word_inputs, device=device)</span><br><span class="line">        tmp = tmp.long()</span><br><span class="line"></span><br><span class="line">        a = torch.load(<span class="string">"./model/pytorch_model.bin"</span>)</span><br><span class="line">        model_dict = self.bert.state_dict()</span><br><span class="line">        pretrained_dict = {k:v <span class="keyword">for</span> k,v <span class="keyword">in</span> a.items() <span class="keyword">if</span> k <span class="keyword">in</span> model_dict}</span><br><span class="line">        model_dict.update(pretrained_dict)</span><br><span class="line">        self.bert.load_state_dict(model_dict)</span><br><span class="line">        </span><br><span class="line">        text_feat = self.txt_feat_linear(self.bert(tmp).last_hidden_state)</span><br><span class="line">   </span><br><span class="line">        <span class="comment"># -&gt; tagscore</span></span><br><span class="line">        outputs = self.hidden2tag(text_feat)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> outputs</span><br></pre></td></tr></tbody></table></figure>
<p>è®­ç»ƒå‡ºçš„ç»“æœï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h4 id="åŠ å…¥å¤šæ¨¡æ€ä¿¡æ¯"><a href="#åŠ å…¥å¤šæ¨¡æ€ä¿¡æ¯" class="headerlink" title="åŠ å…¥å¤šæ¨¡æ€ä¿¡æ¯"></a>åŠ å…¥å¤šæ¨¡æ€ä¿¡æ¯</h4><p>è¿™ä¸ªè¦è€ƒè™‘çš„ç‚¹åº”è¯¥è¿˜æ˜¯æœ‰äº›çš„ï¼Œæ¯”å¦‚<code>object_feature</code>çš„<code>embedding</code>é€‰å–ï¼Œè¿™ä¸ªæ˜¯å¦èƒ½ç›´æ¥ä¹Ÿå’Œ<code>bert</code>çš„<code>embedding</code>é€‰å–ä¸€æ ·è¿˜æ˜¯è¦ç ”ç©¶ä¸€ä¸‹çš„ï¼Œå¤§è‡´çš„æ€è·¯å…ˆè®¾æˆ<code>concat</code>ä»¥åå†å»<code>get fusion feature</code>ã€‚</p>
<h2 id="é‡åˆ°çš„bug"><a href="#é‡åˆ°çš„bug" class="headerlink" title="é‡åˆ°çš„bug"></a>é‡åˆ°çš„bug</h2><h3 id="colabæ‰“å¼€æ–‡ä»¶"><a href="#colabæ‰“å¼€æ–‡ä»¶" class="headerlink" title="colabæ‰“å¼€æ–‡ä»¶"></a>colabæ‰“å¼€æ–‡ä»¶</h3><p><strong>è§£å†³æ–¹æ³•</strong>ï¼šç”¨<code>!cd</code>ä¸è¡Œçš„æ—¶å€™è¯•è¯•<code>%cd</code></p>
<h3 id="Torch-Tensoræ”¾åœ¨GPUä¸Š"><a href="#Torch-Tensoræ”¾åœ¨GPUä¸Š" class="headerlink" title="Torch Tensoræ”¾åœ¨GPUä¸Š"></a>Torch Tensoræ”¾åœ¨GPUä¸Š</h3><p>è¿™ä¸ªæ¯”è¾ƒæ€ªï¼Œæœ‰å‡ ç§æ ¼å¼æ˜¯ä¸è¡Œçš„ï¼Œéœ€è¦æ³¨æ„ä¸€ä¸‹</p>
<h3 id="æ¢¯åº¦NAN"><a href="#æ¢¯åº¦NAN" class="headerlink" title="æ¢¯åº¦NAN"></a>æ¢¯åº¦NAN</h3><p>è¿™ä¸ªå¯èƒ½æ˜¯å­¦ä¹ å¾‹æ²¡è°ƒå¥½ï¼Œå¯ä»¥å‚è€ƒä¸€äº›èµ„æ–™ï¼Œ<code>bert</code>çš„è¯è®¾ç½®æˆ<code>1e-5 or 3e-5</code>éƒ½æ˜¯å¯ä»¥çš„ã€‚ä¹Ÿå°±æ˜¯</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">optimizer = torch.optim.Adam(model.parameters(), lr=<span class="number">5e-5</span>)</span><br></pre></td></tr></tbody></table></figure>
<h3 id="pï¼Œrï¼Œfçš„å€¼é—®é¢˜"><a href="#pï¼Œrï¼Œfçš„å€¼é—®é¢˜" class="headerlink" title="pï¼Œrï¼Œfçš„å€¼é—®é¢˜"></a>pï¼Œrï¼Œfçš„å€¼é—®é¢˜</h3><h3 id="indexè¶Šç•Œ"><a href="#indexè¶Šç•Œ" class="headerlink" title="indexè¶Šç•Œ"></a>indexè¶Šç•Œ</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"main.py"</span>, line <span class="number">569</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    train(data)</span><br><span class="line">  File <span class="string">"main.py"</span>, line <span class="number">481</span>, <span class="keyword">in</span> train</span><br><span class="line">    speed, acc, p, r, f, _,_ = evaluate(data, model, <span class="string">"test"</span>)</span><br><span class="line">  File <span class="string">"main.py"</span>, line <span class="number">171</span>, <span class="keyword">in</span> evaluate</span><br><span class="line">    tag_seq = model(batch_word, batch_features, batch_wordlen, batch_char, batch_charlen, batch_charrecover, mask, batch_obj, obj_mask)</span><br><span class="line">  File <span class="string">"/usr/local/lib/python3.7/dist-packages/torch/nn/modules/module.py"</span>, line <span class="number">1110</span>, <span class="keyword">in</span> _call_impl</span><br><span class="line">    <span class="keyword">return</span> forward_call(*<span class="built_in">input</span>, **kwargs)</span><br><span class="line">  File <span class="string">"/content/drive/MyDrive/Pytorch-implementation-for-OCSGA/model/MUL_LSTM_MCA.py"</span>, line <span class="number">223</span>, <span class="keyword">in</span> forward</span><br><span class="line">    char_seq_recover, object_inputs, object_mask)</span><br><span class="line">  File <span class="string">"/content/drive/MyDrive/Pytorch-implementation-for-OCSGA/model/MUL_LSTM_MCA.py"</span>, line <span class="number">126</span>, <span class="keyword">in</span> _get_lstm_features</span><br><span class="line">    text_feat = self.txt_feat_linear(self.bert(tmp).last_hidden_state)</span><br><span class="line">  File <span class="string">"/usr/local/lib/python3.7/dist-packages/torch/nn/modules/module.py"</span>, line <span class="number">1110</span>, <span class="keyword">in</span> _call_impl</span><br><span class="line">    <span class="keyword">return</span> forward_call(*<span class="built_in">input</span>, **kwargs)</span><br><span class="line">  File <span class="string">"/usr/local/lib/python3.7/dist-packages/transformers/models/bert/modeling_bert.py"</span>, line <span class="number">1027</span>, <span class="keyword">in</span> forward</span><br><span class="line">    return_dict=return_dict,</span><br><span class="line">  File <span class="string">"/usr/local/lib/python3.7/dist-packages/torch/nn/modules/module.py"</span>, line <span class="number">1110</span>, <span class="keyword">in</span> _call_impl</span><br><span class="line">    <span class="keyword">return</span> forward_call(*<span class="built_in">input</span>, **kwargs)</span><br><span class="line">  File <span class="string">"/usr/local/lib/python3.7/dist-packages/transformers/models/bert/modeling_bert.py"</span>, line <span class="number">613</span>, <span class="keyword">in</span> forward</span><br><span class="line">    output_attentions,</span><br><span class="line">  File <span class="string">"/usr/local/lib/python3.7/dist-packages/torch/nn/modules/module.py"</span>, line <span class="number">1110</span>, <span class="keyword">in</span> _call_impl</span><br><span class="line">    <span class="keyword">return</span> forward_call(*<span class="built_in">input</span>, **kwargs)</span><br><span class="line">  File <span class="string">"/usr/local/lib/python3.7/dist-packages/transformers/models/bert/modeling_bert.py"</span>, line <span class="number">498</span>, <span class="keyword">in</span> forward</span><br><span class="line">    past_key_value=self_attn_past_key_value,</span><br><span class="line">  File <span class="string">"/usr/local/lib/python3.7/dist-packages/torch/nn/modules/module.py"</span>, line <span class="number">1110</span>, <span class="keyword">in</span> _call_impl</span><br><span class="line">    <span class="keyword">return</span> forward_call(*<span class="built_in">input</span>, **kwargs)</span><br><span class="line">  File <span class="string">"/usr/local/lib/python3.7/dist-packages/transformers/models/bert/modeling_bert.py"</span>, line <span class="number">430</span>, <span class="keyword">in</span> forward</span><br><span class="line">    output_attentions,</span><br><span class="line">  File <span class="string">"/usr/local/lib/python3.7/dist-packages/torch/nn/modules/module.py"</span>, line <span class="number">1110</span>, <span class="keyword">in</span> _call_impl</span><br><span class="line">    <span class="keyword">return</span> forward_call(*<span class="built_in">input</span>, **kwargs)</span><br><span class="line">  File <span class="string">"/usr/local/lib/python3.7/dist-packages/transformers/models/bert/modeling_bert.py"</span>, line <span class="number">311</span>, <span class="keyword">in</span> forward</span><br><span class="line">    key_layer = self.transpose_for_scores(self.key(hidden_states))</span><br><span class="line">  File <span class="string">"/usr/local/lib/python3.7/dist-packages/torch/nn/modules/module.py"</span>, line <span class="number">1110</span>, <span class="keyword">in</span> _call_impl</span><br><span class="line">    <span class="keyword">return</span> forward_call(*<span class="built_in">input</span>, **kwargs)</span><br><span class="line">  File <span class="string">"/usr/local/lib/python3.7/dist-packages/torch/nn/modules/linear.py"</span>, line <span class="number">103</span>, <span class="keyword">in</span> forward</span><br><span class="line">    <span class="keyword">return</span> F.linear(<span class="built_in">input</span>, self.weight, self.bias)</span><br><span class="line">RuntimeError: CUDA error: CUBLAS_STATUS_EXECUTION_FAILED when calling `cublasSgemm( handle, opa, opb, m, n, k, &amp;alpha, a, lda, b, ldb, &amp;beta, c, ldc)`</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"main.py"</span>, line <span class="number">569</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    train(data)</span><br><span class="line">  File <span class="string">"main.py"</span>, line <span class="number">481</span>, <span class="keyword">in</span> train</span><br><span class="line">    speed, acc, p, r, f, _,_ = evaluate(data, model, <span class="string">"test"</span>)</span><br><span class="line">  File <span class="string">"main.py"</span>, line <span class="number">171</span>, <span class="keyword">in</span> evaluate</span><br><span class="line">    tag_seq = model(batch_word, batch_features, batch_wordlen, batch_char, batch_charlen, batch_charrecover, mask, batch_obj, obj_mask)</span><br><span class="line">  File <span class="string">"/usr/local/lib/python3.7/dist-packages/torch/nn/modules/module.py"</span>, line <span class="number">1110</span>, <span class="keyword">in</span> _call_impl</span><br><span class="line">    <span class="keyword">return</span> forward_call(*<span class="built_in">input</span>, **kwargs)</span><br><span class="line">  File <span class="string">"/content/drive/MyDrive/Pytorch-implementation-for-OCSGA/model/MUL_LSTM_MCA.py"</span>, line <span class="number">228</span>, <span class="keyword">in</span> forward</span><br><span class="line">    outs = self._get_lstm_features(word_inputs, feature_inputs, word_seq_lengths, char_inputs, char_seq_lengths, char_seq_recover, object_inputs, object_mask)</span><br><span class="line">  File <span class="string">"/content/drive/MyDrive/Pytorch-implementation-for-OCSGA/model/MUL_LSTM_MCA.py"</span>, line <span class="number">126</span>, <span class="keyword">in</span> _get_lstm_features</span><br><span class="line">    text_feat = self.txt_feat_linear(self.bert(tmp).last_hidden_state)</span><br><span class="line">  File <span class="string">"/usr/local/lib/python3.7/dist-packages/torch/nn/modules/module.py"</span>, line <span class="number">1110</span>, <span class="keyword">in</span> _call_impl</span><br><span class="line">    <span class="keyword">return</span> forward_call(*<span class="built_in">input</span>, **kwargs)</span><br><span class="line">  File <span class="string">"/usr/local/lib/python3.7/dist-packages/transformers/models/bert/modeling_bert.py"</span>, line <span class="number">1027</span>, <span class="keyword">in</span> forward</span><br><span class="line">    return_dict=return_dict,</span><br><span class="line">  File <span class="string">"/usr/local/lib/python3.7/dist-packages/torch/nn/modules/module.py"</span>, line <span class="number">1110</span>, <span class="keyword">in</span> _call_impl</span><br><span class="line">    <span class="keyword">return</span> forward_call(*<span class="built_in">input</span>, **kwargs)</span><br><span class="line">  File <span class="string">"/usr/local/lib/python3.7/dist-packages/transformers/models/bert/modeling_bert.py"</span>, line <span class="number">613</span>, <span class="keyword">in</span> forward</span><br><span class="line">    output_attentions,</span><br><span class="line">  File <span class="string">"/usr/local/lib/python3.7/dist-packages/torch/nn/modules/module.py"</span>, line <span class="number">1110</span>, <span class="keyword">in</span> _call_impl</span><br><span class="line">    <span class="keyword">return</span> forward_call(*<span class="built_in">input</span>, **kwargs)</span><br><span class="line">  File <span class="string">"/usr/local/lib/python3.7/dist-packages/transformers/models/bert/modeling_bert.py"</span>, line <span class="number">498</span>, <span class="keyword">in</span> forward</span><br><span class="line">    past_key_value=self_attn_past_key_value,</span><br><span class="line">  File <span class="string">"/usr/local/lib/python3.7/dist-packages/torch/nn/modules/module.py"</span>, line <span class="number">1110</span>, <span class="keyword">in</span> _call_impl</span><br><span class="line">    <span class="keyword">return</span> forward_call(*<span class="built_in">input</span>, **kwargs)</span><br><span class="line">  File <span class="string">"/usr/local/lib/python3.7/dist-packages/transformers/models/bert/modeling_bert.py"</span>, line <span class="number">430</span>, <span class="keyword">in</span> forward</span><br><span class="line">    output_attentions,</span><br><span class="line">  File <span class="string">"/usr/local/lib/python3.7/dist-packages/torch/nn/modules/module.py"</span>, line <span class="number">1110</span>, <span class="keyword">in</span> _call_impl</span><br><span class="line">    <span class="keyword">return</span> forward_call(*<span class="built_in">input</span>, **kwargs)</span><br><span class="line">  File <span class="string">"/usr/local/lib/python3.7/dist-packages/transformers/models/bert/modeling_bert.py"</span>, line <span class="number">327</span>, <span class="keyword">in</span> forward</span><br><span class="line">    attention_scores = torch.matmul(query_layer, key_layer.transpose(-<span class="number">1</span>, -<span class="number">2</span>))</span><br></pre></td></tr></tbody></table></figure>
<p><img src="C:\Users\19772\AppData\Roaming\Typora\typora-user-images\image-20220530210749779.png" alt="image-20220530210749779" style="zoom:80%;"></p>
<blockquote>
<p>é­”æ”¹çš„</p>
</blockquote>
<p><img src="C:\Users\19772\AppData\Roaming\Typora\typora-user-images\image-20220530160217433.png" alt="image-20220530160217433" style="zoom:80%;"></p>
<blockquote>
<p>åŸæœ¬çš„</p>
</blockquote>
<p><img src="C:\Users\19772\AppData\Roaming\Typora\typora-user-images\image-20220530160241049.png" alt="image-20220530160241049" style="zoom:80%;"></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br></pre></td><td class="code"><pre><span class="line"> Instance: <span class="number">500</span>; Time: <span class="number">29.92</span>s; loss: <span class="number">6224.8363</span>; acc: <span class="number">6789.0</span>/<span class="number">8107.0</span>=<span class="number">0.8374</span></span><br><span class="line">     Instance: <span class="number">1000</span>; Time: <span class="number">29.99</span>s; loss: <span class="number">5640.4688</span>; acc: <span class="number">13734.0</span>/<span class="number">16267.0</span>=<span class="number">0.8443</span></span><br><span class="line">     Instance: <span class="number">1500</span>; Time: <span class="number">30.06</span>s; loss: <span class="number">5577.4117</span>; acc: <span class="number">20677.0</span>/<span class="number">24446.0</span>=<span class="number">0.8458</span></span><br><span class="line">     Instance: <span class="number">2000</span>; Time: <span class="number">29.85</span>s; loss: <span class="number">5180.2707</span>; acc: <span class="number">27422.0</span>/<span class="number">32427.0</span>=<span class="number">0.8457</span></span><br><span class="line">     Instance: <span class="number">2500</span>; Time: <span class="number">29.97</span>s; loss: <span class="number">4930.7428</span>; acc: <span class="number">34204.0</span>/<span class="number">40443.0</span>=<span class="number">0.8457</span></span><br><span class="line">     Instance: <span class="number">3000</span>; Time: <span class="number">29.82</span>s; loss: <span class="number">4884.8773</span>; acc: <span class="number">41094.0</span>/<span class="number">48582.0</span>=<span class="number">0.8459</span></span><br><span class="line">     Instance: <span class="number">3500</span>; Time: <span class="number">29.62</span>s; loss: <span class="number">4726.5694</span>; acc: <span class="number">47666.0</span>/<span class="number">56365.0</span>=<span class="number">0.8457</span></span><br><span class="line">     Instance: <span class="number">4000</span>; Time: <span class="number">30.20</span>s; loss: <span class="number">4570.1031</span>; acc: <span class="number">54525.0</span>/<span class="number">64439.0</span>=<span class="number">0.8461</span></span><br><span class="line">     Instance: <span class="number">4000</span>; Time: <span class="number">0.07</span>s; loss: <span class="number">0.0000</span>; acc: <span class="number">54525.0</span>/<span class="number">64439.0</span>=<span class="number">0.8461</span></span><br><span class="line">Epoch: <span class="number">0</span> training finished. Time: <span class="number">239.50</span>s, speed: <span class="number">16.70</span>st/s,  total loss: <span class="number">41735.280044555664</span></span><br><span class="line">totalloss: <span class="number">41735.280044555664</span></span><br><span class="line">Entity <span class="built_in">type</span>:  PER p =  <span class="number">0.11956521739130435</span>  r =  <span class="number">0.03985507246376811</span>  f =  <span class="number">0.059782608695652176</span></span><br><span class="line">Entity <span class="built_in">type</span>:  LOC p =  <span class="number">0.3253012048192771</span>  r =  <span class="number">0.05172413793103448</span>  f =  <span class="number">0.08925619834710743</span></span><br><span class="line">wtf</span><br><span class="line">Entity <span class="built_in">type</span>:  ORG p =  -<span class="number">1</span>  r =  <span class="number">0.0</span>  f =  -<span class="number">1</span></span><br><span class="line">wtf</span><br><span class="line">Entity <span class="built_in">type</span>:  OTHER p =  -<span class="number">1</span>  r =  <span class="number">0.0</span>  f =  -<span class="number">1</span></span><br><span class="line">Entity <span class="built_in">type</span>:  <span class="built_in">all</span> p =  <span class="number">0.18352059925093633</span>  r =  <span class="number">0.03169469598965071</span>  f =  <span class="number">0.05405405405405405</span></span><br><span class="line">Dev: time: <span class="number">50.80</span>s, speed: <span class="number">19.69</span>st/s; acc: <span class="number">0.8515</span>, p: <span class="number">0.1835</span>, r: <span class="number">0.0317</span>, f: <span class="number">0.0541</span></span><br><span class="line">Entity <span class="built_in">type</span>:  PER p =  <span class="number">0.12232415902140673</span>  r =  <span class="number">0.04405286343612335</span>  f =  <span class="number">0.06477732793522267</span></span><br><span class="line">Entity <span class="built_in">type</span>:  LOC p =  <span class="number">0.34274193548387094</span>  r =  <span class="number">0.05008839127872716</span>  f =  <span class="number">0.08740359897172235</span></span><br><span class="line">wtf</span><br><span class="line">Entity <span class="built_in">type</span>:  ORG p =  -<span class="number">1</span>  r =  <span class="number">0.0</span>  f =  -<span class="number">1</span></span><br><span class="line">wtf</span><br><span class="line">Entity <span class="built_in">type</span>:  OTHER p =  -<span class="number">1</span>  r =  <span class="number">0.0</span>  f =  -<span class="number">1</span></span><br><span class="line">Entity <span class="built_in">type</span>:  <span class="built_in">all</span> p =  <span class="number">0.18292682926829268</span>  r =  <span class="number">0.03249310752264671</span>  f =  <span class="number">0.05518394648829431</span></span><br><span class="line">Test: time: <span class="number">165.88</span>s, speed: <span class="number">19.64</span>st/s; acc: <span class="number">0.8518</span>, p: <span class="number">0.1829</span>, r: <span class="number">0.0325</span>, f: <span class="number">0.0552</span></span><br><span class="line">Epoch: <span class="number">1</span>/<span class="number">200</span></span><br><span class="line">Shuffle: first <span class="built_in">input</span> word <span class="built_in">list</span>: [<span class="number">1</span>, <span class="number">1</span>, <span class="number">133</span>, <span class="number">121</span>, <span class="number">1</span>, <span class="number">1112</span>, <span class="number">1</span>, <span class="number">1149</span>, <span class="number">2400</span>, <span class="number">1116</span>, <span class="number">7929</span>, <span class="number">121</span>, <span class="number">5147</span>, <span class="number">133</span>, <span class="number">1</span>, <span class="number">1</span>]</span><br><span class="line">     Instance: <span class="number">500</span>; Time: <span class="number">30.08</span>s; loss: <span class="number">4179.5079</span>; acc: <span class="number">6848.0</span>/<span class="number">7980.0</span>=<span class="number">0.8581</span></span><br><span class="line">     Instance: <span class="number">1000</span>; Time: <span class="number">29.93</span>s; loss: <span class="number">4184.3597</span>; acc: <span class="number">13848.0</span>/<span class="number">16093.0</span>=<span class="number">0.8605</span></span><br><span class="line">     Instance: <span class="number">1500</span>; Time: <span class="number">29.98</span>s; loss: <span class="number">4185.1390</span>; acc: <span class="number">20787.0</span>/<span class="number">24141.0</span>=<span class="number">0.8611</span></span><br><span class="line">     Instance: <span class="number">2000</span>; Time: <span class="number">30.00</span>s; loss: <span class="number">3859.3701</span>; acc: <span class="number">27901.0</span>/<span class="number">32301.0</span>=<span class="number">0.8638</span></span><br><span class="line">     Instance: <span class="number">2500</span>; Time: <span class="number">30.01</span>s; loss: <span class="number">4108.8776</span>; acc: <span class="number">34887.0</span>/<span class="number">40407.0</span>=<span class="number">0.8634</span></span><br><span class="line">     Instance: <span class="number">3000</span>; Time: <span class="number">30.20</span>s; loss: <span class="number">3883.9744</span>; acc: <span class="number">41922.0</span>/<span class="number">48493.0</span>=<span class="number">0.8645</span></span><br><span class="line">     Instance: <span class="number">3500</span>; Time: <span class="number">29.88</span>s; loss: <span class="number">3978.1959</span>; acc: <span class="number">48742.0</span>/<span class="number">56396.0</span>=<span class="number">0.8643</span></span><br><span class="line">     Instance: <span class="number">4000</span>; Time: <span class="number">30.11</span>s; loss: <span class="number">3717.6046</span>; acc: <span class="number">55778.0</span>/<span class="number">64439.0</span>=<span class="number">0.8656</span></span><br><span class="line">     Instance: <span class="number">4000</span>; Time: <span class="number">0.07</span>s; loss: <span class="number">0.0000</span>; acc: <span class="number">55778.0</span>/<span class="number">64439.0</span>=<span class="number">0.8656</span></span><br><span class="line">Epoch: <span class="number">1</span> training finished. Time: <span class="number">240.27</span>s, speed: <span class="number">16.65</span>st/s,  total loss: <span class="number">32097.029235839844</span></span><br><span class="line">totalloss: <span class="number">32097.029235839844</span></span><br><span class="line">Entity <span class="built_in">type</span>:  PER p =  <span class="number">0.2731182795698925</span>  r =  <span class="number">0.23007246376811594</span>  f =  <span class="number">0.2497541789577188</span></span><br><span class="line">Entity <span class="built_in">type</span>:  LOC p =  <span class="number">0.47761194029850745</span>  r =  <span class="number">0.24521072796934865</span>  f =  <span class="number">0.3240506329113924</span></span><br><span class="line">wtf</span><br><span class="line">Entity <span class="built_in">type</span>:  ORG p =  -<span class="number">1</span>  r =  <span class="number">0.0</span>  f =  -<span class="number">1</span></span><br><span class="line">wtf</span><br><span class="line">Entity <span class="built_in">type</span>:  OTHER p =  -<span class="number">1</span>  r =  <span class="number">0.0</span>  f =  -<span class="number">1</span></span><br><span class="line">Entity <span class="built_in">type</span>:  <span class="built_in">all</span> p =  <span class="number">0.3478854024556617</span>  r =  <span class="number">0.1649417852522639</span>  f =  <span class="number">0.22378236068451077</span></span><br><span class="line">Dev: time: <span class="number">50.73</span>s, speed: <span class="number">19.72</span>st/s; acc: <span class="number">0.8702</span>, p: <span class="number">0.3479</span>, r: <span class="number">0.1649</span>, f: <span class="number">0.2238</span></span><br><span class="line">Entity <span class="built_in">type</span>:  PER p =  <span class="number">0.2697768762677485</span>  r =  <span class="number">0.21971365638766518</span>  f =  <span class="number">0.24218512898330805</span></span><br><span class="line">Entity <span class="built_in">type</span>:  LOC p =  <span class="number">0.447576099210823</span>  r =  <span class="number">0.2339422510312316</span>  f =  <span class="number">0.30727554179566563</span></span><br><span class="line">wtf</span><br><span class="line">Entity <span class="built_in">type</span>:  ORG p =  -<span class="number">1</span>  r =  <span class="number">0.0</span>  f =  -<span class="number">1</span></span><br><span class="line">wtf</span><br><span class="line">Entity <span class="built_in">type</span>:  OTHER p =  -<span class="number">1</span>  r =  <span class="number">0.0</span>  f =  -<span class="number">1</span></span><br><span class="line">Entity <span class="built_in">type</span>:  <span class="built_in">all</span> p =  <span class="number">0.3364327979712595</span>  r =  <span class="number">0.15675462780622293</span>  f =  <span class="number">0.2138635142396561</span></span><br><span class="line">Test: time: <span class="number">165.75</span>s, speed: <span class="number">19.65</span>st/s; acc: <span class="number">0.8708</span>, p: <span class="number">0.3364</span>, r: <span class="number">0.1568</span>, f: <span class="number">0.2139</span></span><br><span class="line">Epoch: <span class="number">2</span>/<span class="number">200</span></span><br><span class="line">Shuffle: first <span class="built_in">input</span> word <span class="built_in">list</span>: [<span class="number">1</span>, <span class="number">1</span>, <span class="number">133</span>, <span class="number">1</span>, <span class="number">1109</span>, <span class="number">1</span>, <span class="number">119</span>, <span class="number">1</span>, <span class="number">114</span>, <span class="number">190</span>, <span class="number">7788</span>, <span class="number">5516</span>, <span class="number">1112</span>, <span class="number">1143</span>, <span class="number">1106</span>, <span class="number">1105</span>, <span class="number">7903</span>, <span class="number">119</span>, <span class="number">2028</span>, <span class="number">119</span>, <span class="number">1107</span>, <span class="number">2441</span>, <span class="number">11139</span>, <span class="number">1</span>, <span class="number">5958</span>, <span class="number">1</span>]</span><br><span class="line">     Instance: <span class="number">500</span>; Time: <span class="number">29.97</span>s; loss: <span class="number">3311.9038</span>; acc: <span class="number">7337.0</span>/<span class="number">8262.0</span>=<span class="number">0.8880</span></span><br><span class="line">     Instance: <span class="number">1000</span>; Time: <span class="number">30.22</span>s; loss: <span class="number">3342.9267</span>; acc: <span class="number">14481.0</span>/<span class="number">16321.0</span>=<span class="number">0.8873</span></span><br><span class="line">     Instance: <span class="number">1500</span>; Time: <span class="number">30.18</span>s; loss: <span class="number">3425.1955</span>; acc: <span class="number">21577.0</span>/<span class="number">24354.0</span>=<span class="number">0.8860</span></span><br><span class="line">     Instance: <span class="number">2000</span>; Time: <span class="number">30.13</span>s; loss: <span class="number">3388.8539</span>; acc: <span class="number">28886.0</span>/<span class="number">32620.0</span>=<span class="number">0.8855</span></span><br><span class="line">     Instance: <span class="number">2500</span>; Time: <span class="number">30.00</span>s; loss: <span class="number">3328.5253</span>; acc: <span class="number">35740.0</span>/<span class="number">40412.0</span>=<span class="number">0.8844</span></span><br><span class="line">     Instance: <span class="number">3000</span>; Time: <span class="number">30.22</span>s; loss: <span class="number">3432.1716</span>; acc: <span class="number">42810.0</span>/<span class="number">48451.0</span>=<span class="number">0.8836</span></span><br><span class="line">     Instance: <span class="number">3500</span>; Time: <span class="number">30.21</span>s; loss: <span class="number">3013.6499</span>; acc: <span class="number">49927.0</span>/<span class="number">56399.0</span>=<span class="number">0.8852</span></span><br><span class="line">     Instance: <span class="number">4000</span>; Time: <span class="number">30.24</span>s; loss: <span class="number">2982.0695</span>; acc: <span class="number">57131.0</span>/<span class="number">64439.0</span>=<span class="number">0.8866</span></span><br><span class="line">     Instance: <span class="number">4000</span>; Time: <span class="number">0.08</span>s; loss: <span class="number">0.0000</span>; acc: <span class="number">57131.0</span>/<span class="number">64439.0</span>=<span class="number">0.8866</span></span><br><span class="line">Epoch: <span class="number">2</span> training finished. Time: <span class="number">241.25</span>s, speed: <span class="number">16.58</span>st/s,  total loss: <span class="number">26225.296325683594</span></span><br><span class="line">totalloss: <span class="number">26225.296325683594</span></span><br><span class="line">Entity <span class="built_in">type</span>:  PER p =  <span class="number">0.46021505376344085</span>  r =  <span class="number">0.38768115942028986</span>  f =  <span class="number">0.4208456243854474</span></span><br><span class="line">Entity <span class="built_in">type</span>:  LOC p =  <span class="number">0.4669260700389105</span>  r =  <span class="number">0.45977011494252873</span>  f =  <span class="number">0.46332046332046334</span></span><br><span class="line">Entity <span class="built_in">type</span>:  ORG p =  <span class="number">0.16666666666666666</span>  r =  <span class="number">0.004048582995951417</span>  f =  <span class="number">0.007905138339920948</span></span><br><span class="line">wtf</span><br><span class="line">Entity <span class="built_in">type</span>:  OTHER p =  -<span class="number">1</span>  r =  <span class="number">0.0</span>  f =  -<span class="number">1</span></span><br><span class="line">Entity <span class="built_in">type</span>:  <span class="built_in">all</span> p =  <span class="number">0.4619289340101523</span>  r =  <span class="number">0.2943078913324709</span>  f =  <span class="number">0.35954168312919793</span></span><br><span class="line">Dev: time: <span class="number">50.72</span>s, speed: <span class="number">19.72</span>st/s; acc: <span class="number">0.8764</span>, p: <span class="number">0.4619</span>, r: <span class="number">0.2943</span>, f: <span class="number">0.3595</span></span><br><span class="line">Entity <span class="built_in">type</span>:  PER p =  <span class="number">0.44724618447246184</span>  r =  <span class="number">0.3711453744493392</span>  f =  <span class="number">0.40565753836894375</span></span><br><span class="line">Entity <span class="built_in">type</span>:  LOC p =  <span class="number">0.43609022556390975</span>  r =  <span class="number">0.44431349440188567</span>  f =  <span class="number">0.4401634559252772</span></span><br><span class="line">Entity <span class="built_in">type</span>:  ORG p =  <span class="number">0.21739130434782608</span>  r =  <span class="number">0.0059594755661501785</span>  f =  <span class="number">0.01160092807424594</span></span><br><span class="line">wtf</span><br><span class="line">Entity <span class="built_in">type</span>:  OTHER p =  -<span class="number">1</span>  r =  <span class="number">0.0</span>  f =  -<span class="number">1</span></span><br><span class="line">Entity <span class="built_in">type</span>:  <span class="built_in">all</span> p =  <span class="number">0.4397054311138386</span>  r =  <span class="number">0.2821977156360772</span>  f =  <span class="number">0.3437687417536284</span></span><br><span class="line">Test: time: <span class="number">165.15</span>s, speed: <span class="number">19.73</span>st/s; acc: <span class="number">0.8777</span>, p: <span class="number">0.4397</span>, r: <span class="number">0.2822</span>, f: <span class="number">0.3438</span></span><br><span class="line">Epoch: <span class="number">3</span>/<span class="number">200</span></span><br><span class="line">Shuffle: first <span class="built_in">input</span> word <span class="built_in">list</span>: [<span class="number">1602</span>, <span class="number">1849</span>, <span class="number">1</span>, <span class="number">121</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>]</span><br><span class="line">     Instance: <span class="number">500</span>; Time: <span class="number">29.66</span>s; loss: <span class="number">2696.1159</span>; acc: <span class="number">7368.0</span>/<span class="number">8154.0</span>=<span class="number">0.9036</span></span><br><span class="line">     Instance: <span class="number">1000</span>; Time: <span class="number">30.17</span>s; loss: <span class="number">2547.8644</span>; acc: <span class="number">14478.0</span>/<span class="number">16012.0</span>=<span class="number">0.9042</span></span><br><span class="line">     Instance: <span class="number">1500</span>; Time: <span class="number">29.95</span>s; loss: <span class="number">2727.7022</span>; acc: <span class="number">21884.0</span>/<span class="number">24188.0</span>=<span class="number">0.9047</span></span><br><span class="line">     Instance: <span class="number">2000</span>; Time: <span class="number">30.02</span>s; loss: <span class="number">2734.7935</span>; acc: <span class="number">29039.0</span>/<span class="number">32132.0</span>=<span class="number">0.9037</span></span><br><span class="line">     Instance: <span class="number">2500</span>; Time: <span class="number">30.01</span>s; loss: <span class="number">2712.7075</span>; acc: <span class="number">36427.0</span>/<span class="number">40289.0</span>=<span class="number">0.9041</span></span><br><span class="line">     Instance: <span class="number">3000</span>; Time: <span class="number">30.08</span>s; loss: <span class="number">2471.1267</span>; acc: <span class="number">43841.0</span>/<span class="number">48392.0</span>=<span class="number">0.9060</span></span><br><span class="line">     Instance: <span class="number">3500</span>; Time: <span class="number">29.43</span>s; loss: <span class="number">2693.7697</span>; acc: <span class="number">50954.0</span>/<span class="number">56295.0</span>=<span class="number">0.9051</span></span><br><span class="line">     Instance: <span class="number">4000</span>; Time: <span class="number">29.56</span>s; loss: <span class="number">2809.3583</span>; acc: <span class="number">58287.0</span>/<span class="number">64439.0</span>=<span class="number">0.9045</span></span><br><span class="line">     Instance: <span class="number">4000</span>; Time: <span class="number">0.07</span>s; loss: <span class="number">0.0000</span>; acc: <span class="number">58287.0</span>/<span class="number">64439.0</span>=<span class="number">0.9045</span></span><br><span class="line">Epoch: <span class="number">3</span> training finished. Time: <span class="number">238.96</span>s, speed: <span class="number">16.74</span>st/s,  total loss: <span class="number">21393.43817138672</span></span><br><span class="line">totalloss: <span class="number">21393.43817138672</span></span><br><span class="line">Entity <span class="built_in">type</span>:  PER p =  <span class="number">0.6137566137566137</span>  r =  <span class="number">0.42028985507246375</span>  f =  <span class="number">0.49892473118279573</span></span><br><span class="line">Entity <span class="built_in">type</span>:  LOC p =  <span class="number">0.5245901639344263</span>  r =  <span class="number">0.5517241379310345</span>  f =  <span class="number">0.5378151260504203</span></span><br><span class="line">Entity <span class="built_in">type</span>:  ORG p =  <span class="number">0.32075471698113206</span>  r =  <span class="number">0.06882591093117409</span>  f =  <span class="number">0.11333333333333333</span></span><br><span class="line">Entity <span class="built_in">type</span>:  OTHER p =  <span class="number">0.08</span>  r =  <span class="number">0.035555555555555556</span>  f =  <span class="number">0.04923076923076924</span></span><br><span class="line">Entity <span class="built_in">type</span>:  <span class="built_in">all</span> p =  <span class="number">0.5046296296296297</span>  r =  <span class="number">0.352522639068564</span>  f =  <span class="number">0.4150799695354151</span></span><br><span class="line">Dev: time: <span class="number">50.44</span>s, speed: <span class="number">19.83</span>st/s; acc: <span class="number">0.8870</span>, p: <span class="number">0.5046</span>, r: <span class="number">0.3525</span>, f: <span class="number">0.4151</span></span><br><span class="line">Entity <span class="built_in">type</span>:  PER p =  <span class="number">0.5982070089649552</span>  r =  <span class="number">0.4041850220264317</span>  f =  <span class="number">0.48241866579033854</span></span><br><span class="line">Entity <span class="built_in">type</span>:  LOC p =  <span class="number">0.5132450331125827</span>  r =  <span class="number">0.5480259281084267</span>  f =  <span class="number">0.5300655457395269</span></span><br><span class="line">Entity <span class="built_in">type</span>:  ORG p =  <span class="number">0.34911242603550297</span>  r =  <span class="number">0.07032181168057211</span>  f =  <span class="number">0.11706349206349206</span></span><br><span class="line">Entity <span class="built_in">type</span>:  OTHER p =  <span class="number">0.11217948717948718</span>  r =  <span class="number">0.048209366391184574</span>  f =  <span class="number">0.0674373795761079</span></span><br><span class="line">Entity <span class="built_in">type</span>:  <span class="built_in">all</span> p =  <span class="number">0.4994318181818182</span>  r =  <span class="number">0.3461992910594722</span>  f =  <span class="number">0.4089323098394976</span></span><br><span class="line">Test: time: <span class="number">164.48</span>s, speed: <span class="number">19.81</span>st/s; acc: <span class="number">0.8869</span>, p: <span class="number">0.4994</span>, r: <span class="number">0.3462</span>, f: <span class="number">0.4089</span></span><br><span class="line">Epoch: <span class="number">4</span>/<span class="number">200</span></span><br><span class="line">Shuffle: first <span class="built_in">input</span> word <span class="built_in">list</span>: [<span class="number">1264</span>, <span class="number">1105</span>, <span class="number">1316</span>, <span class="number">5326</span>, <span class="number">121</span>, <span class="number">121</span>, <span class="number">121</span>, <span class="number">121</span>, <span class="number">148</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">121</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">121</span>, <span class="number">1</span>]</span><br><span class="line">     Instance: <span class="number">500</span>; Time: <span class="number">29.43</span>s; loss: <span class="number">2212.3702</span>; acc: <span class="number">7353.0</span>/<span class="number">8015.0</span>=<span class="number">0.9174</span></span><br><span class="line">     Instance: <span class="number">1000</span>; Time: <span class="number">29.43</span>s; loss: <span class="number">2362.8129</span>; acc: <span class="number">14884.0</span>/<span class="number">16243.0</span>=<span class="number">0.9163</span></span><br><span class="line">     Instance: <span class="number">1500</span>; Time: <span class="number">29.57</span>s; loss: <span class="number">2218.0854</span>; acc: <span class="number">22168.0</span>/<span class="number">24176.0</span>=<span class="number">0.9169</span></span><br><span class="line">     Instance: <span class="number">2000</span>; Time: <span class="number">29.96</span>s; loss: <span class="number">2308.8332</span>; acc: <span class="number">29746.0</span>/<span class="number">32437.0</span>=<span class="number">0.9170</span></span><br><span class="line">     Instance: <span class="number">2500</span>; Time: <span class="number">29.28</span>s; loss: <span class="number">2341.3982</span>; acc: <span class="number">36869.0</span>/<span class="number">40240.0</span>=<span class="number">0.9162</span></span><br><span class="line">     Instance: <span class="number">3000</span>; Time: <span class="number">29.79</span>s; loss: <span class="number">2233.2528</span>; acc: <span class="number">44244.0</span>/<span class="number">48289.0</span>=<span class="number">0.9162</span></span><br><span class="line">     Instance: <span class="number">3500</span>; Time: <span class="number">29.96</span>s; loss: <span class="number">2494.9616</span>; acc: <span class="number">51573.0</span>/<span class="number">56342.0</span>=<span class="number">0.9154</span></span><br><span class="line">     Instance: <span class="number">4000</span>; Time: <span class="number">29.54</span>s; loss: <span class="number">2236.9029</span>; acc: <span class="number">59003.0</span>/<span class="number">64439.0</span>=<span class="number">0.9156</span></span><br><span class="line">     Instance: <span class="number">4000</span>; Time: <span class="number">0.09</span>s; loss: <span class="number">0.0000</span>; acc: <span class="number">59003.0</span>/<span class="number">64439.0</span>=<span class="number">0.9156</span></span><br><span class="line">Epoch: <span class="number">4</span> training finished. Time: <span class="number">237.04</span>s, speed: <span class="number">16.87</span>st/s,  total loss: <span class="number">18408.6171875</span></span><br><span class="line">totalloss: <span class="number">18408.6171875</span></span><br><span class="line">Entity <span class="built_in">type</span>:  PER p =  <span class="number">0.5726315789473684</span>  r =  <span class="number">0.4927536231884058</span>  f =  <span class="number">0.5296981499513146</span></span><br><span class="line">Entity <span class="built_in">type</span>:  LOC p =  <span class="number">0.584051724137931</span>  r =  <span class="number">0.5191570881226054</span>  f =  <span class="number">0.5496957403651116</span></span><br><span class="line">Entity <span class="built_in">type</span>:  ORG p =  <span class="number">0.36</span>  r =  <span class="number">0.03643724696356275</span>  f =  <span class="number">0.06617647058823528</span></span><br><span class="line">Entity <span class="built_in">type</span>:  OTHER p =  <span class="number">0.09146341463414634</span>  r =  <span class="number">0.06666666666666667</span>  f =  <span class="number">0.07712082262210797</span></span><br><span class="line">Entity <span class="built_in">type</span>:  <span class="built_in">all</span> p =  <span class="number">0.5026595744680851</span>  r =  <span class="number">0.3667529107373868</span>  f =  <span class="number">0.42408376963350786</span></span><br><span class="line">Dev: time: <span class="number">50.52</span>s, speed: <span class="number">19.80</span>st/s; acc: <span class="number">0.8804</span>, p: <span class="number">0.5027</span>, r: <span class="number">0.3668</span>, f: <span class="number">0.4241</span></span><br><span class="line">Entity <span class="built_in">type</span>:  PER p =  <span class="number">0.5453431372549019</span>  r =  <span class="number">0.4900881057268722</span>  f =  <span class="number">0.5162412993039442</span></span><br><span class="line">Entity <span class="built_in">type</span>:  LOC p =  <span class="number">0.5600259571706684</span>  r =  <span class="number">0.5085444902769594</span>  f =  <span class="number">0.5330450895614577</span></span><br><span class="line">Entity <span class="built_in">type</span>:  ORG p =  <span class="number">0.5492957746478874</span>  r =  <span class="number">0.04648390941597139</span>  f =  <span class="number">0.08571428571428572</span></span><br><span class="line">Entity <span class="built_in">type</span>:  OTHER p =  <span class="number">0.0935374149659864</span>  r =  <span class="number">0.07575757575757576</span>  f =  <span class="number">0.0837138508371385</span></span><br><span class="line">Entity <span class="built_in">type</span>:  <span class="built_in">all</span> p =  <span class="number">0.4819937369519833</span>  r =  <span class="number">0.3637258763292635</span>  f =  <span class="number">0.41459034792368127</span></span><br><span class="line">Test: time: <span class="number">164.83</span>s, speed: <span class="number">19.77</span>st/s; acc: <span class="number">0.8775</span>, p: <span class="number">0.4820</span>, r: <span class="number">0.3637</span>, f: <span class="number">0.4146</span></span><br><span class="line">Epoch: <span class="number">5</span>/<span class="number">200</span></span><br><span class="line">Shuffle: first <span class="built_in">input</span> word <span class="built_in">list</span>: [<span class="number">1</span>, <span class="number">1</span>, <span class="number">133</span>, <span class="number">140</span>, <span class="number">1537</span>, <span class="number">4631</span>, <span class="number">1230</span>, <span class="number">1106</span>, <span class="number">172</span>, <span class="number">1</span>, <span class="number">5923</span>, <span class="number">1109</span>, <span class="number">1458</span>, <span class="number">2940</span>, <span class="number">119</span>, <span class="number">1</span>, <span class="number">121</span>, <span class="number">1</span>]</span><br><span class="line">     Instance: <span class="number">500</span>; Time: <span class="number">29.30</span>s; loss: <span class="number">1824.8473</span>; acc: <span class="number">7457.0</span>/<span class="number">8003.0</span>=<span class="number">0.9318</span></span><br><span class="line">     Instance: <span class="number">1000</span>; Time: <span class="number">30.07</span>s; loss: <span class="number">2056.0085</span>; acc: <span class="number">14755.0</span>/<span class="number">15914.0</span>=<span class="number">0.9272</span></span><br><span class="line">     Instance: <span class="number">1500</span>; Time: <span class="number">29.97</span>s; loss: <span class="number">1930.8370</span>; acc: <span class="number">22446.0</span>/<span class="number">24182.0</span>=<span class="number">0.9282</span></span><br><span class="line">     Instance: <span class="number">2000</span>; Time: <span class="number">30.00</span>s; loss: <span class="number">2026.1705</span>; acc: <span class="number">29789.0</span>/<span class="number">32146.0</span>=<span class="number">0.9267</span></span><br><span class="line">     Instance: <span class="number">2500</span>; Time: <span class="number">29.75</span>s; loss: <span class="number">2002.5941</span>; acc: <span class="number">37151.0</span>/<span class="number">40114.0</span>=<span class="number">0.9261</span></span><br><span class="line">     Instance: <span class="number">3000</span>; Time: <span class="number">29.68</span>s; loss: <span class="number">2018.5771</span>; acc: <span class="number">44663.0</span>/<span class="number">48232.0</span>=<span class="number">0.9260</span></span><br><span class="line">     Instance: <span class="number">3500</span>; Time: <span class="number">29.70</span>s; loss: <span class="number">2104.7914</span>; acc: <span class="number">52080.0</span>/<span class="number">56308.0</span>=<span class="number">0.9249</span></span><br><span class="line">     Instance: <span class="number">4000</span>; Time: <span class="number">29.60</span>s; loss: <span class="number">2147.0644</span>; acc: <span class="number">59582.0</span>/<span class="number">64439.0</span>=<span class="number">0.9246</span></span><br><span class="line">     Instance: <span class="number">4000</span>; Time: <span class="number">0.07</span>s; loss: <span class="number">0.0000</span>; acc: <span class="number">59582.0</span>/<span class="number">64439.0</span>=<span class="number">0.9246</span></span><br><span class="line">Epoch: <span class="number">5</span> training finished. Time: <span class="number">238.13</span>s, speed: <span class="number">16.80</span>st/s,  total loss: <span class="number">16110.890441894531</span></span><br><span class="line">totalloss: <span class="number">16110.890441894531</span></span><br><span class="line">Entity <span class="built_in">type</span>:  PER p =  <span class="number">0.5178571428571429</span>  r =  <span class="number">0.5253623188405797</span>  f =  <span class="number">0.5215827338129496</span></span><br><span class="line">Entity <span class="built_in">type</span>:  LOC p =  <span class="number">0.6054852320675106</span>  r =  <span class="number">0.5498084291187739</span>  f =  <span class="number">0.5763052208835342</span></span><br><span class="line">Entity <span class="built_in">type</span>:  ORG p =  <span class="number">0.28421052631578947</span>  r =  <span class="number">0.10931174089068826</span>  f =  <span class="number">0.15789473684210525</span></span><br><span class="line">Entity <span class="built_in">type</span>:  OTHER p =  <span class="number">0.29411764705882354</span>  r =  <span class="number">0.022222222222222223</span>  f =  <span class="number">0.04132231404958678</span></span><br><span class="line">Entity <span class="built_in">type</span>:  <span class="built_in">all</span> p =  <span class="number">0.5314136125654451</span>  r =  <span class="number">0.39391979301423025</span>  f =  <span class="number">0.45245170876671614</span></span><br><span class="line">Dev: time: <span class="number">51.22</span>s, speed: <span class="number">19.53</span>st/s; acc: <span class="number">0.8914</span>, p: <span class="number">0.5314</span>, r: <span class="number">0.3939</span>, f: <span class="number">0.4525</span></span><br><span class="line">Entity <span class="built_in">type</span>:  PER p =  <span class="number">0.5205245153933865</span>  r =  <span class="number">0.5027533039647577</span>  f =  <span class="number">0.511484593837535</span></span><br><span class="line">Entity <span class="built_in">type</span>:  LOC p =  <span class="number">0.5654911838790933</span>  r =  <span class="number">0.5291691219799647</span>  f =  <span class="number">0.5467275494672755</span></span><br><span class="line">Entity <span class="built_in">type</span>:  ORG p =  <span class="number">0.3230240549828179</span>  r =  <span class="number">0.11203814064362336</span>  f =  <span class="number">0.1663716814159292</span></span><br><span class="line">Entity <span class="built_in">type</span>:  OTHER p =  <span class="number">0.30158730158730157</span>  r =  <span class="number">0.026170798898071626</span>  f =  <span class="number">0.04816223067173638</span></span><br><span class="line">Entity <span class="built_in">type</span>:  <span class="built_in">all</span> p =  <span class="number">0.5205627705627706</span>  r =  <span class="number">0.37888932650649865</span>  f =  <span class="number">0.4385684978345111</span></span><br><span class="line">Test: time: <span class="number">164.99</span>s, speed: <span class="number">19.75</span>st/s; acc: <span class="number">0.8887</span>, p: <span class="number">0.5206</span>, r: <span class="number">0.3789</span>, f: <span class="number">0.4386</span></span><br><span class="line">Epoch: <span class="number">6</span>/<span class="number">200</span></span><br><span class="line">Shuffle: first <span class="built_in">input</span> word <span class="built_in">list</span>: [<span class="number">1</span>, <span class="number">7417</span>, <span class="number">2880</span>, <span class="number">9586</span>, <span class="number">1</span>, <span class="number">115</span>, <span class="number">1</span>, <span class="number">116</span>, <span class="number">1109</span>, <span class="number">2640</span>, <span class="number">1982</span>, <span class="number">1109</span>, <span class="number">1</span>, <span class="number">174</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>]</span><br><span class="line">     Instance: <span class="number">500</span>; Time: <span class="number">29.42</span>s; loss: <span class="number">1728.3121</span>; acc: <span class="number">7439.0</span>/<span class="number">7960.0</span>=<span class="number">0.9345</span></span><br><span class="line">     Instance: <span class="number">1000</span>; Time: <span class="number">30.19</span>s; loss: <span class="number">1747.8356</span>; acc: <span class="number">15118.0</span>/<span class="number">16147.0</span>=<span class="number">0.9363</span></span><br><span class="line">     Instance: <span class="number">1500</span>; Time: <span class="number">29.77</span>s; loss: <span class="number">1657.2482</span>; acc: <span class="number">22549.0</span>/<span class="number">24109.0</span>=<span class="number">0.9353</span></span><br><span class="line">     Instance: <span class="number">2000</span>; Time: <span class="number">29.80</span>s; loss: <span class="number">1813.7075</span>; acc: <span class="number">30174.0</span>/<span class="number">32274.0</span>=<span class="number">0.9349</span></span><br><span class="line">     Instance: <span class="number">2500</span>; Time: <span class="number">29.78</span>s; loss: <span class="number">1750.3120</span>; acc: <span class="number">37684.0</span>/<span class="number">40312.0</span>=<span class="number">0.9348</span></span><br><span class="line">     Instance: <span class="number">3000</span>; Time: <span class="number">29.41</span>s; loss: <span class="number">1975.9543</span>; acc: <span class="number">45055.0</span>/<span class="number">48271.0</span>=<span class="number">0.9334</span></span><br><span class="line">     Instance: <span class="number">3500</span>; Time: <span class="number">30.79</span>s; loss: <span class="number">1725.3759</span>; acc: <span class="number">52680.0</span>/<span class="number">56434.0</span>=<span class="number">0.9335</span></span><br><span class="line">     Instance: <span class="number">4000</span>; Time: <span class="number">30.13</span>s; loss: <span class="number">1712.6002</span>; acc: <span class="number">60162.0</span>/<span class="number">64439.0</span>=<span class="number">0.9336</span></span><br><span class="line">     Instance: <span class="number">4000</span>; Time: <span class="number">0.07</span>s; loss: <span class="number">0.0000</span>; acc: <span class="number">60162.0</span>/<span class="number">64439.0</span>=<span class="number">0.9336</span></span><br><span class="line">Epoch: <span class="number">6</span> training finished. Time: <span class="number">239.37</span>s, speed: <span class="number">16.71</span>st/s,  total loss: <span class="number">14111.345703125</span></span><br><span class="line">totalloss: <span class="number">14111.345703125</span></span><br><span class="line">Entity <span class="built_in">type</span>:  PER p =  <span class="number">0.5122377622377622</span>  r =  <span class="number">0.5307971014492754</span>  f =  <span class="number">0.5213523131672598</span></span><br><span class="line">Entity <span class="built_in">type</span>:  LOC p =  <span class="number">0.5176908752327747</span>  r =  <span class="number">0.5325670498084292</span>  f =  <span class="number">0.5250236071765817</span></span><br><span class="line">Entity <span class="built_in">type</span>:  ORG p =  <span class="number">0.35185185185185186</span>  r =  <span class="number">0.07692307692307693</span>  f =  <span class="number">0.12624584717607976</span></span><br><span class="line">Entity <span class="built_in">type</span>:  OTHER p =  <span class="number">0.11659192825112108</span>  r =  <span class="number">0.11555555555555555</span>  f =  <span class="number">0.11607142857142858</span></span><br><span class="line">Entity <span class="built_in">type</span>:  <span class="built_in">all</span> p =  <span class="number">0.4444444444444444</span>  r =  <span class="number">0.3984476067270375</span>  f =  <span class="number">0.4201909959072305</span></span><br><span class="line">Dev: time: <span class="number">50.53</span>s, speed: <span class="number">19.80</span>st/s; acc: <span class="number">0.8800</span>, p: <span class="number">0.4444</span>, r: <span class="number">0.3984</span>, f: <span class="number">0.4202</span></span><br><span class="line">Entity <span class="built_in">type</span>:  PER p =  <span class="number">0.4991606043648573</span>  r =  <span class="number">0.4911894273127753</span>  f =  <span class="number">0.49514293644185403</span></span><br><span class="line">Entity <span class="built_in">type</span>:  LOC p =  <span class="number">0.4955849889624724</span>  r =  <span class="number">0.5291691219799647</span>  f =  <span class="number">0.5118267312624679</span></span><br><span class="line">Entity <span class="built_in">type</span>:  ORG p =  <span class="number">0.3791208791208791</span>  r =  <span class="number">0.08224076281287247</span>  f =  <span class="number">0.13516160626836438</span></span><br><span class="line">Entity <span class="built_in">type</span>:  OTHER p =  <span class="number">0.09798270893371758</span>  r =  <span class="number">0.09366391184573003</span>  f =  <span class="number">0.09577464788732395</span></span><br><span class="line">Entity <span class="built_in">type</span>:  <span class="built_in">all</span> p =  <span class="number">0.4306145251396648</span>  r =  <span class="number">0.37948011027963763</span>  f =  <span class="number">0.4034334763948498</span></span><br><span class="line">Test: time: <span class="number">164.59</span>s, speed: <span class="number">19.80</span>st/s; acc: <span class="number">0.8790</span>, p: <span class="number">0.4306</span>, r: <span class="number">0.3795</span>, f: <span class="number">0.4034</span></span><br><span class="line">Epoch: <span class="number">7</span>/<span class="number">200</span></span><br><span class="line">Shuffle: first <span class="built_in">input</span> word <span class="built_in">list</span>: [<span class="number">1</span>, <span class="number">1</span>, <span class="number">133</span>, <span class="number">109</span>, <span class="number">9077</span>, <span class="number">119</span>, <span class="number">3615</span>, <span class="number">108</span>, <span class="number">6684</span>, <span class="number">1105</span>, <span class="number">1612</span>, <span class="number">108</span>, <span class="number">109</span>, <span class="number">1</span>]</span><br><span class="line">     Instance: <span class="number">500</span>; Time: <span class="number">30.10</span>s; loss: <span class="number">1531.2178</span>; acc: <span class="number">7702.0</span>/<span class="number">8163.0</span>=<span class="number">0.9435</span></span><br><span class="line">     Instance: <span class="number">1000</span>; Time: <span class="number">29.94</span>s; loss: <span class="number">1519.8469</span>; acc: <span class="number">15414.0</span>/<span class="number">16332.0</span>=<span class="number">0.9438</span></span><br><span class="line">     Instance: <span class="number">1500</span>; Time: <span class="number">30.18</span>s; loss: <span class="number">1541.0876</span>; acc: <span class="number">22886.0</span>/<span class="number">24269.0</span>=<span class="number">0.9430</span></span><br><span class="line">     Instance: <span class="number">2000</span>; Time: <span class="number">29.79</span>s; loss: <span class="number">1594.9370</span>; acc: <span class="number">30502.0</span>/<span class="number">32359.0</span>=<span class="number">0.9426</span></span><br><span class="line">     Instance: <span class="number">2500</span>; Time: <span class="number">29.82</span>s; loss: <span class="number">1654.7367</span>; acc: <span class="number">38071.0</span>/<span class="number">40438.0</span>=<span class="number">0.9415</span></span><br><span class="line">     Instance: <span class="number">3000</span>; Time: <span class="number">29.97</span>s; loss: <span class="number">1588.9686</span>; acc: <span class="number">45639.0</span>/<span class="number">48488.0</span>=<span class="number">0.9412</span></span><br><span class="line">     Instance: <span class="number">3500</span>; Time: <span class="number">29.77</span>s; loss: <span class="number">1655.1161</span>; acc: <span class="number">53080.0</span>/<span class="number">56447.0</span>=<span class="number">0.9404</span></span><br><span class="line">     Instance: <span class="number">4000</span>; Time: <span class="number">29.77</span>s; loss: <span class="number">1571.8391</span>; acc: <span class="number">60594.0</span>/<span class="number">64439.0</span>=<span class="number">0.9403</span></span><br><span class="line">     Instance: <span class="number">4000</span>; Time: <span class="number">0.08</span>s; loss: <span class="number">0.0000</span>; acc: <span class="number">60594.0</span>/<span class="number">64439.0</span>=<span class="number">0.9403</span></span><br><span class="line">Epoch: <span class="number">7</span> training finished. Time: <span class="number">239.43</span>s, speed: <span class="number">16.71</span>st/s,  total loss: <span class="number">12657.749816894531</span></span><br><span class="line">totalloss: <span class="number">12657.749816894531</span></span><br><span class="line">Entity <span class="built_in">type</span>:  PER p =  <span class="number">0.6181384248210023</span>  r =  <span class="number">0.4692028985507246</span>  f =  <span class="number">0.5334706488156539</span></span><br><span class="line">Entity <span class="built_in">type</span>:  LOC p =  <span class="number">0.6013513513513513</span>  r =  <span class="number">0.5114942528735632</span>  f =  <span class="number">0.5527950310559006</span></span><br><span class="line">Entity <span class="built_in">type</span>:  ORG p =  <span class="number">0.29310344827586204</span>  r =  <span class="number">0.13765182186234817</span>  f =  <span class="number">0.18732782369146</span></span><br><span class="line">Entity <span class="built_in">type</span>:  OTHER p =  <span class="number">0.22535211267605634</span>  r =  <span class="number">0.07111111111111111</span>  f =  <span class="number">0.10810810810810811</span></span><br><span class="line">Entity <span class="built_in">type</span>:  <span class="built_in">all</span> p =  <span class="number">0.5485714285714286</span>  r =  <span class="number">0.37257438551099614</span>  f =  <span class="number">0.44375963020030823</span></span><br><span class="line">Dev: time: <span class="number">50.60</span>s, speed: <span class="number">19.77</span>st/s; acc: <span class="number">0.8915</span>, p: <span class="number">0.5486</span>, r: <span class="number">0.3726</span>, f: <span class="number">0.4438</span></span><br><span class="line">Entity <span class="built_in">type</span>:  PER p =  <span class="number">0.6101573676680973</span>  r =  <span class="number">0.4697136563876652</span>  f =  <span class="number">0.5308027380211574</span></span><br><span class="line">Entity <span class="built_in">type</span>:  LOC p =  <span class="number">0.607192254495159</span>  r =  <span class="number">0.5173836181496759</span>  f =  <span class="number">0.5587018771874006</span></span><br><span class="line">Entity <span class="built_in">type</span>:  ORG p =  <span class="number">0.3224043715846995</span>  r =  <span class="number">0.14064362336114422</span>  f =  <span class="number">0.19585062240663903</span></span><br><span class="line">Entity <span class="built_in">type</span>:  OTHER p =  <span class="number">0.21115537848605578</span>  r =  <span class="number">0.07300275482093664</span>  f =  <span class="number">0.10849539406345958</span></span><br><span class="line">Entity <span class="built_in">type</span>:  <span class="built_in">all</span> p =  <span class="number">0.5495521525570645</span>  r =  <span class="number">0.37455691217014575</span>  f =  <span class="number">0.4454854198383886</span></span><br><span class="line">Test: time: <span class="number">164.62</span>s, speed: <span class="number">19.79</span>st/s; acc: <span class="number">0.8910</span>, p: <span class="number">0.5496</span>, r: <span class="number">0.3746</span>, f: <span class="number">0.4455</span></span><br><span class="line">Epoch: <span class="number">8</span>/<span class="number">200</span></span><br><span class="line">Shuffle: first <span class="built_in">input</span> word <span class="built_in">list</span>: [<span class="number">16404</span>, <span class="number">27804</span>, <span class="number">133</span>, <span class="number">2270</span>, <span class="number">22332</span>, <span class="number">12294</span>, <span class="number">1120</span>, <span class="number">1162</span>, <span class="number">13930</span>, <span class="number">1172</span>, <span class="number">1219</span>, <span class="number">1</span>, <span class="number">1207</span>, <span class="number">1120</span>, <span class="number">172</span>, <span class="number">1592</span>, <span class="number">1122</span>, <span class="number">1</span>, <span class="number">134</span>, <span class="number">1996</span>, <span class="number">1459</span>, <span class="number">121</span>, <span class="number">1</span>]</span><br><span class="line">     Instance: <span class="number">500</span>; Time: <span class="number">29.40</span>s; loss: <span class="number">1500.0947</span>; acc: <span class="number">7753.0</span>/<span class="number">8222.0</span>=<span class="number">0.9430</span></span><br><span class="line">     Instance: <span class="number">1000</span>; Time: <span class="number">30.68</span>s; loss: <span class="number">1290.2961</span>; acc: <span class="number">15464.0</span>/<span class="number">16321.0</span>=<span class="number">0.9475</span></span><br><span class="line">     Instance: <span class="number">1500</span>; Time: <span class="number">29.51</span>s; loss: <span class="number">1245.8867</span>; acc: <span class="number">23026.0</span>/<span class="number">24264.0</span>=<span class="number">0.9490</span></span><br><span class="line">     Instance: <span class="number">2000</span>; Time: <span class="number">29.63</span>s; loss: <span class="number">1382.7658</span>; acc: <span class="number">30645.0</span>/<span class="number">32303.0</span>=<span class="number">0.9487</span></span><br><span class="line">     Instance: <span class="number">2500</span>; Time: <span class="number">29.91</span>s; loss: <span class="number">1293.4902</span>; acc: <span class="number">38094.0</span>/<span class="number">40156.0</span>=<span class="number">0.9487</span></span><br><span class="line">     Instance: <span class="number">3000</span>; Time: <span class="number">30.16</span>s; loss: <span class="number">1493.9564</span>; acc: <span class="number">45823.0</span>/<span class="number">48353.0</span>=<span class="number">0.9477</span></span><br><span class="line">     Instance: <span class="number">3500</span>; Time: <span class="number">30.00</span>s; loss: <span class="number">1226.3321</span>; acc: <span class="number">53555.0</span>/<span class="number">56449.0</span>=<span class="number">0.9487</span></span><br><span class="line">     Instance: <span class="number">4000</span>; Time: <span class="number">29.79</span>s; loss: <span class="number">1395.7184</span>; acc: <span class="number">61117.0</span>/<span class="number">64439.0</span>=<span class="number">0.9484</span></span><br><span class="line">     Instance: <span class="number">4000</span>; Time: <span class="number">0.06</span>s; loss: <span class="number">0.0000</span>; acc: <span class="number">61117.0</span>/<span class="number">64439.0</span>=<span class="number">0.9484</span></span><br><span class="line">Epoch: <span class="number">8</span> training finished. Time: <span class="number">239.13</span>s, speed: <span class="number">16.73</span>st/s,  total loss: <span class="number">10828.540405273438</span></span><br><span class="line">totalloss: <span class="number">10828.540405273438</span></span><br><span class="line">Entity <span class="built_in">type</span>:  PER p =  <span class="number">0.5115452930728241</span>  r =  <span class="number">0.5217391304347826</span>  f =  <span class="number">0.516591928251121</span></span><br><span class="line">Entity <span class="built_in">type</span>:  LOC p =  <span class="number">0.5262267343485617</span>  r =  <span class="number">0.5957854406130269</span>  f =  <span class="number">0.5588499550763701</span></span><br><span class="line">Entity <span class="built_in">type</span>:  ORG p =  <span class="number">0.26174496644295303</span>  r =  <span class="number">0.15789473684210525</span>  f =  <span class="number">0.19696969696969696</span></span><br><span class="line">Entity <span class="built_in">type</span>:  OTHER p =  <span class="number">0.22857142857142856</span>  r =  <span class="number">0.10666666666666667</span>  f =  <span class="number">0.14545454545454548</span></span><br><span class="line">Entity <span class="built_in">type</span>:  <span class="built_in">all</span> p =  <span class="number">0.47017045454545453</span>  r =  <span class="number">0.4282018111254851</span>  f =  <span class="number">0.4482058226134055</span></span><br><span class="line">Dev: time: <span class="number">50.97</span>s, speed: <span class="number">19.63</span>st/s; acc: <span class="number">0.8847</span>, p: <span class="number">0.4702</span>, r: <span class="number">0.4282</span>, f: <span class="number">0.4482</span></span><br><span class="line">Entity <span class="built_in">type</span>:  PER p =  <span class="number">0.5379000561482313</span>  r =  <span class="number">0.5275330396475771</span>  f =  <span class="number">0.532666110647762</span></span><br><span class="line">Entity <span class="built_in">type</span>:  LOC p =  <span class="number">0.49923352069494126</span>  r =  <span class="number">0.5757218621096052</span>  f =  <span class="number">0.5347564313081555</span></span><br><span class="line">Entity <span class="built_in">type</span>:  ORG p =  <span class="number">0.2565789473684211</span>  r =  <span class="number">0.1394517282479142</span>  f =  <span class="number">0.18069498069498072</span></span><br><span class="line">Entity <span class="built_in">type</span>:  OTHER p =  <span class="number">0.15233415233415235</span>  r =  <span class="number">0.08539944903581267</span>  f =  <span class="number">0.10944395410414828</span></span><br><span class="line">Entity <span class="built_in">type</span>:  <span class="built_in">all</span> p =  <span class="number">0.4594653336231254</span>  r =  <span class="number">0.41630563213863725</span>  f =  <span class="number">0.4368219857423287</span></span><br><span class="line">Test: time: <span class="number">164.89</span>s, speed: <span class="number">19.76</span>st/s; acc: <span class="number">0.8822</span>, p: <span class="number">0.4595</span>, r: <span class="number">0.4163</span>, f: <span class="number">0.4368</span></span><br><span class="line">Epoch: <span class="number">9</span>/<span class="number">200</span></span><br><span class="line">Shuffle: first <span class="built_in">input</span> word <span class="built_in">list</span>: [<span class="number">1</span>, <span class="number">1</span>, <span class="number">133</span>, <span class="number">1</span>, <span class="number">1107</span>, <span class="number">1</span>, <span class="number">6261</span>, <span class="number">1109</span>, <span class="number">2920</span>, <span class="number">5540</span>, <span class="number">1</span>, <span class="number">1</span>]</span><br><span class="line">     Instance: <span class="number">500</span>; Time: <span class="number">30.09</span>s; loss: <span class="number">1083.1557</span>; acc: <span class="number">7904.0</span>/<span class="number">8241.0</span>=<span class="number">0.9591</span></span><br><span class="line">     Instance: <span class="number">1000</span>; Time: <span class="number">30.06</span>s; loss: <span class="number">995.9841</span>; acc: <span class="number">15636.0</span>/<span class="number">16281.0</span>=<span class="number">0.9604</span></span><br><span class="line">     Instance: <span class="number">1500</span>; Time: <span class="number">30.15</span>s; loss: <span class="number">1218.5723</span>; acc: <span class="number">23346.0</span>/<span class="number">24372.0</span>=<span class="number">0.9579</span></span><br><span class="line">     Instance: <span class="number">2000</span>; Time: <span class="number">29.93</span>s; loss: <span class="number">1242.2437</span>; acc: <span class="number">30978.0</span>/<span class="number">32377.0</span>=<span class="number">0.9568</span></span><br><span class="line">     Instance: <span class="number">2500</span>; Time: <span class="number">29.86</span>s; loss: <span class="number">1230.1059</span>; acc: <span class="number">38729.0</span>/<span class="number">40510.0</span>=<span class="number">0.9560</span></span><br><span class="line">     Instance: <span class="number">3000</span>; Time: <span class="number">29.80</span>s; loss: <span class="number">1201.8482</span>; acc: <span class="number">46245.0</span>/<span class="number">48393.0</span>=<span class="number">0.9556</span></span><br><span class="line">     Instance: <span class="number">3500</span>; Time: <span class="number">29.91</span>s; loss: <span class="number">1103.6714</span>; acc: <span class="number">54074.0</span>/<span class="number">56565.0</span>=<span class="number">0.9560</span></span><br><span class="line">     Instance: <span class="number">4000</span>; Time: <span class="number">30.14</span>s; loss: <span class="number">1202.2198</span>; acc: <span class="number">61587.0</span>/<span class="number">64439.0</span>=<span class="number">0.9557</span></span><br><span class="line">     Instance: <span class="number">4000</span>; Time: <span class="number">0.06</span>s; loss: <span class="number">0.0000</span>; acc: <span class="number">61587.0</span>/<span class="number">64439.0</span>=<span class="number">0.9557</span></span><br><span class="line">Epoch: <span class="number">9</span> training finished. Time: <span class="number">239.99</span>s, speed: <span class="number">16.67</span>st/s,  total loss: <span class="number">9277.801086425781</span></span><br><span class="line">totalloss: <span class="number">9277.801086425781</span></span><br><span class="line">Entity <span class="built_in">type</span>:  PER p =  <span class="number">0.5233644859813084</span>  r =  <span class="number">0.5072463768115942</span>  f =  <span class="number">0.5151793928242869</span></span><br><span class="line">Entity <span class="built_in">type</span>:  LOC p =  <span class="number">0.579476861167002</span>  r =  <span class="number">0.5517241379310345</span>  f =  <span class="number">0.5652600588812562</span></span><br><span class="line">Entity <span class="built_in">type</span>:  ORG p =  <span class="number">0.47619047619047616</span>  r =  <span class="number">0.08097165991902834</span>  f =  <span class="number">0.1384083044982699</span></span><br><span class="line">Entity <span class="built_in">type</span>:  OTHER p =  <span class="number">0.14814814814814814</span>  r =  <span class="number">0.10666666666666667</span>  f =  <span class="number">0.12403100775193798</span></span><br><span class="line">Entity <span class="built_in">type</span>:  <span class="built_in">all</span> p =  <span class="number">0.49514563106796117</span>  r =  <span class="number">0.3958602846054334</span>  f =  <span class="number">0.4399712437095615</span></span><br><span class="line">Dev: time: <span class="number">50.59</span>s, speed: <span class="number">19.77</span>st/s; acc: <span class="number">0.8872</span>, p: <span class="number">0.4951</span>, r: <span class="number">0.3959</span>, f: <span class="number">0.4400</span></span><br><span class="line">Entity <span class="built_in">type</span>:  PER p =  <span class="number">0.5225843339050886</span>  r =  <span class="number">0.5033039647577092</span>  f =  <span class="number">0.5127629733520337</span></span><br><span class="line">Entity <span class="built_in">type</span>:  LOC p =  <span class="number">0.5494571773220748</span>  r =  <span class="number">0.5368296994696523</span>  f =  <span class="number">0.5430700447093889</span></span><br><span class="line">Entity <span class="built_in">type</span>:  ORG p =  <span class="number">0.4962962962962963</span>  r =  <span class="number">0.07985697258641239</span>  f =  <span class="number">0.1375770020533881</span></span><br><span class="line">Entity <span class="built_in">type</span>:  OTHER p =  <span class="number">0.13620071684587814</span>  r =  <span class="number">0.1046831955922865</span>  f =  <span class="number">0.11838006230529596</span></span><br><span class="line">Entity <span class="built_in">type</span>:  <span class="built_in">all</span> p =  <span class="number">0.48</span>  r =  <span class="number">0.3875541551792044</span>  f =  <span class="number">0.42885160165613423</span></span><br><span class="line">Test: time: <span class="number">165.73</span>s, speed: <span class="number">19.66</span>st/s; acc: <span class="number">0.8854</span>, p: <span class="number">0.4800</span>, r: <span class="number">0.3876</span>, f: <span class="number">0.4289</span></span><br></pre></td></tr></tbody></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">zxr</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://xurui314.github.io/2022/06/01/Multimodal-NER/">https://xurui314.github.io/2022/06/01/Multimodal-NER/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Python/">Python</a><a class="post-meta__tags" href="/tags/Deep-Learning/">Deep Learning</a></div><div class="post_share"><div class="social-share" data-image="https://s2.loli.net/2022/06/01/NGZoMHJQIyVS5Ab.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer=""></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/2022/05/29/%E6%91%B8%E9%B1%BC%E5%AD%A6%E6%96%B9%E6%B3%95%E8%AE%BA/"><img class="next-cover" src="https://s2.loli.net/2022/05/29/KyGgICA235bBLov.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">æ‘¸é±¼å­¦æ–¹æ³•è®º</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2021/08/15/ä¸¤å±‚ç¥ç»ç½‘ç»œè¯†åˆ«æ‰‹å†™æ•°å­—/" title="ä¸¤å±‚ç¥ç»ç½‘ç»œè¯†åˆ«æ‰‹å†™æ•°å­—"><img class="cover" src="https://i.loli.net/2021/08/15/NYcSXrECnvzOiLP.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-08-15</div><div class="title">ä¸¤å±‚ç¥ç»ç½‘ç»œè¯†åˆ«æ‰‹å†™æ•°å­—</div></div></a></div><div><a href="/2021/08/14/ç¥ç»ç½‘ç»œæ­å»ºå‡†å¤‡å†…å®¹/" title="ç¥ç»ç½‘ç»œæ­å»ºå‡†å¤‡å†…å®¹"><img class="cover" src="https://i.loli.net/2021/08/15/F8aP7R36IidpCt5.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-08-14</div><div class="title">ç¥ç»ç½‘ç»œæ­å»ºå‡†å¤‡å†…å®¹</div></div></a></div><div><a href="/2022/01/14/Machine-Learning-Coding/" title="Machine Learning Code"><img class="cover" src="https://s2.loli.net/2022/01/14/LaGcAPJX9QpgTBH.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-01-14</div><div class="title">Machine Learning Code</div></div></a></div><div><a href="/2022/02/10/MIT-ML/" title="MIT ML"><img class="cover" src="https://s2.loli.net/2022/01/14/ftJD3kOcUnPHpzN.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-02-10</div><div class="title">MIT ML</div></div></a></div></div></div><hr><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comment</span></div><div id="comment-switch"><span class="first-comment">Valine</span><span class="switch-btn"></span><span class="second-comment">Disqus</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div><div><div id="disqus_thread"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://s2.loli.net/2021/12/08/yTYthVwXD4IPbJ9.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"></div><div class="author-info__name">zxr</div><div class="author-info__description">Think and Do like an MIT student</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">47</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">23</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">12</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/XuRui314"><i class="fab fa-github"></i><span>This is zxr!ğŸš€</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/XuRui314" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="https://mail.qq.com/" target="_blank" title="Email-1977289398@qq.com"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>Announcement</span></div><div class="announcement_content">zxrçš„ç”Ÿæ´»ï¼Œmathï¼Œç¼–ç¨‹è®°å½•,<div class="twopeople"><div class="container" style="height:200px;"><canvas class="illo" width="800" height="800" style="max-width: 200px; max-height: 200px; touch-action: none; width: 640px; height: 640px;"></canvas></div><script src="https://cdn.jsdelivr.net/gh/Justlovesmile/CDN/js/twopeople1.js"></script><script src="https://cdn.jsdelivr.net/gh/Justlovesmile/CDN/js/zdog.dist.js"></script><script id="rendered-js" src="https://cdn.jsdelivr.net/gh/Justlovesmile/CDN/js/twopeople.js"></script><style>.twopeople{margin: 0;align-items: center;justify-content: center;text-align: center;}canvas{display: block;margin: 0 auto;cursor: move;}</style></div><div class="twopeople"></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0-amp-%E5%8E%9F%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.</span> <span class="toc-text">æ¦‚è¿°&amp;åŸæ¨¡å‹</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%99%E5%9C%A8%E5%BC%80%E5%A7%8B"><span class="toc-number">1.1.</span> <span class="toc-text">å†™åœ¨å¼€å§‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A6%96%E5%85%88%E4%BB%8Emain-py%E5%BC%80%E5%A7%8B"><span class="toc-number">1.2.</span> <span class="toc-text">é¦–å…ˆä»main.pyå¼€å§‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84"><span class="toc-number">1.3.</span> <span class="toc-text">æ•´ä½“æ¶æ„</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%B7%A5%E7%A8%8B"><span class="toc-number">1.3.1.</span> <span class="toc-text">å¦‚ä½•åˆ›å»ºä¸€ä¸ªå·¥ç¨‹</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%8A%A0%E8%BD%BD"><span class="toc-number">1.3.1.1.</span> <span class="toc-text">æ•°æ®åŠ è½½</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E-init-py"><span class="toc-number">1.3.1.2.</span> <span class="toc-text">å…³äº_init_.py</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.3.1.3.</span> <span class="toc-text">æ¨¡å‹</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86"><span class="toc-number">1.4.</span> <span class="toc-text">æ•°æ®å¤„ç†</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Alphabet%E6%9E%84%E5%BB%BA"><span class="toc-number">1.4.1.</span> <span class="toc-text">Alphabetæ„å»º</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Embedding%E6%9E%84%E5%BB%BA"><span class="toc-number">1.4.2.</span> <span class="toc-text">Embeddingæ„å»º</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E5%9E%8B%E8%AE%AD%E7%BB%83-amp-%E8%AF%84%E4%BC%B0"><span class="toc-number">1.5.</span> <span class="toc-text">æ¨¡å‹è®­ç»ƒ&amp;è¯„ä¼°</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%94%B9%E6%A8%A1%E5%9E%8B"><span class="toc-number">2.</span> <span class="toc-text">æ”¹æ¨¡å‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%8D%E8%A1%A8%E5%A4%84%E7%90%86"><span class="toc-number">2.0.1.</span> <span class="toc-text">è¯è¡¨å¤„ç†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E5%9E%8B%E6%9B%B4%E6%8D%A2"><span class="toc-number">2.0.2.</span> <span class="toc-text">æ¨¡å‹æ›´æ¢</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9B%BF%E6%8D%A2%E4%B8%BABert"><span class="toc-number">2.0.2.1.</span> <span class="toc-text">æ›¿æ¢ä¸ºBert</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%A0%E5%85%A5%E5%A4%9A%E6%A8%A1%E6%80%81%E4%BF%A1%E6%81%AF"><span class="toc-number">2.0.2.2.</span> <span class="toc-text">åŠ å…¥å¤šæ¨¡æ€ä¿¡æ¯</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%81%87%E5%88%B0%E7%9A%84bug"><span class="toc-number">2.1.</span> <span class="toc-text">é‡åˆ°çš„bug</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#colab%E6%89%93%E5%BC%80%E6%96%87%E4%BB%B6"><span class="toc-number">2.1.1.</span> <span class="toc-text">colabæ‰“å¼€æ–‡ä»¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Torch-Tensor%E6%94%BE%E5%9C%A8GPU%E4%B8%8A"><span class="toc-number">2.1.2.</span> <span class="toc-text">Torch Tensoræ”¾åœ¨GPUä¸Š</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A2%AF%E5%BA%A6NAN"><span class="toc-number">2.1.3.</span> <span class="toc-text">æ¢¯åº¦NAN</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#p%EF%BC%8Cr%EF%BC%8Cf%E7%9A%84%E5%80%BC%E9%97%AE%E9%A2%98"><span class="toc-number">2.1.4.</span> <span class="toc-text">pï¼Œrï¼Œfçš„å€¼é—®é¢˜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#index%E8%B6%8A%E7%95%8C"><span class="toc-number">2.1.5.</span> <span class="toc-text">indexè¶Šç•Œ</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/06/01/Multimodal-NER/" title="Multimodal NER"><img src="https://s2.loli.net/2022/06/01/NGZoMHJQIyVS5Ab.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Multimodal NER"></a><div class="content"><a class="title" href="/2022/06/01/Multimodal-NER/" title="Multimodal NER">Multimodal NER</a><time datetime="2022-06-01T15:26:34.000Z" title="Created 2022-06-01 23:26:34">2022-06-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/05/29/%E6%91%B8%E9%B1%BC%E5%AD%A6%E6%96%B9%E6%B3%95%E8%AE%BA/" title="æ‘¸é±¼å­¦æ–¹æ³•è®º"><img src="https://s2.loli.net/2022/05/29/KyGgICA235bBLov.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="æ‘¸é±¼å­¦æ–¹æ³•è®º"></a><div class="content"><a class="title" href="/2022/05/29/%E6%91%B8%E9%B1%BC%E5%AD%A6%E6%96%B9%E6%B3%95%E8%AE%BA/" title="æ‘¸é±¼å­¦æ–¹æ³•è®º">æ‘¸é±¼å­¦æ–¹æ³•è®º</a><time datetime="2022-05-29T04:11:29.000Z" title="Created 2022-05-29 12:11:29">2022-05-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/03/17/%E5%B9%B2%E4%B8%80%E7%A5%A8%E5%A4%A7%E7%9A%84/" title="æ¬²æˆ´ç‹å† ï¼Œå¿…æ‰¿å…¶é‡"><img src="https://s2.loli.net/2022/03/17/M1x5EhUukRDGXOQ.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="æ¬²æˆ´ç‹å† ï¼Œå¿…æ‰¿å…¶é‡"></a><div class="content"><a class="title" href="/2022/03/17/%E5%B9%B2%E4%B8%80%E7%A5%A8%E5%A4%A7%E7%9A%84/" title="æ¬²æˆ´ç‹å† ï¼Œå¿…æ‰¿å…¶é‡">æ¬²æˆ´ç‹å† ï¼Œå¿…æ‰¿å…¶é‡</a><time datetime="2022-03-17T09:17:26.000Z" title="Created 2022-03-17 17:17:26">2022-03-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/02/22/%E8%BF%91%E5%86%B5/" title="è¿‘å†µ"><img src="https://s2.loli.net/2022/02/22/Oi1w2nGkaCtg8To.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="è¿‘å†µ"></a><div class="content"><a class="title" href="/2022/02/22/%E8%BF%91%E5%86%B5/" title="è¿‘å†µ">è¿‘å†µ</a><time datetime="2022-02-22T12:08:27.000Z" title="Created 2022-02-22 20:08:27">2022-02-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/02/10/MIT-ML/" title="MIT ML"><img src="https://s2.loli.net/2022/01/14/ftJD3kOcUnPHpzN.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MIT ML"></a><div class="content"><a class="title" href="/2022/02/10/MIT-ML/" title="MIT ML">MIT ML</a><time datetime="2022-02-10T02:17:30.000Z" title="Created 2022-02-10 10:17:30">2022-02-10</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">Â©2020 - 2022 By zxr</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="github-badge"><a style="color: #fff" rel="license" href="https://hexo.io/" target="_blank" title="ç”± Hexo å¼ºåŠ›é©±åŠ¨"><span class="badge-subject">Powered</span><span class="badge-value bg-blue">Hexo</span></a><a style="color: #fff" rel="license" href="https://gitee.com/" target="_blank" title="é™æ€ç½‘é¡µæ‰˜ç®¡äº GitHub Pages å’Œ Coding Pages å’Œ Gitee Pages"><span class="badge-subject">Hosted</span><span class="badge-value bg-brightgreen">GitHub &amp; Coding &amp; Gitee</span></a><a style="color: #fff" rel="license" href="https://www.jsdelivr.com/" target="_blank" title="jsDelivr æä¾› CDN åŠ é€ŸæœåŠ¡"><span class="badge-subject">CDN</span><span class="badge-value bg-orange">jsDelivr</span></a><a style="color: #fff" rel="license" href="https://jerryc.me" target="_blank" title="ç«™ç‚¹ä½¿ç”¨ Butterflyä¸»é¢˜"><span class="badge-subject">Theme</span><span class="badge-value bg-blue">Butterfly</span></a><a style="color: #fff" rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" title="æœ¬ç«™ç‚¹é‡‡ç”¨çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…è®¸å¯åè®®è¿›è¡Œè®¸å¯"><span class="badge-subject"><i class="fa fa-copyright"></i></span><span class="badge-value bg-lightgrey">BY-NC-SA 4.0  </span></a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="font-plus" type="button" title="Increase font size"><i class="fas fa-plus"></i></button><button id="font-minus" type="button" title="Decrease font size"><i class="fas fa-minus"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="Scroll To Comments"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.2
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container:not\([display]\)').forEach(node => {
            const target = node.parentNode
            if (target.nodeName.toLowerCase() === 'li') {
              target.parentNode.classList.add('has-jax')
            } else {
              target.classList.add('has-jax')
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = '[object Object]'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typeset()
}</script><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '',
      appKey: '',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script><script>function loadDisqus () {
  var disqus_config = function () {
    this.page.url = 'https://xurui314.github.io/2022/06/01/Multimodal-NER/'
    this.page.identifier = '2022/06/01/Multimodal-NER/'
    this.page.title = 'Multimodal NER'
  };

  window.disqusReset = () => {
    DISQUS.reset({
      reload: true,
      config: disqus_config
    })
  }

  if (window.DISQUS) disqusReset()
  else {
    (function() { 
      var d = document, s = d.createElement('script');
      s.src = 'https://.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  }
}

if ('Valine' === 'Disqus' || !false) {
  if (false) btf.loadComment(document.getElementById('disqus_thread'), loadDisqus)
  else loadDisqus()
} else {
  function loadOtherComment () {
    loadDisqus()
  }
}
</script></div><script src="https://cdn.jsdelivr.net/gh/XuRui314/live2d-widget@1.0.1/autoload.js"></script><script src="/js/title.js"></script><script src="/dist/nochocolate.js"></script><div id="aplayer"></div><script type="text/javascript" src="/dist/APlayer.min.js"></script><script type="text/javascript" src="/dist/music.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/gh/metowolf/MetingJS@1.2/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = [
  'title',
  '#config-diff',
  '#body-wrap',
  '#rightside-config-hide',
  '#rightside-config-show',
  '.js-pjax'
]

if (false) {
  pjaxSelectors.unshift('meta[property="og:image"]', 'meta[property="og:title"]', 'meta[property="og:url"]')
}

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.removeEventListener('scroll', window.tocScrollFn)
  window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // Analytics
  if (false) {
    MtaH5.pgv()
  }

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async="" data-pjax="" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --> <script data-pjax="">if(document.getElementById('recent-posts') && (location.pathname ==='all'|| 'all' ==='all')){
    var parent = document.getElementById('recent-posts');
    var child = '<div class="recent-post-item" style="width:100%;height: auto"><div id="catalog_magnet"><div class="magnet_item"><a class="magnet_link" href="https://XuRui314.github.io/categories/Math/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ“š zxrã®æ•°å­¦ä¸–ç•Œ (11)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://XuRui314.github.io/categories/ç®—æ³•å­¦ä¹ /"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ® zxrã®ç®—æ³•å­¦ä¹  (5)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://XuRui314.github.io/categories/ç”Ÿæ´»è¶£é—»/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ±â€ğŸ‘“ zxrã®ç”Ÿæ´»è¶£é—» (4)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://XuRui314.github.io/categories/ç¼–ç¨‹å®ä¾‹/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ‘©â€ğŸ’» zxrã®ç¼–ç¨‹å­¦ä¹  (4)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://XuRui314.github.io/categories/ç”Ÿæ´»æ„Ÿæ‚Ÿ/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸš´â€â™‚ zxrã®ç”Ÿæ´»æ„Ÿæ‚Ÿ (9)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://XuRui314.github.io/categories/Hexo/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ’Œ zxrã®Blogè®°å½• (1)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><a class="magnet_link_more"  href="https://XuRui314.github.io/categories" style="flex:1;text-align: center;margin-bottom: 10px;">æŸ¥çœ‹æ›´å¤š...</a></div></div>';
    console.log('å·²æŒ‚è½½magnet')
    parent.insertAdjacentHTML("afterbegin",child)}
     </script><style>#catalog_magnet{flex-wrap: wrap;display: flex;width:100%;justify-content:space-between;padding: 10px 10px 0 10px;align-content: flex-start;}.magnet_item{flex-basis: calc(50% - 5px);background: #f2f2f2;margin-bottom: 10px;border-radius: 8px;transition: all 0.2s ease-in-out;}.magnet_item:hover{background: #b30070}.magnet_link_more{color:#555}.magnet_link{color:black}.magnet_link:hover{color:white}@media screen and (max-width: 600px) {.magnet_item {flex-basis: 100%;}}.magnet_link_context{display:flex;padding: 10px;font-size:16px;transition: all 0.2s ease-in-out;}.magnet_link_context:hover{padding: 10px 20px;}</style>
    <style></style> <script data-pjax="">if(document.getElementById('recent-posts') && location.pathname =='/'){
    
    var parent = document.getElementById('recent-posts');
    var child = '<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src="https://i.loli.net/2021/09/17/9H5WSbTrVejOdkz.jpg" alt="https://i.loli.net/2021/09/17/9H5WSbTrVejOdkz.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2021-09-17</span><a class="blog-slider__title" href="2021/09/17/æ¦‚ç‡å’Œæµ‹åº¦/">æ¦‚ç‡å’Œæµ‹åº¦(ZJUå¤§ä½¬)</a><div class="blog-slider__text">æ¥çœ‹çœ‹ZJUè®¡ç§‘å¤§ä½¬è§£é‡Šæ¦‚ç‡å’Œæµ‹åº¦ğŸ¥™</div><a class="blog-slider__button" href="2021/09/17/æ¦‚ç‡å’Œæµ‹åº¦/">è¯¦æƒ…</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src="https://i.loli.net/2021/08/25/bPy5m3j9QAilwr2.jpg" alt="https://i.loli.net/2021/08/25/bPy5m3j9QAilwr2.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2021-08-26</span><a class="blog-slider__title" href="2021/08/26/ç®—æ³•é¢˜ç›®ç»ƒä¹ /">AcWing-Oj-åˆ·é¢˜å­¦ä¹ è®°å½•(åŸºç¡€ç®—æ³•)</a><div class="blog-slider__text">æ¥çœ‹ç®—æ³•è’Ÿè’»çš„ä¸¢äººæ—¥å¸¸å•ŠğŸ‘©â€ğŸ¦½</div><a class="blog-slider__button" href="2021/08/26/ç®—æ³•é¢˜ç›®ç»ƒä¹ /">è¯¦æƒ…</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src="https://i.loli.net/2021/08/15/NYcSXrECnvzOiLP.jpg" alt="https://i.loli.net/2021/08/15/NYcSXrECnvzOiLP.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2021-08-15</span><a class="blog-slider__title" href="2021/08/15/ä¸¤å±‚ç¥ç»ç½‘ç»œè¯†åˆ«æ‰‹å†™æ•°å­—/">ä¸¤å±‚ç¥ç»ç½‘ç»œè¯†åˆ«æ‰‹å†™æ•°å­—</a><div class="blog-slider__text">è¯†åˆ«æ‰‹å†™æ•°å­—æœ€ç®€å•çš„å®ç°ğŸ§¦</div><a class="blog-slider__button" href="2021/08/15/ä¸¤å±‚ç¥ç»ç½‘ç»œè¯†åˆ«æ‰‹å†™æ•°å­—/">è¯¦æƒ…</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src="https://i.loli.net/2021/08/15/F8aP7R36IidpCt5.jpg" alt="https://i.loli.net/2021/08/15/F8aP7R36IidpCt5.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2021-08-14</span><a class="blog-slider__title" href="2021/08/14/ç¥ç»ç½‘ç»œæ­å»ºå‡†å¤‡å†…å®¹/">ç¥ç»ç½‘ç»œæ­å»ºå‡†å¤‡å†…å®¹</a><div class="blog-slider__text">å¦‚ä½•è¯†åˆ«æ‰‹å†™ğŸ”¢ï¼Œzxrå¸¦ä½ ä¸€æ­¥ä¸€æ­¥å®ç°ğŸ¼</div><a class="blog-slider__button" href="2021/08/14/ç¥ç»ç½‘ç»œæ­å»ºå‡†å¤‡å†…å®¹/">è¯¦æƒ…</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src="https://i.loli.net/2021/08/12/SJs3MgYC7x8IU26.jpg" alt="https://i.loli.net/2021/08/12/SJs3MgYC7x8IU26.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2021-08-12</span><a class="blog-slider__title" href="2021/08/12/xuperchain-solidity/">xuperchain&solidity</a><div class="blog-slider__text">åŒºå—é“¾ä¸æ­¢æ˜¯æŒ–å¸ï¼Œè¿˜æœ‰vç¥å’ŒsolidityğŸˆ</div><a class="blog-slider__button" href="2021/08/12/xuperchain-solidity/">è¯¦æƒ…</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src="https://i.loli.net/2021/07/27/6fy8mTCbAOWPkrq.png" alt="https://i.loli.net/2021/07/27/6fy8mTCbAOWPkrq.png"/></div><div class="blog-slider__content"><span class="blog-slider__code">2021-07-26</span><a class="blog-slider__title" href="2021/07/26/FFT/">FFTçš„è¯¦è§£</a><div class="blog-slider__text">è¿™ä¹ˆå¥½çœ‹çš„FFTï¼Œä¿¡å·ç‹—éƒ½é¦‹å“­äº†ğŸ’¦</div><a class="blog-slider__button" href="2021/07/26/FFT/">è¯¦æƒ…</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src="https://i.loli.net/2021/08/09/zdt4YKoehQvR96S.jpg" alt="https://i.loli.net/2021/08/09/zdt4YKoehQvR96S.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2021-08-09</span><a class="blog-slider__title" href="2021/08/09/ç‚’é¸¡å¥½ç†è§£çš„æµ‹åº¦è®º/">ç‚’é¸¡å¥½ç†è§£çš„æµ‹åº¦è®º</a><div class="blog-slider__text">ä¸‰æ®µå­—ï¼Œè®©ä½ è¯»æ‡‚æµ‹åº¦è®º</div><a class="blog-slider__button" href="2021/08/09/ç‚’é¸¡å¥½ç†è§£çš„æµ‹åº¦è®º/">è¯¦æƒ…</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src="https://i.loli.net/2021/08/12/wF7TJlqxOLEWGQk.png" alt="https://i.loli.net/2021/08/12/wF7TJlqxOLEWGQk.png"/></div><div class="blog-slider__content"><span class="blog-slider__code">2021-07-27</span><a class="blog-slider__title" href="2021/07/27/FT/">å‚…é‡Œå¶å­¦ä¹ èµ„æ–™</a><div class="blog-slider__text">ç®€å•å¥½å­¦çš„å‚…é‡Œå¶å­¦ä¹ èµ„æ–™</div><a class="blog-slider__button" href="2021/07/27/FT/">è¯¦æƒ…</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src="https://i.loli.net/2021/07/27/f7jO8hlNpzWVXSP.jpg" alt="https://i.loli.net/2021/07/27/f7jO8hlNpzWVXSP.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2021-07-26</span><a class="blog-slider__title" href="2021/07/26/hello-world/">å¤§é¸Ÿè½¬è½¬è½¬é…’å§å†…éƒ¨ç»å¯†æ¡£æ¡ˆ</a><div class="blog-slider__text">ä¸è¦ç‚¹è¿›æ¥QAQï¼</div><a class="blog-slider__button" href="2021/07/26/hello-world/">è¯¦æƒ…</a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';
    console.log('å·²æŒ‚è½½swiper')
    parent.insertAdjacentHTML("afterbegin",child)}
     </script>
<script data-pjax="" src="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-swiper/swiper/swiper.min.js"></script>
<script data-pjax="" src="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-swiper@0.18/swiper/swiperindex.js"></script>
<style></style><script data-pjax="">function electric_clock_injector_config(){
                var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
                var item_html = '<div class="card-widget card-clock"><div class="card-glass"><div class="card-background"><div class="card-content"><div id="hexo_electric_clock"><img id="card-clock-loading" src="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-clock/clock/images/weather/loading.gif" style="height: 120px; width: 100%;" data-ll-status="loading" class="entered loading"></div></div></div></div></div>';
                console.log('å·²æŒ‚è½½electric_clock')
                // parent_div_git.innerHTML=item_html+parent_div_git.innerHTML // æ— æŠ¥é”™ï¼Œä½†ä¸å½±å“ä½¿ç”¨(æ”¯æŒpjaxè·³è½¬)
                parent_div_git.insertAdjacentHTML("afterbegin",item_html) // æœ‰æŠ¥é”™ï¼Œä½†ä¸å½±å“ä½¿ç”¨(æ”¯æŒpjaxè·³è½¬)
            }if( document.getElementsByClassName('sticky_layout')[0] && (location.pathname ==='all'|| 'all' ==='all')){

            electric_clock_injector_config()
        } </script><script src="https://pv.sohu.com/cityjson?ie=utf-8"></script><script data-pjax="" src="https://cdn.jsdelivr.net/gh/Zfour/hexo-electric-clock@1.0.6/clock.js"></script>
  <script data-pjax="" src="https://cdn.jsdelivr.net/gh/Zfour/hexo-github-calendar@1.21/hexo_githubcalendar.js"></script>
  <script data-pjax="">
        function GithubCalendarConfig(){
            var git_githubapiurl ="https://python-github-calendar-api.vercel.app/api?XuRui314";
            var git_color =['#ebedf0', '#fdcdec', '#fc9bd9', '#fa6ac5', '#f838b2', '#f5089f', '#c4067e', '#92055e', '#540336', '#48022f', '#30021f'];
            var git_user ="XuRui314";
            var parent_div_git = document.getElementById('recent-posts');
            var git_div_html = '<div class="recent-post-item" style="width:100%;height:auto;padding:10px;"><div id="github_loading" style="height:100%;display: flex;align-items: center;justify-content: center;"><svg style="height:50px" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"  viewBox="0 0 50 50" style="enable-background:new 0 0 50 50" xml:space="preserve"><path fill="#d0d0d0" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z" transform="rotate(275.098 25 25)"><animateTransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animateTransform></path></svg></div><div id="github_container"></div></div>';
            if(parent_div_git && location.pathname =='/'){
                console.log('å·²æŒ‚è½½github calendar')
                // parent_div_git.innerHTML=git_div_html+parent_div_git.innerHTML // æ— æŠ¥é”™ï¼Œä½†ä¸å½±å“ä½¿ç”¨(æ”¯æŒpjaxè·³è½¬)
                parent_div_git.insertAdjacentHTML("afterbegin",git_div_html) // æœ‰æŠ¥é”™ï¼Œä½†ä¸å½±å“ä½¿ç”¨(æ”¯æŒpjaxè·³è½¬)
            };
            GithubCalendar(git_githubapiurl,git_color,git_user)
        }
        if(document.getElementById('recent-posts')){
            GithubCalendarConfig()
        }
    </script>
    <style>#github_container{min-height:248px}@media screen and (max-width:650px) {#github_container{background-image:;min-height:0px}}</style>
    <style></style><script async="" src="//at.alicdn.com/t/font_2032782_8d5kxvn09md.js"></script><!-- hexo injector body_end end --><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"live2d-widget-model-wanko"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"react":{"opacity":0.7},"log":false});</script></body></html>